(function(S){$.extend(String.prototype,{wrap:function(w){var s=w.split("");s[1]=s[1]||s[0];return[s[0],this,s[1]].join("")},unwrap:function(){var s=this;return s.slice(1,s.length-1)},is:function(s){return this==s},eq:function(s){return this==s},filter:function(chars){var s=this;if(chars){for(var key in chars){s=s.replace(chars[key],key)}}return s},ifNull:function(a,ifNull){return a==null?ifNull:a},isEmpty:function(){return this.trim()==""},json:function(){return this.eval(this)},eval:function(v,scope){try{with(scope||window){return eval("("+(v||this)+")")}}catch(e){warn&&console.warn(e.message);return null}},context:function(a,func){var ctxs=func.split(".");ctxs.pop();var ctx=ctxs.length>0?ctxs.join("."):null;ctx=ctx?this.format_dot_o(a,ctx):a;return ctx},format_dot_o:function(a,value){var func_reg=/([^\(]+)\(([^\)]+)\)/ig;if(func_reg.test(value)){var args=RegExp.$2;var func=RegExp.$1;var context=this.context(a,func);func=this.format_dot_o(a,func);func=typeof func=="function"?func:function(){return"{"+value+"}"};args=args.split(",");for(var i=0;i<args.length;i++){args[i]=this.format_dot_o(a,args[i])||args[i]}return value.eval()||func.apply(context,args)}else{var expression=value.match(/([^\.]+)/g);var v=a[expression[0]];for(var i=1;i<expression.length;i++){v=v&&v[expression[i]]}return this.ifNull(v,"".ifNull(this.eval(value,a),"{"+value+"}"))}},format_o:function(o){var string=this;return this.replace(/\{([^\{\}]+)\}/g,function(index,value){return string.format_dot_o(o,value)})},format_a:function(a){var string=this;return this.replace(/\{([^\{\}]+)\}/g,function(index,value){return string.format_dot_o(a,value)})},format:function(){var content=this;if(arguments.length>0){for(var i=0;i<arguments.length;i++){var o=arguments[i];if($.isArray(o)){content=content.format_a(o)}else{if(typeof o=="object"){content=content.format_o(o)}else{var a=[].slice.apply(arguments,[0,arguments.length]);content=content.format_a(a)}}}return content.replace(/\{([^}]+)\}/g,"")}else{return this}},eachf:function(arr,callback){var segs=[];for(var i=0;i<arr.length;i++){var model=arr[i],html;if(callback){html=callback(model,i,arr)}model=arr[i];segs.push(this.format(model))}return segs.join("")},trim:function(){return this.replace(/^\s*|\s*$/img,"")},prePad:function(l,p){var len=l-this.length;return len>0?Array(len+1).join(p)+this:this},hex:function(){var hex_arr=[],string=this;for(var i=0;i<string.length;i++){var char0=string.charCodeAt(i),hex=(char0).toString(16);hex_arr.push(hex)}return hex_arr},html:function(){return this.filter({"&amp;":/&/img,"&lt;":/</img,"&gt;":/>/img,"&nbsp;":/ /img,"&quot;":/"/img,"&#39;":/'/img})}});$.request=(new function(){var console=window.console||{};console.info=console.info||function(a){alert(a)};this.parameters={};this.init=function(search){var search=decodeURIComponent(search||"");if(search.indexOf("?")==0){search=search.substring(1)}var pa=search.split("&");for(var i=0;i<pa.length;i++){var kv=pa[i].split("=");this.parameters[kv[0]||""]=kv[1]||""}};this.parameters={};this.get=function(name){return this.parameters[name||""]||""};this.toString=function(){var string="";for(var a in this.parameters){string+=a+"-"+this.parameters[a]+"\n"}console.info(string)};var search=location.search.substring(1);this.init(search)});window.debug=$.request.get("debug")=="true";window.warn=$.request.get("warn")=="true";window.info=$.request.get("info")=="true";window.log=$.request.get("log")=="true";window.search_disable=$.request.get("search_disable")=="true";window.cart_disable=$.request.get("cart_disable")=="true";window.req=$.request.parameters;$.coookie=function(){var d=document;var cookies=d.cookie.split("; ");var date=new Date();var expiresFun="toGMTString";var o={expires:"",path:"/",domain:location.hostname,secure:false};var o2s=function(s){var ss=[];for(var n in s){ss.push(n+"="+s[n])}return ss.join("; ")};var s=function(n,v,ss){var set={};set[n]=escape(v);set=$.extend(set,ss||{});if(set&&set.expires){date.setTime(date.getTime()+set.expires);set.expires=date[expiresFun]()}console.info(o2s(set));document.cookie=o2s(set)};var g=function(n){var find=false;var v=null;for(var i=0;i<cookies.length;i++){cookie=cookies[i].split("=");var cn=cookie[0]||"";var cv=cookie[1]||"";if(cn==n){if(!find){v=unescape(cv)}find=true}}return v};var d=function(n,ss){s(n,null,$.extend({expires:-10000},ss||{}))};var l=function(){console.info(">>===========================");$.each(cookies,function(i,cookie){console.info(i+".	"+unescape(cookie))});console.info("<<===========================")};$.cokie=$.extend({},{s:s,g:g,d:d,l:l});return $.cokie};window.coookie=$.icoookie=$.coookie;var TemplateEngine=function(html,options){return TemplateEngine.compile(html).process(options)};TemplateEngine.config={tagMap:{src:/s-src/img,"lazy-src":/s-lazy-src/img}};TemplateEngine.makeTags=function(code){return code.filter(TemplateEngine.config.tagMap)};TemplateEngine.compile=function(html){var line_separator="$LINE$";html=html.replace(/\t+/img,"  ");html=html.replace(/\n+/img,line_separator);var re=/<%(.*?)%>/g,reExp=/((\bif\b|\bfor\b|\belse\b|\bswitch\b|\bcase\b|\bbreak\b|\breturn\b|{|}))(.*)?/g,code="",cursor=0;var add=function(line,js){line=$.trim(line);if(!line||line==line_separator){return add}window.debug&&console.debug(line,js);var match=line.match(reExp);js?(code+=match?line.replace(/\$LINE\$/img,"\r\n")+"\r\n":"r.push("+line+");\r\n"):(code+=line!=""?'r.push("'+line.replace(/\$LINE\$/img,"").replace(/"/g,'\\"')+'");\r\n':"");return add};while(match=re.exec(html)){window.debug&&console.debug(match);add(html.slice(cursor,match.index))(match[1],true);cursor=match.index+match[0].length}add(html.substr(cursor,html.length-cursor));code="var r=[];\n with(this){\n"+code+'}return r.join("");';code=TemplateEngine.makeTags(code.replace(/^\n+$/img,""));window.debug&&console.info("TemplateEngine.compile-code\n",code);return{tplFn:new Function(code),process:function(options){return this.tplFn.apply(options)}}};String.prototype.sara=function(data){return TemplateEngine(this,data).process()};String.prototype.compile=function(){return TemplateEngine.compile(this)};$.fn.saraDom=function(odata,otpl){var param=$(this).attrs("tpl"),tplElm=$("textarea[tpl={tpl}]".format(param)),ptpl=tplElm.val();var tpl=(otpl&&otpl.compile())||$(this).data("tpl");(ptpl&&!tpl)&&(tpl=ptpl.compile());tpl=tpl||($(this).html()||"").trim().filter({"<":/&lt;/img,">":/&gt;/img,"&":/&amp;/img,"":/\n/img}).compile();var data=odata||$(this).data("data");tpl&&$(this).data("tpl",tpl);$(this).show().empty();var tplHtml=tpl.process(data)||"";data&&!tplHtml.isEmpty()&&$(this).html(tplHtml);$("[s-click]",this).click(function(e){var action=$(this).attr("s-click");action.eval(action,data);return false});return $(this)};$.fn.sara=function(){var elm=this;var d=$(elm).attr("sara");var json=$(elm).attr("json");var jsonp=$(elm).attr("jsonp");d&&$(elm).saraDom(d.json());json&&$.get(json,function(data){data&&$(elm).saraDom(data)});jsonp&&$.ajax({url:jsonp,type:"GET",dataType:"jsonp",jsonpCallback:"sara",data:{},success:function(data){data&&$(elm).saraDom(data)},error:function(xhr,textStatus,thrown){}});$(elm).saraDom();return $(this)};$.fn.refresh=function(data,tpl){if($(this).size()>1){$(this).each(function(i,elm){data&&$(this).data("data",data);tpl&&$(this).data("tpl",tpl.compile());$(this).sara()})}else{data&&$(this).data("data",data);tpl&&$(this).data("tpl",tpl.compile());$(this).sara()}return $(this)};window.Pagination=function(total,pagesize,pageAction){var $page=this;$page.calculate=function(total,pagesize,pageAction){$.extend($page,{range:3,pageAction:pageAction||$page.pageAction||function(){},total:"".ifNull(total,$page.total||10),pagesize:"".ifNull(pagesize,$page.pagesize||10),page:"".ifNull($page.page,0)});var totalpage=Math.ceil($page.total/$page.pagesize);if(totalpage>100){totalpage=100}$page.totalpage=totalpage;$page.calculatePage()};$page.calculateRange=function(){$page.rangeList=[];var rangUp=Math.min(Math.ceil($page.range/2)+$page.page,$page.totalpage);var rangDown=Math.max(0,$page.page-Math.floor($page.range/2));for(var i=rangDown;i<rangUp;i++){$page.rangeList.push({pagei:i,page:(i+1),actived:i==$page.page})}};$page.calculatePage=function(){$page.page=Math.max(0,$page.page);$page.page=Math.min($page.page,$page.totalpage-1);$page.page=Math.max(0,$page.page);$page.start=$page.page*$page.pagesize;$page.end=($page.page+1)*$page.pagesize;if($page.page<=0){$page.prev.disabled=true}else{$page.prev.disabled=false}if($page.page>=($page.totalpage-1)){$page.next.disabled=true}else{$page.next.disabled=false}$page.calculateRange()};$page.gotopage=function(page){$page.page=(page||$("#gotopageText").val()-1||0)>($page.totalpage-1)?0:(page||$("#gotopageText").val()-1||0);$page.calculatePage();$page.pageAction()};$page.prev=function(){--$page.page;if(!$page.prev.disabled){$page.calculatePage();$page.pageAction()}};$page.next=function(){++$page.page;if(!$page.next.disabled){$page.calculatePage();$page.pageAction()}};$page.calculate(total,pagesize,pageAction)};window.$key=function(e){function k(e){this.e=e;var KeyMap={"ctrl+enter":function(e){var is=e.ctrlKey&&e.which==10;return is},"shit+enter":function(e){var is=e.shiftKey&&e.which==13;return is},enter:function(e){var enter=e.which==13;return enter},down:function(e){return e.keyCode==40},up:function(e){return e.keyCode==38},left:function(e){return e.keyCode==37},right:function(e){return e.keyCode==39},del:function(e){return e.keyCode==46}};var $k=this;$k.when=function(key,keyAction){var keyEvent=KeyMap[key];if(keyEvent&&keyEvent(this.e)){keyAction.apply(this,[this.e])}return this}}return new k(e)};var lazy_src="lazy-src";var l_blank="//imgssl.suning.com/images/ShoppingArea/Common/blank.gif";var lazy,l=lazy=S.LazyLoad={lazy_src:lazy_src,lazy_not_load:"img[{src}][{src}!=finish]".format({src:lazy_src}),blank:l_blank,holder:{blank:l_blank},filters:[],exec_filters:function(elm){var i=0;function next(){var filter=lazy.filters[i++];if(filter){filter.apply(elm,[i,elm,next])}}next()},filter_add:function(filter){lazy.filters.push(filter)},onerror:function(){debug&&console.debug("load img error");$(this).attr("error",this.src);var holder=$(this).attr("holder")||"";holder=l.holder[holder]||l.blank;holder=holder==this.src?l.blank:holder;this.src=holder},loadImg:function(elm){elm.onerror=lazy.onerror;lazy.exec_filters(elm);var src=elm.getAttribute(l.lazy_src);if(src){log&&console.log("lazy load image:"+src);elm.src=src;elm.setAttribute(l.lazy_src,"finish")}},load1screen:function(el){$(el||document.body).find(l.lazy_not_load).each(function(){var _this=$(this)[0];var top=Math.max(_this.offsetTop,$(this).offset().top);var height=window.innerHeight;debug&&console.info("{top} < {height}".format({top:top,height:height}));if(top<height){lazy.loadImg(_this)}})},lazyLoad:function(el){var lazyImages=$(el||document.body).find(l.lazy_not_load);if(lazyImages.size()>0){lazy.load1screen(el)}var delay=null;function $lazy(){$(el||document.body).find(l.lazy_not_load).each(function(){var _this=$(this)[0];if(_this.getAttribute(l.lazy_src)==null){return}var top=Math.max(_this.offsetTop,$(this).offset().top);var h=window.innerHeight||window.screen.height;var scrollTop=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;debug&&console.info("document scrollTop:{scrollTop}--window height:{h}--img top:{top}".format({top:top,h:h,scrollTop:scrollTop}));if(scrollTop>top+h||scrollTop<top-h){clearTimeout(delay);return}if(scrollTop>top-h){lazy.loadImg(_this)}})}$(window).bind("img-lazy",function(){$lazy();$(window).trigger("img-lazy-lisenter")});$(window).add("body").bind("scroll",function(){delay=setTimeout(function(){$(window).trigger("img-lazy")},100)})}};$.fn.$toggleClass=function(o){o=$.extend({scope:document,event:"click",className:"",isSingle:function(scope){return true},callback:$.noop},o);var elms=$(this);debug&&console.debug("toggle class binding!");o.callback2=o.callback2||o.callback;o.event&&$(elms.selector).live(o.event+".toggleClass",function(e){var curr=$(this);var scope=curr.parents(o.scope);if(o.isSingle(scope)){var scope_elms=$(elms.selector,scope).not(curr);scope_elms.removeClass(o.className)}if(!curr.is("."+o.className)){curr.addClass(o.className);return o.callback.apply(this,[e,o])}else{curr.removeClass(o.className);return o.callback2.apply(this,[e,o])}})};$.extend(Object,{toArray:function(o){var a=[];for(var attr in o){if(!$.isFunction(o[attr])){a.push([attr,o[attr]].join(":"))}}return a}});$.extend(Array.prototype,{each1:function(f){for(var i=0;i<this.length;i++){f.apply(this,[i,this[i]])}},toObject:function(){var o={};this.each1(function(i,elm){var kv=elm.split(":");o[kv[0]]=kv[1]});return o},fill:function(s){var a=this;for(var i=0;i<a.length;i++){if(a[i]==null){a[i]=s}}return this}});Array.copy=function(a){var args=Array.prototype.slice.apply(arguments,[1]);return Array.prototype.slice.apply(a,args)};var pckg=function(){var packages=Array.copy(arguments,0);var pckgs=window;for(var pi=0;pi<packages.length;pi++){var _package=packages[pi];var pnames=_package.match(/[^\.]+/g);for(var i=0;i<pnames.length;i++){if(!pckgs[pnames[i]]){pckgs[pnames[i]]={}}pckgs=pckgs[pnames[i]]}}return pckgs};var define=function(packages,def,context){if("function"==typeof packages){if(!window.template){window.template=packages()}return}var pckgs=context||window,pko=null;var pnames=packages.match(/[^\.]+/g);for(var i=0;i<pnames.length;i++){if(!pckgs[pnames[i]]&&i<pnames.length-1){pckgs[pnames[i]]={}}if(i==pnames.length-1){if(typeof def=="object"){var old=pckgs[pnames[i]];pckgs[pnames[i]]=old==null?def:$.extend(old||{},def||{})}else{pckgs[pnames[i]]=def}}pckgs=pckgs[pnames[i]]}return def};window.define=define;window.pckg=pckg;define("String.prototype.pad_code",function(len){var zero18="000000000000000000";var code=this||zero18;var clen=code.length;if(clen>len){code=code.substring(0,len)}else{if(clen<len){code=zero18.substring(0,len-clen)+code}}return code});define("String.prototype.sub_code",function(){var productcode=this||"";if(""!=productcode){var pcodeLen=productcode.length;for(var idx=0;idx<pcodeLen;idx++){if("0"!=productcode.charAt(0)){break}productcode=productcode.substring(1)}}return productcode});Function.prototype.before=function(func){var __self=this;return function(){var ret=func.apply(this,arguments);if(ret===false||(ret&&ret.success===false)){return ret}return __self.apply(this,arguments)}};Function.prototype.after=function(func){var __self=this;return function(){var ret=__self.apply(this,arguments);if(ret===false||(ret&&ret.success===false)){return ret}func.apply(this,arguments);return ret}};Function.prototype.around=function(func){var __self=this;return function(){__self.apply(this,arguments);var ret=func.apply(this,arguments);__self.apply(this,arguments);return ret}};$.fn.attrs=function(){var args=Array.copy(arguments,0);var elm=$(this);function attrs(){var o={};var args=Array.copy(arguments,0);for(var i=0;i<args.length;i++){var oprop=args[i];if(oprop instanceof Array){for(var j=0;j<oprop.length;j++){var prop=oprop[j];$.extend(o,attrs(prop))}}else{if(typeof oprop=="string"){o[oprop]=elm.attr(oprop)||""}}}return o}return attrs(args)};$.jsonp=function(url,data,success,error,callname,method,option){var params={type:method||"GET",url:url,cache:false,async:false,data:data||{},dataType:"jsonp",jsonp:"callback",success:success||$.noop,error:error||$.noop};callname&&(params.jsonpCallback=callname);$.ajax($.extend({},params,option||{}))};$(function(){$("[sara]").each(function(){$(this).sara()});document.onerror=function(e,url,line){console.info("document error",e,url,line)};window.onerror=function(e,url,line){console.info("window error",e,url,line)};Shop.LazyLoad.lazyLoad()});var helloworld="%c店铺展示系统SFS!\n%chttp://www.suning.com\n如有店铺相关问题建议或兴趣请反馈QQ群：104646505\n-------------\n2015年3月30日19:23:06  Powered by 开放平台店铺开发部";var imageTxt=["%c	    ___           ___           ___                       ___           ___        ","       /\\  \\         /\\__\\         /\\__\\          ___        /\\__\\         /\\  \\       ","      /::\\  \\       /:/  /        /::|  |        /\\  \\      /::|  |       /::\\  \\      ","     /:/\\ \\  \\     /:/  /        /:|:|  |        \\:\\  \\    /:|:|  |      /:/\\:\\  \\     ","    _\\:\\~\\ \\  \\   /:/  /  ___   /:/|:|  |__      /::\\__\\  /:/|:|  |__   /:/  \\:\\  \\    ","   /\\ \\:\\ \\ \\__\\ /:/__/  /\\__\\ /:/ |:| /\\__\\  __/:/\\/__/ /:/ |:| /\\__\\ /:/__/_\\:\\__\\   ","   \\:\\ \\:\\ \\/__/ \\:\\  \\ /:/  / \\/__|:|/:/  / /\\/:/  /    \\/__|:|/:/  / \\:\\  /\\ \\/__/   ","    \\:\\ \\:\\__\\    \\:\\  /:/  /      |:/:/  /  \\::/__/         |:/:/  /   \\:\\ \\:\\__\\     ","     \\:\\/:/  /     \\:\\/:/  /       |::/  /    \\:\\__\\         |::/  /     \\:\\/:/  /     ","      \\::/  /       \\::/  /        /:/  /      \\/__/         /:/  /       \\::/  /      ","       \\/__/         \\/__/         \\/__/                     \\/__/         \\/__/       ",];try{window.console=console||{};console&&console.log&&console.log(helloworld,"color:#009a61; font-size: 28px;","color:#009a61");console.log(imageTxt.join("\n"),"background-color:#338fff;color:white;")}catch(e){}window.MODULE_MODE_SFS=1;window.MODULE_MODE_DS=2;window.MODULE_MODE_TS=3;window.MODULE_MODE_SDK=4})(window.Shop=window.Shop||{});(function(){var req=$.request.parameters;window.MODULE_MODE=window.MODULE_MODE||req.mode||window.MODULE_MODE_SFS;window.m_mode=$.extend(window.m_mode||{},{sfs:window.MODULE_MODE_SFS,ds:window.MODULE_MODE_DS,ts:window.MODULE_MODE_TS,sdk:window.MODULE_MODE_SDK});window.m_is=function(){var names=Array.copy(arguments),is=false;for(var i=0;i<names.length;i++){is=is||window.MODULE_MODE==m_mode[names[i]]}return is};window.m_is_sfs=function(){return m_is("sfs")};$.extend(String.prototype,{format_prop:function(mix,contexts){var propname=$.trim(this);var __const__={__break__:"PTYPE_BREAK",__continue__:"PTYPE_CONTINUE"};function error(desc){var d=new Date().toLocaleString();req["format.debug"]&&console.warn("["+d+"]","[error]","字符串格式化错误 ",desc.formata(Array.copy(arguments,1)))}function safe_check(code){var ban_regex=/document\.cookie/img;if(ban_regex.test(code)){throw new Error("unsafe code["+code+"]")}}function __eval__(code,__context){try{safe_check(code);return function(){with(__context||window){return eval("("+(code)+")")}}.apply(__context||window)}catch(e){error("{0}eval处理异常-{1}",code,e)}}var prop_types={"number-value":{entry:true,match:/^\d+$/,exec:function(propname,matches,mix,self){var ret=__const__.__continue__;try{var arg_num=parseInt(propname);ret=mix["arg"+arg_num]}catch(e){error("{1}处理{0}异常-{2}",propname,self.ptype_name,e)}return ret}},"function":{entry:true,match:/^([^\(]+)\(([^\)]*)\)/,route:"expr-eval"},value:{entry:true,match:/^[^\(\=\)]+$/,route:{"const-value":/^("|')([^"']+)("|')$/,"dot-value":/[\.]+/,"arr-value":/([^\[\]]+)\[([^\]]+)\]/,"no-dot-value":/^[a-zA-Z\$_]+[\w$]*$/,"unkown-expr-value":"expr-eval"}},"const-value":{exec:function(propname,matches,mix,self){return matches[2]}},"arr-value":{exec:function(propname,matches,mix,self){var v1=matches[1],v2=matches[2];var v=mix[v1]||{};return v[v2]}},"dot-value":{regex_name:/([^\.]+)/g,exec:function(propname,matches,mix,self){var ret=__const__.__continue__;function dot_value(propname,context){var props=propname.match(self.regex_name);var value=context[props[0]];for(var i=1;i<props.length;i++){value=value!=null?value[props[i]]:null}return value}try{ret=dot_value(propname,mix);ret=ret==null?__eval__(propname,mix):ret}catch(e){error("{1}处理{0}异常-{2}",propname,self.ptype_name,e)}return ret}},"no-dot-value":{exec:function(propname,matches,mix,self){var ret=__const__.__continue__;try{ret=mix[propname];ret=ret==null?window[propname]:ret}catch(e){error("{1}处理{0}异常-{2}",propname,self.ptype_name,e)}return ret}},expr:{entry:true,match:/[\+\-\*\/\%\=\>\<\?\:\(\)]+/,route:{"unkown-expr":"expr-eval"}},"expr-eval":{exec:function(propname,matches,mix,self){var ret=__const__.__continue__;try{ret=__eval__(propname,mix)}catch(e){error("{1}处理{0}异常-{2}",propname,self.ptype_name,e)}return ret}},__route2__:function(ptype_name,propname,mix,route_matched){try{var ptype=prop_types[ptype_name],ptype_matched;var matches=ptype.__match__(propname,mix);if(!matches.is_match){return matches}var route_matches=ptype.__route__(propname,matches.matched,mix);if(route_matches.route_matched){ptype_matched=$.extend(matches,route_matches)}else{var pexec=ptype.__exec__(propname,route_matched||matches.matched,mix);ptype_matched=$.extend(matches,pexec)}req["format.debug"]&&console.info(ptype_name,propname,ptype_matched.pvalue);return ptype_matched}catch(e){error("ptypes-route2-{0}-处理{1}异常-{2}",ptype_name,propname,e);throw e}}};function ptype_match(propname,mix){var ptype=this,ptype_name=ptype.name;var matches=null;if($.isRegex(ptype.match)){matches=propname.match(ptype.match)}else{if($.isFunction(ptype.match)){if($.isRegex(ptype.regex)){var re_matches=propname.match(ptype.regex);if(re_matches!=null){matches=ptype.match(propname,ptype,re_matches,mix)}}else{matches=ptype.match(propname,ptype,mix)}}else{matches=true}}return{is_match:ptype.match==null||!(matches==null||matches===false),matched:matches}}function ptype_route(propname,matches,mix){var ptype=this,ptype_name=ptype.name,next_route=null,route_ret,route_matched;if(ptype.route==null){return{route_matched:false}}if($.isFunction(ptype.route)){next_route=ptype.route(propname,matches,mix)}else{if($.isPlainObject(ptype.route)){for(var route_name in ptype.route){var route_obj=ptype.route[route_name];if($.isRegex(route_obj)){var regex=route_obj;route_matched=propname.match(regex);if(route_matched){next_route=route_name;break}}else{if($.isFunction(route_obj)){var route_fun=route_obj;route_matched=route_fun.apply(ptype,[propname,matches,mix]);if(route_matched){next_route=route_name;break}}else{if(typeof route_obj=="string"){next_route=route_obj;window.debug&&console.info(ptype_name+"->"+route_name,propname);break}}}}}else{if(typeof ptype.route=="string"){next_route=ptype.route}else{error("route-{1}处理{0}无匹配路由",propname,ptype_name)}}}if(next_route!=null&&prop_types[next_route]){route_ret=prop_types.__route2__(next_route,propname,mix,route_matched)}return $.extend({route_matched:next_route!=null&&route_ret!=null},route_ret||{})}function ptype_exec(propname,matches,mix){var ptype=this;if(!$.isFunction(ptype.exec)){return{is_continue:true}}var pexec=ptype.exec(propname,matches,mix,ptype);var is_continue=pexec===__const__.__continue__;var is_break=pexec===__const__.__break__;return{is_continue:is_continue,is_break:is_break,is_success:!(is_continue||is_break),pvalue:pexec}}function init_ptypes(){for(var ptype_name in prop_types){var ptype=prop_types[ptype_name];$.extend(ptype,{name:ptype_name,__match__:ptype_match,__exec__:ptype_exec,__route__:ptype_route})}}init_ptypes();var pvalue=null;for(var ptype_name in prop_types){var ptype=prop_types[ptype_name];if(ptype.entry===true){var matches=prop_types.__route2__(ptype_name,propname,mix);if(!matches.is_match){continue}if(matches.is_continue){continue}else{if(matches.is_break){break}else{pvalue=matches.pvalue;break}}}}return pvalue},format1:function(){var contexts=Array.copy(arguments);var arg0=contexts[0],string=this;if(contexts.length==1&&$.isArray(arg0)){contexts=arg0}var mix={};mix.length=contexts.length;$.mix(contexts,mix);var string_formated=string.replace(/\{([^\{\}]+)\}/g,function(expr,prop,at,contextstring){var value=prop.format_prop(mix);value=value==null?expr:value;return value});window.debug&&console.info("string_formated",string_formated);return string_formated},formata:function(){var contexts=Array.copy(arguments);var arg0=contexts[0],string=this;if(contexts.length==1&&$.isArray(arg0)){contexts=arg0}var string_formated=string.replace(/\{([^\{\}]+)\}/g,function(expr,prop,at,contextstring){var value=contexts[prop];value=value==null?expr:value;return value});return string_formated}});String.prototype.format=String.prototype.format1;$.fn.format=function(){var args=Array.copy(arguments);args=args.length==1&&$.isArray(args[0])?args[0]:args;$(this).each(function(i,el){var istext=el.nodeType===3;var tpl=$(el).data("format-tpl")||(istext?$(el).text():$(el).html());tpl&&$(el).data("format-tpl",tpl);var content=tpl.format.apply(tpl,args);tpl&&(istext?$(el).txt(content):$(el).html(content))});return $(this)};$.fn.ohtml=function(html){if(html){var item=$(html);$(this).replaceWith(item);return item}else{var copy=$("<div></div>");$(this).clone().appendTo(copy);var content=copy.html();copy.remove();return content}};$.fn.comment=function(){var html=$(this).ohtml();html="<!-- "+html+" -->";$(this).ohtml(html)};$.fn.childest=function(el){function search(elm,el){var elms=$();if(elm.find(el).size()>0){var children=elm.children();var target_children=children.filter(el);$.merge(elms,target_children.toArray());children.not(target_children).each(function(i,celm){var ochildren=search($(celm),el);$.merge(elms,ochildren.toArray())})}return elms}return search($(this),el)};$.fn.texts=function(){return $(this).contents().filter(function(){return this.nodeType===3})};$.fn.txt=function(txt){var elm=this[0];var istext=elm.nodeType===3;txt&&istext&&(elm.nodeValue=txt);return txt?$(this):istext?elm.nodeValue:$(this).text()};$.expr[":"].parents=function(elm,index,m,all){return m&&m[3]&&$(elm).parents(m[3]).size()>0};$.mix=function mix(contexts,mixed_context){for(var i=contexts.length-1;i>=0;i--){var context=contexts[i];context=contexts[i]==null?{}:context;if(typeof context=="object"){$.extend(mixed_context,context)}else{mixed_context["arg"+i]=context}}return mixed_context};$.isRegex=function(regex){return regex instanceof RegExp};$.fn.elmout=function(){var contexts=Array.copy(arguments),arg_len=arguments.length;var mixed_context={};function mix(contexts,mixed_context){for(var i=contexts.length-1;i>=0;i--){var context=contexts[i];context=contexts[i]==null?{}:context;if(typeof context=="object"){$.extend(mixed_context,context)}else{mixed_content["arg"+i]=context}}return mixed_context}mix(contexts,mixed_context);var tag_config={"e-if":function(elm,no){var parent=$(elm).parents("[e-each]");var scope=mixed_context;if(parent.length>0){if(parent.is('[e-id*="e-each"]')){scope=$.extend({},scope,parent.data("scope")||{})}else{return}}var expr=$(elm).attr("e-if")||"";var scope=mixed_context;scope=$.extend({},scope,parent_scope(elm));if(expr.format_prop(scope)){$(elm).attr("e-id",eid("e-if",no)).data("scope",scope);if(!$(elm).is("[e-each]")){if(start(elm)){$(elm).texts().format(contexts)}else{$(elm).format(contexts)}}}else{$(elm).comment()}},"e-each":function(elm,no){function each_do(el,scope,scope_name){var before=$(el),inner=$(el).is("[inner]"),html=inner?$(el).html():$(el).ohtml();var length=scope.length;inner&&before.empty();for(var i=0;i<scope.length;i++){var item_scope={},item_value=scope[i];if($.isPlainObject(item_value)){$.extend(item_scope,item_value)}item_scope[scope_name]=item_value;item_scope[scope_name+"_index"]=i;item_scope[scope_name+"_length"]=length;var item_html=html.format(item_scope,parent_scope(item),mixed_context);var item=$(item_html);if(inner){$(before).append(item)}else{$(before).after(item);before=item}var $eid=eid("e-each-"+scope_name,no+"-"+i);item_scope.$eid=$eid;item.data("scope",item_scope).attr("e-id",$eid);start(item)}!inner&&$(el).comment();return elms}function group(el,scope,scope_name){var before=$(el),group=before.attr("group"),groupi=parseInt(group)||0,html=before.ohtml();if(groupi>0&&scope.length>0){var scope_arrs=scope.split(groupi);for(var i=0;i<scope_arrs.length;i++){var scope_arr=scope_arrs[i];var item=$(html);$(before).after(item);var $eid=eid("e-group-"+scope_name,no+"-"+i);item.attr("e-id",$eid);each_do(item,scope_arr,scope_name);before=item}$(el).comment()}else{each_do(el,scope,scope_name)}}var scope_name=$.trim($(elm).attr("e-each")||""),scope={},data_scope_name;var matches=scope_name.match(/^(\S+)\s+as\s+(\S+)$/);if(matches){data_scope_name=matches[1];scope_name=matches[2]}else{data_scope_name=scope_name}scope=resolve_scope(data_scope_name);var elms=group(elm,scope,scope_name)},"e-out":function(elm,no){var scope_name=$(elm).attr("e-out");var scope=resolve_scope(scope_name);scope_name&&$(elm).html(scope);!scope_name&&$(elm).format(contexts)},"e-on":function(elm,no,prop){var scope=parent_scope(elm);var onAction=$(elm).attrs("on-click","on-class","on-else-click","on-else-class");var if_true=prop&&prop.format_prop($.extend({},scope,mixed_context));if(if_true){if(onAction["on-class"]){$(elm).addClass(onAction["on-class"])}if(onAction["on-click"]){$(elm).off("click.on.click").on("click.on.click",function(){onAction["on-click"].format_prop($.extend({},scope,mixed_context))})}}else{if(onAction["on-else-class"]){$(elm).addClass(onAction["on-else-class"])}if(onAction["on-else-click"]){$(elm).off("click.on.click").on("click.on.click",function(){onAction["on-else-click"].format_prop($.extend({},scope,mixed_context))})}}if($(elm).is("[on-show]")){if(if_true){$(elm).show()}else{$(elm).hide()}}if($(elm).is("[on-else-show]")){if(!if_true){$(elm).show()}else{$(elm).hide()}}if(!$(elm).is('[e-id*="e-each"]')){start(elm)}},"e-show":function(elm,no,prop){var scope=parent_scope(elm);if(prop&&prop.format_prop($.extend({},scope,mixed_context))){$(elm).show();start(elm)}else{$(elm).hide()}},"e-click":function(elm,no){var scope=parent_scope(elm),clickFunName=$(elm).attr("e-click");$(elm).off("click.eclick").on("click.eclick",function(){clickFunName&&clickFunName.format_prop($.extend({},scope,mixed_context))})},"e-bind":function(elm,no,prop){var scope=parent_scope(elm);if(prop){$(elm).off("keyup.e-bind").on("keyup.e-bind",function(){scope[prop]=$(this).val()})}}};function eid(scope_name,no){return scope_name+"-"+new Date().getTime()+"-"+(no||0)}function list_tags(){var tag_els=[];for(var tag in tag_config){if(tag!="tags"){tag_els.push("["+tag+"]")}}return tag_els}function parent_scope(elm){var ptag=$($(elm).filter('[e-id*="e-each"]')[0]||$(elm).parents("[e-id],[e-root]")[0]);var pscope=ptag[0]?ptag.eq(0).data("scope")||{}:{};return pscope}function resolve_scope(scope_name){var scope=null;if(typeof scope_name=="string"){for(var i=0;i<contexts.length;i++){var context=contexts[i]||{};scope=context[scope_name];if(scope!=null){break}}}return scope==null?contexts[0]:scope}function resolve_tag(tags){var tags_el_arr=list_tags();for(var i=0;i<tags_el_arr.length;i++){var the_tag_el=tags_el_arr[i],the_tag_name=the_tag_el.unwrap();var the_tags=tags.filter(the_tag_el);if(the_tags.length>0){the_tags.each(function(i,tag_elm){tag_config[the_tag_name](tag_elm,i,$(tag_elm).attr(the_tag_name))})}}}function resolve_each_tag(tag_elm){var tags_el_arr=list_tags().$remove("[e-each]");for(var i=0;i<tags_el_arr.length;i++){var the_tag_el=tags_el_arr[i],the_tag_name=the_tag_el.unwrap();if(tag_elm.is(the_tag_el)){tag_config[the_tag_name](tag_elm,i,$(tag_elm).attr(the_tag_name))}}}function start(context){var tags_el=list_tags().join(",");var tag_elms=$(context).childest(tags_el);var has_tag=tag_elms.length>0;if($(context).is('[e-id*="e-each"]')){resolve_each_tag(context)}if(has_tag){resolve_tag(tag_elms)}else{if(!$(context).is("[e-id]")){$(context).format(contexts)}}return has_tag}function ready(context){var load_el=$(context).attr("loading");if(load_el&&!$(context).data("loaded")){$(load_el).show();$(context).hide()}var copy=$(context).data("copy");if(copy){$(context).html(copy)}else{copy=$(context).html();$(context).data("copy",copy)}var scope=$(context).data("scope");if(arg_len==0&&scope){mixed_context=scope}$(context).data("scope",mixed_context).attr("e-root","root")}function over(context){var load_el=$(context).attr("loading");if(load_el&&!$(context).data("loaded")){$(load_el).hide();$(context).show().data("loaded",true)}var propmap={"e-src":"src"};for(prop in propmap){$("["+prop+"]",context).each(function(i,elm){var propvalue=$(elm).attr(prop);var prop1=propmap[prop];$(elm).attr(prop1,propvalue)})}}ready(this);start(this);over(this);return $(this)};Number.range=function(roption){var range_arr=[],range_rule_re=/^([\(\[])+([^\)\]]+)([\)\]]+)$/i;var range_char_funcs={"[]":function(n,start,end){return end==null?n==start:n>=start&&n<=end},"()":function(n,start,end){return end==null?n==start:n>start&&n<end},"[)":function(n,start,end){return end==null?n>=start:n>=start&&n<end},"(]":function(n,start,end){return end==null?n<=start:n>start&&n<=end}};function parse(range_rule,in_range_value){var range_rule_match=range_rule.match(range_rule_re);if(!range_rule_match){return}var rrm_length=range_rule_match.length;if(rrm_length==4){var start_char=range_rule_match[1],range_value=range_rule_match[2],end_char=range_rule_match[3];var range_char_func=range_char_funcs[start_char+end_char];if(range_char_func){return{range_value:in_range_value,range_values:range_value.split(","),range_func:range_char_func,exec:function(n){var in_range=this.range_func.apply(this,[n].concat(this.range_values));return in_range?this.range_value:null}}}}}for(var r in roption){var rv=roption[r];var range_obj=parse(r,rv);range_obj&&range_arr.push(range_obj)}return{range_arr:range_arr,range:function(n){var rv=null;for(var i=0;i<this.range_arr.length;i++){var range_obj=this.range_arr[i];rv=range_obj.exec(n);if(rv!=null){break}}return rv}}};Number.prototype.pad0=String.prototype.pad0=function(len){var z18="000000000000000000",max=z18.length,snum=(this).toString(),clen=snum.length;return clen>len?snum.substring(0,len):z18.substring(0,len-clen)+snum};Number.prototype.add=function(num){return this+num};Number.prototype.each_delay=function(func,delay,over,auto){var start=0,self,end=self=this,auto=auto==null?false:auto;var delay_is_func=typeof delay=="function";self.i=start,self.tid=0;self.next=function next(){this.exec()};self.exec=function exec(){var self=this;if(self.i<end){var delay_i=delay_is_func?delay(self.i):delay;delay_i=delay_i==null?1000:delay_i;if(delay_i>0){self.tid=setTimeout(function(){func(self.i++,self);auto&&self.next()},delay_i)}else{func(self.i++,self)}}else{clearTimeout(self.tid);over&&over(self)}};self.cancel=function(){clearTimeout(self.tid)};self.exec();return self};Date.weeks={en:["Sunday","Monday","Thuesday","Wednesay","Tursday","Friday","Saturday"],zh:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"]};Date.now=function(){return new Date()};Date.prototype.format=function(frmt){frmt=frmt||"yyyy-MM-dd hh:mm:ss.SSS";var self=this;var frmt_funcs={y:function(expr){var y=self.getYear();y=y<1900?1900+y:y;return y.pad0(expr.length)},M:function(expr){return self.getMonth().add(1).pad0(expr.length)},d:function(expr){return self.getDate().pad0(expr.length)},h:function(expr){return self.getHours().pad0(expr.length)},m:function(expr){return self.getMinutes().pad0(expr.length)},s:function(expr){return self.getSeconds().pad0(expr.length)},S:function(expr){return self.getMilliseconds().pad0(expr.length)},E:function(expr){return Date.weeks.zh[self.getDay()].pad0(expr.length)}};return frmt.replace(/(y+|M+|d+|h+|m+|s+|S+|E+)/g,function(expr1,expr2,at,string){var frmt_func=frmt_funcs[expr1[0]];var frmt_val=frmt_func?frmt_func.apply(self,[expr1]):expr1;return frmt_val==null?expr1:frmt_val})};Date.parse=function(date,frmt){frmt=frmt||"yyyy-MM-dd hh:mm:ss.SSS";var self=new Date();var s_frmt_funcs={y:function(v){v=v<1900?v+1900:v;return self.setYear(v)},M:function(v){return self.setMonth(v-1)},d:function(v){return self.setDate(v)},h:function(v){return self.setHours(v)},m:function(v){return self.setMinutes(v)},s:function(v){return self.setSeconds(v)},S:function(v){return self.setMilliseconds(v)},E:function(v){return self.setDay(v)}};frmt.replace(/(y+|M+|d+|h+|m+|s+|S+|E+)/g,function(expr1,expr2,at,string){var v=date.substr(at,expr2.length),v=parseInt(v)||0;var s_frmt_func=s_frmt_funcs[expr1[0]];s_frmt_func?s_frmt_func.apply(self,[v]):"";return expr1});return self};define("Date.prototype",{eq:function(d1){var d=this;return d.getTime()==d1.getTime()},gt:function(d1){var d=this;return d.getTime()>d1.getTime()},gte:function(d1){var d=this;return d.getTime()>=d1.getTime()},lt:function(d1){var d=this;return d.getTime()<d1.getTime()},lte:function(d1){var d=this;return d.getTime()<=d1.getTime()}});String.prototype.date2str=function(format2,format1){return Date.parse(this,format1).format(format2)};Array.prototype.copy=function(){var newArray=[];for(var i=0;i<this.length;i++){newArray.push(this[i])}return newArray};Array.prototype.tomap=function(key,value){var map={};for(var i=0;i<this.length;i++){var o=this[i];var prop=o[key]||o;if(value){o=o[value]}map[prop]=o}return map};Array.prototype.split=function(num){var arrs=[];var me=this;var len=me.length;if(len>0){var group=parseInt(len/num);var left=len%num;group=left>0?group+1:group;for(var i=0;i<group;i++){var start=i*num,end=(i+1)*num;var arr=me.slice(start,end);arrs.push(arr)}}else{arrs.push(this)}return arrs};Array.prototype.$search=function(obj,filter){var elm=null;for(var i=0;i<this.length;i++){var o=this[i];if(filter){if(filter(o,obj)){elm=o;break}}else{if(obj==o){elm=o;break}}}return elm};Array.prototype.$indexOf=function(obj,filter){var at=-1;for(var i=0;i<this.length;i++){if(filter){if(filter(this[i],obj)){at=i}}else{if(obj==this[i]){at=i}}}return at};Array.prototype.$remove=function(obj,filter){var at=this.$indexOf(obj,filter);if(at>=0){this.splice(at,1)}return this};Array.prototype.$clear=function(){this.length=0;return this};Array.prototype.push_all=function(arr){var len=arr.length;if(len!=null){this.push.apply(this,arr)}else{this.push(arr)}return this};Array.prototype.each_delay=function(func,delay,over){var start=0,self=this,end=self.length;var delay_is_func=typeof delay=="function";self.i=start,self.tid=0;self.next=function next(){this.exec()};self.exec=function exec(){var self=this;if(self.i<end){var delay_i=delay_is_func?delay(self.i):delay;delay_i=delay_i==null?1000:delay_i;if(delay_i>0){self.tid=setTimeout(function(){func(self.i,self[self.i],self);self.i++;self.next()},delay_i)}else{func(self.i,self[self.i++],self)}}else{clearTimeout(self.tid);over&&over(self)}};self.cancel=function(){clearTimeout(self.tid)};self.exec();return self};window.map2array=function(me,b,props){var arr=[];if(props){for(var i=0;i<props.length;i++){var prop=props[i];var value=me[prop];if(value){if(b){arr.push(value)}else{arr.push(prop)}}}return arr}for(var prop in me){if(me.hasOwnProperty(prop)){var value=me[prop];if(b){arr.push(value)}else{arr.push(prop)}}}return arr};function marquee(el){var marguee_elms=$(el||"[marquee]");function marquee$impl(elm){var marguee_elm=$(elm),marquee_content_elm=marguee_elm.children(),lineHeight=marquee_content_elm.children().eq(0).height();var marq=$(marguee_elm).data("marqueue-data");if(marq){marq.cancel()}var marquee_height=marquee_content_elm.height()*2-marguee_elm.height();var frame0=parseInt(marguee_elm.attr("frame")||0);function marquee_go(){marquee_content_elm.eq(0).css({marginTop:0});return(marquee_height).each_delay(function(i,eo){marquee_content_elm.eq(0).css({marginTop:-i});eo.next()},function(i){var frame=frame0||ishop.util.marquee.frame||45;var delay=1000/frame;return delay},function(){marquee_go()})}if(marquee_height>10){if(!marq){marguee_elm.append(marquee_content_elm.clone())}marq=marquee_go();$(marguee_elm).data("marqueue-data",marq)}}marguee_elms.each(function(i,elm){marquee$impl(elm)})}var delay_range={"(5]":5,"(5,15]":10,"(15,25]":15,"(25,35]":25,"(35,45]":35,"(45,55]":40,"(55,65]":35,"(65,75]":25,"(75,85]":15,"(85,95]":12,"(95,98]":8,"(98,100]":5,"(100,110]":3,"[110)":2};var range_obj=Number.range(delay_range);function draw_exec_animate(context,item_no,draw_class,callback){context=context||document;item_no=item_no==null?0:item_no;var draw_box=$("[draw-box]:visible",context);window.debug&&console.info("item_no",item_no);var total_scene=100,item_num=parseInt(draw_box.attr("draw-box"));total_scene=total_scene-(total_scene%item_num);var draw_items=$("[item-no]",draw_box),end=total_scene+(item_no||0)+item_num,at=0;var item_length=draw_items.length;function run_at(at){var item_no=at%item_length;draw_items.removeClass(draw_class).filter("[item-no="+item_no+"]").addClass(draw_class)}(end+1).each_delay(function(i,eo){at=i;run_at(at);eo.next()},function(i){var frame=range_obj.range(i)||45;var delay=1000/frame;return delay},function(){callback&&callback()})}function ensureLogin(success,nologin,error,cancel){var url=sn.service["service.auth.status.url"].format(sn,location);var params={};$.jsonp(url,params,function(data){if(data.hasLogin){success&&success()}else{nologin&&nologin(success)}},function(){error&&error();$(window).trigger("login.error")})}function pop2login(success){var base=sn.daka_context+"/";var passport_config={base:base,loginTheme:"b2c_pop"};success&&loginCallbackStack.push(success);popupLoginContainer(passport_config)}function qrcode(url,size,color,logo,days,imgtype){var qrcode_rule=sn.shop.qrcode_rule;url=(url||"").hex().join(",");logo=(logo||"").hex().join(",");return qrcode_rule.format({longUrl:url,imgType:imgtype||"JPG",imgSize:size||"100",color:color||"000000",qrCodeLogoUrl:logo,days:days||-1})}window.__ioc={arg2map:function(service,args){var matches=service.toString().match(/\s*function\s*(\S+)\(([^\)]+)\)/i);var names=matches[2]||"";names=names.split(",");var argmap={};for(var i=0;i<names.length;i++){var name=$.trim(names[i]);argmap[name]=args[i]}argmap.arguments=args;argmap.names=names;return argmap},di:function(name,service,args){var argmap=__ioc.arg2map(service,args);if(this.service){this.argmap=argmap}return argmap[name]},extend:function(ioc){ioc.di=function(name){return __ioc.di.apply(ioc,[name,ioc.service,ioc.arguments])};return ioc}};Function.prototype.aop=function(aop_func){var __service_func=this,args=Array.copy(arguments,1);return function(){var __context=this,__arguments=arguments;var proxy=function(){return __service_func.apply(__context,__arguments)};var ioc=__ioc.extend({service:__service_func,context:__context,arguments:__arguments});aop_args=[proxy,ioc,args];var ret=aop_func.apply(__context,aop_args);return ret}};function rcallback(){var self={no:0,debug:req["callback.debug"]};function $name(callback){var call_no=self.no++,timeid=(new Date).getTime();var callback_name="callback$instance"+call_no+"$"+timeid;window[callback_name]=function(){self.debug&&console.info("args",Array.copy(arguments));callback.apply(self,Array.copy(arguments));window[callback_name]=null};return callback_name}self.$name=$name;return self}define("ishop.util",{marquee:marquee,draw_exec_animate:draw_exec_animate,ensureLogin:ensureLogin.aop(function(proxy,ioc){if(!m_is("sfs","qs")||req.no_login){var success=ioc.di("success");req.debug&&console.info(ioc.argmap.names);success&&success()}else{return proxy()}}),rcallback:rcallback(),pop2login:pop2login,qrcode:qrcode});Function.prototype.ensureLogin=Function.prototype.ensureLogin||function(ret){var __self=this;return function(){var __context=this,__arguments=arguments;ishop.util.ensureLogin(function(){__self.apply(__context,__arguments)},pop2login);return ret===true}};var dialog=function(){var tpl={dialog:'<div style="display: block;height: 105px;vertical-align: middle;line-height: 105px;text-align: center;"><h1>{content}</h1></div>',dialog_msg:'<div class="draw-pop pop2" dialog><div class="draw-pop-black" layer></div><div class="purple-not-award"> <em class="finish-icon"></em> <div> {errorDesc}<p class="purple-finish-p"></p> </div> <i class="purple-draw-close" close></i> </div> </div>',dialog_success:'<div class="draw-pop submit-info-finish"  dialog dialog-addr-success e-root="root"><div class="draw-pop-black" layer></div><div class="purple-draw-congratulation pop400 finish"><em class="lion-finish-icon"></em><div class="info-finish"><span>信息提交成功!</span></div><div class="congratulation-choice" oppo-path hide style="display: none;"><p>您可以通过以下操作获得抽奖机会：</p><div class="btn-grey" style="width:234px;"><div><a class="purple-draw-love" href="javascript:void(0);" oppo="01" hide data-index="6" style="display: none;"><i></i>收藏店铺</a></div></div></div><i class="purple-draw-close" close></i></div></div>',dialog_draw_info:'<div class="draw-pop draw-info-look" dialog dialog-draw-info> <div class="draw-pop-black" layer></div> <div class="purple-draw-congratulation pop400 finish"> <div class="draw-info-title">奖品寄送信息</div> <div data-type="{type}" class="draw-info-detail" js-draw-pop> <div class="lucky-draw-form lucky-form-disabled"> <label for="">姓名：</label> <input type="text" value="{contactsName}" disabled> </div> <div class="lucky-draw-form lucky-form-disabled"> <label for="">联系电话：</label> <input type="text" class="draw-phone" disabled value="{phoneNumber}"> </div> <div class="lucky-draw-form lucky-textarea lucky-form-disabled"> <label for="">联系地址：</label><textarea class="textarea textpre" dialog-goods-address contenteditable="true">{receivingAddress}</textarea></div> <div class="lucky-draw-tips" style="display:none;text-align: center;" goods-tips><i class="warn"></i></div><div winningid="{winningId}" goods-submit class="lucky-draw-form lucky-submit">修改信息</div> </div> <div class="congratulation-choice"> <p>您也可以在苏宁易购-我的易购-<a class="red-info" target="_blank" href="{myhref}" data-index="6">我的抽奖</a>里查到中奖信息哦</p> </div> <i class="purple-draw-close" close></i> </div> </div>'};var els={close:"[close]",dialog:"[dialog]",dialog_msg:"[msg]",layer:"[layer]",dialog_tpl:"[dialog-tpl]"};var formats={format:function(data,el){tpl&&$(el).format(data);return $(el)},"s-format":function(data,el){return $(el).refresh(data)},"elm-out":function(data,el){return $(el).elmout(data)},flush:function(data,el,def){var format_type=$(el).attr("dialog")||def||"elm-out";formats[format_type](data,el);$(el).show()}};els.version=$(els.dialog).size()>0?2:1;function close(){window.simpleAlert&&simpleAlert.hideAlertHtml();$([els.dialog,els.layer].join(",")).hide();$(window.top.document.body||window.document.body).find(".sf-popWin, .sf-popWinMask, .sf-popWinFrame").remove()}function showMsg1(obj,els){close();formats.flush(obj,els,"format").show()}function showMsg2(content,dialog_el){close();var dialog_el=dialog_el||els.dialog;$(els.dialog_msg,dialog_el).html(content);$([dialog_el,els.layer].join(",")).show()}function showAlert1(content,title){close();simpleAlert.show(title||"温馨提示",tpl.dialog.format({content:content||""}))}function showAlert2(title,el,obj){close();$(el).refresh(obj).hide();simpleAlert.show(title,$(el))}function showAlertWithDialog(dialog,msg){close();$(window).popWin({width:0,content:tpl[dialog].format({errorDesc:msg||""}),showTitle:false,showBtn:false,autoShow:true,callback:function(o,fn,e){}})}function showAlert3(errorDesc){close();$(window).popWin({width:0,content:tpl.dialog_msg.format({errorDesc:errorDesc||""}),showTitle:false,showBtn:false,autoShow:true,callback:function(o,fn,e){}})}function show(obj,el,multi){if(!multi){close()}formats.flush(obj,el);$(els.layer).show();$(el).show()}function showAddr(type,contactsName,phoneNumber,receivingAddress,winningId){close();var obj={myhref:sn.my_draw_server,type:type,contactsName:contactsName,phoneNumber:phoneNumber,receivingAddress:receivingAddress,winningId:winningId};var content=tpl.dialog_draw_info.format(obj);$(window).popWin({width:0,content:content,showTitle:false,showBtn:false,autoShow:true,callback:function(o,fn,e){}})}var proto={showMsg1:showMsg1,showMsg2:showMsg2,showAlert1:showAlert1,showAlert2:showAlert2,showAlert3:showAlert3,showAlertWithDialog:showAlertWithDialog,showAddr:showAddr,version:!m_is("sfs","qs")?2:$(els.dialog).size()>0?2:1,show:show};$(document).on("click",els.close,close);$(window).on("dialog.close",els.close,close);return proto}();window.dialog=dialog;define("ishop.favorite",function(){var variables={};function check(shopId,success,fail,error){var service_name="service.favorite.check.url";var params={shopId:shopId.pad_code(10)};var url=sn.service[service_name].format(params,sn,sn.shop);$.jsonp(url,params,function(json){console.info(service_name,json);json=json||{};if(json.returnCode=="1"){success&&success()}else{if(json.returnCode=="0"){fail&&fail()}else{console.error(service_name,"unkown status")}}},function(){console.info(service_name,"error");error&&error()})}function cancel(shopId,success,fail,error){var service_name="service.favorite.cancel.url";var params={shopId:shopId.pad_code(10)};var url=sn.service[service_name].format(params,sn,sn.shop);$.jsonp(url,params,function(json){console.info(service_name,json);if(json.returnCode=="0"){success&&success()}else{fail&&fail()}},function(){console.info(service_name,"error");error&&error()})}function add(shopId,success,fail,error){var service_name="service.favorite.add.url";var params={shopId:shopId.pad_code(10),entrance:"shopHome"};var url=sn.service[service_name].format(params,sn,sn.shop);$.jsonp(url,params,function(json){window.debug&&console.info(service_name,json);if(json.returnCode=="0"){success&&success()}else{fail&&fail()}},function(){window.error&&console.info(service_name,"error");error&&error()})}function pointcut(proxy,ioc,json){if(m_is("sfs","qs")){return proxy()}else{var callback=ioc.di("success");req.debug&&console.info(ioc.argmap.names);callback&&callback(json)}}var methods={check:check.aop(pointcut,{returnCode:"0"}),cancel:cancel.aop(pointcut,{returnCode:"0"}),add:add.aop(pointcut,{returnCode:"0"})};var clazz=$.extend(variables,methods);return clazz}());var channel="PC";define("ishop.draw.service",function(){var self={debug:$.request.get("env")=="dev"};function queryActPstatus(callback,shopId){var service_name="service.draw.act.pstatus.url";var callbackname=ishop.util.rcallback.$name(function(json){window.debug&&console.info(service_name,json);!self.debug&&callback&&callback(json);self.debug&&callback&&callback(ishop.draw.sample.actPstatus)});var url=sn.service[service_name].format(sn,{spcode:shopId,callback:callbackname},sn.shop);url=url.replace("http://","//").replace("https://","//");$.jsonp(url,{},$.noop,function(){window.error&&console.error(service_name,"error")},callbackname)}function queryActInfo(actId,callback){var service_name="service.draw.act.url";var url=sn.service[service_name].format(sn,sn.shop,{actId:actId});$.jsonp(url,{showType:"ACT"},function(json){window.debug&&console.info("service.draw.act.url",json);callback&&callback(json)},function(){window.error&&console.info("service.draw.act.url error")})}function queryWapDrawStatus(valid,invalid){queryActPstatus(function(actPstatus){if(actPstatus&&actPstatus.actId&&actPstatus.pstatus!="0"){queryActInfo(actPstatus.actId,function(actInfo){if(actInfo&&actInfo.activityStatus!=null&&actInfo.activityStatus!="3"){valid&&valid(actInfo)}else{invalid&&invalid(actInfo);window.debug&&console.info("抽奖活动已结束",actInfo)}})}else{invalid&&invalid(actPstatus)}},sn.shop.spcode)}function queryActDetail(shopId,actId,callback){var service_name="service.draw.detail.url";var url=sn.service[service_name].format(sn,{actId:actId,spcode:shopId});$.jsonp(url,{showType:"ALL"},function(json){window.debug&&console.info(service_name,json);!self.debug&&callback&&callback(json);if(self.debug){var len=$.request.get("len")||10,rl=ishop.draw.sample.actDetail.rewardList;var status=$.request.get("status")||2;ishop.draw.sample.actDetail.activityStatus=status;ishop.draw.sample.actDetail.rewardList=rl.slice(0,len)}self.debug&&callback&&callback(ishop.draw.sample.actDetail)},function(){window.error&&console.info(service_name,"error")})}function queryActDrawLog(shopId,actId,callback){var service_name="service.draw.log.url";var url=sn.service[service_name].format(sn,{actId:actId,spcode:shopId});$.jsonp(url,{},function(json){window.debug&&console.info(service_name,json);!self.debug&&callback&&callback(json);self.debug&&callback&&callback(ishop.draw.sample.actDrawLog)},function(){window.error&&console.info(service_name,"error")})}function queryActVipInfo(shopId,actId,callback){var service_name="service.vip.log.url";var url=sn.service[service_name].format(sn,{actId:actId,spcode:shopId});$.jsonp(url,{showType:"TL"},function(json){window.debug&&console.info(service_name,json);!self.debug&&callback&&callback(json);self.debug&&callback&&callback(ishop.draw.sample.vipInfo)},function(){window.error&&console.info(service_name,"error")})}function queryActVipLog(shopId,actId,callback){var service_name="service.vip.log.url";var url=sn.service[service_name].format(sn,{actId:actId,spcode:shopId});$.jsonp(url,{showType:"ALL"},function(json){window.debug&&console.info(service_name,json);!self.debug&&callback&&callback(json);self.debug&&callback&&callback(ishop.draw.sample.actVipLog)},function(){window.error&&console.info(service_name,"error")})}function draw_exec(shopId,actId,callback,error){var service_name="service.draw.exec.url";var url=sn.service[service_name].format(sn,{actId:actId,spcode:shopId});$.jsonp(url,{channel:channel},function(json){window.debug&&console.info(service_name,json);!self.debug&&callback&&callback(json);if(self.debug){var reward=ishop.draw.sample.draw_exec;var no=$.request.get("item-no");if(no=="0"){reward=ishop.draw.sample.draw_thanks}else{var draw_box=$("[draw-box]:visible");var draw_items=$("[item-no]",draw_box);var item_length=draw_items.length;var item_no=(Math.random()*100)%item_length;ishop.draw.sample.draw_exec.rewardCode=(no==null||no=="")?item_no:no}self.debug&&callback&&callback(reward)}},function(){window.error&&console.info(service_name,"error");error&&error()})}function draw_add(shopId,actId,triggerType,callback){var service_name="service.draw.add.url";var url=sn.service[service_name].format(sn,{actId:actId,triggerType:triggerType,spcode:shopId});$.jsonp(url,{},function(json){window.debug&&console.info(service_name,json);callback&&callback(json)},function(){window.error&&console.info(service_name,"error")})}function draw_save_address(shopCode,activityCode,winningId,contactsName,phoneNumber,receivingAddress,callback){var service_name="service.draw.save.receiving";var url=sn.service[service_name].format(sn);$.jsonp(url,{shopCode:shopCode,activityCode:activityCode,winningId:winningId,contactsName:contactsName,phoneNumber:phoneNumber,receivingAddress:receivingAddress},function(json){window.debug&&console.info(service_name,json);callback&&callback(json)},function(){window.error&&console.info(service_name,"error")})}function pointcut(proxy,ioc,sampleDataName){if(m_is("sfs","ds")){return proxy()}else{var callback=ioc.di("callback");req.debug&&console.info(ioc.argmap.names);callback&&callback(ishop.draw.sample[sampleDataName])}}var proto={queryActPstatus:queryActPstatus,queryActInfo:queryActInfo,queryWapDrawStatus:queryWapDrawStatus,drawSaveAddress:draw_save_address,queryActDetail:queryActDetail.aop(pointcut,"actDetail"),queryActDrawLog:queryActDrawLog.aop(pointcut,"actDrawLog"),queryActVipInfo:queryActVipInfo.aop(pointcut,"vipInfo").ensureLogin(),queryActVipLog:queryActVipLog.aop(pointcut,"actVipLog").ensureLogin(),draw_exec:draw_exec.aop(pointcut,"draw_exec").ensureLogin(),draw_add:draw_add.aop(pointcut,"actOppo")};$.extend(self,proto);return self}());ishop.draw.sample={actPstatus:{actId:111,pstatus:1},actDetail:{activityStatus:2,activityStartTime:"2017-02-05 15:20:00",activityEndTime:"2017-03-05 23:59:59",activityTimes:3,rewardList:[{rewardCode:1,rewardType:"20",rewardAmount:10},{rewardCode:2,rewardType:"10",rewardAmount:25},{rewardCode:3,rewardType:"20",rewardAmount:15},{rewardCode:4,rewardType:"10",rewardAmount:35},{rewardCode:5,rewardType:"20",rewardAmount:25},{rewardCode:6,rewardType:"10",rewardAmount:45},{rewardCode:7,rewardType:"20",rewardAmount:25},{rewardCode:8,rewardType:"20",rewardAmount:45},{rewardCode:9,rewardType:"10",rewardAmount:45}],triggerList:[{triggerType:"01",triggerName:"收藏",triggerTimes:"2",triggerFlag:"0"},{triggerType:"02",triggerName:"收藏",triggerTimes:"分享",triggerFlag:"0"}]},actDrawLog:{recordList:[{customName:"小华华1",rewardType:"10",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小朱朱1",rewardType:"20",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小华华2",rewardType:"10",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小朱朱2",rewardType:"20",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小华华3",rewardType:"10",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小朱朱3",rewardType:"20",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小华华4",rewardType:"10",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"},{customName:"小朱朱4",rewardType:"20",rewardAmount:20,rewardTime:"2017-03-05 23:59:59"}]},vipInfo:{surplusTimes:2},actVipLog:{surplusTimes:0,triggerList:[{triggerType:"01",triggerName:"收藏",triggerTimes:"2",triggerFlag:"0"},{triggerType:"02",triggerName:"收藏",triggerTimes:"分享",triggerFlag:"0"}],recordList:[{customName:"小华华1",rewardType:"10",rewardAmount:10,rewardTime:"2017-03-05"},{customName:"小朱朱1",rewardType:"20",rewardAmount:25,rewardTime:"2017-03-05"},{customName:"小华华2",rewardType:"10",rewardAmount:15,rewardTime:"2017-03-05"},{customName:"小朱朱2",rewardType:"20",rewardAmount:25,rewardTime:"2017-03-05"},{customName:"小华华3",rewardType:"10",rewardAmount:10,rewardTime:"2017-03-05"},{customName:"小朱朱3",rewardType:"20",rewardAmount:25,rewardTime:"2017-03-05"},{customName:"小华华4",rewardType:"10",rewardAmount:15,rewardTime:"2017-03-05"},{customName:"小朱朱4",rewardType:"20",rewardAmount:50,rewardTime:"2017-03-05"}]},actOppo:{description:"恭喜您获得2次额外的抽奖机会"},draw_exec:{successFlag:true,rewardCode:1,rewardDesc:"恭喜您获得5元优惠券",surplusTimes:0,errorCode:"err.overDraw",errorDesc:"抽奖次数超限"},draw_thanks:{successFlag:true,rewardCode:"0",rewardDesc:"谢谢参与！",surplusTimes:0,errorCode:null,errorDesc:null}};try{ishop.draw.sample=window.datasource.draw.sample||ishop.draw.sample}catch(e){}define("ishop.draw.view",function(){var draw_module_el="[draw-module],[ds-draw-module]";function drawproto(moduleid){var self={moduleid:moduleid,running:false,enable:true,el:{breakEgg:"[breakEgg]",golden_egg:"[golden-egg]",breakEgg_config:"breakEgg-config",barrierLayer:"[barrierLayer]",scratchCard:"[scratchCard]",card_config:"card-config",layer:"[layer]",draw_module:draw_module_el,draw_box:"[draw-box]",draw_item:"[item-no]",the_draw_box:"[draw-box={length}]",oppo_num:"[oppo-num]",oppo_path:"[oppo-path]",draw_exec:"[draw-exec]",show_my_log:"[show-my-log]",show_draw_info:"[show-draw-info]",qrcode:"[qrcode]",show_draw_log:"[show-draw-log]",show_draw_detail:"[show-draw-detail]",dialog_msg:"[dialog-msg]",dialog_get:"[dialog-get]",dialog_miss:"[dialog-miss]",dialog_my_log:"[my-log],[dialog-my-log]",goods_tips:"[goods-tips]",goods_submit:"[goods-submit]",dialog_draw_not_start:"[draw-not-start],[dialog-draw-not-start]",dialog_draw_over:"[draw-over],[dialog-draw-over]",dialog_oppo_get:"[dialog-oppo-get]",dialog_addr_success:"[dialog-addr-success]",dialog_draw_info:"[dialog-draw-info]",dialog_addr_show:"[dialog-addr-show]",productGoods:"[productGoods]",addressInfo:"[addressInfo]",js_draw_pop:"[js-draw-pop]",draw_red_box:".draw-red-box"},props:{disable_class:"disable-class",draw_class:"draw-class",actId:"actId"},draw_constant:{noting:"00",coupon:"20",diamond:"10",goods:"40"},draw_item_types:{"00":"谢谢参与","20":"优惠券","10":"云钻","40":""},draw_item_units:{"00":"","20":"元","10":"","40":""},draw_item_tpl:{"00":'<i class="draw-thanks"></i><p>谢谢参与</p><em></em>',"10":"<i></i><p>{rewardAmount}云钻</p><em></em>","20":'<i class="draw-voucher"></i><p>{rewardAmount}优惠券</p><em></em>',"40":'<img src="{picUrl}"/><span>{prizeName}</span><em></em>'},draw_log_info_tpl:{"1":'<span look-info class="ds-look-info-btn">查看信息</span>',"0":'<span look-info class="ds-look-info-btn">完善信息</span>'},draw_log_tpl:"<li>{customName}抽奖获得{rewardAmount}{rewardName}</li>",draw_log_prize_tpl:"<li>{customName}抽奖获得 {prizeName}</li>",disable_class:"draw-begin-grey",draw_class:"draw-black",draw_item_thanks:{rewardCode:"0",rewardType:"00",rewardAmount:0},oppo:0};function $$(el){return el?$(el,self.module_elm):self.module_elm}function draw2disable(){self.enable=false;$$(self.el.draw_exec).addClass(self.disable_class)}function draw2enable(){if(self.oppo>0&&!self.running&&self.act.activityStatus=="2"){self.enable=true;$$(self.el.draw_exec).removeClass(self.disable_class)}}function changePop(selector,type,deliverGoodsStatus){deliverGoodsStatus=deliverGoodsStatus||"0";type=type||0;$$(selector).find(".lucky-draw-form").not(":last").each(function(){if(type==0){$(this).removeClass("lucky-form-disabled");$(this).find("input").removeAttr("disabled");$(this).find("textarea").removeAttr("disabled")}else{$(this).addClass("lucky-form-disabled");$(this).find("input").attr("disabled","disabled");$(this).find("textarea").attr("disabled","disabled")}});var $btn=$$(selector).find(".lucky-draw-form:last");if(type==0){$btn.text("提交");self.initLuckySubmit(selector)}else{$btn.on("click",function(){$(this).unbind("click");if("0"==deliverGoodsStatus){changePop(selector,0,0)}else{(dialog.version==1)&&dialog.showAlert1("抱歉！奖品已发货，信息无法修改！如有问题，请联系商家！");!(dialog.version==1)&&dialog.showAlert3("抱歉！奖品已发货，信息无法修改！如有问题，请联系商家！")}});$btn.text("修改信息")}}function jschangePop(selector,type,deliverGoodsStatus){deliverGoodsStatus=deliverGoodsStatus||"0";type=type||0;$(selector).find(".lucky-draw-form").not(":last").each(function(){if(type==0){$(this).removeClass("lucky-form-disabled");$(this).find("input").removeAttr("disabled");$(this).find("textarea").removeAttr("disabled")}else{$(this).addClass("lucky-form-disabled");$(this).find("input").attr("disabled","disabled");$(this).find("textarea").attr("disabled","disabled")}});var $btn=$(selector).find(".lucky-draw-form:last");if(type==0){$btn.text("提交");self.initLuckySubmit(selector)}else{$btn.on("click",function(){$(this).unbind("click");if("0"==deliverGoodsStatus){jschangePop(selector,0,0)}else{(dialog.version==1)&&dialog.showAlert1("抱歉！奖品已发货，信息无法修改！如有问题，请联系商家！");!(dialog.version==1)&&dialog.showAlert3("抱歉！奖品已发货，信息无法修改！如有问题，请联系商家！")}});$btn.text("修改信息")}}function draw2run(){self.running=true;draw2disable()}function draw2stop(){self.running=false;draw2enable()}function set2props(){$$("[set-prop]").each(function(i,propelm){var propname=($(propelm).attr("set-prop")||"").trim();var prop=$(propelm).is(":input")?$(propelm).val():$(propelm).html();prop=(prop||"").trim();propname&&prop&&define(propname,prop,self)});for(var prop in self.props){var propname=self.props[prop];var propvalue=$$().attr(propname);propvalue&&(self[prop]=propvalue)}}function fmt4drawType(items){$(items).each(function(i,elm){elm.rewardName=self.draw_item_types[elm.rewardType||"00"];if(elm.rewardType==self.draw_constant.goods){elm.rewardName=elm.prizeName;elm.rewardAmount=""}elm.rewardUnit=self.draw_item_units[elm.rewardType||"00"];elm.rewardTime=elm.rewardTime&&elm.rewardTime.substring(0,16)})}function render_draw_log(logs){logs=logs||[],log_htmls=[];fmt4drawType(logs);if(logs.length>0){$(logs).each(function(i,log){var prizeType=log.rewardType;var tpl=self.draw_log_tpl;if(prizeType&&prizeType!="00"){log_htmls.push(tpl.format(log))}});$$(self.el.show_draw_log+" ul").html(log_htmls.join(""));marquee($$(self.el.show_draw_log))}else{$$(self.el.show_draw_log+" ul").html("<li>暂无抽奖记录！</li>")}}function init_draw_log(){ishop.draw.service.queryActDrawLog(sn.shop.spcode,self.actId,function(actDrawLog){actDrawLog=actDrawLog||{};render_draw_log(actDrawLog.recordList||[])})}function render_draw_items(items){items=(items||[]).copy();items.push(self.draw_item_thanks);fmt4drawType(items);var the_draw_box=$$(self.el.the_draw_box.format(items)),draw_boxes=$$(self.el.draw_box);var draw_item_elms=$(self.el.draw_item,the_draw_box);var draw_item_map={};$(items).each(function(i,item){var itemElm=draw_item_elms.filter("[item-no="+item.rewardCode+"]");var tpl=self.draw_item_tpl[item.rewardType]||"";tpl&&itemElm.html(tpl.format(item));draw_item_map[item.rewardCode]=item});self.draw_item_map=draw_item_map;draw_boxes.hide();the_draw_box.show()}function render_golden_egg(){if($$(self.el.breakEgg).size()==0){return}var data=eval("("+$$(self.el.breakEgg).attr(self.el.breakEgg_config)+")");$$(self.el.breakEgg).addClass(data.hammer);$$(self.el.breakEgg).find(self.el.golden_egg).addClass(data.perfect_egg)}function render_barrierLayer(){if($$(self.el.scratchCard).size()==0){return}var data=eval("("+$$(self.el.scratchCard).attr(self.el.card_config)+")");var size=data.size;var area=data.area;$$(self.el.barrierLayer).eraser({size:size?size:30,completeRatio:area?area:0.2,startRatio:0.01,startFunction:start_move,completeFunction:mask_img_bg})}function start_move(canvas){if(self.oppo<=0){$$(self.el.dialog_msg).show();return}try{ishop.draw.service.draw_exec(sn.shop.spcode,self.actId,function(json){var thanksTxt=json.errorDesc||json.rewardDesc||"";var thanks=thanksTxt.indexOf("谢谢参与")>=0;var dialog_el=self.el.dialog_get;if(thanks||json.rewardCode=="0"){dialog_el=self.el.dialog_miss;json.successFlag=true;json.rewardCode="0";json.rewardDesc=thanksTxt}var item_no=parseInt(json.rewardCode);json.reward=self.draw_item_map[item_no]||self.draw_item_thanks;if(json.successFlag==true){window.debug&&console.info("item_no",item_no);self.oppo=json.surplusTimes;dialog.show(json,$$(dialog_el));$(window).trigger("oppo.path.update");render_vip_oppo(json);if(json.reward.rewardType==self.draw_constant.goods){if(m_is("sfs","qs")){$$(self.el.addressInfo).on("click",function(){dialog.showAddr(0,"","","",$(this).attr("prizeid"));var type=$(self.el.js_draw_pop).attr("data-type");jschangePop(self.el.js_draw_pop,type)})}}}else{dialog.show(json,$$(self.el.dialog_msg));$(window).trigger("oppo.path.update")}$(window).off("oppo.path.update");if(json.surplusTimes==0){update_vip_info()}})}catch(e){self.oppo=0}}function mask_img_bg(canvas){var ids="#"+this.source.id;$$().find(ids).hide()}function render_my_log(viplog){self.oppo=viplog.surplusTimes;fmt4drawType(viplog.recordList);if(dialog.version==1){dialog.showAlert2("我的奖品",$$(self.el.dialog_my_log.split(",")[0],viplog))}else{dialog.show(viplog,$$(self.el.dialog_my_log.split(",")[1]));var reward=handle_log_info(viplog.recordList);addressInfo(reward)}}function handle_log_info(jsonArr){for(var a=0;a<jsonArr.length;a++){if(jsonArr[a].rewardType==self.draw_constant.goods){var phoneNumber=jsonArr[a].phoneNumber||"";var arr=self.draw_log_info_tpl;if(""==phoneNumber){jsonArr[a].tplInfo=arr["0"];jsonArr[a].type="0"}else{jsonArr[a].tplInfo=arr["1"];jsonArr[a].type="1"}}}return jsonArr}function addressInfo(jsonArr){$$(self.el.dialog_my_log).find('[e-each="recordList"]').each(function(){var i=$(this).attr("e-id").split("-")[5];if(jsonArr[i].rewardType==self.draw_constant.goods){$(this).find(self.el.productGoods).append(jsonArr[i].tplInfo);if(m_is("sfs","qs")){$(this).find(self.el.productGoods).find("[look-info]").click(function(){alert_address(jsonArr[i])})}}})}function alert_address(address){with(address){if($$(self.el.dialog_draw_info).parents(".sf-moduleList").attr("moduletype")=="sys.draw"){address.myhref=sn.my_draw_server;dialog.show(address,$$(self.el.dialog_draw_info));$$(self.el.goods_submit).attr("winningId",winningId);setTimeout(function(){self.changePop($$(self.el.dialog_draw_info),type,deliverGoodsStatus)},100);appendExpress($$(self.el.dialog_draw_info),expressCode,expressCompanyName)}else{dialog.showAddr(type,contactsName,phoneNumber,receivingAddress,winningId);var type=$(self.el.js_draw_pop).attr("data-type");jschangePop(self.el.js_draw_pop,type);appendExpress(self.el.js_draw_pop,expressCode,expressCompanyName)}}}function appendExpress(select,expressCode,expressCompanyName){if(expressCode&&expressCompanyName){$(select).find(".lucky-textarea").after(getDrawInfo(expressCode,expressCompanyName));$(select).find(".clipboard").off("click").on("click",function(){var text=document.getElementById("logistics").value;var oInput=document.createElement("input");oInput.value=text;oInput.select();document.body.appendChild(oInput);oInput.select();var result=document.execCommand("Copy");oInput.className="oInput";oInput.style.display="none";window.console.log("复制"+result);var _thisH=($(this).height()/2)-20;var _thisT=$(this).position().top+_thisH;var _thisL=$(this).position().left+75;var _parentW=$(this).parent().width();if((100+_thisL)>_parentW){_thisL=$(this).position().left-110}var copyHtml="<div class='sf-scheck' style='position: absolute;z-index:99'><div><i></i><span>复制成功</span></div></div>";$(this).after(copyHtml);$(".sf-scheck").css({top:_thisT,left:_thisL}).delay(1500).hide(0,function(){$(this).remove()})})}}function getDrawInfo(expressCode,expressCompanyName){var box=[];if(expressCode&&expressCompanyName){box.push('<div class="lucky-draw-form lucky-textarea lucky-form-disabled"><label for="">物流信息</label><div class="logistics-info"><input type="text" style=\'text-align: right;padding:0;\' value="'+expressCompanyName+'" readonly=""><a href="javascript:void(0);" class="clipboard">复制</a><input id="logistics" logistics style=\'text-align: right;width: 70%;padding:0;\' type="text" readonly="" value="'+expressCode+'"></div></div>')}return box.join("")}function render_draw_detail(act){$$(self.el.show_draw_detail).each(function(i,elm){var tplname=$(elm).attr(self.el.show_draw_detail.unwrap());var tpl=self[tplname]||"";tpl&&$(elm).html(tpl.format(act))})}function render_vip_oppo(vip_info){self.vip_info=vip_info;self.vip=true;self.oppo=vip_info.surplusTimes;render_oppo();if(vip_info.surplusTimes==0||(self.act&&self.act.activityStatus==3)){draw2disable()}else{draw2enable()}}function render_oppo(){if(self.oppo!=null){$$(self.el.oppo_num).html(self.oppo+"次")}if(self.oppo==0){draw2disable()}}function update_vip_info(){ishop.draw.service.queryActVipInfo(sn.shop.spcode,self.actId,function(vip_info){vip_info&&render_vip_oppo(vip_info);vip_info&&vip_info.triggerList&&render_oppo_path(vip_info.triggerList);$(window).on("oppo.path.update",function(){vip_info&&vip_info.triggerList&&render_oppo_path(vip_info.triggerList||[])})})}function do_oppo_add(oppo_type){window.debug&&alert("----do_oppo_add");ishop.draw.service.draw_add(sn.shop.spcode,self.actId,oppo_type,function(oppo){window.debug&&alert("----do_oppo_add"+oppo);if(oppo&&oppo.description){(dialog.version==1)&&dialog.showAlert1(oppo.description,"恭喜");!(dialog.version==1)&&dialog.show(oppo,$$(self.el.dialog_oppo_get));update_vip_info()}})}function draw_oppo_add(oppo_type){var oppo_actions={"01":function(){ishop.favorite.add(sn.shop.spcode,function(){do_oppo_add(oppo_type);window.debug&&console.info("shop.favorite.success")},function(){do_oppo_add(oppo_type);window.debug&&console.info("shop.favorite.fail")},function(){window.debug&&console.info("shop.favorite.error")})},"02":function(){}};var oppo_action=oppo_actions[oppo_type];oppo_action&&oppo_action(oppo_type)}function render_oppo_path(triggerList){$$("[oppo]").hide();if(self.act.activityStatus==3){return}var total_oppo=0;for(var i=0;i<triggerList.length;i++){var trigger=triggerList[i],flag=trigger.triggerFlag;flag=flag==null?"0":flag;total_oppo+=parseInt(flag);if(channel=="PC"&&trigger.triggerType=="02"&&flag=="0"){total_oppo++}if(flag==0){$$("[oppo="+trigger.triggerType+"]").show()}if(channel=="PC"&&trigger.triggerType=="02"){$$("[oppo="+trigger.triggerType+"]").hide()}}if(total_oppo<triggerList.length){$$(self.el.oppo_path).show()}else{$$(self.el.oppo_path).hide()}ishop.favorite.check(sn.shop.spcode,function(){$$("[oppo=01]").hide();$$(self.el.oppo_path).hide()},function(){},function(){$$("[oppo=01]").hide()})}function init_act_detail(){ishop.draw.service.queryActDetail(sn.shop.spcode,self.actId,function(actDetail){if(actDetail&&actDetail.rewardList){self.act=actDetail;render_draw_items(actDetail.rewardList);render_golden_egg();render_barrierLayer();if(actDetail.activityStatus==1){draw2disable();(dialog.version==1)&&dialog.showMsg1(self.act,$$(self.el.draw_not_start));!(dialog.version==1)&&dialog.show(self.act,$$(self.el.dialog_draw_not_start),true)}else{if(actDetail.activityStatus==3){draw2disable();(dialog.version==1)&&dialog.showMsg1(self.act,$$(self.el.dialog_draw_over));!(dialog.version==1)&&dialog.show(self.act,$$(self.el.dialog_draw_over),true)}init_draw_log()}render_draw_detail(actDetail);if(!self.vip){self.oppo=actDetail.activityTimes;render_oppo()}actDetail.triggerList&&render_oppo_path(actDetail.triggerList)}else{draw2disable()}})}function initialize(){if(self.moduleid){self.module_elm=$(draw_module_el,".sf-moduleList[moduleid="+self.moduleid+"]")}set2props();var actId=self.actId;if(actId==null){window.error&&console.error("抽奖活动id不存在");return}init_act_detail();if(m_is("sfs")){ishop.util.ensureLogin(function(){update_vip_info()},function(){self.vip=true;$$(self.el.oppo_num).html("登录后查看").attr("ensure-login",true)})}if(m_is("sfs","sdk")){$$().on("click","[ensure-login]",function(){}.ensureLogin(true));$$().on("click",self.el.show_my_log,function(){ishop.draw.service.queryActVipLog(sn.shop.spcode,actId,function(actVipLog){actVipLog&&render_my_log(actVipLog);actVipLog&&render_vip_oppo(actVipLog);actVipLog&&actVipLog.triggerList&&render_oppo_path(actVipLog.triggerList)})});$$().on("click","[oppo-path] [oppo]",function(){var triggerType=$(this).attr("oppo");self.draw_oppo_add(triggerType)})}if(sn.shop.logo){var img_src="{protocol}"+sn.shop.logo;$$(self.el.qrcode).attr("src",img_src.format(location,sn));if(m_is("sfs")){ishop.draw.service.queryWapDrawStatus(function(){var shop_m_draw="{shop_m_context}draw/{spcode}.html".format(sn.shop,location);var img_src=ishop.util.qrcode(shop_m_draw,"100","000000","http:"+sn.shop.logo);$$(self.el.qrcode).attr("src",img_src)},function(){})}}function draw_click(e){if(self.running||!self.enable||self.oppo<=0){return}else{draw2disable()}try{ishop.draw.service.draw_exec(sn.shop.spcode,self.actId,function(json){draw2run();var thanksTxt=json.errorDesc||json.rewardDesc||"";var thanks=thanksTxt.indexOf("谢谢参与")>=0;var dialog_el=self.el.dialog_get;if(thanks||json.rewardCode=="0"){dialog_el=self.el.dialog_miss;json.successFlag=true;json.rewardCode="0";json.rewardDesc=thanksTxt}var item_no=parseInt(json.rewardCode);json.reward=self.draw_item_map[item_no]||self.draw_item_thanks;if(json.successFlag==true){window.debug&&console.info("item_no",item_no);self.oppo=json.surplusTimes;ishop.util.draw_exec_animate($$(),item_no,self.draw_class,function(){setTimeout(function(){if(json.reward.rewardType==self.draw_constant.goods){$(self.el.goods_submit).attr("winningId",json.winningId);dialog.show(json,$$(dialog_el));setTimeout(function(){self.initLuckySubmit()},100);if(m_is("sfs","qs")){$$(self.el.addressInfo).on("click",function(){dialog.showAddr(0,"","","",$(this).attr("prizeid"));var type=$(self.el.js_draw_pop).attr("data-type");jschangePop(self.el.js_draw_pop,type)})}}else{(dialog.version==1)&&dialog.showAlert1(json.rewardDesc);!(dialog.version==1)&&dialog.show(json,$$(dialog_el))}$(window).trigger("oppo.path.update");draw2stop()},1000)});render_vip_oppo(json)}else{(dialog.version==1)&&dialog.showAlert1(json.errorDesc);!(dialog.version==1)&&dialog.show(json,$$(self.el.dialog_msg));$(window).trigger("oppo.path.update");draw2stop()}$(window).off("oppo.path.update");if(json.surplusTimes==0){update_vip_info()}})}catch(e){self.draw_enable()}}function egg_click(e){var egg=$(this);var eggConfig=$$(self.el.breakEgg);var data=eval("("+eggConfig.attr(self.el.breakEgg_config)+")");eggConfig.removeClass(data.hammer);eggConfig.addClass(data.break_hammer);setTimeout(function(){eggConfig.removeClass(data.break_hammer);eggConfig.addClass(data.hammer);egg.removeClass(data.perfect_egg);egg.addClass(data.broken_egg);if(self.oppo<=0){setTimeout(function(){var msg=$$(self.el.dialog_msg);msg.show();msg.find(self.el.layer).show();egg.removeClass(data.broken_egg);egg.addClass(data.perfect_egg)},1000);return}try{ishop.draw.service.draw_exec(sn.shop.spcode,self.actId,function(json){var thanksTxt=json.errorDesc||json.rewardDesc||"";var thanks=thanksTxt.indexOf("谢谢参与")>=0;var dialog_el=self.el.dialog_get;if(thanks||json.rewardCode=="0"){dialog_el=self.el.dialog_miss;json.successFlag=true;json.rewardCode="0";json.rewardDesc=thanksTxt}var item_no=parseInt(json.rewardCode);json.reward=self.draw_item_map[item_no]||self.draw_item_thanks;if(json.successFlag==true){window.debug&&console.info("item_no",item_no);self.oppo=json.surplusTimes;setTimeout(function(){dialog.show(json,$$(dialog_el));$(window).trigger("oppo.path.update");egg.removeClass(data.broken_egg);egg.addClass(data.perfect_egg);if(json.reward.rewardType==self.draw_constant.goods){if(m_is("sfs","qs")){$$(self.el.addressInfo).on("click",function(){dialog.showAddr(0,"","","",$(this).attr("prizeid"));var type=$(self.el.js_draw_pop).attr("data-type");jschangePop(self.el.js_draw_pop,type)})}}},1000);render_vip_oppo(json)}else{setTimeout(function(){dialog.show(json,$$(self.el.dialog_msg));$(window).trigger("oppo.path.update");egg.removeClass(data.broken_egg);egg.addClass(data.perfect_egg)},1000)}$(window).off("oppo.path.update");if(json.surplusTimes==0){update_vip_info()}})}catch(e){self.oppo=0}},data.delay_time)}function drawTest(){testCases.draw_animate($$())}if(m_is("sfs","sdk")){var draw_test=$.request.get("draw_test");$$().on("click",self.el.draw_exec,draw_test?drawTest:draw_click.ensureLogin());$$().on("click",self.el.golden_egg,egg_click.ensureLogin());$$().on("click",$$(self.el.draw_module+"[href]"),function(e){if($(e.target).parents(self.el.draw_red_box).length==1||$(e.target).parents("[dialog]").length==1||$(e.target).is("li")||$(e.target).is("a")){return}var href=$(this).attr("href");href&&(location.href=href)})}m_is("sfs","qs")&&$$().on("click","[sa-uv]:not([sa-uv=prize_bg]),[noop],[dialog]",function(event){})}function init_lucky_submit(obj){obj=obj||$$(self.el.dialog_get);$(obj).find(self.el.goods_submit).on("click",function(){var errMsg="",constantName=$(obj).find("input:eq(0)").val(),constantPhone=$(obj).find("input:eq(1)").val(),constantAddress=$(obj).find(".textarea").val();if(!constantName){errMsg="收货人姓名不能为空"}if(!errMsg&&!constantName.length>10){errMsg="收货人长度不能超过10个字符"}if(!errMsg&&!constantPhone){errMsg="电话不能为空！"}var reg=/^1[0-9]{10}$/;if(!errMsg&&!(reg.test(constantPhone))){errMsg="电话格式输入错误，请输入正确的手机号码！"}if(!errMsg&&!constantAddress){errMsg="收货地址不能为空"}if(!errMsg&&constantAddress.length>60){errMsg="收货地址长度不能超过60个字"}if(errMsg){$(obj).find(self.el.goods_tips).empty().html('<i class="warn"></i>'+errMsg);$(obj).find(self.el.goods_tips).show();return}ishop.draw.service.drawSaveAddress(sn.shop.spcode,self.actId,$(this).attr("winningid"),constantName,constantPhone,constantAddress,function(json){if(json.success){dialog.show({oper:"提交"},$$(self.el.dialog_addr_success));if($$(self.el.dialog_addr_success).length==0){dialog.showAlertWithDialog("dialog_success",json.message)}}else{(dialog.version==1)&&dialog.showAlert1(json.message);!(dialog.version==1)&&dialog.showAlert3(json.message)}})})}var proto={alertAddress:alert_address,initLuckySubmit:init_lucky_submit,initialize:initialize,draw2disable:draw2disable,changePop:changePop,draw_oppo_add:draw_oppo_add.ensureLogin()};$.extend(self,proto);return self}var instances=[];function initialize(){if($(draw_module_el).size()==0){return}$(draw_module_el).each(function(i,elm){var draw_module_elm=$(elm);var moduleid=draw_module_elm.parents("[moduleid]").attr("moduleid");if(!moduleid){moduleid="ds-draw-module-"+i;draw_module_elm.parents("[moduleid]").attr("moduleid",moduleid)}var init_event_name="module.initialize."+moduleid;var draw_module=drawproto(moduleid);draw_module.initialize();$(window).off(init_event_name).on(init_event_name,function(){draw_module.initialize()});instances.push(draw_module)})}return{instances:instances,initialize:initialize}}());var smear={init:function(options){return this.each(function(){var $this=$(this),data=$this.data("eraser");if(!data){var width=$this.width(),height=$this.height(),pos=$this.offset(),$canvas=$("<canvas/>"),canvas=$canvas.get(0),size=(options&&options.size)?options.size:40,completeRatio=(options&&options.completeRatio)?options.completeRatio:0.7,startRatio=(options&&options.startRatio)?options.startRatio:0.1,startFunction=(options&&options.startFunction)?options.startFunction:null,completeFunction=(options&&options.completeFunction)?options.completeFunction:null,parts=[],colParts=Math.floor(width/size),numParts=colParts*Math.floor(height/size),n=numParts,ctx=canvas.getContext("2d");$this.after($canvas);canvas.id=this.id;canvas.className=this.className;canvas.width=width;canvas.height=height;ctx.drawImage(this,0,0,width,height);$this.remove();ctx.globalCompositeOperation="destination-out";ctx.strokeStyle="rgba(255,0,0,255)";ctx.lineWidth=size;ctx.lineCap="round";$canvas.bind("mousedown.eraser",smear.mouseDown);$canvas.bind("touchstart.eraser",smear.touchStart);$canvas.bind("touchmove.eraser",smear.touchMove);$canvas.bind("touchend.eraser",smear.touchEnd);while(n--){parts.push(1)}data={posX:pos.left,posY:pos.top,touchDown:false,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:$canvas,ctx:ctx,w:width,h:height,source:this,size:size,parts:parts,colParts:colParts,numParts:numParts,ratio:0,complete:false,start:false,completeRatio:completeRatio,startRatio:startRatio,startFunction:startFunction,completeFunction:completeFunction};$canvas.data("eraser",data);$(window).resize(function(){var pos=$canvas.offset();data.posX=pos.left;data.posY=pos.top})}})},touchStart:function(event){var $this=$(this),data=$this.data("eraser");if(!data.touchDown){var t=event.originalEvent.changedTouches[0],tx=t.pageX-data.posX,ty=t.pageY-data.posY;smear.evaluatePoint(data,tx,ty);data.touchDown=true;data.touchID=t.identifier;data.touchX=tx;data.touchY=ty;event.preventDefault()}},touchMove:function(event){var $this=$(this),data=$this.data("eraser");if(data.touchDown){var ta=event.originalEvent.changedTouches,n=ta.length;while(n--){if(ta[n].identifier==data.touchID){var tx=ta[n].pageX-data.posX,ty=ta[n].pageY-data.posY;smear.evaluatePoint(data,tx,ty);data.ctx.beginPath();data.ctx.moveTo(data.touchX,data.touchY);data.touchX=tx;data.touchY=ty;data.ctx.lineTo(data.touchX,data.touchY);data.ctx.stroke();event.preventDefault();break}}}},touchEnd:function(event){var $this=$(this),data=$this.data("eraser");if(data.touchDown){var ta=event.originalEvent.changedTouches,n=ta.length;while(n--){if(ta[n].identifier==data.touchID){data.touchDown=false;event.preventDefault();break}}}},evaluatePoint:function(data,tx,ty){var p=Math.floor(tx/data.size)+Math.floor(ty/data.size)*data.colParts;if(p>=0&&p<data.numParts){data.ratio+=data.parts[p];data.parts[p]=0;if(!data.start){if(data.ratio/data.numParts>=data.startRatio){data.start=true;if(data.startFunction!=null){data.startFunction()}}}if(!data.complete){if(data.ratio/data.numParts>=data.completeRatio){data.complete=true;if(data.completeFunction!=null){data.completeFunction()}}}}},mouseDown:function(event){var $this=$(this),data=$this.data("eraser"),tx=event.pageX-data.posX,ty=event.pageY-data.posY;smear.evaluatePoint(data,tx,ty);data.touchDown=true;data.touchX=tx;data.touchY=ty;data.ctx.beginPath();data.ctx.moveTo(data.touchX-1,data.touchY);data.ctx.lineTo(data.touchX,data.touchY);data.ctx.stroke();$this.bind("mousemove.eraser",smear.mouseMove);$(document).bind("mouseup.eraser",data,smear.mouseUp);event.preventDefault()},mouseMove:function(event){var $this=$(this),data=$this.data("eraser"),tx=event.pageX-data.posX,ty=event.pageY-data.posY;smear.evaluatePoint(data,tx,ty);data.ctx.beginPath();data.ctx.moveTo(data.touchX,data.touchY);data.touchX=tx;data.touchY=ty;data.ctx.lineTo(data.touchX,data.touchY);data.ctx.stroke();event.preventDefault()},mouseUp:function(event){var data=event.data,$this=data.canvas;data.touchDown=false;$this.unbind("mousemove.eraser");$(document).unbind("mouseup.eraser");event.preventDefault()},clear:function(){var $this=$(this),data=$this.data("eraser");if(data){data.ctx.clearRect(0,0,data.w,data.h);var n=data.numParts;while(n--){data.parts[n]=0}data.ratio=data.numParts;data.complete=true;if(data.completeFunction!=null){data.completeFunction()}}},size:function(value){var $this=$(this),data=$this.data("eraser");if(data&&value){data.size=value;data.ctx.lineWidth=value}},reset:function(){var $this=$(this),data=$this.data("eraser");if(data){data.ctx.globalCompositeOperation="source-over";data.ctx.drawImage(data.source,0,0);data.ctx.globalCompositeOperation="destination-out";var n=data.numParts;while(n--){data.parts[n]=1}data.ratio=0;data.complete=false}}};$.fn.eraser=function(method){if(smear[method]){return smear[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return smear.init.apply(this,arguments)}else{$.error("Method "+method+" does not yet exist on jQuery.eraser")}}};define("ishop.coupon.view",function(){var QUAN_RENDER_STRATEGY_API="API-EACH",QUAN_RENDER_STRATEGY_ID="ID-GROUP-EACH";var self={now:Date.now(),debug:req["q.debug"],el:{api:"[sale-querycoupon]",the_api:'[sale-querycoupon="{qIds}"]',coupon_get:"[coupon-get]"},QUAN_GROUP_LENGTH:5,QUAN_RENDER_STRATEGY_API:QUAN_RENDER_STRATEGY_API,QUAN_RENDER_STRATEGY_ID:QUAN_RENDER_STRATEGY_ID,QUAN_RENDER_STRATEGY:QUAN_RENDER_STRATEGY_ID,cache:{},cache_key:{},api_cache:{},qIds:[],status_map:{"1":"未开始","2":"进行中","3":"已结束","4":"已领取","5":"已领完"},prop_map:{activityId:"qId",activityName:"qname",activitySecretKey:"qkey",startTime:"atime1",endTime:"atime2",actStatus:"qstatus1",couponAmount:"qamount",couponType:"qtype",couponRulesStartTime:"usetime1",couponRulesEndTime:"usetime2",couponRulesShowMsg:"qdetail",rewardsPreferential:"qrule",isReceive:"isgot",remainAmt:"ramount",remainCount:"rcount",dayRemainCount:"drcount",memberDayRemainCount:"mdrcount",memberRemainCount:"mrcount"},ireq:0};function format_map(source_map,prop_map){var formated_map={};if(!source_map.qId){for(var prop in prop_map){var source_v=source_map[prop];if(source_v){var to_prop=prop_map[prop];formated_map[to_prop]=source_map[prop]}}}else{formated_map=source_map}if(formated_map.qamount&&formated_map.qamount.match(/\d+\.+0+/)){formated_map.qamount=parseInt(formated_map.qamount)||0}if(formated_map.qstatus==null&&formated_map.atime1&&formated_map.atime2){var atime11=Date.parse(formated_map.atime1);var atime22=Date.parse(formated_map.atime2);formated_map.qstatus=self.now.lt(atime11)?1:self.now.gte(atime11)&&self.now.lt(atime22)?2:3}if(formated_map.qstatus!=null){formated_map.qstatusName=self.status_map[formated_map.qstatus]}if(formated_map.isgot!=null){var isgot0=formated_map.isgot==1;with(formated_map){var out=formated_map.rcount==0||formated_map.drcount==0||formated_map.ramount==0;if(isgot0){formated_map.qstatus=4}if(out){formated_map.qstatus=5}}}if(formated_map.qkey){self.cache_key[formated_map.qId]=formated_map.qkey}return formated_map}function format_list(json){json.success=json.queryResults=="1"||json.resultFlag=="1";var qlist=json.qlist||json.coupon_list||json.actInfoList||json.activityList||[];var formated_list=[];for(var i=0;i<qlist.length;i++){var quan=qlist[i];var formated_quan=format_map(quan,self.prop_map);formated_list.push(formated_quan)}json.qlist=formated_list;return formated_list}function query_coupon(qIds,callback){var service_name="service.quan.list.url",call_no=self.ireq++,timeid=(new Date).getTime();var callback_name="quan$coupon$callback$"+call_no+"$"+timeid;function callback$proxy(json){json=$.extend({},json);format_list(json);callback&&callback(json)}window[callback_name]=function(){window.debug&&console.info(service_name,json);!self.debug&&callback$proxy.apply(self,Array.copy(arguments));self.debug&&callback$proxy(ishop.coupon.sample.coupon_request);window[callback_name]=null};var url=sn.service[service_name].format(sn,{actIds:qIds.join(",")},sn.shop,{callback:callback_name});$.jsonp(url,{},$.noop,function(){window.error&&console.info(service_name,"error")})}function query_coupon_group(qids,callback){var qIds_arr=Array.prototype.split.apply(qids,[self.QUAN_GROUP_LENGTH]);qIds_arr.each_delay(function(i,qIds,eo){self.query_coupon(qIds,function(json){$.extend(self.cache,json.qlist.tomap("qId"));eo.next()})},-1,function(){var qarr=map2array(self.cache,true,qids);callback({qlist:qarr})})}function query_coupon_progress(qIds,callback){var service_name="service.quan.progress.url";var url=sn.service[service_name].format(sn);var params={actIds:qIds.join(","),channel:"1"};function callback$proxy(json){json=$.extend({},json);format_list(json);callback&&callback(json)}$.jsonp(url,params,function(){window.debug&&console.info(service_name,json);format_list.apply(self,Array.copy(arguments));!self.debug&&callback$proxy.apply(self,Array.copy(arguments));self.debug&&callback$proxy(ishop.coupon.sample.progress)},function(){window.error&&console.info(service_name,"error")})}function render_quan(apiElm,data){$(apiElm).elmout(data,self);$(window).trigger("coupon.loaded")}function push2api_cache(ids,$qarr){var qarr=self.api_cache[ids]||[],qIds=ids.split(",");self.api_cache[ids]=qarr;if(qarr.length==0){qarr.push_all($qarr)}else{var map1=qarr.tomap("qId");var map2=$qarr.tomap("qId");for(var qId in map2){var q2=map2[qId];var q1=map1[qId];if(q1&&q2){$.extend(q1,q2)}else{if(q2){map1[qId]=q2}}}qarr.$clear().push_all(map2array(map1,true,qIds))}return qarr}function api_each_group(callback){for(var ids in self.api_cache){var qIds=ids.split(",");if(qIds.length>0){function closure(qIds,ids){var qIds_arr=qIds.split(self.QUAN_GROUP_LENGTH);qIds_arr.each_delay(function(i,$qIds){callback&&callback(i,$qIds,ids)},100)}closure(qIds,ids)}}}function push2cache(data){var qids=map2array(data);for(var i=0;i<qids.length;i++){var qid=qids[i];var q0=self.cache[qid],q1=data[qid];if(q0&&q1){if(q0.isgot){var q=$.extend(q1,q0);$.extend(q0,q)}else{if(q1.isgot){$.extend(q0,q1)}}}else{if(q1.isgot||q1.qrule){self.cache[qid]=q1}}}}function response_coupon(){var couponApiElms=$(self.el.api),api_prop=self.el.api.unwrap();couponApiElms.each(function(i,apiElm){var qIds=$(apiElm).attr(api_prop)||"";qIds=qIds.split(",");if(qIds.length>0){self.api_cache[qIds]=null;self.qIds.push_all(qIds)}});if(self.QUAN_RENDER_STRATEGY=="ID-GROUP-EACH"){$(window).on("shop.coupon.update",function(){for(var ids in self.api_cache){var qIds=ids.split(",");var qarr=map2array(self.cache,true,qIds)||[];if(qarr&&qarr.length>0){qarr=push2api_cache(ids,qarr)}$(self.el.the_api.format({qIds:qIds.join(",")})).each(function(i,apiElm){render_quan(apiElm,{qlist:qarr})})}});if(self.qIds.length>0){self.qIds=map2array(self.qIds.tomap())}var qIds_arr=self.qIds.split(self.QUAN_GROUP_LENGTH);qIds_arr.each_delay(function(i,qIds){self.query_coupon(qIds,function(json){push2cache(json.qlist.tomap("qId"));$(window).trigger("shop.coupon.update")})},100)}else{if(self.QUAN_RENDER_STRATEGY=="API-EACH"){api_each_group(function(i,qIds,ids){self.query_coupon(qIds,function(json){if(json.qlist.length>0){var qarr=json.qlist;qarr=push2api_cache(ids,qarr);push2cache(qarr.tomap("qId"));json.qlist=qarr}$(self.el.the_api.format({qIds:ids})).each(function(i,apiElm){render_quan(apiElm,json)})})})}}}function response_coupon_progress(){self.debug&&console.info("islogin to response coupon progress");api_each_group(function(i,qIds,ids){self.query_coupon_progress(qIds,function(json){if(json.qlist.length>0){var qarr=json.qlist;qarr=push2api_cache(ids,qarr);push2cache(qarr.tomap("qId"));json.qlist=qarr;$(self.el.the_api.format({qIds:ids})).each(function(i,apiElm){render_quan(apiElm,json)})}})});self.coupon_progress_queried=true}function coupon2get(qId,qkey){var cityId=(d("SN_CITY")||"100_010").split("|")[0].split("_")[1];var paramObj={cityId:cityId,actId:qId,actKey:qkey||self.cache_key[qId],sourceId:"5001"};self.debug&&console.table([paramObj]);if(m_is("sfs")){coupon.receive.receiveCoupon(paramObj,function(result){self.debug&&console.info("coupon-get",arguments);if(result&&result.resultCode=="0"){self.debug&&console.info("coupon get success")}else{self.debug&&console.info("coupon get fail")}})}else{if(m_is("ts","sdk")){alert("恭喜,领取成功!","优惠券领取")}}}function initialize(){window.sa=window.sa||{};sa.bid=null;if($(self.el.api).length>0){response_coupon();m_is("sfs","qs")&&ishop.util.ensureLogin(function(){response_coupon_progress()})}var coupon_get_prop=self.el.coupon_get.unwrap();if(m_is("sfs","sdk","ts")){$(document).on("click",self.el.coupon_get,function(){if(m_is("sfs")){if(!self.coupon_progress_queried){response_coupon_progress()}var qId=$(this).attr(coupon_get_prop);var qkey=self.cache_key[qId];if(qkey==null){self.query_coupon([qId],function(json){$.extend(self.cache,json.qlist.tomap("qId"));qkey=self.cache_key[qId];self.coupon2get(qId,qkey)})}else{self.coupon2get(qId,qkey)}}else{if(m_is("ts","sdk")){alert("恭喜,领取成功!","优惠券领取")}}}.ensureLogin(true))}}function pointcut(proxy,ioc,sampleDataName){if(m_is("sfs","ds")){return proxy()}else{var callback=ioc.di("callback");var qIds=ioc.di("qIds")||"";req.debug&&console.info(ioc.argmap.names);function callback$proxy(json){json=$.extend({},json);format_list(json);$.extend(self.cache,json.qlist.tomap("qId"));var qarr=map2array(self.cache,true,qIds);json.qlist=qarr;callback&&callback(json)}callback$proxy(ishop.coupon.sample[sampleDataName])}}var proto={initialize:initialize,coupon2get:coupon2get,query_coupon_group:query_coupon_group,query_coupon_progress:query_coupon_progress.aop(pointcut,"progress"),query_coupon:query_coupon.aop(pointcut,"coupon_request")};$.extend(self,proto);return self}());ishop.coupon.sample={coupon_request:{queryResults:"1",failureReasons:"",actInfoList:[{activityId:"1",activityName:"111",activitySecretKey:"111",startTime:"2017-10-05 17:47:26",endTime:"2017-10-05 17:47:30",couponAmount:"10",couponType:"",actStatus:"4",couponRulesStartTime:"2017-10-05 17:47:57",couponRulesEndTime:"2017-10-05 17:48:00",couponRulesShowMsg:"满1000000000元使用，限该店铺内使用",rewardsPreferential:"满100减10"},{activityId:"2",activityName:"222",activitySecretKey:"222",startTime:"2017-10-05 17:47:26",endTime:"2017-10-05 17:47:30",couponAmount:"20",couponType:"",actStatus:"8",couponRulesStartTime:"2017-10-05 17:47:57",couponRulesEndTime:"2017-10-05 17:48:00",couponRulesShowMsg:"满2000000000元使用，限该店铺内使用",rewardsPreferential:"满200减20"},{activityId:"3",activityName:"333",activitySecretKey:"333",startTime:"2017-10-05 17:47:26",endTime:"2017-10-05 17:47:30",couponAmount:"30",couponType:"",actStatus:"4",couponRulesStartTime:"2017-10-05 17:47:57",couponRulesEndTime:"2017-10-05 17:48:00",couponRulesShowMsg:"满3000000000元使用，限该店铺内使用",rewardsPreferential:"满300减30"},{activityId:"4",activityName:"444",activitySecretKey:"444",startTime:"2017-10-05 17:47:26",endTime:"2017-10-05 17:47:30",couponAmount:"40",couponType:"",actStatus:"7",couponRulesStartTime:"2017-10-05 17:47:57",couponRulesEndTime:"2017-10-05 17:48:00",couponRulesShowMsg:"满4000000000元使用，限该店铺内使用",rewardsPreferential:"满400减40"},{activityId:"5",activityName:"555",activitySecretKey:"555",startTime:"2017-10-05 17:47:26",endTime:"2017-10-05 17:47:30",couponAmount:"50",couponType:"",actStatus:"4",couponRulesStartTime:"2017-10-05 17:47:57",couponRulesEndTime:"2017-10-05 17:48:00",couponRulesShowMsg:"满5000000000元使用，限该店铺内使用",rewardsPreferential:"满500减50"}]},progress:{resultFlag:"1",failCode:"S0001",failMessage:"系统异常",activityList:[{activityId:"1",isReceive:"1",receiveTimes:"2",remainAmt:100,actCount:10,remainCount:2,dayRemainCount:1,memberDayRemainCount:1,memberRemainCount:1},{activityId:"2",isReceive:"1",receiveTimes:"2",remainAmt:0,actCount:10,remainCount:2,dayRemainCount:1,memberDayRemainCount:1,memberRemainCount:1},{activityId:"3",isReceive:"2",receiveTimes:"2",remainAmt:100,actCount:10,remainCount:0,dayRemainCount:1,memberDayRemainCount:1,memberRemainCount:1},{activityId:"4",isReceive:"2",receiveTimes:"2",remainAmt:100,actCount:10,remainCount:2,dayRemainCount:1,memberDayRemainCount:1,memberRemainCount:1},{activityId:"5",isReceive:"2",receiveTimes:"2",remainAmt:0,actCount:10,remainCount:0,dayRemainCount:1,memberDayRemainCount:1,memberRemainCount:1}]}};try{ishop.coupon.sample=window.datasource.coupon.sample||ishop.coupon.sample}catch(e){}$(window).on("draw-module.initialize module.initialize",function(){ishop.draw.view.initialize()});$(window).on("coupon-module.initialize module.initialize",function(){ishop.coupon.view.initialize()});$(function(){window.testCases={draw_animate:function(context){context=context||document;var draw_box=$("[draw-box]:visible",context);var draw_items=$("[item-no]",draw_box);var item_length=draw_items.length;var item_no=(Math.random()*100)%item_length;ishop.util.draw_exec_animate(context,parseInt(item_no),"draw-black",function(){setTimeout(function(){dialog.showAlert1("draw_test")},1000)})},"draw.btn.disable":function(){ishop.draw.view.draw2disable()},"dialog.oppo.get":function(){dialog.show({description:"恭喜获得一次抽奖机会哟！"},ishop.draw.view.el.dialog_oppo_get)},"dialog.miss":function(){dialog.show({rewardDesc:"你没有抽到奖品！"},ishop.draw.view.el.dialog_miss)},"dialog.msg":function(){dialog.show({errorDesc:"机会用完了"},ishop.draw.view.el.dialog_msg)},initialize:function(){ishop.util.marquee()}};var test=$.request.get("test")||"";var testCase=testCases[test];testCase&&testCase();if(!testCase){var testArgs=test.split(":");var testCaseName=testArgs[0]||"";testCase=testCases[testCaseName];testCase&&testCase(testArgs[1]||"")}ishop.draw.view.initialize();ishop.coupon.view.initialize()})})();$(function(){var debug=location.href.indexOf("debug")>=0;var shopType=sn.shop.shopType;var sfsHeadSearchUrl=sn.config.header_search;var shopCart_Link=sn.config.cart;var shop_context=sn.shop.context;var shop_search=shop_context+sn.shop.shopId+"/"+sn.shop.search;var spcode=sn.shop.spcode;var shopType=sn.shop.shopType;var cart_disable=window.cart_disable||false;var header={parseJSON:function(sjson){try{return eval("("+sjson+")")}catch(e){console.info(e.message)}},fixWidth:function(){String.prototype.getCnStrLen=function(){return this.replace(/[^\x00-\xff]/g,"aa").length};var wH=$(window).width();if(wH>1200){$(".g-header .wrapper").addClass("wrapper2");$(".g-toolbar .wrapper").addClass("wrapper2");$(".ng-toolbar .ng-toolbar-con").addClass("wrapper2");var len=$("#chead_indexUrl strong").html()||"";if(len.getCnStrLen()>34){$("#chead_indexUrl strong").html(len.substr(0,15)+"...")}}else{$(".g-header .wrapper").removeClass("wrapper2");$(".g-toolbar .wrapper").removeClass("wrapper2");$(".ng-toolbar .ng-toolbar-con").removeClass("wrapper2");var len=$("#chead_indexUrl strong").html()||"";if(len.getCnStrLen()>24){$("#chead_indexUrl strong").html(len.substr(0,10)+"...")}}},gdshop:{show:function(){var shopId=sn.shop.shopId;$.ajax({url:shop_context+"ajax/getGdShopInfo_"+shopId+"/gdinfo.html",dataType:"jsonp",cache:true,jsonpCallback:"gdinfo",success:renderGdInfo,error:function(){console.info("加载页头馆标识相关信息失败")}});function renderGdInfo(data){if(data!=null&&data.gdShopMark!=null&&data.gdShopMark.length>0){$("#gdShopMark").attr("title",data.gdShopMark);$("#gdShopMark").text(data.gdShopMark);$("#gdShopMark").show()}else{$("#gdShopSpan").hide()}}}},guide:{show:function(){var shopId=sn.shop.shopId;var districtCode=null;GUIDESHOP.base.getCity(function(cityId){$.ajax({url:shop_context+"ajax/GuideShopSign_"+shopId+"_"+cityId+"_"+districtCode+"/guideinfo.html",dataType:"jsonp",cache:true,jsonpCallback:"guideinfo",success:renderGuideInfo,error:function(){debug&&console.info("加载页头向导店相关信息失败")}})});function getCityId(){return d("cityId")||9173}function searchStoreByDistrictCode(districtCode){var shopId=sn.shop.shopId;GUIDESHOP.base.getCity(function(cityId){$.ajax({url:shop_context+"ajax/GuideShopSign_"+shopId+"_"+cityId+"_"+districtCode+"/guideinfo.html",dataType:"jsonp",cache:true,jsonpCallback:"guideinfo",success:renderGuideShopListInfo,error:function(){console.info("加载页头向导店相关信息失败")}})})}function renderGuideShopListInfo(data){if(data!=null&&data.districtList!=null&&data.districtList.length>0){$("#guidShopLogoPlay").attr("style","display:block");$(".storeListContainer").html("");for(var j=0;j<data.guideShopList.length;j++){var htmlAddress=sn.shop.shopContext+"guide_"+data.guideShopList[j].storeCode+".html";$(".storeListContainer").append("<tr><td width='410'><i class='sf-map'></i>"+data.guideShopList[j].storeAddress+"</td><td><a href='"+htmlAddress+"' target='_blank'>查看门店样品</a></td></tr>")}}else{$("#guideShopLogo").attr("style","display:none");$("#guideShopAround").attr("style","display:none");$("#guidShopLogoPlay").attr("style","display:none")}}function renderGuideInfo(data){if(data!=null&&data.districtList!=null&&data.districtList.length>0){$("#guidShopLogoPlay").show();$("#guideShopLogo").show();$("#guideShopAround").hide();for(var i=0;i<data.districtList.length;i++){var area=data.districtList[i].districtCode;$(".districtContainer").append("<a href='#' pguide-area='"+area+"'>"+data.districtList[i].districtName+"</a>")}for(var j=0;j<data.guideShopList.length;j++){var htmlAddress=sn.shop.shopContext+"guide_"+data.guideShopList[j].storeCode+".html";$(".storeListContainer").append("<tr><td width='410'><i class='sf-map'></i>"+data.guideShopList[j].storeAddress+"</td><td><a href='"+htmlAddress+"' target='_blank'>查看门店样品</a></td></tr>")}var el="[pguide]";var pcode=[];var doItem=$(el).filter(function(index){var pcode=$(this).attr("pguide");return/^\d{9}$/.test(pcode)});doItem.each(function(i,elm){pcode[i]=$(this).attr("pguide")});var shopId=sn.shop.shopId;var callback="getGuide";if(pcode.length>0){var pcodeStr=pcode.join(",");$.ajax({url:shop_context+"ajax/getGuideShopProductSign_"+shopId+"_"+pcodeStr+"_"+callback+".html",dataType:"jsonp",cache:false,jsonpCallback:callback,success:function(data){for(var j=0;j<pcode.length;j++){if(data[pcode[j]].indexOf(getCityId())!=-1){var hasPicElm="[pguide={pcodeHas}]".format({pcodeHas:pcode[j]});$(hasPicElm).each(function(){$(this).show()})}}},error:function(){console.info("加载页头向导店相关信息失败")}})}$("#searchGuideBox").show();$("#classSearchGuideBox").show();header.guide.guideShopOpen();$("[pguide-area]").live("click",function(){$(this).siblings().removeClass("cur");$(this).addClass("cur");var area=$(this).attr("pguide-area");searchStoreByDistrictCode(area)})}else{$("#guideShopLogo").hide();$("#guideShopAround").hide();$("#searchGuideBox").hide();$("#guidShopLogoPlay").hide()}}},guideShopOpen:function(){var _trytoShopHtml=$(".JS-sf-trytoShop").html();$(".JS-nearby-store").popWin({width:610,titleTxt:"身边的门店",content:_trytoShopHtml,showBtn:false,callback:function(o,fn,e){}})}},ad:{load:function(op){var o=$.extend({close:"[sf-ad-close]"||".close-btn",target:"[sf-ad-content]"||"#cshopAdheaderInfo",container:"[sf-ad]"||"#__CSHOPTOP_ACTIVE__"},op);var container=$(o.container);if(container.size()==0){return}var target=$(o.target,container);var close=$(o.close,container);close.click(function(e){container.hide()});var adUrl=shop_context+"ajax/getShopAdHeader/shopAdHeaderInfo.html";container&&$.ajax({url:adUrl,dataType:"jsonp",jsonpCallback:"shopAdHeaderInfo",cache:true,success:function(json){if(json&&"1"===json.isShown){target.html(json.ad);container.show()}else{container.hide()}},error:function(){container.hide()}})},bind:function(){var ad_attr="sf-ad";var container=$("["+ad_attr+"]");var config=header.parseJSON(container.attr(ad_attr)||"{}");container.length&&this.load(config)}},cart:{getNum:function(){return d("totalProdQty")||"0"},bind:function(){var cart=this;$("#cartShopNum").text(this.getNum());$("#shopCartLink").mouseover(function(){$("#cartShopNum").text(cart.getNum())});$("#shopCartLink").click(function(){if(shopCart_Link&&!cart_disable){document.location=shopCart_Link}});$(window).scroll(function(){var topM=$(document).scrollTop();if(topM>5){$("#gSideTools").find("li.backtop").show()}else{$("#gSideTools").find("li.backtop").hide()}});getSupplierState("#rightFloatService,#onlineService1,#beforeService1","00"+spcode,shopType);$("#rightFloatService,#onlineService1,#beforeService1").click(function(){findpassSupplier("00"+spcode,"","","")});$("#afterService1").live("click",function(){findpass("","","")})}},search:{bind:function(){if(sn.shop.shopType=="3"&&$("#snKeywordNewHwg").length>0){var callback="showHwgHotkeywords";var hotUrl=sn.config.sfs_ds_domain+"ds/hotkeywords/22010--{callback}.xjsonp?callback={callback}".format({callback:callback});$.ajax({url:hotUrl,dataType:"jsonp",jsonpCallback:callback,cache:true,success:function(json){if(json&&json.html){$("#snKeywordNewHwg").append(json.html);$("#searchKeywords").val($("#searchDefaultKeyword").val()||"");$("#snKeywordNewHwg").find("font").each(function(i,elm){$(elm).css({color:"#a390e4"})})}else{}},error:function(){debug&&console.info("海外购调热词异常")}})}$("#ac_results").on("click","li",function(){var keyWord=$("#searchKeywords").val();keyWord=resolveStr(keyWord);var url="";if($(this).hasClass("g-ac-store")){url=sfsHeadSearchUrl+"shop/search.do?app=shopsearch&keyword="+keyWord;document.location=url}else{if($(this).hasClass("cateSearch")){url=sfsHeadSearchUrl+keyWord+"/&ci="+$(this).attr("categoryid");document.location=url}else{keyWord=$(this).find("span").eq(0).text();$("#searchKeywords").val(keyWord)}}});$("#searchShopSubmit").click(function(){var keyWord=$("#searchKeywords").val();Shop.search.searchTo({keyword:keyWord},this)});$("#searchEbuySubmit").click(function(){searchFromHomeSit()});$("#searchKeywords").keydown(function(event){if(event.keyCode==13){searchFromHomeSit()}});$("#searchKeywords").focus(function(){$(this).parents("div:eq(0)").addClass("g-search-focus");var searchDefaultKeyword=$("#searchDefaultKeyword").val();var searchKeywords=$(this).val();if(searchKeywords==searchDefaultKeyword){$(this).val("")}$(this).css({color:"rgb(0, 0, 0)"})}).blur(function(){$(this).parents("div:eq(0)").removeClass("g-search-focus");var searchDefaultKeyword=$("#searchDefaultKeyword").val();var searchKeywords=$(this).val();if(searchKeywords==""){$(this).val(searchDefaultKeyword);$(this).css({color:"rgb(153, 153, 153)"})}});function resolveStr(str){str=str.replace(/\-/g,"%2d");str=str.replace(/\&/g,"%26");str=str.replace(/\./g,"%2E");str=str.replace(/\+/g,"%2B");return str}function searchFromHomeSit(){var keyWord=$("#searchKeywords").val();if(sn.shop.shopType=="3"){document.location=sfsHeadSearchUrl+encodeURIComponent(resolveStr(keyWord))+"/&ch=3"}else{document.location=sfsHeadSearchUrl+encodeURIComponent(resolveStr(keyWord))+"/"}}function getCityId(){return(d("SN_CITY")||"100_025").split("|")[0].split("_")[1]}}},shop:{load:function(){$("#storeShop3").click(function(){if("header"==sn.page.pageType){var name="SHOPSEARCH_00"+spcode;mySuning.add2ShopFavorite("00"+spcode,"shopHome",name)}else{shopSideBar.shoucang.shopfavorite("00"+spcode)}});function showPercentagePic(percentage,comparetage){percentage=percentage||"0";comparetage=comparetage||"0";var p=parseInt(percentage);percentage=p<0?percentage.slice(1):percentage;var config={hold:'<span class="per per-hold"><em class="em1">------</em></span>',down:'<span class="per per-down" ><em class="em2">'+percentage+"</em></span>",up:'<span class="per per-up" ><em class="em1">'+percentage+"</em></span>"};var viewId=comparetage==0?"hold":comparetage<0?"down":"up";return config[viewId]||config.hold}var cTextctrl=function(){var cText=$(".JS_txtCtrl i").text();var nLength=$(".JS_txtCtrl").text().length;if(nLength>40){$(".JS_txtCtrl i").text(cText.substring(0,40))}};cTextctrl();function renderShopInfo(data){if(data){$("#chead_indexUrl").attr("href",data.indexUrl);$("#chead_shopIndexUrl").attr("href",data.indexUrl);var dstar="5.00";$("#chead_shopStar").text(data.star||dstar);$("#chead_qualityStar").text("商品满意度："+(data.Qstar||dstar)+"分");$("#chead_attitudeStar").text("服务满意度："+(data.Astar||dstar)+"分");$("#chead_deliverySpeedStar").text("物流满意度："+(data.Dstar||dstar)+"分");$("#chead_qualityPercent").replaceWith(showPercentagePic(data.Qpercent,data.Qcompare));$("#chead_attitudePercent").replaceWith(showPercentagePic(data.Apercent,data.Acompare));$("#chead_deliverySpeedPercent").replaceWith(showPercentagePic(data.Dpercent,data.Dcompare));if(data.logoUrl_60){var logoImg=$("#chead_logoUrl img");var dLogoUrl=logoImg.attr("src");logoImg[0]&&(logoImg[0].onerror=function(){this.src!=dLogoUrl?this.src=dLogoUrl:""});logoImg.attr("src",data.logoUrl_60)}$("#chead_companyName").text(data.companyName?data.companyName:"");if(3==shopType||"3"==shopType){$("#chead_companyAddress").text(data.countryName?data.countryName:"")}else{var data_companyAddress=(data.companyProvince?data.companyProvince:"")+","+(data.companyCity?data.companyCity:"");$("#chead_companyAddress").text(data_companyAddress.replace(/^,|,$/img,""))}if(data.qualificationPageUrl){$("#id_qual_li").show();$("#chead_qualification").attr("href",data.qualificationPageUrl)}$("#chead_licence").attr("href",data.licencePageUrl);if(data.telPhone){$("#chead_telPhone").text(data.telPhone?data.telPhone:"")}else{$("#chead_telPhone").parent().css("display","none")}$("#chead_road").removeClass("bg-none");$("#chead_roadPic").hide();$(".JS_store_grade").hover(function(){$(".sg-details").stop();$(".store-grade").addClass("store-grade-hover");$(".sg-details").show()},function(){$(".sg-details").stop();$(".store-grade").removeClass("store-grade-hover");$(".sg-details").hide()})}}var shopID=sn.shop.shopId;if(shopID.length==10){shopID=shopID.substring(2)}var shopInfoUrl4jsonp=shop_context+"jsonp/"+shopID+"/shopinfo/shopinfo.html";$.ajax({url:shopInfoUrl4jsonp,dataType:"jsonp",cache:true,jsonpCallback:"shopinfo",success:renderShopInfo,error:function(){debug&&console.info("加载店铺页头失败")}})}}};header.fixWidth();$(window).resize(function(){header.fixWidth()});header.ad.bind();header.cart.bind();header.search.bind();header.shop.load();header.gdshop.show()});(function(a){a.fn.markSlider=function(c){var b={speed:600,auto:true,pause:5000,continuous:true,vertical:false,imgPreload:true,easing:"slow",progressNavId:"promo_triggers",progressNavCurrent:"current",progressNavHover:false,customProgressNav:false,customProTag:"li",hasLink:false,numeric:true,thumbImgNav:false,smallImg:"_small",imgType:".jpg",directionNav:false,prevId:"promo_prev",prevText:"",nextId:"promo_next",showBtn:true,nextText:"",directionNavFade:false,directionNavToggle:false,pauseShow:false,pauseId:"promo_pause",pausePlayClass:"promo_pause_play",pauseStopText:"pause",pausePlayText:"play",fullScreen:false,haveBigImg:false,bigImgWidth:1600,minWidth:980,classicRight:true,countShow:false,countShowId:"promo_count",countCurrentId:"promo_count_current",countTotalId:"promo_count_total",countSplitId:"promo_count_split",countSplitContent:"/",countCurrentBefore:"",countCurrentAfter:"",countTotalBefore:"",countTotalAfter:""};var c=a.extend(b,c);this.each(function(){var x=a(this),q=x.children("ul"),m=q.children("li"),z=m.length,u=m.width(),G=m.height();var A=true;x.width(u);x.height(G);x.css({overflow:"hidden",position:"relative"});var f=z-1,y=0;if(!c.vertical){q.css("width",z*u);m.css("float","left")}if(!c.customProgressNav&&z>1&&x.parent().find("."+c.progressNavId).length<1){var v="";v+='<ul class="'+c.progressNavId+'"></ul>';a(x).after(v);if(c.numeric&&!c.thumbImgNav){for(var E=0;E<z;E++){a(document.createElement("li")).html('<a href="javascript:;">'+(E+1)+"</a>").appendTo(x.parent().find("."+c.progressNavId))}}if(c.thumbImgNav&&!c.numeric){var g=a("img",x);var F=g.length;var H=new Array();if(F==1){H.push(new Array(g.attr("src").replace(c.imgType,c.smallImg+c.imgType)))}else{for(var E=0;E<F;E++){H.push(new Array(g.eq(E).attr("src").replace(c.imgType,c.smallImg+c.imgType)))}}for(var E=0;E<z;E++){a(document.createElement("li")).html("<a rel="+E+' href="javascript:;"><img src="'+H[E]+'" alt="" /></a>').appendTo(x.parent().find("."+c.progressNavId));if(c.imgPreload){x.parent().find("."+c.progressNavId+" img").each(function(){var h=a(this);var i=h.attr("src");j(h,i)})}}}}e();function e(){var i=x.parent().find("."+c.progressNavId).children(c.customProgressNav?c.customProTag:"li");if(c.progressNavHover){var h;i.hover(function(){var s=a(this);h=setTimeout(function(){B(s.index(),false,true)},150)},function(){clearTimeout(h)})}else{i.click(function(){B(a(this).index(),true,false)})}i.click(function(){return c.hasLink&&c.customProgressNav?true:false})}function k(h){h=parseInt(h);x.parent().find("."+c.progressNavId).children(c.customProgressNav?c.customProTag:"li").eq(h).addClass(c.progressNavCurrent).siblings(c.customProgressNav?c.customProTag:"li").removeClass(c.progressNavCurrent)}if(c.directionNav){var v=" ";v+=' <span class="'+c.prevId+'"><a onselectstart="return false;" class="page-num" href="javascript:;"></a></span>';v+=' <span class="'+c.nextId+'"><a onselectstart="return false;" class="page-num2" href="javascript:;"></a></span>';v+='<span class="pages"></span>';if(c.showBtn){a(x).after(v)}x.parent().find("."+c.nextId).click(function(){B("next",true,false);return false});x.parent().find("."+c.prevId).click(function(){B("prev",true,false);return false});if(c.directionNavToggle){var l=x.parent().find("."+c.prevId);var D=x.parent().find("."+c.nextId);l.hide();D.hide();x.parent().bind("mouseover",function(){l.show();D.show()}).bind("mouseout",function(){l.hide();D.hide()})}}if(c.pauseShow&&c.auto){var v="";v+='<span class="'+c.pauseId+'"><a href="javascript:;"><span>'+c.pauseStopText+"</span></a></span>";a(x).after(v);x.parent().find("."+c.pauseId).toggle(function(){clearTimeout(r);a(this).find("a").addClass(c.pausePlayClass).find("span").html(c.pausePlayText);return false},function(){I();a(this).find("a").removeClass(c.pausePlayClass).find("span").html(c.pauseStopText);return false})}if(c.countShow){var v="";v+='<div class="'+c.countShowId+'"><span class="'+c.countCurrentId+'"></span><span class="'+c.countSplitId+'">'+c.countSplitContent+'</span><span class="'+c.countTotalId+'"></span></div>';x.parent().find(".page-num").append(v);x.parent().find(".page-num2").append(v);x.parent().find(".pages").append(v)}if(c.fullScreen){var n=a(window).width();if(n<c.minWidth){n=c.minWidth}u=n;x.width(u);x.parent().width(u);c.vertical?q.css({width:u}):q.css({width:z*u});m.css({overflow:"hidden"}).width(u);if(c.haveBigImg){a("img",x).each(function(){var h=a(this);var i=h.attr("src");j(h,i,n,c.bigImgWidth)})}if((c.thumbImgNav||c.numeric)&&c.classicRight){x.parent().find("."+c.progressNavId).css({position:"absolute",right:(n-c.minWidth)/2})}a(window).resize(function(){var h=a(window).width();if(h<c.minWidth){h=c.minWidth}u=h;x.width(u);x.parent().width(u);c.vertical?q.css({width:u}):q.css({width:z*u,"margin-left":-y*u});m.css({overflow:"hidden"}).width(u);if(c.haveBigImg){a("img",x).each(function(){a(this).css({"margin-left":(h-c.bigImgWidth)/2})})}if((c.thumbImgNav||c.numeric)&&c.classicRight){x.parent().find("."+c.progressNavId).css({position:"absolute",right:(h-c.minWidth)/2})}})}function j(t,w,i,s){t.hide();var h=new Image();a(h).load(function(){t.attr("src",w);if(s){t.css({"margin-left":(i-s)/2})}t.fadeIn(200)}).attr("src",w);return t}function C(){var h=a(window).width()<c.minWidth?c.minWidth:a(window).width();if(!c.vertical){if(y==-1){if(c.fullScreen){m.last().attr("style","float:left; overflow:hidden; width:"+h+"px")}else{m.last().attr("style","float:left;")}q.css({"margin-left":f*m.width()*-1});y=f}if(y==z){if(c.fullScreen){m.first().attr("style","float:left; overflow:hidden; width:"+h+"px")}else{m.first().attr("style","float:left;")}q.css({"margin-left":"0"});y=0}}else{if(y==-1){m.last().attr("style"," ");q.css({"margin-top":f*m.height()*-1});y=f}if(y==z){m.first().attr("style"," ");q.css({"margin-top":"0"});y=0}}A=true}function B(h,s,J){if(A){A=J?true:false;var t=y;switch(h){case"next":y=parseInt((t>=f)?(c.continuous?y+1:f):y+1);break;case"prev":y=parseInt((y<=0)?(c.continuous?y-1:0):y-1);break;default:y=parseInt(h);break}y==z?k(0):k(y);var w=c.speed;if(!c.vertical){if(y==-1){m.last().css({position:"relative",left:q.width()*-1})}if(y==z){m.first().css({position:"relative",left:q.width()})}p=(y*u*-1);q.animate({marginLeft:p},{queue:false,duration:w,complete:C,easing:c.easing})}else{if(y==-1){m.last().css({position:"relative",top:G*z*-1})}if(y==z){m.first().css({position:"relative",top:G*z})}p=(y*G*-1);q.animate({marginTop:p},{queue:false,duration:w,complete:C,easing:c.easing})}if(!c.continuous&&c.directionNavFade){y==f?x.parent().find("."+c.nextId).hide():x.parent().find("."+c.nextId).show();y==0?x.parent().find("."+c.prevId).hide():x.parent().find("."+c.prevId).show()}if(c.auto&&s&&!x.parent().find("."+c.pauseId).find("a").hasClass(c.pausePlayClass)){clearTimeout(r);I()}else{if(c.auto&&h=="next"&&!x.parent().find("."+c.pauseId).find("a").hasClass(c.pausePlayClass)){I()}}if(c.countShow){var i=c.countCurrentBefore+(parseInt(y==-1?f:(y==z?0:y))+1)+c.countCurrentAfter;x.parent().find("."+c.countCurrentId).html(i);x.parent().find(".promo_count_current").html(i)}}}k(0);var r;function I(){r=setTimeout(function(){B("next",false)},c.pause)}if(c.auto&&z>1){I();x.parent().hover(function(){clearTimeout(r)},function(){if(!x.parent().find("."+c.pauseId).find("a").hasClass(c.pausePlayClass)){I()}})}if(c.countShow){x.parent().find("."+c.countCurrentId).html(c.countCurrentBefore+"1"+c.countCurrentAfter);x.parent().find("."+c.countTotalId).html(c.countTotalBefore+z+c.countTotalAfter)}if(!c.continuous&&c.directionNavFade){x.parent().find("."+c.prevId).hide()}if(c.imgPreload){a("img",x).each(function(){var h=a(this);var i=h.attr("src");j(h,i)})}})};jQuery.extend(jQuery.easing,{slow:function(f,g,e,i,h){return i*((g=g/h-1)*g*g*g*g+1)+e},fast:function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g*g*g*g+e}return i/2*((g-=2)*g*g*g*g+2)+e}})})(jQuery);(function(f,v,h,C,i){C.shop.url=location.href;h.extend(i.LazyLoad.holder,{item:C.shop.item_place_holder});var l=function(u,s){var c=u.split(s),j=0;this.random=function(){j=j%c.length;var D=c[j];j++;return D}};var H=function(){h(".thumbnail").each(function(){var J=h(this).find(".JS_thumbnailSlide");var c=h(this).find(".JS_thumbnailNext");var j=h(this).find(".JS_thumbnailPrev");J.carousel({btnNext:c,btnPrev:j,scrolls:1,mouseWheel:true,circular:false,visible:4});var s=h(this).find(".JS_thumbnailSlide .list_item");var I=h(this).parent("li").find(".picture");var D=400;var u=400;var K;s.hover(function(){var L=h(this);K=setTimeout(function(){L.addClass("hover").siblings().removeClass("hover");I.attr("src",L.find("img").attr("src").replace(D+"x"+D,u+"x"+u))},150)},function(){var L=h(this);L.removeClass("hover");clearTimeout(K)})})};window.simpleAlert={hideAlertHtml:function(){h(".m-dialog-overlay-fav").remove();h(".alert-lay").remove()},showAlert:function(s,D){var c=document.body.scrollHeight;var u=["<div class='m-dialog-overlay-fav'>","<div class='close lay overlay' style='height: {height}px; background: black; opacity: 0.3; display: block;'></div>","<!--[if IE 6]><iframe class='close lay frame'  src='about:blank' frameborder='0' ></iframe><![endif]-->","</div>"];h(".ECode-floatBar").after(u.join("").format({height:c}));var j=["<div id='favpolite-prod-lay' class='alert-lay' style='top:300px;position: fixed;'>","<div class='title'><h3>{title}</h3></div>","<a href='javascript:void(0);' class='alert-close' title='关闭'><i class='gt'>&gt;</i><i class='lt'>&lt;</i></a>","<table class='tableClass'>","<tr>","<td valign='middle' style='width:105px;height:105px;'></td>","<td style='padding-left:1rem;' valign='middle'>","<div><h1 id='favpolite-tip'>{content}</h1></div>","</td>","</tr>","<tr>","<td colspan='2'>","</td>","</tr>","</table>","</div>"];h(".ECode-floatBar").after(j.join("").format({content:s,title:D||"温馨提示"}));h(".alert-close").on("click",function(){simpleAlert.hideAlertHtml()});h(".m-dialog-overlay-fav").on("click",function(){simpleAlert.hideAlertHtml()})},show:function(I,j){var c=document.body.scrollHeight;var D=["<div class='m-dialog-overlay-fav'>","<div class='close lay overlay' style='height: {height}px; background: black; opacity: 0.3; display: block;'></div>","<!--[if IE 6]><iframe class='close lay frame'  src='about:blank' frameborder='0' ></iframe><![endif]-->","</div>"];h(".ECode-floatBar").after(D.join("").format({height:c}));var u=["<div id='favpolite-prod-lay' class='alert-lay' style='top:300px;position: fixed;min-width: 400px;'>","<div class='title'><h3>{title}</h3></div>","<a href='javascript:void(0);' class='alert-close' title='关闭'><i class='gt'>&gt;</i><i class='lt'>&lt;</i></a>","<table class='tableClass'>","<tr>","<td style='padding:0.5rem 1rem;' valign='middle'>","<div content></div>","</td>","</tr>","<tr>","<td colspan='2'>","</td>","</tr>","</table>","</div>"];var s=h(u.join("").format({title:I||"温馨提示"}));h("[content]",s).append(h(j).clone().show());h(".ECode-floatBar").after(s);h(".alert-close,[close]").on("click",function(){simpleAlert.hideAlertHtml()});return s}};var n,e=n={renderFilter:function(){},renderProd:function(j,c){},converter:{pimgDomain:new l(C.config.pimgDomain,","),pimgRule:"//{pimgDomain}/uimg/b2c/newcatentries/00{spcode}-{pscode18}_1_{picSize}x{picSize}.jpg?v={picVersion}",priceDomain:new l(C.config.priceDomain,";"),priceRule:"http://{priceDomain}/webapp/wcs/stores/prdprice/{pscode}_{cityId}_00{spcode}_2-0.png",detailRule:"{detailDomain}00{spcode}/{pscode}.html",convert:function(c){this.pimg(c);this.price(c);this.detail(c)},pimg:function(c){var j=this.pimgRule.format(c,{picSize:C.page.picSize,spcode:C.shop.spcode,pimgDomain:this.pimgDomain.random()});c.pimg=j;return j},price:function(c){var j=this.priceRule.format(c,{cityId:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],spcode:C.shop.spcode,priceDomain:this.priceDomain.random()});c.price=j;return j},detail:function(c){var j=this.detailRule.format(c,{spcode:C.shop.spcode,detailDomain:C.config.detailDomain});c.purl=j;return j}},validNineNumber:function(c){if(c.length!=9){return c.substring(c.length-9,c.length)}else{return c}},validEightenNumber:function(c){var u="000000000000000000";c=c||u;var s=c.length;var j=u.length;if(s>j){c=c.substring(0,j)}else{if(s<j){c=u.substring(0,j-s)+c}}return c},validEffectiveNumber:function(j){j=j||"";if(""!=j){var s=j.length;for(var c=0;c<s;c++){if("0"!=j.charAt(0)){break}j=j.substring(1)}}return j},formatData:function(j){var c=parseInt(j);if((c+"").length>7){c=Math.round(c/10000)+"万"}return c},formatSubCodesData:function(K){var c=K.split(",");var D=[];for(var u=0;u<c.length;u++){if(u<8){var s=c[u].split("|");var J="//{pimgDomain}/uimg/b2c/newcatentries/00{spcode}-{pscode18}_1_{picSize}x{picSize}.jpg?v={picVersion}".format({pimgDomain:new l(C.config.pimgDomain,",").random(),spcode:C.shop.spcode,pscode18:e.validEightenNumber(s[0]),picSize:C.page.picSize,picVersion:s[5]||""});c[u]="<li class='list_item'><a href='javascript:void(0);' class='img38'><img lazy-src='{pimg}' alt='{pcolor}' title='{pcolor}' style='width:38px;height:38px;' /></a></li>".format({pimg:J,pcolor:s[2]});D[u]=c[u]}}var I=D.join("");return I},format:function(V){var U=[];for(var S=0;S<V.length;S++){var K=V[S];var s=K.partnumber||"000000000";var R=(K.subCodes||s).split(",")[0];var J=e.formatData(K.totalCount||0);var u=e.formatData(K.countOfarticle||0);var Q=(K.catentdesc||"").html();var j=(K.title||K.catentdesc||"").html();var P=K.hasSubGoods||false;var L=K.inventory||"00";var N=(K.subColors||"").split(",").length||0;var T=e.formatSubCodesData(K.subColors||"");var O=e.validEightenNumber(s);var I=e.validEightenNumber(R);var c=K.picVersion||"";var M=K.praiseRate||"0";var D={pid:K.catentry_Id||"0000000",pcode:s,pscode:R,pcnum:u,pstar:K.articlePoint||0,spoint:(K.auxdescription||"").html(),opname:Q,pname:j,psale:J,hasSubGoods:P||false,inventory:L||"00",subColors:T||"",noprodTips:"暂时无货",subLength:N,pcode18:O,pscode18:I,picVersion:c,praiseRate:M};this.converter.convert(D);U.push(D)}return U},format4category1:function(u){var D=[];for(var s=0;s<u.length;s++){var j=u[s];var c={spoint:(j.spoint||"").html(),pname:(j.pname||"").html()};c=h.extend({},j,c);D.push(c)}return D}};var A=new Pagination(null,C.page.pagesize,null);var G,y=G={need:C.page.pageType=="list",pagesize:C.page.pagesize,pagination:A,bRenderFilter:false,options:{prodDom:"[sf-search-product]",pageDom:"[sf-search-page]",totalDom:"[sf-total-result]",filterDom:"[sf-search-filters]",all:"[sf-category-all]",urlV:"sf-category-url",sortV:"sf-sort",item:"sf-category-item"},selector:"sf-category",render:function(j){G.pagination.calculate(j.totalRecords,A.pagesize);j.filters=j.filters||[];if(!this.bRenderFilter){G.options.filterDom&&h(G.options.filterDom).refresh(j);this.bRenderFilter=true}var s=j.totalRecords||"0";G.options.totalDom&&h(G.options.totalDom).refresh({total:s});var c=j.productList;G.options.prodDom&&h(G.options.prodDom).refresh({prods:c||[]});z.bind();H();G.options.pageDom&&h(G.options.pageDom).refresh(G.pagination);a.listener()},category:function(){var c=[].slice.apply(arguments,[0]);c.push(C.category);var j=h.extend.apply({},c);G.query(j)},query:function(){var c=h.extend.apply({},[].slice.apply(arguments,[0]));if(C.category.ctype=="1"&&C.category.cid!="all"){G.query1(c)}else{G.query0(c)}},query0:function(s){s=h.extend({cityId:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],spcode:C.shop.spcode,pagesize:G.pagesize,start:0,cid:C.category.cid,sortField:"",cf:""},s);var j=["queryByGroup.do?","vendor_Id=00{spcode}","&groupId={cid}","&start={start}","&cityId={cityId}","&rows={pagesize}","&sortField={sortField}","&cf={cf}"];var c=C.config.searchDomain+j.join("").format(s);h.ajax({url:c,dataType:"jsonp",cache:true,jsonpCallback:"jsonpQueryByGroup",success:function(I){var D=n.format(I.goods);var u={productList:D,filters:I.filters||[],totalRecords:I.totalSize};s.success&&s.success(u);G.render(u)},error:function(){debug&&console.info("自动分类搜索网络异常");G.render({})}})},query1:function(s){s=h.extend({cityId:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],spcode:C.shop.spcode,pagesize:G.pagesize,start:0,cid:C.category.cid,sortField:"",cf:""},s);var j=["queryByGroup.do?","vendor_Id=00{spcode}","&manualGroupId={cid}","&start={start}","&cityId={cityId}","&rows={pagesize}","&sortField={sortField}","&cf={cf}"];var c=C.config.searchDomain+j.join("").format(s);h.ajax({url:c,dataType:"jsonp",cache:true,success:function(I){var D=n.format(I.goods);var u={productList:D,filters:I.filters||[],totalRecords:I.totalSize};s.success&&s.success(u);G.render(u)},error:function(){debug&&console.info("手动分类搜索网络异常");G.render({})}})},categoryTo:function(s,c){s=h.extend({target:"_self",spcode:C.shop.spcode,cid:C.category.cid||"all",ctype:C.category.ctype||"0",context:C.shop.context,domain:C.shop.domain,shopContext:C.shop.shopContext,selfDomain:C.shop.selfDomain},s);var j="{shopContext}list_{cid}_{ctype}.html".format(s);if(s.target=="_self"){location.href=j}else{if(s.target=="_blank"){c.href=j;c.target=s.target}}},loadClass:function(){var c=h.request.parameters;var j={success:function(s){G.pagination.calculate(s.totalRecords,c.pagesize||G.pagesize,function(){if(t.need){t.search({start:this.start,pagesize:this.pagesize},h.request.parameters,t.getSearchParams())}else{if(G.need){G.query({start:this.start,page:this.page,pagesize:this.pagesize})}}r.top()})}};G.query(C.page,j,c)},bind:function(){var c=G.options;C.category=C.category||{};h("["+G.selector+"] ["+c.item+"]").live("click",function(){var j=h(this).parents("["+G.selector+"]");var s=(j.attr(G.selector)||"{}").json();s=h.extend({},G.options,s);o=h.extend({cid:h(this).attr(s.item)||"",target:"_blank"},s);G.categoryTo(o,this)});G.need&&this.loadClass();h("[{category}] [{sort}]".format({category:G.selector,sort:c.sortV})).live("click.sf-category-sort",function(s){var j=h(this).attr(c.sortV);t.searchParameter.sortField=j;var u=t.extend({target:"_blank"},t.searchParameter);t.searchTo(u,this)});h("[{category}] {all}".format({category:G.selector,all:c.all})).on("click.sf-category-all",function(j){var s=t.extend({target:"_blank"});t.searchTo(s,this)});h("[{urlV}]".format({urlV:c.urlV})).live("click.sf-category-url",function(j){var s=(h(this).attr(c.urlV)||"{}").json();s=t.extend({target:"_blank"},s);G.categoryTo(s,this)})},highLight:function(){if(G.need&&"all"!=C.category.cid){h(".sf-category [sf-category-item]").each(function(c,j){if(h(j).attr("sf-category-item")==C.category.cid){if(h(j).find("img").size()>0){h(j).addClass("img").css({width:"auto"});h(j).css({border:"1px solid #f70",margin:"5px",padding:"0"});h(j).find("img").css({"max-width":"100%"})}else{h(j).css("color","#f70")}}})}}};var t,q=t={need:C.page.pageType=="search",cate:C.page.pageType.is("list"),pagesize:C.page.pagesize,pagination:A,bRenderFilter:false,options:{price:["-1","-1"],prodDom:"[sf-search-product]",pageDom:"[sf-search-page]",totalDom:"[sf-total-result]",filter:{filterDom:"[sf-search-filters]",filterEl:"[sf-search-filter]",filterV:"[sf-search-filter-item]",selectedClass:"a-itcur",render:function(c){var j=t.options.filter;j.filterDom&&h(j.filterDom).refresh(c)},select:function(){var j=this;var c=[];h([j.filterV,".",j.selectedClass].join("")).each(function(u,D){var s=h(D).attr(j.filterV.unwrap());s&&c.push(s)});h(".sf-scrolloverall").find("li").each(function(){var u=h(this).attr("sf-search-filter-item-check");if(u!=undefined){var s=u.split(",");for(var D=0;D<s.length;D++){if(h.inArray(s[D],c)==-1){c.push(s[D])}}}});return c}},sort:{sortV:"[sf-sort]",module_name:"[sf-sort-module]",selectedClass:"sf-cur",dSortFiled:"",asc:"up",desc:"down",init:function(){var u=this;var s=h.request.parameters.sortField||C.page.sortField;if(s){if(s.match(/(\w+)\-(\w+)/img)){var I=RegExp.$1,j=RegExp.$2;var c=h([u.module_name," ",u.sortV].join(""));c.removeClass(u.selectedClass).removeClass(u.desc+" "+u.asc);var D=u.sortV.unwrap();var J=h(u.module_name+" [{sort}*={value}]".format({sort:D,value:I})).addClass(u.selectedClass);if(I=="price"){J.addClass(u[j]||"asc")}J.attr(D,s)}}},select:function(){var c=this;return h([c.module_name," ",c.sortV,".",c.selectedClass].join("")).attr(c.sortV.unwrap())||c.dSortFiled}},keywordV:"sf-keyword",ok:"[sf-search-ok]",cancel:"[sf-search-cancel]",keyword:"[name=keyword]",startPrice:"[name=startPrice]",endPrice:"[name=endPrice]"},selector:"sf-search",searchParameter:{},bind:function(){h.request.parameters.keyword=h.request.parameters.keyword||h.request.parameters.keyWord||"";try{C.page.keyword=decodeURIComponent(C.page.keyword||"")}catch(u){}var s=t.options;this.loadTpl();var c=h("["+t.selector+"]");if(c.length>0){t.searchM=c.eq(0);t.need&&this.loadSearch();h("[k-search]").on("click",function(){var D=h("[k-placeholder]");if(D.length>0&&C.page.k_placeholder!=null){if(D.is(":visible")){C.page.__keyword__=h("[k-placeholder]").val()||C.page.k_placeholder}else{C.page.__keyword__=null}}});c.each(function(J,I){var D=h(I);t.bindSearchEvent(D)})}this.init();if(t.need||t.cate){t.bindFilter();t.bindSort()}if(C.page.pageType=="list"||C.page.pageType=="search"){h("[sf-search-keywords]").elmout(C.page);h("[sf-item-list]").removeClass(item_class_list).addClass(C.page.row_class);h(document).on("focusin","[k-placeholder]",function(){h(this).hide()});if(h(".sf-keywordList a[sf-keyword]").length>0&&h("[k-keyword]").val()){h("[k-placeholder]").hide()}var j="[k-keyword],[k-search]";h(document).on("click",":not([k-placeholder])",function(I){var J=h(I.srcElement).is(j);var D=h("[k-keyword]").val();if(J||D){}else{h("[k-placeholder]").show()}})}t.bindKeyword()},init:function(){var j=t.options;var c=t.options.sort;var s=r.filter(C.page.keyword||decodeURIComponent(h.request.parameters.keyword||h.request.parameters.keyWord||""));s&&h(j.keyword).val(s);if(C.page.k_placeholder!=null){h("[k-placeholder]").val(C.page.k_placeholder)}else{h("[k-placeholder]").remove()}c.init()},bindSort:function(){var s=t.options.sort;var c=s.sortV.unwrap();var u=h(s.module_name);if(u[0]){var j=u.attr(c)||"";j=h.extend(s,j.json());var D=h(s.sortV,u);D.$toggleClass({event:"click",single:false,className:j.selectedClass,callback:function(N,O){var K=h(this).attr(c)||j.dSortFiled;var M=K.match(/(\w+)/img);if(M&&M[0]&&M[0]=="price"){h(this).addClass(O.className)}D.removeClass(j.desc+" "+j.asc);if(h(this).is("[sortable]")){var L=h(this).attr(c);var I=null;if(I=L.match(/(\w+)/img)){var J=I[1]=="desc"?"asc":"desc";h(this).addClass(j[J]);L="{field}-{type}".format({field:I[0],type:J});debug&&console.info("sort:"+L);debug&&console.info(J);h(this).attr(c,L)}}A.page=0;var O=t.getParameter();if(G.need||G.active){G.category(O)}if(t.need||t.active){t.search(O)}return false}})}},multipleDim:function(D){var J=";";var j={groupIDCopy:"",promotions:"",bnf:"",price:""};var K=D.length;for(var c=0;c<K;c++){var I=D[c].split(":");if(""==j[I[0]]){j[I[0]]=I[1]}else{j[I[0]]=j[I[0]]+J+I[1]}}var s=[];for(var u in j){if(""!=j[u]){s.push(u+":"+j[u])}}return s},getParameter:function(){var c=t.options;var j=t.getSearchParams();var D=h.request.parameters;var I=t.options.sort;var L=I.select();var K=t.options.filter;var s=K.select();var J=D.price;J&&s.push("price:"+J);j.cf&&s.push(j.cf);s=t.multipleDim(s);var u=s.reverse().toObject();s=Object.toArray(u).join(",");return h.extend(D,j,{cf:s,sortField:L})},bindFilter:function(){var c=t.options.filter;h(c.filterV).$toggleClass({scope:c.filterEl,event:"click",className:c.selectedClass,isSingle:function(j){return j.is("[sf-search-filter=price]")},callback:function(){var j=h(this).parents("li").attr("sf-search-filter-item-check");var u=[];if(j!=undefined){if(j.split(":")[0]=="price"){h(this).parents("li").find(".sf-itcur").each(function(){h(this).removeClass("sf-itcur");h(this).find("span").removeClass("a-itcur")});h(this).parent().toggleClass("sf-itcur");h(this).parents("li").removeClass("sf-hover");var s=h(this).text();h(this).parents("li").find("em").text(s.substring(0,2));h(this).parents("li").attr("sf-search-filter-item-check",h(this).attr("sf-search-filter-item"))}else{if(h(this).parent().find("input").attr("checked")=="checked"){h(this).parent().find("input").removeAttr("checked");h(this).parent().removeClass("sf-itcur")}else{h(this).parent().find("input").attr("checked","checked");h(this).parent().addClass("sf-itcur")}h(this).parents("li").find("input").each(function(){if(h(this).attr("checked")=="checked"){u.push(h(this).next().attr("sf-search-filter-item"))}});return false}}if(h(this).parent().parent().find(".sf-btnselectmore").css("display")=="none"&&h(this).parents("li").attr("sf-search-filter")!="price"){return false}var D=t.getParameter();A.page=0;if(t.need){t.search(D)}if(G.need){G.category(D)}}})},bindKeyword:function(){var c=t.options;var s=c.keywordV;var j=s.wrap("[]");h(document).on("click.sf-keyword",j,function(D){var u=r.filter(h(this).text());var I=t.extend({target:"_blank",keyword:u},{});t.searchTo(I,this)})},synFilter:function(){var c=h("[sf-search-filter]");c.length>0&&c.each(function(D,s){var J=h(s);var I=h("[sf-search-filter-expand]",J);var j=h("[sf-search-filter-panel]",J);var u=j.children();var K=0;for(var D=0;D<u.length;D++){K=K+u.eq(D).outerWidth()+35}if(K>j.innerWidth()){I.show()}else{I.hide()}})},render:function(j){t.pagination.calculate(j.totalSize,A.pagesize);j.filters=j.filters||[];if(!this.bRenderFilter){t.options.filter.render(j);this.bRenderFilter=true}var s=j.totalSize||"0";t.options.totalDom&&h(t.options.totalDom).refresh({total:s});j.goods=j.goods||[];var c=n.format(j.goods);t.options.prodDom&&h(t.options.prodDom).refresh({prods:c});z.bind();H();t.options.pageDom&&h(t.options.pageDom).refresh(t.pagination);a.listener()},extend:function(){var j=[].slice.apply(arguments,[0]);var c=[];h.each(j,function(u,s){if(s&&s.cf){c.push(s.cf)}});j.push({cf:c.join(",")});return h.extend.apply(h,j)},loadTpl:function(){var u=null;if(t.need){u=h(".sf-sortbox")}if(t.cate){u=h(".sf-module780")}if(u){var s=h("[sf-search-tpl]");var j=h('[moduletype="sys.intelligRec"]');if(u.length>0&&s.length>0){var c=s.text()||s.html();if(j.size()>0&&t.need){j.parents(".sf-layoutList").before(c)}else{u.append(c)}return true}else{return false}}return true},getSearchParams:function(){var J=t.options;var j=t.searchM;var I=h(J.startPrice,j).val()||"";var c=h(J.endPrice,j).val()||"";var u=true;if(I.isEmpty()||c.isEmpty()){u=false}if(!I.isEmpty()&&!c.isEmpty()){u=parseInt(c)>=parseInt(I);if(!u){var s=c;c=I;I=s}}var D={keyword:r.filter((C.page.__keyword__||h(J.keyword,j).val()||"")),valid:true};if(!I.isEmpty()||!c.isEmpty()){D=h.extend(D,{price:"{start}-{end}".format({start:I||t.options.price[0],end:c||t.options.price[1]})})}return h.extend({},D)},resolveStr:function(c){c=c.replace(/\-/g,"%2d");c=c.replace(/\&/g,"%26");c=c.replace(/\./g,"%2E");c=c.replace(/\+/g,"%2B");return c},bindSearchEvent:function(j){var s=j.attr(t.selector)||"{}";s=s.json();s=h.extend(this,t.options,s);var c=t.searchM=j;c.ok=h(s.ok,j);j.click(function(){debug&&console.debug("search selected a search target");t.searchM=h(this)});c.ok.click(function(){t.searchM=h(this).parents("["+t.selector+"]");var u=t.extend({target:"_self"},t.getSearchParams());if(u.valid){!search_disable&&t.searchTo(u)}return false});h([s.keyword,s.startPrice,s.endPrice].join(","),j).keypress(function(u){$key(u).when("enter",function(D){var I=t.extend({target:"_self"},t.getSearchParams());if(I.valid){t.searchTo(I)}})});t.searchM=c},searchTo:function(s,c){var j=h.extend({target:"_self",spcode:C.shop.spcode,pagesize:t.pagesize,keyword:"",start:0,sortField:"",context:C.shop.context,domain:C.shop.domain,selfDomain:C.shop.selfDomain,shopContext:C.shop.shopContext,price:"",cf:""},s);j.keyword=encodeURIComponent(t.resolveStr(j.keyword));var u="";if(h(c).is("[sf-category-all]")||h(c).is(".searchstore-btn")){u='{shopContext}{keyword ? "search/" + keyword : "search"}.html'.format(j)}else{u='{shopContext}{keyword ? "search/" + keyword : "search"}.html?keyword={keyword}{price ? "&price="+price : ""}{sortField ? "&sortField="+sortField : ""}'.format(j)}if(j.target=="_self"){location.href=u}else{if(j.target=="_blank"){c.href=u;c.target=j.target}}},search:function(D){var u=h.extend.apply({},[].slice.apply(arguments,[0]));u=h.extend({cityId:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],spcode:C.shop.spcode,pagesize:t.pagesize,keyword:"",start:0,sortField:"",cf:""},u);debug&&console.info(u);var s=["queryByKeyword.do?","vendor_Id=00{spcode}","&keyword={keyword}","&start={start}","&rows={pagesize}","&sortField={sortField}","&cf={cf}"];var c=C.config.searchDomain+s.join("").format(u);try{h.ajax({url:c,dataType:"jsonp",cache:true,timeout:5000,jsonpCallback:"jsonpQueryByKeyword",success:function(I){D.success&&D.success(I);t.render(I)},error:function(){debug&&console.info("关键词搜索网络异常");t.render({})}})}catch(j){console.info("关键词搜索异常");t.prodDom&&h(t.prodDom).refresh({prods:[]})}},loadSearch:function(){var c=C.page.keyword||h.request.parameters.keyword||h.request.parameters.keyWord||h("#searchKeywords").val()||"";var j=h.extend({success:function(s){var u=t.getParameter();t.pagination.calculate(s.totalSize,u.pagesize||t.pagesize,function(){t.search({start:this.start,pagesize:this.pagesize},u);r.top()})}},{cf:"price:"+(h.request.parameters.price||"")},h.request.parameters,{keyword:c});t.search(C.page,j);h("#searchKeywords").val(c)}};var z,x=z={split:20,labelSplit:5,marketLabelMap:{"4-1":"大聚惠","4-2":"抢购","4-3":"团购","4-4":"闪购","4-5":"渠道专享","4-6":"名品特卖","4-7":"S码专享","4-8":"员工专享价","4-9":"限时促销","4-10":"爆款抢购","4-12":"掌上抢","4-14":"特卖","7-1":"预约","7-2":"预约","7-3":"预约","7-4":"预约","8-1":"预订","8-2":"定金团","8-3":"预订","8-4":"定金团","12-1":"预约","12-2":"预约","13-1":"预订","13-2":"定金团"},paramsMap:{"4-1":"大聚惠","4-2":"抢购","4-3":"团购","4-4":"闪购","4-5":"渠道专享","4-6":"名品特卖","4-7":"S码专享","4-8":"员工专享价","4-9":"限时促销","4-10":"爆款抢购","7-1":"预约","7-2":"预约","7-3":"预约","7-4":"预约","8-1":"预订","8-2":"定金团","8-3":"预订","8-4":"定金团"},rule:["4","11","5","9","12","3","99"],queryPrice:function(){var s=[];var j=[];h("[sf-price]").each(function(J,L){var K=h(L);var I=K.attr("pscode");if(-1==I.indexOf("<%")&&I.length>=9){s.push(e.validEightenNumber(I))}else{j.push(I)}});if(j.length>0){z.dealBadCode(j)}var c=s.tomap();var u=map2array(c);if(u.length>0){var D=u.split(z.split);D.each_delay(function(J,I){z.query(I)},1000)}},dealBadCode:function(c){h.each(c,function(s,j){var u="[sf-price][pscode={pcodeBad}]".format({pcodeBad:j});h(u).each(function(J,D){var I="售罄";h(D).replaceWith(I)})})},query:function(s){var D=s.join(",");var j={icpsHost:C.config.icpsDomain,cmmdtyCode:D,cityCode:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],chan:"1",type:"2",isCache:"1",spcode:C.shop.spcode};var c="{icpsHost}icps-web/getAllPriceNew.htm?cmmdtyCode={cmmdtyCode}&type={type}&cityCode={cityCode}&chan={chan}&isCache={isCache}&bizCode=00{spcode}&sys=SFS".format(j);try{h.ajax({url:c,dataType:"jsonp",cache:false,timeout:5000,success:function(J){var K=(J||[]).tomap("cmmdtyCode");h.each(s,function(M,L){var O=e.validEffectiveNumber(L);var P=K[L];var N="[sf-price][pscode={pcode9}]".format({pcode9:O});h(N).each(function(T,R){var U=h(R).attr("sf-price")||"price";var S=P[U]||"售罄";if("售罄"==S&&(h(R).parent().parent().find("[sf-product-cart]"))){h(R).parent().parent().find("[sf-product-cart]").attr("class","noproduct");h(R).parent().parent().find("[sf-product-cart]").removeAttr("sf-product-cart");h(R).parent().parent().find(".sf-PriceSymbol").remove()}else{var Q=S.split(".");if(Q&&Q.length>=2){S=Q[0]+'.<b class="sf-priceDecimal">'+Q[1]+"</b>"}}var V=P.priceType||"";h(R).parent().parent().find(".sf-protag").attr("sf-tag",V);h(R).replaceWith(S)})});if(h(".sf-protag[sf-tag]").length>0){var I=s.split(z.labelSplit);I.each_delay(function(L,M){z.queryLabel(M,K)},100)}},error:function(){h.each(s,function(J,I){var L=e.validEffectiveNumber(I);var K="[sf-price][pscode={pcode9}]".format({pcode9:L});h(K).each(function(O,M){var N="";h(M).replaceWith(N)})});debug&&console.info("调价格中心jsonp接口网络异常")}})}catch(u){h.each(s,function(J,I){var L=e.validEffectiveNumber(I);var K="[sf-price][pscode={pcode9}]".format({pcode9:L});h(K).each(function(O,M){var N="";h(M).replaceWith(N)})});debug&&console.info("调价格中心jsonp接口网络异常")}},queryLabel:function(L,s){var P=[];for(var I=0;I<L.length;I++){var N=L[I];var D=s[N];var M=D.priceType||"";M=z.paramsMap[M]?M:"";if("3"==C.shop.shopType){P.push(N+"*00"+C.shop.spcode+"*1*"+M)}else{P.push(N+"*00"+C.shop.spcode+"*0*"+M)}}var j=P.join(",");var J=new Date();var O="shopPage"+J.getTime();var u={productCodeAndStoreId:j,callback:O};var c=C.config.sfs_spes_domain+"spes-web/act/searchActCode/31_025__9_3_{productCodeAndStoreId}_{callback}.jsonp".format(u);try{h.ajax({url:c,dataType:"jsonp",cache:false,timeout:5000,jsonpCallback:O,success:function(V){var W={};for(var R=0;R<V.activityList.length;R++){var X=[];var S=[];for(var Q=0;Q<V.activityList[R]["activityInfo"].length;Q++){var Y={};if(V.activityList[R]["activityInfo"][Q]["activityTypeId"]=="5"){V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"]="赠品@@@购买可送赠品"}else{if(V.activityList[R]["activityInfo"][Q]["activityTypeId"]=="10"){V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"]="免运费@@@免运费"}else{if(V.activityList[R]["activityInfo"][Q]["activityTypeId"]=="11"){V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"]="领券"+V.activityList[R]["activityInfo"][Q]["bonusList"][0]["couponValue"].replace(/\.00/g,"")+"@@@"+V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"].replace(/\.00/g,"")}else{V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"]=V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"].replace(/\.00/g,"").replace(/减/g,"-").replace(/元/g,"").replace(/券/g,"")+"@@@"+V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"].replace(/\.00/g,"")}}}if(V.activityList[R]["activityInfo"][Q]["activityTypeId"]&&V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"]){Y[V.activityList[R]["activityInfo"][Q]["activityTypeId"]]=V.activityList[R]["activityInfo"][Q]["bonusList"][0]["bonusRulesDesc"];X.push(Y)}}for(var U=0;U<z.rule.length;U++){for(var T=0;T<X.length;T++){if(X[T][z.rule[U]]){S.push(X[T])}}}W[V.activityList[R]["productNumber"]]=S}h.each(L,function(aa,Z){var ac=e.validEffectiveNumber(Z);var ab="[sf-tag][pscode={pcode9}]".format({pcode9:ac});h(ab).each(function(ad,ag){var ah=3;if(C.page.pageType=="list"){ah=2}ah=2;var ae=s[Z]["priceType"]||"";if(undefined==h(ag).attr("label-flag")){if(""!=ae&&z.marketLabelMap[ae]){h(ag).append("<span class='sf-btn1'><i>"+z.marketLabelMap[ae]+"</i></span>");ah=ah-1}for(var af=0;af<((W[Z].length<ah)?W[Z].length:ah);af++){for(key in W[Z][af]){h(ag).append("<span class='sf-btn2'><i>"+W[Z][af][key].split("@@@")[0]+"</i><em>"+W[Z][af][key].split("@@@")[1]+"</em></span>")}}h(ag).attr("label-flag","finish")}})})},error:function(){debug&&console.info("调促销接口网络异常")}})}catch(K){debug&&console.info("调促销接口网络异常")}},bind:function(){z.queryPrice()}};var r,a=r={top:function(){location.hash="#top";location.hash="#"},bind:function(){var c="00{spcode}".format(C.shop);h("[sf-top]").on("click.sf-top",function(){r.top()});h("[sf-im-state]").removeClass("sf-im");getSupplierState("[sf-im-state]",c,C.shop.shopType);h("[sf-im]").live("click.sf-im",function(){findpassSupplier(c,"","","")});h("[sf-im-channel]").live("click.sf-im-channel",function(){var j=h(this).attr("sf-im-channel");findpassNewSupplier("","01",c,"","",j)});h("[sf-im-suning]").live("click.sf-im-suning",function(){findpass("","","")});h("[sf-im],[sf-im-suning]").css("cursor","pointer");h("[sf-cart]").live("click.sf-cart",function(){location.href=C.config.cart});h("[sf-cart]").live("mouseover.sf-cart",function(){h("[sf-cart-num]").text(d("totalProdQty")||"0")});h("[sf-cart-num]").text(d("totalProdQty")||"0");h("[sf-favorite]").live("click.sf-favorite",function(){shopSideBar.shoucang.shopfavorite("00"+C.shop.spcode)});h("[sf-product-favorite],[sf-item-favorite]").live("click.sf-product-favorite",function(){var s=h(this).attr("sf-product-favorite")||h(this).attr("sf-item-favorite");var j=e.validEightenNumber(s);mySuning.add2ProductFavorite(j,c,"shopHome","","shopHome_result")});h("[sf-product-notice]").live("click.sf-product-notice",function(){var j=e.validEightenNumber(h(this).attr("sf-product-notice"));mySuning.subscribeArrivalNotice(j,c,"shopHome_result")});h("[sf-product-cart]").live("click.sf-product-cart",function(u){var j=u||window.event;var I=function(P){if("1"==P.result){var M=h(".sn-sidebar-tab-cart[data-type=cart]");var O=M.offset();var N=h(document).scrollTop();var K=h(u.target).parents("li").find(".picture").attr("src");var J=h('<img class="u-flyer" src="'+K+'">');J.css({width:150+"px",height:150+"px","z-index":"999"});var L=h(u.target).parents("li");J.fly({start:{left:j.pageX,top:j.screenY-400},end:{left:O.left+10,top:O.top-N+25,width:30,height:30},onEnd:function(){J.detach();M.find(".tab-cart-num.J_cart_total_num").text(d("totalProdQty")||"0")}})}else{simpleAlert.showAlert("添加购物车失败")}};var D={};D.provinceCode=(d("SN_CITY")||"100_025_1000173_9173_01_11365_1_1").split("|")[0].split("_")[0];D.cityCode=(d("SN_CITY")||"100_025_1000173_9173_01_11365_1_1").split("|")[0].split("_")[1];D.districtCode=(d("SN_CITY")||"100_025_1000173_9173_01_11365_1_1").split("|")[0].split("_")[5];D.cmmdtyVOList=[];var s={};s.activityType="01";s.cmmdtyCode=e.validEightenNumber(h(this).attr("sf-product-cart"));s.cmmdtyQty=1;s.shopCode=c;D.cmmdtyVOList.push(s);cart.normal.addToCart(D,I)});h("[sf-index]").live("click.sf-index",function(){location.href=C.shop.domain});h(window).bind("item.loaded",function(){h(".varnishResult").hide()});h("[sf-shop]").each(function(s,I){var u=h(I);var j=(u.attr("sf-shop")||"{}").json();j=h.extend({up:"sf-up",down:"sf-down",hold:"sf-flat"},j);var D=h("[sf-shop-score]",I);D.each(function(L,J){var K=h(J).attr("sf-shop-score")||"hold";var M=r.shop_score(K,j);h(J).removeClass([j.up,j.down,j.hold].join(" "));h(J).addClass(M)})})},shop_score:function(j,s){j=j||"0";var u=parseInt(j)||0;j=u<0?j.slice(1):j;var c=u==0?"hold":u<0?"down":"up";return s[c]||s.hold},fixDomain:function(){var D=["resourcesoppre.cnsuning.com","resource.sop.suning.cn","sdaspre.cnsuning.com","edao.suning.com"],M=location.host;for(var u=0;u<D.length;u++){if(D[u].indexOf(M)>=0){return}}var c="//{host}{pathname}".format(location);var L=/\/\/([^\/:]+)(:?\d+)?(\/(sfs-shop-web|sfs))?(\/(\d+))?(\/[^\/\.]*)?(\.?\w+)?/im;var I="//$1$2$3";var K="//{1}{2}{3}";var s=K.format(C.shop.domain.match(L,I).fill(""));var J=K.format(c.match(L,I).fill(""));info&&console.info(s,J,currDomain);var M=location.host;var j=location.port;if(r.isDomain(M)){C.shop.accessDomain=true;C.shop.context=J+"/";C.shop.shopContext=J+"/";debug&&console.info("this is local debug model")}else{C.shop.accessDomain=false}if(r.isDomain(s)){C.shop.selfDomain=true;C.shop.shopDomain=s+"/";debug&&console.info("the shop is self domain")}else{C.shop.selfDomain=false}},isDomain:function(c){var s=/(http:\/\/)?((\bdevshop|\bsitshop|\bpreshop|\bshop)(\.(sit|sfsdev))?(\.?(cn)?suning.com))(\:\d+)?/im;var j=/(http:\/\/)?((\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost)(\:\d+)?/im;return !s.test(c)&&!j.test(c)},listener:function(){h(window).trigger("img-lazy");h(window).trigger("price-change");t.synFilter();h(window).trigger("item.loaded")},fixHeader:function(){var j=h(".sf-sortbox");var D=h(".sf-sortbox .JS-head");if(D.length>0){var s=D.height();var c=(j.css("background-position")||"").split(" ");var u=[c[0],s+"px"].join(" ");debug&&console.info(top+"header position"+u);j.css("background-position",u)}},filter:function(j){j=j||"";var u=new RegExp("[`~!@#$^&*()_\\+=|{}':;',\\[\\]\\\\<>?~！@#￥……&*（）——|{}【】‘；：”“\"'。，、？]");var c="";for(var s=0;s<j.length;s++){c+=j.substr(s,1).replace(u," ")}return c}};var w,k=w=new function(){};var F,b=F={pv:function(s){if(C.shop.accessDomain){var u=document.location.hostname;var D="<input type='hidden' id='CSupplierID' value='{spcode}'>".format(C.shop);var j="<input type='hidden' id='CUrlPattern' value='shopidnew.suning.com{pageType}'>".format({pageType:(function(){var I={search:"/search",list:"/class",sale:"/number",index:""};return I[C.page.pageType]||""}())});h("body").append(D).append(j)}var c="{protocol}//{env}{protocol=='https:'?'imgssl.suning.com':'script.suning.cn'}/javascript/sn_da/{jsName}.js".format({protocol:document.location.protocol,jsName:s,env:(function(){var J=document.location.hostname;J.match(/(dev|sit|pre)/img);var I={dev:"pre",sit:"sit1",pre:"pre"};return I[RegExp.$1||""]||""}())});b.lazyLoadScripts().init({src:[c]})},uv:function(){h("[sa-uv]").live("click.sa-uv",function(){var j=h(this).attr("sa-uv");var D=h(this).attr("ignore-page")||"false";var c=h(this).attr("ignore-sysname")||"false";!j&&console.warn("sa-uv setting is null");var u=((c=="false"?"{msfs}_":"")+(D=="false"?"{ptype}_":"")+"{name}").format({msfs:"sfs",ptype:C.page.pageType,name:j});debug&&console.info("sa-uv:"+u);var s=h("[name="+u+"]");if(s.size()==0){s=h("<input type='hidden' name='"+u+"' />");h("body").append(s)}j&&window.sa.click.sendDatasIndex(s[0])})},recb:function(){if(!C.cityId){C.cityId="025"}if(typeof _analyseExpoTags=="function"){_analyseExpoTags("a")}else{setTimeout(function(){F.recb()},1000)}},rlv:function(){h(".sf-moduleList").each(function(){h(this).find("a").each(function(c){h(this).attr("data-index",c)})});h(".sf-moduleList").each(function(){h(this).find("area").each(function(c){h(this).attr("data-index",c)})});h(".sf-moduleList").on("click","a,area",function(){var u=h(this).parents(".sf-moduleList");var s=u.attr("moduleid");var J=h(this);var c=C.shopFolio;var I=J[0].nodeName.toLowerCase();var D=("{shopId}_{pageId}_{moduleId}_"+I+":{index}").format({shopId:C.shop.shopId,pageId:c,moduleId:s,index:J.attr("data-index")});var j=h("<input type='hidden' name='"+D+"' />");window.sa.click.sendDatasIndex(j[0])})},lazyLoadScripts:function(){var D=document,s,u=[],L=[],j;function J(O,c){var P,N;K();if(O.src){O.src=O.src.constructor===Array?O.src:[O.src];for(var M=0;M<O.src.length;M++){if(O.src[M].constructor!==Array){O.src[M]=[O.src[M]]}L.push(O.src[M])}}u=L.shift();s=s||D.getElementsByTagName("head")[0];O.src=u;for(var M=0;M<O.src.length;M++){N=O.src[M];P=D.createElement("script");P.src=N;P.type="text/javascript";if(j.ie){P.onreadystatechange=function(){var Q=this.readyState;if(Q==="loaded"||Q==="complete"){this.onreadystatechange=null;I(O,c)}}}else{P.onload=P.onerror=function(){I(O,c)}}s.appendChild(P)}}function I(N,c){var M=u;if(!M){return}M.shift();if(!M.length){if(L.length){J(N,c)}else{if(typeof c=="function"){c()}return}}}function K(){if(j){return}var c=/msie/i.test(navigator.userAgent.toLowerCase());j={ie:c}}return{init:function(M,c){J(M,c)}}}};var E={bind:function(){if(h("[moduleType='sys.navigation']").length==1){E.showNavi()}},showNavi:function(){var c=C.shop.context+"ajax/getNaviOfActivePage_"+C.shop.spcode+"_"+C.shop.shopType+"/jsonpQueryForNavFromSFS.html";h.ajax({url:c,dataType:"jsonp",cache:true,jsonpCallback:"jsonpQueryForNavFromSFS",success:function(s){if(s&&s.pcInfo){var u=s.pcInfo||"";if(u.imgUrl&&u.activeUrl&&""!=u.imgUrl&&""!=u.activeUrl){var j="<div class='hot'><a href='"+u.activeUrl.replace("http://","//")+"'><img src='"+u.imgUrl+"'></a></div>";h("[moduleType='sys.navigation']").find(".sf-allcate").after(j);h("[moduleType='sys.navigation']").find(".sf-navlist").css("width","715px")}}},error:function(){debug&&console.info("查询导航承接页露出网络异常")}})}};h.extend(i,{category:y,product:e,search:q,util:a,extendNavi:E,priceUtil:x,page:k,sa:F});define("shop.image.compress",function(){var s={test_re:/(\?.*?format=)([^&]+)/ig,format_tpl:"format={format}",webp:".webp",c80q:"80Q",c90q:"90Q",hosts_re:/(image\d?|uimgpre).(cn)?suning.(cn|com)\/uimg\/(sop|b2c)/ig,jpg_re:/[^\.\/]+\.(jpg|jpeg)/ig};function J(L){var K=L.match(s.hosts_re);return K!=null}function I(L){var K=L.match(s.jpg_re);return K!=null}function j(Q,O){if(Q.match(s.test_re)){return Q.replace(s.test_re,"$1$2|"+O)}else{var M="?",L="&",K=Q.indexOf(M)>0,N=Q[Q.length-1]==M;var R=s.format_tpl.format({format:O});var P=K?N?R:L+R:M+R;return Q+P}}function u(K,O,L){var M=h(O);var N=M.attr("lazy-src")||"";if(M.is("img[lazy-src][lazy-src!=finish]")&&J(N)&&I(N)){N=j(N,s.c90q);if(N){M.attr("lazy-src",N)}}L()}function c(){window.Shop.LazyLoad.filter_add(u);window.debug&&console.info("image compress filter is setup")}var D={filter:u,setup:c};h.extend(s,D);return s}());shop.image.compress.setup();h(function(){q.bind();y.bind();a.bind();E.bind();x.bind();y.highLight();b.uv();a.fixHeader();b.rlv();try{h(".sf-module990").each(function(j,u){var s=h(".sf-moduleList",u).size();window.debug&&console.info("module-list",s,u);if(s==0){h(u).texts().remove()}})}catch(c){}h(window).on("item.loaded",function(){if(h(".sf-filters").find(".sf-filterBrand").length>3&&h(".sf-filters").find(".sf-filterOpen").length==0){h(".sf-filters").css({height:"105px"})}})});Shop.util.fixDomain();if(h(".slideFloat").length>0){h(".slideFloat").parents(".sf-layoutList").css("zIndex",15);h(".slideFloat").css("zIndex",15)}h(".slideFloat a[topPostition]").each(function(c){h(this).live("click",function(){var j=h(this).attr("topPostition");h("body,html").animate({scrollTop:j},0);return false})});function m(D){var c=D.parents(".sf-moduleList").attr("showstyle");var s=parseInt(parseInt(c)/10)*parseInt(parseInt(c)%10);var u=D.find(".page").length;var j=false;if(u>s){j=true}else{j=false}D.markSlider({pauseShow:false,countShow:j,showBtn:j,directionNav:true,progressNavHover:true,speed:1000,pause:30000000,numeric:false})}function B(D){var M=D.attr("showstyle");var O=D.attr("shownum");var L=D.attr("moduleStyle");var j=D.attr("isHidden");var J=h(h(D.find(".promo"+L+M).find(".page")[0]).find("img")).attr("data-picsize")||"160x160";if(1===parseInt(j)){return}D.find(".promo"+L+M).show();var K={generateProductURL:function(P,Q){var Q=Q;return C.config.detailDomain+K.validTenNnumber(P)+"/"+K.validNineNumber(Q)+".html"},generateProductImg:function(P,R,Q){var Q=Q||"400x400";Q=Q.split("x")[0];var R=R;return Shop.product.converter.pimg({picSize:Q,pscode18:R})},validTenNnumber:function(P){if(P.length==10){return P}else{return"00"+P}},validEightenNnumber:function(P){var S="000000000000000000";P=P||S;var R=P.length;var Q=S.length;if(R>Q){P=P.substring(0,Q)}else{if(R<Q){P=S.substring(0,Q-R)+P}}return P},validNineNumber:function(Q){Q=Q||"";if(""!=Q){var R=Q.length;for(var P=0;P<R;P++){if("0"!=Q.charAt(0)){break}Q=Q.substring(1)}}return Q},formatProds:function(W,Q,V){var X=[];for(var S=0;S<Q.length;S++){var U=Q[S];var R=U.partnumber;var T=U.price;var P={pcode:R,purl:K.generateProductURL(W,R),pimg:K.generateProductImg(W,R,V),opname:U.catentdesc||"",pname:U.title||U.catentdesc||"",price:T,pguide:U.isPguide};X.push(P)}return X},formatProd:function(P){return{pcode:P.pcode||"----",purl:P.purl||"javascript:void(0);",pimg:P.pimg||"----",opname:P.opname||"",pname:P.pname||" ",price:P.price||"----",pguide:P.pguide||0}},validTenNnumber:function(P){if(P.length==10){return P}else{return"00"+P}}};var s={generateProductImg:function(P,R,Q){var Q=Q||"400x400";Q=Q.split("x")[0];return Shop.product.converter.pimg({picSize:Q,pscode18:R})},formatProds:function(W,Q,V){var X=[];for(var S=0;S<Q.length;S++){var U=Q[S];var R=U.sugGoodsCode||"";var T=U.price;var P={pcode:R,purl:K.generateProductURL(W,R),pimg:s.generateProductImg(W,R,V),opname:U.catentdesc||"",pname:U.sugGoodsName||"",price:T,handwork:U.handwork};X.push(P)}return X}};function c(Z,ai,aa){var af=(!ai||!ai.length||ai.length===0)?0:ai.length;var ag=parseInt(parseInt(Z.attr("showstyle"))/10)*(parseInt(Z.attr("showstyle"))%10);var W=parseInt(Z.attr("shownum"))/ag;var V=af===0?1:Math.ceil(af/ag);var ac=W-V;if(ac>0){for(var ab=0;ab<ac;ab++){var U=Z.find(".promo"+Z.attr("moduleStyle")+Z.attr("showstyle")).find(".promo_item").length;if(U>1){h(h(Z.find(".promo"+Z.attr("moduleStyle")+Z.attr("showstyle")).find(".promo_item"))[U-1]).remove()}}}var Q=Z.find(".promo"+Z.attr("moduleStyle")+Z.attr("showstyle")).find(".page");if(af===0){for(var ab=1;ab<Q.length;ab++){h(Q[ab]).remove()}}if(ai.length<Q.length&&ai.length%ag!==0){var ad=ag-ai.length%ag;for(var ab=0;ab<ad&&Q.length>0;ab++){h(Q[Q.length-1]).remove();Q.length--}}for(var ab=0;ab<Q.length;ab++){if("rec"===aa){var ah={pageType:"dpHome",parameter:"none",module:"recdpsptj",position:"1-"+(ab+1),shopCode:C.shop.spcode.length===10?C.shop.spcode:"00"+C.shop.spcode,sugGoodsCode:ai[ab]["pcode"],handwork:ai[ab]["handwork"]?ai[ab]["handwork"]:"none_none_none_none"};var T="{pageType}_{parameter}_{module}_{position}_p_{shopCode}_{sugGoodsCode}_{handwork}".format(ah);var S="{pageType}_{parameter}_{module}_{position}_c_{shopCode}_{sugGoodsCode}_{handwork}".format(ah);var Y={pageType:"baoguang",module:"recdpsptj",position:"1-"+(ab+1),shopCode:C.shop.spcode.length===10?C.shop.spcode:"00"+C.shop.spcode,sugGoodsCode:ai[ab]["pcode"],handwork:ai[ab]["handwork"]?ai[ab]["handwork"]:"none_none_none_none"};var X="{pageType}_{module}_{position}_{shopCode}_{sugGoodsCode}_{handwork}".format(Y);h(h(Q[ab]).find("a")[0]).attr("name",T);h(h(Q[ab]).find("a")[0]).attr("sa-uv",T);h(h(Q[ab]).find("a")[0]).attr("ignore-page","true");h(h(Q[ab]).find("a")[0]).attr("ignore-sysname","true");h(h(Q[ab]).find("a")[1]).attr("name",S);h(h(Q[ab]).find("a")[1]).attr("sa-uv",S);h(h(Q[ab]).find("a")[1]).attr("ignore-page","true");h(h(Q[ab]).find("a")[1]).attr("ignore-sysname","true");h(h(Q[ab]).find("a")[1]).attr("id",X);h(h(Q[ab]).find("a")[0]).attr("href",ai[ab]["purl"]+"?src="+T);h(h(Q[ab]).find("a")[1]).attr("href",ai[ab]["purl"]+"?src="+S)}else{h(Q[ab]).find("a").attr("href",ai[ab]["purl"])}h(Q[ab]).find("img").attr("src",ai[ab]["pimg"]);var ae='<span class="stress"></span>';h(Q[ab]).find(".intro").html(ai[ab]["pname"]+ae);h(Q[ab]).find("img").attr("alt",ai[ab]["pname"]);h(Q[ab]).find("img").attr("title",ai[ab]["pname"]);h(Q[ab]).find(".intro").attr("alt",ai[ab]["pname"]);h(Q[ab]).find(".intro").attr("title",ai[ab]["pname"]);var R=isNaN(parseFloat(ai[ab]["price"]).toFixed(2))?ai[ab]["price"]:parseFloat(ai[ab]["price"]).toFixed(2);var P=R.split(".");if(P&&P.length>=2){R='<em class="sf-PriceSymbol">¥</em>'+P[0]+'.<b class="sf-priceDecimal">'+P[1]+"</b>"}h(Q[ab]).find(".price").html(R)}m(h("[moduleid="+Z.attr("moduleid")+"]").find(".promo_content"+Z.attr("moduleStyle")+ag))}function u(V,T,P){if(T&&T.length>0){var U=[];for(var S=0;S<T.length;S++){U.push(K.validEightenNnumber(T[S].pcode))}var R={icpsHost:C.config.icpsDomain,cmmdtyCode:U.join(","),cityCode:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],spcode:K.validTenNnumber(C.shop.spcode),chan:1};var Q="{icpsHost}icps-web/getAllPriceNew.htm?cmmdtyCode={cmmdtyCode}&cityCode={cityCode}&chan={chan}&bizCode={spcode}&type=2&sys=SFS&isCache=1".format(R);h.ajax({url:Q,dataType:"jsonp",data:{format:"json"},cache:false,timeout:5000,success:function(Z){var aa=(Z||[]).tomap("cmmdtyCode");for(var W=0;W<T.length;W++){var Y=aa[K.validEightenNnumber(T[W].pcode)]["price"];var X=/^[0-9]+.?[0-9]*$/;T[W]["price"]=X.test(Y)?Y:"售罄"}c(V,T,P)},error:function(){console&&console.info("调价格中心jsonp接口系统繁忙")}})}return}function N(){var P=C.config.searchDomain+"queryByKeyword.do?vendor_Id="+K.validTenNnumber(C.shop.shopId)+"&start=0&rows="+O;h.ajax({url:P,dataType:"jsonp",cache:true,success:function(Q){var R=K.formatProds(K.validTenNnumber(C.shop.shopId),Q.goods||[],J||"160x160");u(D,R,"search")},error:function(){}})}function I(){var T=C.rec_server;var R,Q;var P="23-11";var S="&cityId="+(d("SN_CITY")||"100_025").split("|")[0].split("_")[1];h.icoookie().g("_snma")?R="&c="+h.icoookie().g("_snma").split(decodeURIComponent("%7C"))[1]:R="";h.icoookie().g("custno")?Q="&u="+h.icoookie().g("custno"):Q="";var U=T+"/recommend-portal/dyBase.jsonp?sceneIds="+P+Q+R+"&vendorId="+K.validTenNnumber(C.shop.shopId)+S+"&count="+O;h.ajax({url:U,dataType:"jsonp",cache:true,success:function(V){var X=[];if(V&&V.sugGoods&&V.sugGoods[0]&&V.sugGoods[0].skus){X=V.sugGoods[0].skus}var W=s.formatProds(K.validTenNnumber(C.shop.shopId),X||[],J||"160x160");if(W&&W.length>0){u(D,W,"rec")}else{N()}},error:function(){N()}})}I()}function g(s){var j;if(s&&parseInt(s.attr("layoutid"))>0&&s.hasClass("sf-layoutList")){j=h(s).find("[showNum][moduletype='sys.intelligRec']")}else{j=h("[showNum][moduletype='sys.intelligRec']")}if(j&&j.length>0){for(var c=0;c<j.length;c++){B(h(j[c]))}}F.recb()}h(g);h(function(){function s(){var I=t.getParameter();A.page=0;if(t.need){t.search(I)}if(G.need){G.category(I)}}h(window).on("item.loaded",function(){h(".sf-otherlist").find("li").each(function(){if(h(this).attr("sf-search-filter")=="price"){h(this).find(".sf-btnselectmore").remove();h(this).find("input").remove();h(this).find(".JS-btncateConfirm").remove();h(this).find(".JS-btncateCancel").remove()}})});h(".sf-osearch-bar .sf-keyword").focus(function(){h(this).parents("label").addClass("sf-labelfocus")});h(".JS-filterbtn").live("click",function(){h(this).toggleClass("filterbtnup");if(h(this).hasClass("filterbtnup")){h(this).text("展开筛选")}else{h(this).text("收起筛选")}h(".sf-othermore").toggle();h(this).parents(".sf-osearch").find(".sf-filtercate").slideToggle("fast")});h(".JS-catemore").live("click",function(){h(this).parents("dl").toggleClass("sf-cateshowmore")});h(".sf-otherlist li ,.sf-scrolloverall li").live("mouseover",function(){var K=h(this).find(".sf-sublist");var J=h(this).position().left;var I=parseInt(h(this).position().top);K.css({top:I+30});h(this).addClass("sf-hover");h(this).parents("dl").addClass("sf-cateshowmore");h(this).find(".sf-itcur input").each(function(){h(this).attr("checked","true")})}).live("mouseout",function(){h(this).removeClass("sf-hover");h(this).parents("dl").removeClass("sf-cateshowmore")});h(".JS-btncateCancel").live("click",function(){h(this).parents("li").removeClass("sf-hover");h(this).parents("dl").removeClass("sf-cateshowmore");if(h(this).parents(".sf-scrolloverall").length>0){var I=h(this).parents("li").attr("sf-search-filter-item-check").split(",");h(this).parents("li").find("span").each(function(){if(h.inArray(h(this).attr("sf-search-filter-item"),I)!=-1&&h(this).attr("sf-search-filter-item")!=undefined){h(this).parent().addClass("sf-itcur");h(this).parent().find("input").attr("checked","checked")}else{h(this).parent().removeClass("sf-itcur");h(this).parent().find("input").removeAttr("checked")}})}else{h(this).parents(".sf-sublist").removeClass("sf-sublist-check").find(".sf-btnselectmore").show();h(this).parents(".sf-sublist").find("input").removeAttr("checked");h(this).parents(".sf-sublist").find(".sf-itcur").removeClass("sf-itcur");h(this).parents(".sf-sublist").find(".a-itcur").removeClass("a-itcur")}});function u(J){if(J!=undefined){var I=J.parents(".sf-osearch")}else{var I=h(".sf-osearch")}I.each(function(){var T=h(this).width();var P=0;var L=h(this).find(".sf-scrolloverall");L.find("li").each(function(){_childili=h(this).width()+5;P+=_childili});var K=L.width();var N=P;var R=L.parents(".sf-selectedCate");L.width(Math.ceil(N));var Q=L.width();if(L.css("marginLeft")!=undefined){var M=parseInt(L.css("marginLeft").substring(0,L.css("marginLeft").length-2))}var S=parseInt(K-Q);var O=parseInt(M+S);if(T>=990){if(L.width()>=620){R.find(".sf-btn").show();if(M!=undefined){if(M!=0){if(S>0){L.css("marginLeft",O)}else{R.find(".sf-btnnext").removeClass("sf-btnnextDisabled")}R.find(".sf-btnprev").removeClass("sf-btnprevDisabled")}else{R.find(".sf-btnnext").removeClass("sf-btnnextDisabled")}}else{R.find(".sf-btnnext").removeClass("sf-btnnextDisabled")}}else{L.parents(".sf-selectedCate").find(".sf-btn").hide();L.css("marginLeft",0)}}else{if(h(".sf-scrolloverall").width()>=420){h(".sf-selectedCate .sf-btn").show();if(M!=undefined){if(M!=0){if(S>0){L.css("marginLeft",O)}else{R.find(".sf-btnnext").removeClass("sf-btnnextDisabled")}R.find(".sf-btnprev").removeClass("sf-btnprevDisabled")}else{R.find(".sf-btnnext").removeClass("sf-btnnextDisabled")}}else{R.find(".sf-btnnext").removeClass("sf-btnnextDisabled")}}else{L.parents(".sf-selectedCate").find(".sf-btn").hide();L.css("marginLeft",0)}}})}h(".sf-selectedCate .sf-btnprev").live("click",function(){var I=h(this).parents(".sf-selectedCate");I.find(".sf-scrolloverall").animate({marginLeft:"0"});h(this).addClass("sf-btnprevDisabled");I.find(".sf-btnnext").removeClass("sf-btnnextDisabled")});h(".sf-selectedCate .sf-btnnext").live("click",function(){var K=h(this).parents(".sf-selectedCate").find(".sf-scrolloverall");if(h(this).parents(".sf-osearch").width()==990){var J=K.width()-620}else{var J=K.width()-420}var I=h(this).parents(".sf-selectedCate");I.find(".sf-scrolloverall").animate({marginLeft:-J});h(this).addClass("sf-btnnextDisabled");I.find(".sf-btnprev").removeClass("sf-btnprevDisabled")});h(".sf-osearch").each(function(){var I=h(this).width();if(I>=990){h(this).find(".sf-selectCateScroll").css("maxWidth",620)}else{h(this).find(".sf-selectCateScroll").css("maxWidth",420)}});function c(J){if(J!=undefined){var I=J.parents(".sf-osearch")}else{var I=h(".sf-osearch")}I.each(function(){var M=h(this).width();var K=h(this).find(".sf-selectedCate").width()+10;var L=h(this).find(".sf-osearch-bar label").width()+44;var O=h(this).find(".JS-filterbtn").width()+30;var N=M-20-K-L-O;h(this).find(".sf-keywordList").width(N)})}c();h(".sf-otherlist .JS-btncateConfirm").live("click",function(){h(this).parents("dl").removeClass("sf-cateshowmore");j(h(this))});h(".sf-otherlist .sf-sublist").find("a.sf-it span").live("click",function(){if(!h(this).parents("a").find("input").is(":visible")){h(this).parents("a").toggleClass("sf-itcur").siblings("a").removeClass("sf-itcur");h(this).parents("dl").removeClass("sf-cateshowmore");j(h(this))}else{if(h(this).parents("a").find("input").is(":checked")){h(this).parents("a").find("input").attr("checked",false)}else{h(this).parents("a").find("input").attr("checked",true)}}});h(".sf-selectedCate .JS-btncateConfirm").live("click",function(){var L=h(this).parents(".sf-scrolloverall");var N=h(this).parents(".sf-sublist").find("input:checked");var K=h(this).parents("li");var P=[];var O=0;var M=[];if(N.length>0){N.each(function(Q){if(Q<2){P[Q]=h(this).parents(".sf-it").find("span").text().substring(0,2)}else{O=Q}M.push(h(this).next().attr("sf-search-filter-item"))});var J=P.join("、");if(O<2){K.find("h5 em").text(J)}else{K.find("h5 em").text(J+"...")}}else{K.remove();if(L.find("li").length<=0){h(".sf-selectedCate").hide()}}K.find(".a-itcur").removeClass("a-itcur");K.find(".a-itcur").removeClass("sf-itcur");K.removeClass("sf-hover");u(L);c(L);var I=M.join(",");h(this).parents("li").attr("sf-search-filter-item-check",I);s()});h(".sf-selectedCate .sf-sublist").not(".sf-sublist-check").find("a.sf-it span").live("click",function(){h(this).parents("a").toggleClass("sf-itcur").siblings("a").removeClass("sf-itcur");j(h(this))});function j(O){var M=[];var V=0;var K,X,Q,J,I;var T=O.parents(".sf-filtercate");var L=O.parents(".sf-sublist").find("input:checked");var S=O.parents("li");var Z=S.find(".a-item").text();var N=O.parents(".sf-osearch").find(".sf-scrolloverall");var W=[];if(L.length>0){L.each(function(aa){h(this).parents("a").addClass("sf-itcur");if(aa<2){M[aa]=h(this).parents(".sf-it").find("span").text().substring(0,2)}else{V=aa}W.push(h(this).next().attr("sf-search-filter-item"))});var P=S.find(".sf-sublist").html();var U=M.join("、");var R=W.join(",");Q='<li sf-search-filter-item-check="'+R+'"><h5><span>'+Z+"：</span><em>";if(V<2){J=Q+U+"</em><b></b></h5>"}else{J=Q+U+"...</em><b></b></h5>"}I=J+'<div class="sf-sublist">'+P+"</div></li>";h(".sf-selectedCate").show();N.append(I);u(O);c(O);S.remove();s()}else{if(O.text()=="确定"){return false}else{var U=O.text().substring(0,2);if(O.parents(".sf-selectedCate").length>0){var Y=O.parents("li").find("h5 em").text(U);u(O);c(O);O.parents("li").removeClass("sf-hover")}else{var R=O.attr("sf-search-filter-item");Q='<li sf-search-filter-item-check="'+R+'" ><h5><span>'+Z+"：</span><em>";if(V<2){J=Q+U+"</em><b></b></h5>"}else{J=Q+U+"...</em><b></b></h5>"}var P=S.find(".sf-sublist").html();I=J+'<div class="sf-sublist">'+P+"</div></li>";h(".sf-selectedCate").show();N.append(I);u(O);c(O);S.remove()}}}D(T)}h(".JS-moreother").live("click",function(){h(".sf-otherlist").parents("dl").toggleClass("sf-cateshowmore2");h(this).toggleClass("up");h(".sf-otherlist").parents("dd").toggleClass("sf-otherlist-more")});h(".sf-btnselectmore").live("click",function(){h(this).hide();h(this).parents(".sf-sublist").addClass("sf-sublist-check")});h(".sf-scrolloverall li b").live("click",function(){var P=h(this).parents(".sf-scrolloverall").find("li").attr("sf-search-filter-item-check").split(":");var W=h(this).parents(".sf-scrolloverall");var J=h(this).parents("li");var V=J.width()+4;var I=J.parent(".sf-scrolloverall");var M=I.width()-V;var T=h(this).parents(".sf-osearch").width();var K=h(this).parents(".sf-osearch").find(".sf-filtercate");var N=J.find("h5 span").text();var Q=N.length;var R=N.substring(0,Q-1);J.find(".sf-itcur").removeClass("sf-itcur");J.find(".a-itcur").removeClass("a-itcur");J.find("input").removeAttr("checked");var L=J.find(".sf-sublist").html();var S="<li sf-search-filter="+P[0]+'><a href="javascript:void(0);" class="a-item">'+R+"<i></i></a>";var O=S+'<div class="sf-sublist">'+L+"</div></li>";J.remove();if(T==990){if(M<=620){I.parents(".sf-selectedCate").find(".sf-btn").hide();I.removeAttr("style")}else{var U=620-M;I.css({marginLeft:U,width:M})}}else{if(M<=420){I.parents(".sf-selectedCate").find(".sf-btn").hide();I.removeAttr("style")}else{var U=420-M;I.css({marginLeft:U,width:M})}}h(".sf-otherlist").append(O);h(".sf-otherlist").find(".sf-btnselectmore").show();u(W);c(W);D(K);if(W.width()==0){h(".sf-selectedCate").hide()}s()});h(".sf-selectedCate dl").hover(function(){h(this).toggleClass("sf-hover")});h(".sf-nsearchPrice label input").focus(function(){h(this).parents(".sf-nsearchPrice").find(".sf-nsearchPlug").show()});h(document).bind("click",function(I){if(!h(I.target).closest(".sf-nsearchPrice").length){h(".sf-nsearchPlug").hide()}});h(".JS-pricecancel").live("click",function(){h(this).parents(".sf-nsearchPrice").find("input").val(" ")});h(".sf-sublist .sf-it input").live("click",function(){h(this).parents("a").toggleClass("sf-itcur")});h(window).on("item.loaded",function(){D()});function D(K){if(h(".sf-filtercate .sf-otherlist").length>0){if(K!=undefined){var I=K.find(".sf-otherlist").height();if(I>30){K.parents(".sf-osearch").find(".sf-othermore").show()}else{K.parents(".sf-osearch").find(".sf-othermore").hide()}}else{var J=h(".sf-filtercate .sf-otherlist");var I=J.height();if(I>30){J.parents(".sf-osearch").find(".sf-othermore").show()}else{J.parents(".sf-osearch").find(".sf-othermore").hide()}}}else{h(".sf-osearch").find(".sf-othermore").hide()}}h(".sf-nsearchPrice a,.sf-clear").live("click",function(I){var J=h(this).parents(".sf-nsearchPrice");J.find("input").val("")});setInterval(function(){h(".sf-nsearchPrice input").each(function(){var J=h(this).val();var I=/^[0-9]*$/.test(J);if(!I){J=J.slice(0,J.length-1)}h(this).val(J)})},50)})})(window,document,jQuery,sn||{},window.Shop=window.Shop||{});(function(){var a=$.request.parameters;define("ishop.util",{lazyLoadJavascripts:function(){var m=document,k,l=[],s=[],j;function q(f,b){var g,e;r();if(f.src){f.src=f.src.constructor===Array?f.src:[f.src];for(var c=0;c<f.src.length;c++){if(f.src[c].constructor!==Array){f.src[c]=[f.src[c]]}s.push(f.src[c])}}l=s.shift();k=k||m.getElementsByTagName("head")[0];f.src=l;for(var c=0;c<f.src.length;c++){e=f.src[c];g=m.createElement("script");g.src=e;g.type="text/javascript";if(j.ie){g.onreadystatechange=function(){var h=this.readyState;if(h==="loaded"||h==="complete"){this.onreadystatechange=null;n(f,b)}}}else{g.onload=g.onerror=function(){n(f,b)}}k.appendChild(g)}}function n(e,b){var c=l;if(!c){return}c.shift();if(!c.length){if(s.length){q(e,b)}else{if(typeof b=="function"){b()}return}}}function r(){if(j){return}var b=/msie/i.test(navigator.userAgent.toLowerCase());j={ie:b}}return{init:function(c,b){q(c,b)}}}(),lljs:function(b,c){ishop.util.lazyLoadJavascripts.init({src:b},c)}});$(function(){var c={tingyun:"{ds_resource_context}/project/shopv2/common/js/ting-yun.js{rversion}".format(sn),tingyun_dev:"{ds_resource_context}/project/shopv2/common/js/ting-yun-pre.js{rversion}".format(sn)};var b=[];if(sn.env=="prod"){b.push(c.tingyun)}else{b.push(c.tingyun_dev)}ishop.util.lljs(b,function(){console.info("js异步加载脚本结束")})})})();(function(){$(function(){var g=function(l,k){l.find("object,.bj-video").each(function(){var q=$(this).parents(".sf-videoWrap").attr("leftx");var n=1920-$(window).width()+k;var m=q-parseInt(n/2);$(this).css("left",m)})};var j=function(y,H,E,u,z){if(H){z.find(y).html(H)}if(!u){return false}u=u.replace(/-/g,"/");u=new Date(u);var k=new Date();var A=u.getTime()-k.getTime();if(A<=0){return false}var D=Math.floor(A/1000/60/60/24);var r=Math.floor(A/1000/60/60%24);var B=Math.floor(A/1000/60%60);var G=Math.floor(A/1000%60);var x;var m;if(0==D){x=0;m=0}else{x=parseInt(D/10);m=parseInt(D%10)}var C;var F;if(0==r){C=0;F=0}else{C=parseInt(r/10);F=parseInt(r%10)}var q;var v;if(0==B){q=0;v=0}else{q=parseInt(B/10);v=parseInt(B%10)}var l;var w;if(0==G){l=0;w=0}else{l=parseInt(G/10);w=parseInt(G%10)}var n=new Array(x,m,C,F,q,v,l,w);var s=0;z.find(E).each(function(){$(this).html(n[s]);s++})};var e=function(r,v,z,l,q){if(v){q.find(r).html(v)}if(!l){return false}l=l.replace(/-/g,"/");l=new Date(l);var w=new Date();var y=l.getTime()-w.getTime();if(y<=0){return false}var u=Math.floor(y/1000/60/60/24);u=c(u);var n=Math.floor(y/1000/60/60%24);n=c(n);var m=Math.floor(y/1000/60%60);m=c(m);var k=Math.floor(y/1000%60);k=c(k);var x=new Array(u,n,m,k);var s=0;q.find(z).each(function(){$(this).html(x[s]);s++})};function c(k){if(k<10){return"0"+k}else{return k}}var a=function(k){k.each(function(){var s=$(this);var q=s.attr("timeStyle");var v=s.attr("styleValue");if("1"==q){var u=s.attr("title");var n=s.attr("time");if("1"==v){h(s,".red-single",".time-p-t",u,".time-p",n,1)}else{if("2"==v){h(s,".black-single",".time-p-t",u,".time-p",n,2)}else{if("3"==v){h(s,".green-single",".time-p-t",u,".time-p",n,2)}}}}else{if("2"==q){var l=s.attr("startTitle");var m=s.attr("startTime");var t=s.attr("endTitle");var r=s.attr("endTime");if("1"==v){b(s,".red-single",".time-p-t",".time-p",l,m,t,r,1)}else{if("2"==v){b(s,".black-single",".time-p-t",".time-p",l,m,t,r,2)}else{if("3"==v){b(s,".green-single",".time-p-t",".time-p",l,m,t,r,2)}}}}}})};var f=function(k){k.each(function(){var s=$(this);var q=s.attr("timeStyle");var v=s.attr("styleValue");if("1"==q){var u=s.attr("title");var n=s.attr("time");if("1"==v){h(s,".red-double",".time-p-d-t",u,".time-p-d",n,1)}else{if("2"==v){h(s,".black-double",".time-p-d-t",u,".time-p-d",n,2)}else{if("3"==v){h(s,".green-double",".time-p-d-t",u,".time-p-d",n,2)}}}}else{if("2"==q){var l=s.attr("startTitle");var m=s.attr("startTime");var t=s.attr("endTitle");var r=s.attr("endTime");if("1"==v){b(s,".red-double",".time-p-d-t",".time-p-d",l,m,t,r,1)}else{if("2"==v){b(s,".black-double",".time-p-d-t",".time-p-d",l,m,t,r,2)}else{if("3"==v){b(s,".green-double",".time-p-d-t",".time-p-d",l,m,t,r,2)}}}}}})};var h=function(s,r,t,q,k,n,l){s.find(r).removeClass("hide").siblings("div").addClass("hide");var m=s.find(r);if(1==l){window.setInterval(function(){j(t,q,k,n,m)},1000)}else{if(2==l){window.setInterval(function(){e(t,q,k,n,m)},1000)}}};var b=function(m,q,v,s,l,n,u,t,k){m.find(q).removeClass("hide").siblings("div").addClass("hide");var r=m.find(q);if(1==k){window.setInterval(function(){i(k,r,v,s,l,n,u,t)},1000)}else{if(2==k){window.setInterval(function(){i(k,r,v,s,l,n,u,t)},1000)}}};function i(k,q,v,r,l,m,u,s){var x=l;var z=m;m=m.replace(/-/g,"/");var n=new Date(m);var w=new Date();var y=n.getTime()-w.getTime();if(y<0){z=s;x=u}if(1==k){j(v,x,r,z,q)}else{if(2==k){e(v,x,r,z,q)}}}$(window).on("pcCountdown.initialize",function(){a($(".singlePCCountdown"));f($(".doublePCCountdown"))});$(window).trigger("pcCountdown.initialize");g($(".sf-videoWrap"),0)})})();(function($){var shopSideBar={hasLogin:false,clickFlag:true,giftFlag:false,pageMap:{index:"index",search:"search",list:"list",sale:"sale"},urlCollection:{shopLevel:{dev:"//vippre.cnsuning.com/memberlevel/showLevel.do",sit:"//vippre.cnsuning.com/memberlevel/showLevel.do",pre:"//vippre.cnsuning.com/memberlevel/showLevel.do",prod:"//vip.suning.com/memberlevel/showLevel.do"},shopCloud:{dev:"//cmallpre.cnsuning.com/cmall-web/yigou.htm",sit:"//cmallpre.cnsuning.com/cmall-web/yigou.htm",pre:"//cmallpre.cnsuning.com/cmall-web/yigou.htm",prod:"//cmall.suning.com/cmall-web/yigou.htm"},shopCoupon:{dev:"//quanpre.cnsuning.com/yhq.do",sit:"//quanpre.cnsuning.com/yhq.do",pre:"//quanpre.cnsuning.com/yhq.do",prod:"//quan.suning.com/yhq.do"},cAggregation:{dev:"//tsspre.cnsuning.com/ticket/tss/pc/{qruleId}.html",sit:"//tsspre.cnsuning.com/ticket/tss/pc/{qruleId}.html",pre:"//tsspre.cnsuning.com/ticket/tss/pc/{qruleId}.html",prod:"//tss.suning.com/ticket/tss/pc/{qruleId}.html"},getShopFavoList:{dev:"//favoritepre.cnsuning.com/ajax/myTopNShopFavorites.do",sit:"//favoritesit.cnsuning.com/ajax/myTopNShopFavorites.do",pre:"//favoritepre.cnsuning.com/ajax/myTopNShopFavorites.do",prod:"//favorite.suning.com/ajax/myTopNShopFavorites.do"},shopFavoMore:{dev:("13"==sn.shop.shopType||"14"==sn.shop.shopType)?"//hk-pre.cnsuning.com/favorite/shop":"//favoritepre.cnsuning.com/myShopFavorites.do",sit:("13"==sn.shop.shopType||"14"==sn.shop.shopType)?"//hk-sit.cnsuning.com/favorite/shop":"//favoritepre.cnsuning.com/myShopFavorites.do",pre:("13"==sn.shop.shopType||"14"==sn.shop.shopType)?"//hk-pre.cnsuning.com/favorite/shop":"//favoritepre.cnsuning.com/myShopFavorites.do",prod:("13"==sn.shop.shopType||"14"==sn.shop.shopType)?"//www.hksuning.com/favorite/shop":"//favorite.suning.com/myShopFavorites.do"}},getHttpUrl:function(key,env){return shopSideBar.urlCollection[key][env]},getHostName:function(){var _prd_reg=/^\w*?.(hk)?suning.com$/;var _pre_reg=/^(\w*)(pre)(\w*)(.cnsuning.com)$/;var _sit_reg=/^(\w*)(sit)(\w*)(.cnsuning.com)$/;var _dev_reg=/^(\w*)(dev)(\w*)(.cnsuning.com)$/;var env="pre";var hostName=document.location.hostname;if(_prd_reg.test(hostName)){env="prod"}else{if(_pre_reg.test(hostName)){env="pre"}else{if(_sit_reg.test(hostName)){env="sit"}else{if(_dev_reg.test(hostName)){env="dev"}}}}return env},shoucang:{getShopFavoListFun:function(shopId,hasLogin,favStatus,data){var tip="",giftTip="",showFlag="none",elName="shoucang";if("1"==favStatus){tip="此店铺已收藏"}else{if("2"==favStatus){tip="店铺收藏成功！"}else{if("3"==favStatus){tip="店铺收藏成功！",showFlag="block",elName="shoucang-gift";if(""==data.couponType){giftTip="恭喜您！获得<b>"+data.couponAmount+"</b>"+data.couponName}else{giftTip="恭喜您！获得一张<b>"+data.couponAmount+"</b>元"+data.couponName}}}}if($(".sn-sidebar-content.sn-sidebar-"+elName).length==0){shopSideBar.appendElContent("cart",elName)}var html=$("#shop-sidebar-shoucang-content").html();var env=shopSideBar.getHostName();var url=shopSideBar.getHttpUrl("getShopFavoList",env);$.jsonp(url,{pageSize:"10"},function(data){if("0"==data.returnCode){$(".sn-sidebar-content.sn-sidebar-"+elName).html(html.format({tip:tip,giftTip:giftTip,showFlag:showFlag}));var userShopHtml=$(".sn-sidebar-content.sn-sidebar-"+elName).find("#userShopshoucang").html();var list=data.shopBaseInfoList;var listLen=list.length;var favoHtml="";for(var idx=0;idx<listLen;idx++){var item=list[idx];var shopCust=item.shopCust;if(shopCust>10000){shopCust="<b>"+Math.round(shopCust/10000*10)/10+"</b>万"}else{shopCust="<b>"+shopCust+"</b>"}item.shopCust=shopCust;var shopLogo=item.shopLogo;if(shopSideBar.isEmpty(shopLogo)){shopLogo=""}else{shopLogo="<img src='"+shopLogo+"'/>"}item.shopLogo=shopLogo;var shopDomainUrl=item.shopDomainUrl;if(shopSideBar.isEmpty(shopDomainUrl)){shopDomainUrl="javascript:void(0);"}else{shopDomainUrl=shopDomainUrl}item.shopDomainUrl=shopDomainUrl;favoHtml+=userShopHtml.format({item:item})}$(".sn-sidebar-content.sn-sidebar-"+elName).find("#userShopshoucang").replaceWith(favoHtml);$("a[name=public0_none_cblnew_shoucang]").attr("dataMode","finish");shopSideBar.renderElEvent(shopId,hasLogin);shopSideBar.showModule(elName)}},function(XMLHttpRequest,textStatus,errorThrown){console.info("getShopFavoList-XMLHttpRequest："+JSON.stringify(XMLHttpRequest));console.info("getShopFavoList-textStatus："+textStatus);console.info("getShopFavoList-errorThrown："+errorThrown)},"getShopFavoList","post")},shopActPowerFun:function(shopId,hasLogin){var url=sn.service["service.favorite.shopActPower"];$.jsonp(url,{shopId:shopId},function(data){if("0"==data.returnFlag){var powerFlag=data.shopActivityPowerList[0].powerFlag;if("1"==powerFlag){shopSideBar.shoucang.showFavorHtml(shopId,hasLogin,"2")}else{shopSideBar.shoucang.showFavorHtml(shopId,hasLogin,"1")}}},function(XMLHttpRequest,textStatus,errorThrown){console.info("shopActPowerFun-XMLHttpRequest："+JSON.stringify(XMLHttpRequest));console.info("shopActPowerFun-textStatus："+textStatus);console.info("shopActPowerFun-errorThrown："+errorThrown)},"shopActPowerFun","post")},userActPowerFun:function(shopId,hasLogin){var url=sn.service["service.favorite.userActPower"];$.jsonp(url,{shopId:shopId},function(data){if("0"==data.returnFlag){var powerFlag=data.shopActivityPowerList[0].powerFlag;if("1"==powerFlag){shopSideBar.shoucang.showFavorHtml(shopId,hasLogin,"2")}else{shopSideBar.shoucang.showFavorHtml(shopId,hasLogin,"1")}}},function(XMLHttpRequest,textStatus,errorThrown){console.info("userActPowerFun-XMLHttpRequest："+JSON.stringify(XMLHttpRequest));console.info("userActPowerFun-textStatus："+textStatus);console.info("userActPowerFun-errorThrown："+errorThrown)},"userActPowerFun","post")},shopFavorAndFreeFun:function(shopId,hasLogin,mainFlag){var channelId="1";var dt=encodeURIComponent(bd.rst())||"";var url=sn.service["service.favorite.shopFavorAndFree"];$.jsonp(url,{shopId:shopId,entrance:"shopHome",channelId:channelId,dt:dt},function(data){if("0"==data.returnFlag){shopSideBar.giftFlag=false;var couponAmount=data.couponAmount||"";var couponType=data.couponType||"";var couponName=data.couponName||"";if(""!=couponAmount){data.couponAmount=couponAmount;data.couponType=couponType;data.couponName=couponName;if("1"==mainFlag){shopSideBar.shoucang.getShopFavoListFun(shopId,hasLogin,"3",data)}else{shopSideBar.shoucang.showFavDialog(shopId,hasLogin,"3",data)}}else{if(!shopSideBar.isEmpty(data.faileMessgae)){console.info("shopFavorAndFreeFun-"+data.faileMessgae)}}}else{console.info("收藏有礼："+JSON.stringify(data))}},function(XMLHttpRequest,textStatus,errorThrown){console.info("shopFavorAndFreeFun-XMLHttpRequest："+JSON.stringify(XMLHttpRequest));console.info("shopFavorAndFreeFun-textStatus："+textStatus);console.info("shopFavorAndFreeFun-errorThrown："+errorThrown)},"shopFavorAndFreeFun","post")},showFavorHtml:function(shopId,hasLogin,favStatus){if(favStatus=="2"){shopSideBar.giftFlag=true;$(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-shoucang").hide();$(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-shoucang-gift").show()}},hideFavorHtml:function(){$(".m-dialog-overlay-fav").remove();$(".favpolite-prod-lay").remove()},onClick:function(dataType,shopId,hasLogin){if(hasLogin){var dataMode=$("a[name=public0_none_cblnew_shoucang]").attr("dataMode");if(shopSideBar.isEmpty(dataMode)){ishop.favorite.check(shopId,function(){shopSideBar.shoucang.getShopFavoListFun(shopId,hasLogin,"1")},function(){if("shoucang"==dataType){ishop.favorite.add(shopId,function(){shopSideBar.shoucang.getShopFavoListFun(shopId,hasLogin,"2")})}else{shopSideBar.shoucang.shopFavorAndFreeFun(shopId,hasLogin,"1")}})}else{$(".sn-sidebar-content.sn-sidebar-"+dataType).find("div[name=tip]").text("此店铺已收藏");$(".sn-sidebar-content.sn-sidebar-"+dataType).find("div[name=giftTip]").hide();shopSideBar.showModule(dataType)}}else{if($(".sn-sidebar-content.sn-sidebar-"+dataType).length==0){shopSideBar.appendElContent("cart",dataType)}var loginTip="想收藏当前店铺，赶紧登录吧！";var loginUrl=sn.passport_context+"/ids/login";var html=$("#shop-sidebar-login").html().format({loginUrl:loginUrl,loginTip:loginTip});$(".sn-sidebar-content.sn-sidebar-"+dataType).html(html);shopSideBar.showModule(dataType)}},shopfavorite:function(shopId){var hasLogin=shopSideBar.hasLogin;if(shopSideBar.clickFlag){if(hasLogin){shopSideBar.clickFlag=false;ishop.favorite.check(shopId,function(){shopSideBar.shoucang.showFavDialog(shopId,hasLogin,"1")},function(){if(shopSideBar.giftFlag){shopSideBar.shoucang.shopFavorAndFreeFun(shopId,hasLogin,"2")}else{ishop.favorite.add(shopId,function(){shopSideBar.shoucang.showFavDialog(shopId,hasLogin,"2")})}})}else{location.href=sn.passport_context+(("13"==sn.shop.shopType||"14"==sn.shop.shopType)?"/login":"/ids/login")}}},showFavDialog:function(shopId,hasLogin,favStatus,data){var item=data||{},tip="",giftTip="",showFlag="none",icon="ok",top="37px";if("1"==favStatus){tip="此店铺已收藏",icon="tip"}else{if("2"==favStatus){tip="店铺收藏成功！"}else{if("3"==favStatus){tip="店铺收藏成功！",showFlag="block",top="64px";if(""==data.couponType){giftTip="恭喜您！获得<b>"+data.couponAmount+"</b>"+data.couponName}else{giftTip="恭喜您！获得一张<b>"+data.couponAmount+"</b>元"+data.couponName}}}}item.icon=icon;item.top=top;item.tip=tip;item.showFlag=showFlag;item.giftTip=giftTip;item.shopName=sn.shop.shopName;if(!shopSideBar.isEmpty(sn.shop.shopName)){item.shopLogo="<img src='"+sn.shop.logo+"'/>"}else{item.shopLogo=""}item.id="shopfavorite"+shopSideBar.randomNumBoth(1,100);var windowW=$(window).width();var windowH=$(window).height();var scrollH=$(document).scrollTop();var html=$("#shop-shoucang-dialog").html();$(".shop-sf-shade").after(html.format({item:item}));var elObj=$("#"+item.id);var elW=elObj.width();var elH=elObj.height();$(".shop-sf-shade").show();elObj.css({top:scrollH+eval((windowH-elH)/2)+100,left:eval((windowW-elW)/2),opacity:"0.1",display:"block"});elObj.animate({top:scrollH+eval((windowH-elH)/2),opacity:"1"},600);elObj.find(".closed").off("click").on("click",function(){shopSideBar.clickFlag=true;$(".shop-sf-shade").hide();elObj.remove()});$(document).scroll(function(){var windowH=$(window).height();var scrollH=$(document).scrollTop();elObj.css({top:scrollH+eval((windowH-elH)/2)})});$(window).resize(function(){var windowH=$(window).height();var scrollH=$(document).scrollTop();elObj.css({top:scrollH+eval((windowH-elH)/2)})});shopSideBar.renderElEvent(shopId,hasLogin)},exec:function(shopId,hasLogin){if(hasLogin){ishop.favorite.check(shopId,function(){shopSideBar.shoucang.showFavorHtml(shopId,hasLogin,"1")},function(){shopSideBar.shoucang.userActPowerFun(shopId,hasLogin)})}else{this.shopActPowerFun(shopId,hasLogin)}}},coupon:{levelConfig:{"161000000150":"超级粉丝","161000000140":"V4","161000000130":"V3","161000000120":"V2","161000000110":"V1","161000000160":"V0","161000000100":"新人 ","161000000040":"白金会员","161000000030":"金卡会员","161000000020":"银卡会员 ","161000000010":"普通会员","--":"--"},getCouponInfo:function(shopId,hasLogin){var customNo=$.coookie().g("custno")||"0000000000";var custLevel=$.coookie().g("custLevel")||"--";var url=sn.shop.context+"shopSideBar/ajax/queryCouponInfo_{shopId}_{customNo}_50_1_{callback}.html";url=url.format({shopId:shopId,customNo:customNo,callback:"queryCouponInfo"});$.jsonp(url,{},function(data){var couponMap={};couponMap.custLevel=custLevel;couponMap.custLevelName=shopSideBar.coupon.levelConfig[custLevel];couponMap.basicValue=parseInt(data.basicValue);couponMap.couponCount=data.couponCount;if($(".sn-sidebar-content.sn-sidebar-coupon").length==0){shopSideBar.appendElContent("cart","coupon")}var html=$("#shop-sidebar-coupon-content").html().format(couponMap);$(".sn-sidebar-content.sn-sidebar-coupon").html(html);var shopUseArray=data.shopUseCoupon;var shopUseLen=shopUseArray.length;if(shopUseLen>0){var shopUseFormat=$(".sn-sidebar-content.sn-sidebar-coupon").find("#shopUseCoupon").html();var shopUseHtml="";for(var idx=0;idx<shopUseLen;idx++){var item=shopUseArray[idx];item.shopName=sn.shop.shopName;shopUseHtml+=shopUseFormat.format(item)}$(".sn-sidebar-content.sn-sidebar-coupon").find("#shopUseCoupon").replaceWith(shopUseHtml);var couponObj=$(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-coupon");couponObj.find(".tab-tip").text("有券可用");var tabW=couponObj.find(".tab-tip").width();couponObj.find(".tab-tip").stop().animate({left:"-"+tabW+"px"},"normal");couponObj.addClass("sn-sidebar-tab-hover");setTimeout(function(){couponObj.find(".tab-tip").stop().animate({left:"0px"},"normal");couponObj.removeClass("sn-sidebar-tab-hover");couponObj.find(".tab-tip").text("我的优惠")},3000)}else{$(".sn-sidebar-content.sn-sidebar-coupon").find("#shopUseCoupon").parent().remove()}var env=shopSideBar.getHostName();var qruleUrl=shopSideBar.getHttpUrl("cAggregation",env);var userGetFormat=$(".sn-sidebar-content.sn-sidebar-coupon").find("#userGetCoupon").html();var userGetArray=data.userGetCoupon;var userGetLen=userGetArray.length;userGetLen=userGetLen>5?5:userGetLen;var userGetHtml="";for(var idx=0;idx<userGetLen;idx++){var item=userGetArray[idx];item.qruleUrl=qruleUrl.format({qruleId:item.qruleId});userGetHtml+=userGetFormat.format(item)}$(".sn-sidebar-content.sn-sidebar-coupon").find("#userGetCoupon").replaceWith(userGetHtml)},function(XMLHttpRequest,textStatus,errorThrown){console.info("queryCouponInfo-XMLHttpRequest："+JSON.stringify(XMLHttpRequest));console.info("queryCouponInfo-textStatus："+textStatus);console.info("queryCouponInfo-errorThrown："+errorThrown)},"queryCouponInfo")},onClick:function(dataType,shopId,hasLogin){shopSideBar.showModule(dataType)},exec:function(shopId,hasLogin){if(hasLogin){this.getCouponInfo(shopId,hasLogin)}else{if($(".sn-sidebar-content.sn-sidebar-coupon").length==0){shopSideBar.appendElContent("cart","coupon")}var loginTip="想查看店铺优惠信息，赶紧登录吧！";var loginUrl=sn.passport_context+"/ids/login";var html=$("#shop-sidebar-login").html().format({loginUrl:loginUrl,loginTip:loginTip});$(".sn-sidebar-content.sn-sidebar-coupon").html(html)}}},shopCode:{onClick:function(dataType,shopId,hasLogin){if(hasLogin){}else{}},exec:function(shopId,hasLogin){shopSideBar.appendElContent("cart","shopCode");var src=$("#shopCode").val();var codeHtml='<a href="javascript:;" name="public0_none_cblnew_shopCode" target="_blank"><img class="tab-tip-code-warp-img" src="'+src+'"></a>';$(".sn-sidebar-content.sn-sidebar-shop.sn-sidebar-shopCode").html(codeHtml);shopSideBar.renderElEvent(shopId,hasLogin)}},shopService:{onClick:function(dataType,shopId,hasLogin){findpassSupplier(shopId,"","","")},exec:function(shopId,hasLogin){}},getElTemplate:function(elName,elType,sauv,isTabTip){var tabTip="";if(isTabTip){tabTip='<span class="tab-tip">'+elName+"</span>"}var elHtml=$("#shop-sidebar-el").html();return elHtml.format({tabTip:tabTip,elType:elType,sauv:sauv})},getElContentTemplate:function(elType){var elContentHtml=$("#shop-sidebar-el-content").html();return elContentHtml.format({elType:elType})},appendEl:function(shopId,hasLogin){var beforeArray=[],afterArray=[];beforeArray.push(this.getElTemplate("我的优惠","coupon","collection_coupon",true));beforeArray.push(this.getElTemplate("收藏店铺","shoucang","collection_collection",true));beforeArray.push(this.getElTemplate("收藏有礼","shoucang-gift","collection_gift",true));afterArray.push(this.getElTemplate("二维码","shopCode","collection_code",false));afterArray.push(this.getElTemplate("店铺客服","shopService","util_online",true));$(".sn-sidebar-tab[data-type=history]").before(beforeArray.join(""));$(".sn-sidebar-tab[data-type=history]").after(afterArray.join(""));$(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-shoucang-gift").hide();if("1"==sn.shop.shopType){$(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-shopService").css("visibility","hidden")}var windowH=$(window).height();var dSnSidebarMiddleTabs=$(".sn-sidebar").find(".sn-sidebar-middle-tabs");if(windowH>526){dSnSidebarMiddleTabs.css("top","178px")}else{dSnSidebarMiddleTabs.css("top","25%")}if(windowH>678){dSnSidebarMiddleTabs.css({height:"357px","min-height":"357px"})}else{dSnSidebarMiddleTabs.css({height:"340px","min-height":"340px"})}shopSideBar.renderElEvent(shopId,hasLogin)},appendElContent:function(selector,elType,appendMode){var elHtml=this.getElContentTemplate(elType);var currObj=$(".sn-sidebar-content.sn-sidebar-"+selector);currObj=("shopCode"==elType)?currObj.parent():currObj;if("before"==appendMode){currObj.before(elHtml)}else{currObj.after(elHtml)}},renderElEvent:function(shopId,hasLogin){var dSnSidebar=$(".sn-sidebar");var dSnSidebarTabJS=dSnSidebar.find(".sn-sidebar-shop.sn-sidebar-tab-js");var dTabTipCodeWarp=dSnSidebar.find(".sn-sidebar-shopCode");var dTabTipCodeWarpImg=dTabTipCodeWarp.find(".tab-tip-code-warp-img");dSnSidebarTabJS.off("mouseenter").unbind("mouseleave");dSnSidebarTabJS.hover(function(){if(!$(this).hasClass("sn-sidebar-tab-click")){var tabW=$(this).find(".tab-tip").width();$(this).find(".tab-tip").stop().animate({left:"-"+tabW+"px"},"normal");$(this).addClass("sn-sidebar-tab-hover");if($(this).hasClass("sn-sidebar-tab-shopCode")){dTabTipCodeWarp.stop().show().animate({left:"-150px"},"normal")}}},function(){$(this).find(".tab-tip").stop().animate({left:"0px"},"normal");$(this).removeClass("sn-sidebar-tab-hover");if($(this).hasClass("sn-sidebar-tab-shopCode")){dTabTipCodeWarp.stop().animate({left:"0px"},"normal",function(){$(this).hide()})}});dTabTipCodeWarp.off("mouseenter").unbind("mouseleave");dTabTipCodeWarp.hover(function(){dSnSidebar.find(".sn-sidebar-code").addClass("sn-sidebar-tab-hover");$(this).stop().show().animate({left:"-131px"},"normal")},function(){dSnSidebar.find(".sn-sidebar-code").removeClass("sn-sidebar-tab-hover");$(this).stop().animate({left:"0px"},"normal",function(){$(this).hide()})});dSnSidebar.find(".sn-sidebar-shop").off("click").on("click",function(){var dataType=$(this).attr("data-type");if("shoucang"==dataType||"shoucang-gift"==dataType){shopSideBar.shoucang.onClick(dataType,shopId,hasLogin)}else{if("coupon"==dataType){shopSideBar.coupon.onClick(dataType,shopId,hasLogin)}else{if("shopService"==dataType){shopSideBar.shopService.onClick(dataType,shopId,hasLogin)}}}});$("[registClick='goto']").off("click").on("click",function(){var dataconf=$(this).attr("data-config");if(!shopSideBar.isEmpty(dataconf)){var jsonObj=$.parseJSON(dataconf);var key=jsonObj.key;var target=jsonObj.target;var env=shopSideBar.getHostName();var url=shopSideBar.getHttpUrl(key,env);if(""!=url){if("_blank"==target){window.open(url)}else{location.href=url}}}})},showModule:function(dataType){var dSnSidebar=$(".sn-sidebar");var dSnSidebarContents=dSnSidebar.find(".sn-sidebar-contents");var dSnSidebarAllLoading=dSnSidebar.find(".sn-sidebar-all-loading");var dSnSidebarBg=dSnSidebar.find(".sn-sidebar-bg");var domEl=dSnSidebar.find(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-"+dataType);var domContent=dSnSidebar.find(".sn-sidebar-contents  .sn-sidebar-"+dataType);var windowW=$(window).width();var windowH=$(window).height();domContent.css({height:windowH});if(domEl.hasClass("sn-sidebar-tab-click")){shopSideBar.hideModule(dataType);SnSidebar.judgeDacuImg(0)}else{domEl.removeClass("sn-sidebar-tab-hover").addClass("sn-sidebar-tab-click");domEl.siblings(".sn-sidebar-tab-js").removeClass("sn-sidebar-tab-click");domEl.find(".tab-tip").stop().animate({left:"0px"},"normal");domContent.find(".tab-tip").stop().css("left","0px");if(windowH<600||windowW<1240){dSnSidebarBg.show()}dSnSidebarContents.find(".sn-sidebar-content").stop(true,true).hide();dSnSidebarContents.addClass("sn-sidebar-contents-show").stop().animate({right:"35px"});dSnSidebarContents.find(".sn-sidebar-"+dataType).stop(true,true).css({top:0}).show();SnSidebar.judgeDacuImg(1)}},hideModule:function(dataType){var dSnSidebar=$(".sn-sidebar");var dSnSidebarContents=dSnSidebar.find(".sn-sidebar-contents");var domEl=dSnSidebar.find(".sn-sidebar-tab.sn-sidebar-shop.sn-sidebar-tab-"+dataType);domEl.removeClass("sn-sidebar-tab-hover").removeClass("sn-sidebar-tab-click");domEl.find(".tab-tip").stop().animate({left:"0px"},"normal");dSnSidebarContents.find(".sn-sidebar-content").stop(true,true).hide();dSnSidebarContents.removeClass("sn-sidebar-contents-show").stop().animate({right:"-250px"});dSnSidebarContents.find(".sn-sidebar-"+dataType).stop(true,true).css({top:0}).hide()},isEmpty:function(obj){if(undefined==obj||""==obj||null==obj){return true}return false},randomNumBoth:function(Min,Max){var Range=Max-Min;var Rand=Math.random();var num=Min+Math.round(Rand*Range);return num},main:function(hasLogin){shopSideBar.hasLogin=hasLogin;var shopId=(sn.shop.shopId).length==8?"00"+sn.shop.shopId:sn.shop.shopId;shopSideBar.appendEl(shopId,hasLogin);shopSideBar.shoucang.exec(shopId,hasLogin);shopSideBar.coupon.exec(shopId,hasLogin);shopSideBar.shopCode.exec(shopId,hasLogin)},delRepeatImportJs:function(jsName){var scriptArray=$("script[src*='"+jsName+"']");if(scriptArray.length>1){scriptArray.each(function(index){if(index>0){$(this).remove();console.info("移除重复引入JS资源,移除"+index+"次,JS名称："+jsName)}})}},checkLogin:function(){var execIndex=1;var shopInterval=setInterval(function(){if(typeof probeAuthStatus==="function"||execIndex==10){clearInterval(shopInterval);shopSideBar.delRepeatImportJs("passport.js");probeAuthStatus(function(){shopSideBar.main(true)},function(){shopSideBar.main(false)})}execIndex++},100)},init:function(){if(undefined!=shopSideBar.pageMap[sn.page.pageType]){this.checkLogin()}}};$(function(){window.shopSideBar=shopSideBar;shopSideBar.init()})})(jQuery);(function(a,e,c,f,b){c(function(){c(window).trigger("img-lazy");c(".sf-product li").live("mouseover",function(){c(this).find(".btn").show()});c(".sf-product li").live("mouseout",function(){c(this).find(".btn").hide()});c(".show_filter").live("click",function(){c(this).parents(".sf-searchFilter").find(".sf-filters").show();c(this).hide();c(".hide_filter").show();c(".sf-othermore").show()});c(".hide_filter").live("click",function(){c(this).parents(".sf-searchFilter").find(".sf-filters").hide();c(this).hide();c(".show_filter").show();c(".sf-othermore").hide()})})})(window,document,jQuery,window.sn=window.sn||{},window.Shop=window.Shop||{});