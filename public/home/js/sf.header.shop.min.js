$(function(){var debug=location.href.indexOf("debug")>=0;var shopType=sn.shop.shopType;var sfsHeadSearchUrl=sn.config.header_search;var shopCart_Link=sn.config.cart;var shop_context=sn.shop.context;var shop_search=shop_context+sn.shop.shopId+"/"+sn.shop.search;var spcode=sn.shop.spcode;var shopType=sn.shop.shopType;var cart_disable=window.cart_disable||false;var header={parseJSON:function(sjson){try{return eval("("+sjson+")")}catch(e){console.info(e.message)}},fixWidth:function(){String.prototype.getCnStrLen=function(){return this.replace(/[^\x00-\xff]/g,"aa").length};var wH=$(window).width();if(wH>1200){$(".g-header .wrapper").addClass("wrapper2");$(".g-toolbar .wrapper").addClass("wrapper2");$(".ng-toolbar .ng-toolbar-con").addClass("wrapper2");var len=$("#chead_indexUrl strong").html()||"";if(len.getCnStrLen()>34){$("#chead_indexUrl strong").html(len.substr(0,15)+"...")}}else{$(".g-header .wrapper").removeClass("wrapper2");$(".g-toolbar .wrapper").removeClass("wrapper2");$(".ng-toolbar .ng-toolbar-con").removeClass("wrapper2");var len=$("#chead_indexUrl strong").html()||"";if(len.getCnStrLen()>24){$("#chead_indexUrl strong").html(len.substr(0,10)+"...")}}},gdshop:{show:function(){var shopId=sn.shop.shopId;$.ajax({url:shop_context+"ajax/getGdShopInfo_"+shopId+"/gdinfo.html",dataType:"jsonp",cache:true,jsonpCallback:"gdinfo",success:renderGdInfo,error:function(){console.info("加载页头馆标识相关信息失败")}});function renderGdInfo(data){if(data!=null&&data.gdShopMark!=null&&data.gdShopMark.length>0){$("#gdShopMark").attr("title",data.gdShopMark);$("#gdShopMark").text(data.gdShopMark);$("#gdShopMark").show()}else{$("#gdShopSpan").hide()}}}},guide:{show:function(){var shopId=sn.shop.shopId;var districtCode=null;GUIDESHOP.base.getCity(function(cityId){$.ajax({url:shop_context+"ajax/GuideShopSign_"+shopId+"_"+cityId+"_"+districtCode+"/guideinfo.html",dataType:"jsonp",cache:true,jsonpCallback:"guideinfo",success:renderGuideInfo,error:function(){debug&&console.info("加载页头向导店相关信息失败")}})});function getCityId(){return d("cityId")||9173}function searchStoreByDistrictCode(districtCode){var shopId=sn.shop.shopId;GUIDESHOP.base.getCity(function(cityId){$.ajax({url:shop_context+"ajax/GuideShopSign_"+shopId+"_"+cityId+"_"+districtCode+"/guideinfo.html",dataType:"jsonp",cache:true,jsonpCallback:"guideinfo",success:renderGuideShopListInfo,error:function(){console.info("加载页头向导店相关信息失败")}})})}function renderGuideShopListInfo(data){if(data!=null&&data.districtList!=null&&data.districtList.length>0){$("#guidShopLogoPlay").attr("style","display:block");$(".storeListContainer").html("");for(var j=0;j<data.guideShopList.length;j++){var htmlAddress=sn.shop.shopContext+"guide_"+data.guideShopList[j].storeCode+".html";$(".storeListContainer").append("<tr><td width='410'><i class='sf-map'></i>"+data.guideShopList[j].storeAddress+"</td><td><a href='"+htmlAddress+"' target='_blank'>查看门店样品</a></td></tr>")}}else{$("#guideShopLogo").attr("style","display:none");$("#guideShopAround").attr("style","display:none");$("#guidShopLogoPlay").attr("style","display:none")}}function renderGuideInfo(data){if(data!=null&&data.districtList!=null&&data.districtList.length>0){$("#guidShopLogoPlay").show();$("#guideShopLogo").show();$("#guideShopAround").hide();for(var i=0;i<data.districtList.length;i++){var area=data.districtList[i].districtCode;$(".districtContainer").append("<a href='#' pguide-area='"+area+"'>"+data.districtList[i].districtName+"</a>")}for(var j=0;j<data.guideShopList.length;j++){var htmlAddress=sn.shop.shopContext+"guide_"+data.guideShopList[j].storeCode+".html";$(".storeListContainer").append("<tr><td width='410'><i class='sf-map'></i>"+data.guideShopList[j].storeAddress+"</td><td><a href='"+htmlAddress+"' target='_blank'>查看门店样品</a></td></tr>")}var el="[pguide]";var pcode=[];var doItem=$(el).filter(function(index){var pcode=$(this).attr("pguide");return/^\d{9}$/.test(pcode)});doItem.each(function(i,elm){pcode[i]=$(this).attr("pguide")});var shopId=sn.shop.shopId;var callback="getGuide";if(pcode.length>0){var pcodeStr=pcode.join(",");$.ajax({url:shop_context+"ajax/getGuideShopProductSign_"+shopId+"_"+pcodeStr+"_"+callback+".html",dataType:"jsonp",cache:false,jsonpCallback:callback,success:function(data){for(var j=0;j<pcode.length;j++){if(data[pcode[j]].indexOf(getCityId())!=-1){var hasPicElm="[pguide={pcodeHas}]".format({pcodeHas:pcode[j]});$(hasPicElm).each(function(){$(this).show()})}}},error:function(){console.info("加载页头向导店相关信息失败")}})}$("#searchGuideBox").show();$("#classSearchGuideBox").show();header.guide.guideShopOpen();$("[pguide-area]").live("click",function(){$(this).siblings().removeClass("cur");$(this).addClass("cur");var area=$(this).attr("pguide-area");searchStoreByDistrictCode(area)})}else{$("#guideShopLogo").hide();$("#guideShopAround").hide();$("#searchGuideBox").hide();$("#guidShopLogoPlay").hide()}}},guideShopOpen:function(){var _trytoShopHtml=$(".JS-sf-trytoShop").html();$(".JS-nearby-store").popWin({width:610,titleTxt:"身边的门店",content:_trytoShopHtml,showBtn:false,callback:function(o,fn,e){}})}},ad:{load:function(op){var o=$.extend({close:"[sf-ad-close]"||".close-btn",target:"[sf-ad-content]"||"#cshopAdheaderInfo",container:"[sf-ad]"||"#__CSHOPTOP_ACTIVE__"},op);var container=$(o.container);if(container.size()==0){return}var target=$(o.target,container);var close=$(o.close,container);close.click(function(e){container.hide()});var adUrl=shop_context+"ajax/getShopAdHeader/shopAdHeaderInfo.html";container&&$.ajax({url:adUrl,dataType:"jsonp",jsonpCallback:"shopAdHeaderInfo",cache:true,success:function(json){if(json&&"1"===json.isShown){target.html(json.ad);container.show()}else{container.hide()}},error:function(){container.hide()}})},bind:function(){var ad_attr="sf-ad";var container=$("["+ad_attr+"]");var config=header.parseJSON(container.attr(ad_attr)||"{}");container.length&&this.load(config)}},cart:{getNum:function(){return d("totalProdQty")||"0"},bind:function(){var cart=this;$("#cartShopNum").text(this.getNum());$("#shopCartLink").mouseover(function(){$("#cartShopNum").text(cart.getNum())});$("#shopCartLink").click(function(){if(shopCart_Link&&!cart_disable){document.location=shopCart_Link}});$(window).scroll(function(){var topM=$(document).scrollTop();if(topM>5){$("#gSideTools").find("li.backtop").show()}else{$("#gSideTools").find("li.backtop").hide()}});getSupplierState("#rightFloatService,#onlineService1,#beforeService1","00"+spcode,shopType);$("#rightFloatService,#onlineService1,#beforeService1").click(function(){findpassSupplier("00"+spcode,"","","")});$("#afterService1").live("click",function(){findpass("","","")})}},search:{bind:function(){if(sn.shop.shopType=="3"&&$("#snKeywordNewHwg").length>0){var callback="showHwgHotkeywords";var hotUrl=sn.config.sfs_ds_domain+"ds/hotkeywords/22010--{callback}.xjsonp?callback={callback}".format({callback:callback});$.ajax({url:hotUrl,dataType:"jsonp",jsonpCallback:callback,cache:true,success:function(json){if(json&&json.html){$("#snKeywordNewHwg").append(json.html);$("#searchKeywords").val($("#searchDefaultKeyword").val()||"");$("#snKeywordNewHwg").find("font").each(function(i,elm){$(elm).css({color:"#a390e4"})})}else{}},error:function(){debug&&console.info("海外购调热词异常")}})}$("#ac_results").on("click","li",function(){var keyWord=$("#searchKeywords").val();keyWord=resolveStr(keyWord);var url="";if($(this).hasClass("g-ac-store")){url=sfsHeadSearchUrl+"shop/search.do?app=shopsearch&keyword="+keyWord;document.location=url}else{if($(this).hasClass("cateSearch")){url=sfsHeadSearchUrl+keyWord+"/&ci="+$(this).attr("categoryid");document.location=url}else{keyWord=$(this).find("span").eq(0).text();$("#searchKeywords").val(keyWord)}}});$("#searchShopSubmit").click(function(){var keyWord=$("#searchKeywords").val();Shop.search.searchTo({keyword:keyWord},this)});$("#searchEbuySubmit").click(function(){searchFromHomeSit()});$("#searchKeywords").keydown(function(event){if(event.keyCode==13){searchFromHomeSit()}});$("#searchKeywords").focus(function(){$(this).parents("div:eq(0)").addClass("g-search-focus");var searchDefaultKeyword=$("#searchDefaultKeyword").val();var searchKeywords=$(this).val();if(searchKeywords==searchDefaultKeyword){$(this).val("")}$(this).css({color:"rgb(0, 0, 0)"})}).blur(function(){$(this).parents("div:eq(0)").removeClass("g-search-focus");var searchDefaultKeyword=$("#searchDefaultKeyword").val();var searchKeywords=$(this).val();if(searchKeywords==""){$(this).val(searchDefaultKeyword);$(this).css({color:"rgb(153, 153, 153)"})}});function resolveStr(str){str=str.replace(/\-/g,"%2d");str=str.replace(/\&/g,"%26");str=str.replace(/\./g,"%2E");str=str.replace(/\+/g,"%2B");return str}function searchFromHomeSit(){var keyWord=$("#searchKeywords").val();if(sn.shop.shopType=="3"){document.location=sfsHeadSearchUrl+encodeURIComponent(resolveStr(keyWord))+"/&ch=3"}else{document.location=sfsHeadSearchUrl+encodeURIComponent(resolveStr(keyWord))+"/"}}function getCityId(){return(d("SN_CITY")||"100_025").split("|")[0].split("_")[1]}}},shop:{load:function(){$("#storeShop3").click(function(){if("header"==sn.page.pageType){var name="SHOPSEARCH_00"+spcode;mySuning.add2ShopFavorite("00"+spcode,"shopHome",name)}else{shopSideBar.shoucang.shopfavorite("00"+spcode)}});function showPercentagePic(percentage,comparetage){percentage=percentage||"0";comparetage=comparetage||"0";var p=parseInt(percentage);percentage=p<0?percentage.slice(1):percentage;var config={hold:'<span class="per per-hold"><em class="em1">------</em></span>',down:'<span class="per per-down" ><em class="em2">'+percentage+"</em></span>",up:'<span class="per per-up" ><em class="em1">'+percentage+"</em></span>"};var viewId=comparetage==0?"hold":comparetage<0?"down":"up";return config[viewId]||config.hold}var cTextctrl=function(){var cText=$(".JS_txtCtrl i").text();var nLength=$(".JS_txtCtrl").text().length;if(nLength>40){$(".JS_txtCtrl i").text(cText.substring(0,40))}};cTextctrl();function renderShopInfo(data){if(data){$("#chead_indexUrl").attr("href",data.indexUrl);$("#chead_shopIndexUrl").attr("href",data.indexUrl);var dstar="5.00";$("#chead_shopStar").text(data.star||dstar);$("#chead_qualityStar").text("商品满意度："+(data.Qstar||dstar)+"分");$("#chead_attitudeStar").text("服务满意度："+(data.Astar||dstar)+"分");$("#chead_deliverySpeedStar").text("物流满意度："+(data.Dstar||dstar)+"分");$("#chead_qualityPercent").replaceWith(showPercentagePic(data.Qpercent,data.Qcompare));$("#chead_attitudePercent").replaceWith(showPercentagePic(data.Apercent,data.Acompare));$("#chead_deliverySpeedPercent").replaceWith(showPercentagePic(data.Dpercent,data.Dcompare));if(data.logoUrl_60){var logoImg=$("#chead_logoUrl img");var dLogoUrl=logoImg.attr("src");logoImg[0]&&(logoImg[0].onerror=function(){this.src!=dLogoUrl?this.src=dLogoUrl:""});logoImg.attr("src",data.logoUrl_60)}$("#chead_companyName").text(data.companyName?data.companyName:"");if(3==shopType||"3"==shopType){$("#chead_companyAddress").text(data.countryName?data.countryName:"")}else{var data_companyAddress=(data.companyProvince?data.companyProvince:"")+","+(data.companyCity?data.companyCity:"");$("#chead_companyAddress").text(data_companyAddress.replace(/^,|,$/img,""))}if(data.qualificationPageUrl){$("#id_qual_li").show();$("#chead_qualification").attr("href",data.qualificationPageUrl)}$("#chead_licence").attr("href",data.licencePageUrl);if(data.telPhone){$("#chead_telPhone").text(data.telPhone?data.telPhone:"")}else{$("#chead_telPhone").parent().css("display","none")}$("#chead_road").removeClass("bg-none");$("#chead_roadPic").hide();$(".JS_store_grade").hover(function(){$(".sg-details").stop();$(".store-grade").addClass("store-grade-hover");$(".sg-details").show()},function(){$(".sg-details").stop();$(".store-grade").removeClass("store-grade-hover");$(".sg-details").hide()})}}var shopID=sn.shop.shopId;if(shopID.length==10){shopID=shopID.substring(2)}var shopInfoUrl4jsonp=shop_context+"jsonp/"+shopID+"/shopinfo/shopinfo.html";$.ajax({url:shopInfoUrl4jsonp,dataType:"jsonp",cache:true,jsonpCallback:"shopinfo",success:renderShopInfo,error:function(){debug&&console.info("加载店铺页头失败")}})}}};header.fixWidth();$(window).resize(function(){header.fixWidth()});header.ad.bind();header.cart.bind();header.search.bind();header.shop.load();header.gdshop.show()});(function(W,D,$,sn,S){$.extend(String.prototype,{wrap:function(w){var s=w.split("");s[1]=s[1]||s[0];return[s[0],this,s[1]].join("")},unwrap:function(){var s=this;return s.slice(1,s.length-1)},is:function(s){return this==s},eq:function(s){return this==s},filter:function(chars){var s=this;if(chars){for(var key in chars){s=s.replace(chars[key],key)}}return s},ifNull:function(a,ifNull){return a==null?ifNull:a},isEmpty:function(){return this.trim()==""},json:function(){return this.eval(this)},eval:function(v,scope){try{with(scope||window){return eval("("+v+")")}}catch(e){warn&&console.warn(e.message);return null}},context:function(a,func){var ctxs=func.split(".");ctxs.pop();var ctx=ctxs.length>0?ctxs.join("."):null;ctx=ctx?this.format_dot_o(a,ctx):a;return ctx},format_dot_o:function(a,value){var func_reg=/([^\(]+)\(([^\)]+)\)/ig;if(func_reg.test(value)){var args=RegExp.$2;var func=RegExp.$1;var context=this.context(a,func);func=this.format_dot_o(a,func);func=typeof func=="function"?func:function(){return"{"+value+"}"};args=args.split(",");for(var i=0;i<args.length;i++){args[i]=this.format_dot_o(a,args[i])||args[i]}return func.apply(context,args)}else{var expression=value.match(/([^\.]+)/g);var v=a[expression[0]];for(var i=1;i<expression.length;i++){v=v&&v[expression[i]]}return this.ifNull(v,"".ifNull(this.eval(value,a),"{"+value+"}"))}},format_o:function(o){var string=this;return this.replace(/\{([^}]+)\}/g,function(index,value){return string.format_dot_o(o,value)})},format_a:function(a){var string=this;return this.replace(/\{([^}]+)\}/g,function(index,value){return string.format_dot_o(a,value)})},format:function(){var content=this;if(arguments.length>0){for(var i=0;i<arguments.length;i++){var o=arguments[i];if($.isArray(o)){content=content.format_a(o)}else{if(typeof o=="object"){content=content.format_o(o)}else{var a=[].slice.apply(arguments,[0,arguments.length]);content=content.format_a(a)}}}return content}else{return this}},eachf:function(arr,callback){var segs=[];for(var i=0;i<arr.length;i++){var model=arr[i],html;if(callback){html=callback(model,i,arr)}model=arr[i];segs.push(this.format(model))}return segs.join("")},trim:function(){return this.replace(/^\s*|\s*$/img,"")},prePad:function(l,p){var len=l-this.length;return len>0?Array(len+1).join(p)+this:this},html:function(){return this.filter({"&amp;":/&/img,"&lt;":/</img,"&gt;":/>/img,"&nbsp;":/ /img,"&quot;":/"/img,"&#39;":/'/img})}});W.$key=function(e){function k(e){this.e=e;var KeyMap={"ctrl+enter":function(e){var is=e.ctrlKey&&e.which==10;return is},"shit+enter":function(e){var is=e.shiftKey&&e.which==13;return is},enter:function(e){var enter=e.which==13;return enter},down:function(e){return e.keyCode==40},up:function(e){return e.keyCode==38},left:function(e){return e.keyCode==37},right:function(e){return e.keyCode==39},del:function(e){return e.keyCode==46}};var $k=this;$k.when=function(key,keyAction){var keyEvent=KeyMap[key];if(keyEvent&&keyEvent(this.e)){keyAction.apply(this,[this.e])}return this}}return new k(e)};var lazy_src="lazy-src";var l_blank="//imgssl.suning.com/images/ShoppingArea/Common/blank.gif";var lazy,l=lazy=S.LazyLoad={lazy_src:lazy_src,bRemoveLazySrc:true,lazy_not_load:"img[{src}][{src}!=finish]".format({src:lazy_src}),blank:l_blank,holder:{blank:l_blank},listeners:[],onerror:function(){debug&&console.debug("load img error");$(this).attr("error",this.src);var holder=$(this).attr("holder")||"";holder=l.holder[holder]||l.blank;holder=holder==this.src?l.blank:holder;this.src=holder},loadImg:function(elm){var src=elm.getAttribute(l.lazy_src);elm.onerror=lazy.onerror;if(src){log&&console.log("lazy load image:"+src);elm.src=src;elm.className=elm.className+"bouseIn";$(elm).attr(l.lazy_src,l.bRemoveLazySrc?null:"finish")}},load1screen:function(el){$(el||document.body).find(l.lazy_not_load).each(function(){var _this=$(this)[0];var top=Math.max(_this.offsetTop,$(this).offset().top);var height=window.innerHeight;debug&&console.info("{top} < {height}".format({top:top,height:height}));if(top<height){lazy.loadImg(_this)}})},lazyLoad:function(el){var lazyImages=$(el||document.body).find(l.lazy_not_load);if(lazyImages.size()>0){lazy.load1screen(el)}var delay=null;function $lazy(){$(el||document.body).find(l.lazy_not_load).each(function(){var _this=$(this)[0];if(_this.getAttribute(l.lazy_src)==null){return}var top=Math.max(_this.offsetTop,$(this).offset().top);var h=window.innerHeight||window.screen.height;var scrollTop=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;debug&&console.info("document scrollTop:{scrollTop}--window height:{h}--img top:{top}".format({top:top,h:h,scrollTop:scrollTop}));if(scrollTop>top+h||scrollTop<top-h){clearTimeout(delay);return}if(scrollTop>top-h){lazy.loadImg(_this)}})}$(window).bind("img-lazy",function(){$lazy();$(window).trigger("img-lazy-lisenter")});$(window).bind("scroll",function(){delay=setTimeout(function(){$(window).trigger("img-lazy")},100)})}};var _={};$.extend(_,{fill:function(arr,s){var a=arr;for(var i=0;i<a.length;i++){if(a[i]==null){a[i]=s}}return arr}});$.fn.openBlank=function(url){var oelm=$(this);var url=url||oelm.attr("href");if(oelm.is("a")){oelm.attr("target","_blank");oelm.attr("href",url)}else{window.open(url)}};var c,category=c={options:{all:"[sf-category-all]",urlV:"sf-category-url",sortV:"sf-sort",item:"sf-category-item"},selector:"sf-category",categoryTo:function(o,a){o=$.extend({target:"_self",spcode:sn.shop.spcode,cid:sn.category.cid||"all",ctype:sn.category.ctype||"0",context:sn.shop.context,domain:sn.shop.domain,shopContext:sn.shop.shopContext,selfDomain:sn.shop.selfDomain},o);var url="{shopContext}list_{cid}_{ctype}.html".format(o);if(o.target=="_self"){location.href=url}else{if(o.target=="_blank"){$(a).openBlank(url)}}},bind:function(){var opts=c.options;sn.category=sn.category||{};$("["+c.selector+"] ["+opts.item+"]").live("click",function(){var classModule=$(this).parents("["+c.selector+"]");var op=(classModule.attr(c.selector)||"{}").json();op=$.extend({},c.options,op);o=$.extend({cid:$(this).attr(op.item)||"",target:"_blank"},op);c.categoryTo(o,this)});$("[{category}] [{sort}]".format({category:c.selector,sort:opts.sortV})).live("click.sf-category-sort",function(e){var sortField=$(this).attr(opts.sortV);var o=s.extend({target:"_blank"},{sortField:sortField});s.searchTo(o,this)});$("[{category}] {all}".format({category:c.selector,all:opts.all})).on("click.sf-category-all",function(e){var o=s.extend({target:"_blank"});s.searchTo(o,this)});$("[{urlV}]".format({urlV:opts.urlV})).live("click.sf-category-url",function(e){var o=($(this).attr(opts.urlV)||"{}").json();o=s.extend({target:"_blank"},o);c.categoryTo(o,this)})}};var s,search=s={options:{price:["-1","-1"],prodDom:"[sf-search-product]",pageDom:"[sf-search-page]",filter:{filterDom:"[sf-search-filters]",filterEl:"[sf-search-filter]",filterV:"[sf-search-filter-item]",selectedClass:"sf-cur",render:function(json){var f=s.options.filter;f.filterDom&&$(f.filterDom).refresh(json)},select:function(){var f=this;var cf=[];$([f.filterV,".",f.selectedClass].join("")).each(function(i,elm){var attr=$(elm).attr(f.filterV.unwrap());attr&&cf.push(attr)});return cf}},sort:{sortV:"[sf-sort]",module_name:"[sf-sort-module]",selectedClass:"sf-filterBtnSel",dSortFiled:"countOfarticle-desc",asc:"up",desc:"down",init:function(){var sort=this;var curSF=$.request.parameters.sortField;if(curSF){if(curSF.match(/(\w+)\-(\w+)/img)){var sf=RegExp.$1,st=RegExp.$2;var sitem=$([sort.module_name," ",sort.sortV].join(""));sitem.removeClass(sort.selectedClass).removeClass(sort.desc+" "+sort.asc);$("[{sort}*={value}]".format({sort:sort.sortV.unwrap(),value:sf})).addClass(sort.selectedClass).addClass(sort[st]||"asc")}}},select:function(){var sort=this;return $([sort.module_name," ",sort.sortV,".",sort.selectedClass].join("")).attr(sort.sortV.unwrap())||sort.dSortFiled}},keywordV:"sf-keyword",ok:"[sf-search-ok]",cancel:"[sf-search-cancel]",keyword:"[name=keyword]",startPrice:"[name=startPrice]",endPrice:"[name=endPrice]"},selector:"sf-search",bind:function(){var searchModule=$("["+s.selector+"]");if(searchModule.length>0){s.searchM=searchModule.eq(0);searchModule.each(function(i,searchElm){var searchM=$(searchElm);s.bindSearchEvent(searchM)})}s.bindKeyword()},bindKeyword:function(){var opts=s.options;var sf_keyword_name=opts.keywordV;var keywordsM=$(sf_keyword_name.wrap("[]"));keywordsM.on("click.sf-keyword",function(e){var keyword=u.filter($(this).text());var o=s.extend({target:"_blank",keyword:keyword},{});s.searchTo(o,this)})},extend:function(){var args=[].slice.apply(arguments,[0]);var cfs=[];$.each(args,function(i,arg){if(arg&&arg.cf){cfs.push(arg.cf)}});args.push({cf:cfs.join(",")});return $.extend.apply($,args)},getSearchParams:function(){var op=s.options;var searchM=s.searchM;var start=$(op.startPrice,searchM).val()||"";var end=$(op.endPrice,searchM).val()||"";var valid=true;if(start.isEmpty()||end.isEmpty()){valid=false}if(!start.isEmpty()&&!end.isEmpty()){valid=parseInt(end)>=parseInt(start);if(!valid){var t=end;end=start;start=t}}var sp={keyword:u.filter(($(op.keyword,searchM).val()||"")),valid:true};if(!start.isEmpty()||!end.isEmpty()){sp=$.extend(sp,{price:"{start}-{end}".format({start:start||s.options.price[0],end:end||s.options.price[1]})})}return $.extend({},sp)},bindSearchEvent:function(searchModule){var op=searchModule.attr(s.selector)||"{}";op=op.json();op=$.extend(this,s.options,op);var searchM=s.searchM=searchModule;searchM.ok=$(op.ok,searchModule);searchModule.click(function(){debug&&console.debug("search selected a search target");s.searchM=$(this)});searchM.ok.click(function(){s.searchM=$(this).parents("["+s.selector+"]");var o=s.extend({target:"_self"},s.getSearchParams());if(o.valid){!search_disable&&s.searchTo(o)}});$([op.keyword,op.startPrice,op.endPrice].join(","),searchModule).keypress(function(e){$key(e).when("enter",function(e){var o=s.extend({target:"_self"},s.getSearchParams());if(o.valid){s.searchTo(o)}})});s.searchM=searchM},searchTo:function(o,a){var params=$.extend({target:"_self",spcode:sn.shop.spcode,pagesize:s.pagesize,keyword:"",start:0,sortField:"",context:sn.shop.context,domain:sn.shop.domain,selfDomain:sn.shop.selfDomain,shopContext:sn.shop.shopContext,price:"",cf:""},o);var shopSearchUrl="";if($(a).is("[sf-category-all]")||$(a).is(".searchstore-btn")){shopSearchUrl='{shopContext}{keyword ? "search/" + keyword : "search"}.html'.format(params)}else{shopSearchUrl='{shopContext}{keyword ? "search/" + keyword : "search"}.html?keyword={keyword}{price ? "&price="+price : ""}{sortField ? "&sortField="+sortField : ""}'.format(params)}if(params.target=="_self"){location.href=shopSearchUrl}else{if(params.target=="_blank"){if(a){$(a).openBlank(shopSearchUrl)}}}}};var array2map=function(array,propName){var map={};for(var i=0;i<array.length;i++){var o=array[i];var prop=o[propName]||o;map[prop]=o}return map};var map2array=function(me,b){var arr=[];for(var prop in me){if(me.hasOwnProperty(prop)){var value=me[prop];if(b){arr.push(value)}else{arr.push(prop)}}}return arr};var splitArr=function(array,num){var arrs=[];var me=array;var len=me.length;if(len>0){var group=parseInt(len/num);var left=len%num;group=left>0?group+1:group;for(var i=0;i<group;i++){var start=i*num,end=(i+1)*num;var arr=me.slice(start,end);arrs.push(arr)}}else{arrs.push(array)}return arrs};var eachArr=function(array,f,t){var a=array;a.i=0;a.tid=0;function callback(a){if(a.i<a.length){a.tid=setTimeout(function(){f(a.i,a[a.i]);a.i++;callback(a)},t|1000)}else{clearTimeout(a.tid)}}callback(a)};var j,priceUtil=j={split:20,validEightenNumber:function(productcode){var zero18="000000000000000000";productcode=productcode||zero18;var pcodeLen=productcode.length;var zero18Len=zero18.length;if(pcodeLen>zero18Len){productcode=productcode.substring(0,zero18Len)}else{if(pcodeLen<zero18Len){productcode=zero18.substring(0,zero18Len-pcodeLen)+productcode}}return productcode},validEffectiveNumber:function(productcode){productcode=productcode||"";if(""!=productcode){var pcodeLen=productcode.length;for(var idx=0;idx<pcodeLen;idx++){if("0"!=productcode.charAt(0)){break}productcode=productcode.substring(1)}}return productcode},queryPrice:function(){var pcodeArr=[];var pcodeBadArr=[];$("[sf-price]").each(function(i,elm){var pricetxt=$(elm);var pscode=pricetxt.attr("pscode");if(-1==pscode.indexOf("<%")&&pscode.length>=9){pcodeArr.push(j.validEightenNumber(pscode))}else{pcodeBadArr.push(pscode)}});if(pcodeBadArr.length>0){j.dealBadCode(pcodeBadArr)}var pcodeMap=array2map(pcodeArr);var pcodeArray=map2array(pcodeMap);if(pcodeArray.length>0){var pcodeArrayTemp=splitArr(pcodeArray,j.split);eachArr(pcodeArrayTemp,function(i,arr){j.query(arr)},1000)}},dealBadCode:function(pcodeBadArr){$.each(pcodeBadArr,function(i,pcodeBad){var el="[sf-price][pscode={pcodeBad}]".format({pcodeBad:pcodeBad});$(el).each(function(j,priceDom){var priceTxt="售罄";$(priceDom).replaceWith(priceTxt)})})},query:function(pcodeArr){var pcodeString=pcodeArr.join(",");var config={icpsHost:sn.config.icpsDomain,cmmdtyCode:pcodeString,cityCode:(d("SN_CITY")||"100_025").split("|")[0].split("_")[1],chan:"1",type:"2",isCache:"1",spcode:sn.shop.spcode};var url="{icpsHost}icps-web/getAllPriceNew.htm?cmmdtyCode={cmmdtyCode}&type={type}&cityCode={cityCode}&chan={chan}&isCache={isCache}&bizCode=00{spcode}&sys=SFS".format(config);try{$.ajax({url:url,dataType:"jsonp",cache:false,timeout:5000,success:function(data){var priceMap=array2map((data||[]),"cmmdtyCode");$.each(pcodeArr,function(i,pcode18){var pcode9=j.validEffectiveNumber(pcode18);var priceData=priceMap[pcode18];var el="[sf-price][pscode={pcode9}]".format({pcode9:pcode9});$(el).each(function(j,priceDom){var ptype=$(priceDom).attr("sf-price")||"price";var priceTxt=priceData[ptype]||"售罄";$(priceDom).replaceWith(priceTxt)})})},error:function(){$.each(pcodeArr,function(i,pcode18){var pcode9=j.validEffectiveNumber(pcode18);var el="[sf-price][pscode={pcode9}]".format({pcode9:pcode9});$(el).each(function(j,priceDom){var priceTxt="";$(priceDom).replaceWith(priceTxt)})});debug&&console.info("调价格中心jsonp接口网络异常")}})}catch(e){$.each(pcodeArr,function(i,pcode18){var pcode9=j.validEffectiveNumber(pcode18);var el="[sf-price][pscode={pcode9}]".format({pcode9:pcode9});$(el).each(function(j,priceDom){var priceTxt="";$(priceDom).replaceWith(priceTxt)})});debug&&console.info("调价格中心jsonp接口网络异常")}},bind:function(){j.queryPrice()}};var extendNavi={bind:function(){if($("[moduleType='sys.navigation']").length==1){extendNavi.showNavi()}},showNavi:function(){var url=sn.shop.context+"ajax/getNaviOfActivePage_"+sn.shop.spcode+"_"+sn.shop.shopType+"/jsonpQueryForNavFromSFS.html";$.ajax({url:url,dataType:"jsonp",cache:true,jsonpCallback:"jsonpQueryForNavFromSFS",success:function(json){if(json&&json.pcInfo){var pcInfo=json.pcInfo||"";if(pcInfo.imgUrl&&pcInfo.activeUrl&&""!=pcInfo.imgUrl&&""!=pcInfo.activeUrl){var html="<div class='hot'><a href='"+pcInfo.activeUrl.replace("http://","//")+"'><img src='"+pcInfo.imgUrl+"'></a></div>";$("[moduleType='sys.navigation']").find(".sf-allcate").after(html);$("[moduleType='sys.navigation']").find(".sf-navlist").css("width","715px")}}},error:function(){debug&&console.info("查询导航承接页露出网络异常")}})}};var u,util=u={bind:function(){var spcode10="00{spcode}".format(sn.shop);$("[sf-im-state]").removeClass("sf-im");getSupplierState("[sf-im-state]",spcode10,sn.shop.shopType);$("[sf-im]").live("click.sf-im",function(){findpassSupplier(spcode10,"","","")});$("[sf-im-channel]").live("click.sf-im-channel",function(){var gid=$(this).attr("sf-im-channel");findpassNewSupplier("","02",spcode10,"","",gid)});$("[sf-im-suning]").live("click.sf-im-suning",function(){findpass("","","")});$("[sf-im],[sf-im-suning]").css("cursor","pointer");$("[sf-cart]").live("click.sf-cart",function(){location.href=sn.config.cart});$("[sf-cart]").live("mouseover.sf-cart",function(){$("[sf-cart-num]").text(d("totalProdQty")||"0")});$("[sf-cart-num]").text(d("totalProdQty")||"0");$("[sf-favorite]").live("click.sf-favorite",function(){var name="SHOPSEARCH_00"+sn.shop.spcode;mySuning.add2ShopFavorite("00"+sn.shop.spcode,"shopHome",name)});$("[sf-index]").live("click.sf-index",function(){var url=sn.shop.domain;$(this).openBlank(url)});$(".sf-navbar a").each(function(i,elm){elm.target="_blank"})},fixDomain:function(){var url="//{host}{pathname}".format(location);var domainRe=/\/\/([^\/:]+)(:?\d+)?(\/(sfs-shop-web|sfs))?(\/(\d+))?(\/[^\/\.]*)?(\.?\w+)?/im;var rep="//$1$2$3";var repf="//{1}{2}{3}";var do_arr=sn.shop.domain.match(domainRe,rep);var domain=repf.format(_.fill(do_arr,""));var url_arr=url.match(domainRe,rep);var currContext=repf.format(_.fill(url_arr,""));info&&console.info(domain,currContext,currDomain);var host=location.host;var port=location.port;var pageType=sn.page.pageType||"header";if(pageType!="header"&&u.isDomain(host)){sn.shop.context=currContext+"/";sn.shop.$context=currContext+"/";sn.shop.shopContext=currContext+"/";debug&&console.info("this is local debug model")}if(u.isDomain(domain)){sn.shop.selfDomain=true;sn.shop.shopDomain=domain+"/";debug&&console.info("the shop is self domain")}else{sn.shop.selfDomain=false}},isDomain:function(host){var newRe=/(http:\/\/)?((\bdevshop|\bsitshop|\bpreshop|\bshop)(\.(sit|sfsdev))?(\.?(cn)?suning.com))(\:\d+)?/im;var localRe=/(http:\/\/)?((\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost)(\:\d+)?/im;return !newRe.test(host)&&!localRe.test(host)},filter:function(string){string=string||"";var pattern=new RegExp("[`~!@#$^&*()_\\+=|{}':;',\\[\\]\\\\<>?~！@#￥……&*（）——|{}【】‘；：”“\"'。，、？]");var retnStr="";for(var i=0;i<string.length;i++){retnStr+=string.substr(i,1).replace(pattern,"")}return retnStr}};var sa,SA=sa={pv:function(jsName){var host=document.location.hostname;if(/shop\d{8}|shop\./.test(host)){var hid_cSupplierID="<input type='hidden' id='CSupplierID' value='{spcode}'>".format(sn.shop);var hid_cUrlPattern="<input type='hidden' id='CUrlPattern' value='shopidnew.suning.com{pageType}'>".format({pageType:(function(){var pageType={search:"/search",list:"/class",sale:"/number",index:""};return pageType[sn.page.pageType]||""}())});$("body").append(hid_cSupplierID).append(hid_cUrlPattern)}var sa_url="{protocol}//{env}{protocol=='https:'?'imgssl.suning.com':'script.suning.cn'}/javascript/sn_da/{jsName}.js".format({protocol:document.location.protocol,jsName:jsName,env:(function(){var host=document.location.hostname;host.match(/(dev|sit|pre)/img);var env={dev:"pre",sit:"sit1",pre:"pre"};return env[RegExp.$1||""]||""}())});sa.lazyLoadScripts().init({src:[sa_url]})},uv:function(){$("[sa-uv]").live("click.sa-uv",function(){var name=$(this).attr("sa-uv");var ipage=$(this).attr("ignore-page")||"false";debug&&!name&&console.warn("sa-uv setting is null");var sa_name="{sys}_{ptype}_{name}".format({sys:"sfs",ptype:sn.page.pageType,name:name});if(ipage=="true"){sa_name="{sys}_{name}".format({sys:"sfs",name:name})}debug&&console.info("sa-uv:"+sa_name);var sa_dom=$("[name="+sa_name+"]");if(sa_dom.size()==0){sa_dom=$("<input type='hidden' name='"+sa_name+"' />");$("body").append(sa_dom)}name&&window.sa&&window.sa.click&&window.sa.click.sendDatasIndex(sa_dom[0])})},lazyLoadScripts:function(){var h=document,a,i=[],c=[],b;function f(j,m){var d,k;e();if(j.src){j.src=j.src.constructor===Array?j.src:[j.src];for(var l=0;l<j.src.length;l++){if(j.src[l].constructor!==Array){j.src[l]=[j.src[l]]}c.push(j.src[l])}}i=c.shift();a=a||h.getElementsByTagName("head")[0];j.src=i;for(var l=0;l<j.src.length;l++){k=j.src[l];d=h.createElement("script");d.src=k;d.type="text/javascript";if(b.ie){d.onreadystatechange=function(){var n=this.readyState;if(n==="loaded"||n==="complete"){this.onreadystatechange=null;g(j,m)}}}else{d.onload=d.onerror=function(){g(j,m)}}a.appendChild(d)}}function g(d,k){var j=i;if(!j){return}j.shift();if(!j.length){if(c.length){f(d,k)}else{if(typeof k=="function"){k()}return}}}function e(){if(b){return}var d=/msie/i.test(navigator.userAgent.toLowerCase());b={ie:d}}return{init:function(d,j){f(d,j)}}}};window.info=window.debug=window.warn=window.log=false;window.search_disable=false;$.extend(S,{category:category,search:search,util:util,extendNavi:extendNavi,sa:SA});$(function(){category.bind();search.bind();util.bind();extendNavi.bind();if(!sn.actInfo){priceUtil.bind()}sa.uv();sa.pv("da_opt");$("div[sa-uv='banner'] img").each(function(){$(this).attr("src",$(this).attr("lazy-src"));$(this).removeAttr("lazy-src")});$(".sf-nav img").each(function(){$(this).attr("src",$(this).attr("lazy-src"));$(this).removeAttr("lazy-src")})});Shop.util.fixDomain()})(window,document,jQuery,sn||{},window.Shop=window.Shop||{});