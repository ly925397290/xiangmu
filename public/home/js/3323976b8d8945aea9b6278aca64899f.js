function _loadAsyncJs(src){var _src=src;var _scripts=document.getElementsByTagName("script");for(var i=0;i<_scripts.length;i++){if(_scripts[i].src==_src){return}}var _script=document.createElement("script");_script.type="text/javascript";_script.async=true;_script.src=_src;var _s=_scripts[0];_s.parentNode.insertBefore(_script,_s)}function _getJsFilePath(js_file){var _hostName=document.location.hostname;var _prd_reg=/^\w*?.suning.com$/;var _pre_reg=/^\w*?pre.cnsuning.com$/;var _sit_reg=/^\w*?sit.cnsuning.com$/;var sa_src="";if(_prd_reg.test(_hostName)){sa_src=("https:"==document.location.protocol)?"https://imgssl.suning.com":"http://script.suning.cn"}else{if(_pre_reg.test(_hostName)){sa_src=("https:"==document.location.protocol)?"https://preimgssl.suning.com":"http://prescript.suning.cn"}else{if(_sit_reg.test(_hostName)){sa_src=("https:"==document.location.protocol)?"https://sit1imgssl.suning.com":"http://sit1script.suning.cn"}else{sa_src=("https:"==document.location.protocol)?"https://preimgssl.suning.com":"http://prescript.suning.cn"}}}sa_src="//res.suning.cn/javascript/sn_da/"+js_file;return sa_src};var operateCheckCmmdty=[];var updateNumCmmdty=[];var againBuyClickTag=0;var cartRemovedObject=[];var cmmdtyObject={};var validateCode;var validateUuid;var productDomain="//product.suning.com";var snDomain="//ssl.suning.com";var cartTimeFlag="";var cmmdtyDOM=new Array();var specsMap={};var count=0;var fc_config={fcWebUrl:"//tspofc.suning.com",fcResUrl:"//res.suning.cn/project/tspofc"};var buyRule="";var cloudCart1={init:function(){this.checkout.init();this.selectList.init();this.judgeFailure();this.changeNumber.init();this.changeSpecs.init();this.judeFixBottom();this.fixBottom();this.snAddressInit();this.gatherOrder.addCart();this.gatherOrder.addCart1();this.allStoreDiscount.init();this.getAjaxGift();this.sunPackage.sunPackageClickInit();this.jugeQuickChangeOrReChange();this.getAjaxCoupon();this.couponExpand();this.changeBuy.init();this.advertisingInit();this.getAjaxPcssLabel();this.queryUsableCouponList();cloudCart.floatBar({zIndex:7700,contents:$(".cart-float-bar"),align:"right",vertical:"bottom",css:{"margin-bottom":180}});this.login();this.hoverOpt.init();this.fullCut();this.lazyQueryProduct();this.controlTaxFareDisplay();this.promoLocation.bindEvent()},judgeFailure:function(){if($(".fail-icon").length==0){$(".del-fail").hide()}},gatherOrder:{meetCutFn:function(options,tipDom,targetDom,tipFn){var cmmdtyCodes=[];var custNum=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var u="";if(typeof custNum!="undefined"&&custNum&&custNum!="undefined"){u=u+custNum}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}var itemSubs=$(".item-sub,.item-main");var count=1;$.each(itemSubs,function(n,itemSub){var item=$(itemSub).parent();var check=item.find("input[type='checkbox']");var cmmdtyCode=$(itemSub).find("input[type='hidden']").attr("cmmdtyCode");var shopCode=$(itemSub).find("input[type='hidden']").attr("shopCode");if(check.attr("checked")=="checked"&&shopCode=="0000000000"){cmmdtyCode=$(itemSub).find("input[type='hidden']").attr("cmmdtyCode");cmmdtyCodes.push("parameters="+cmmdtyCode);count++}if(count>6){return false}});var parameters=cmmdtyCodes.join("&");var recommendDomain="//tuijian.suning.com";var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}if(parameters==""){parameters="parameters="}if(cityId==null){cityId="025"}sn.cityId=cityId;var priceSpread="";var needBuy;if(typeof($("#newFreightGray").val())!="undefined"&&$("#newFreightGray").val()=="true"){needBuy=$("#newFreightNeedBuy").val();var newFreightNeedWeight=$("#newFreightNeedWeight").val();if(typeof needBuy!="undefined"&&needBuy&&needBuy!="undefined"){priceSpread="&priceSpread="+needBuy}if(typeof newFreightNeedWeight!="undefined"&&newFreightNeedWeight&&newFreightNeedWeight!="undefined"){if(priceSpread==""){priceSpread="&weight="+newFreightNeedWeight}else{priceSpread+="&weight="+newFreightNeedWeight}}var _url=recommendDomain+"/recommend-portal/recommend/paramsBiz.jsonp?"+parameters+"&cityId="+cityId+"&sceneIds=4-21&count=18&u="+u+"&c="+c+""+priceSpread;$.ajax({url:_url,dataType:"jsonp",async:false,cache:true,success:function(data){gather_jsonpCallback_freight(data,options,tipDom,targetDom,tipFn,needBuy)},error:function(){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty)}})}else{needBuy=$("#needBuy").val();if(typeof needBuy!="undefined"&&needBuy&&needBuy!="undefined"){priceSpread="&priceSpread="+needBuy}var _url=recommendDomain+"/recommend-portal/recommend/paramsBiz.jsonp?"+parameters+"&cityId="+cityId+"&sceneIds=4-11&count=50&u="+u+"&c="+c+""+priceSpread;$.ajax({url:_url,dataType:"jsonp",async:false,cache:true,success:function(data){gather_jsonpCallback(data,options,tipDom,targetDom,tipFn,needBuy)},error:function(){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty)}})}},cMeetCutFn:function(options,tipDom,targetDom,tipFn){var custNum=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}var u="";if(typeof custNum!="undefined"&&custNum&&custNum!="undefined"){u=u+custNum}var flag="";var vendorId=targetDom.attr("shopCode");var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}if(cityId==null){cityId="025"}sn.cityId=cityId;var recommendDomain="//tuijian.suning.com";activityMsg=targetDom.attr("activityMsg"),activityItems=activityMsg.split(","),activityId="",priceSpread="",flag="";for(var i=0;i<activityItems.length;i++){if(i>2){return}var activityItem=activityItems[i].split("-");if(i!=0){activityId=activityId+":"+activityItem[0];priceSpread=priceSpread+":"+activityItem[1];if(activityItem[2]=="1"){flag=flag+":2"}else{if(activityItem[2]=="2"){flag=flag+":1"}}}else{activityId=activityItem[0];priceSpread=activityItem[1];if(activityItem[2]=="1"){flag="2"}else{if(activityItem[2]=="2"){flag="1"}}}}var _url=recommendDomain+"/recommend-portal/recommend/paramsBiz.jsonp?activityId="+activityId+"&vendorId="+vendorId+"&priceSpread="+priceSpread+"&flag="+flag+"&cityId="+cityId+"&sceneIds=10-36&count=30&u="+u+"c="+c;$.ajax({url:_url,dataType:"jsonp",async:false,cache:true,success:function(data){cgather_jsonpCallback(data,options,tipDom,targetDom,tipFn)},error:function(){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty)}})},addCart:function(){$(document).on("click",".meet-cut-select .cart-btn",function(e){e.preventDefault();var checkboxs=$(".meet-cut-select li input[type='checkbox']");var cart={};var cmmdty=new Array();cart.sourcePageType="05";$.each(checkboxs,function(n,checkbox){if($(checkbox).prop("checked")){var cmmdtyCode=$(checkbox).attr("cmmdtyCode");var shopCode=$(checkbox).attr("shopCode");var cmmdtyName=$(checkbox).attr("cmmdtyName");var cmmdtyObjetc={};cmmdtyObjetc.cmmdtyCode=cmmdtyCode;cmmdtyObjetc.shopCode=shopCode;cmmdtyObjetc.activityType="01";cmmdtyObjetc.cmmdtyQty="1";cmmdty.push(cmmdtyObjetc);cmmdtyObject[cmmdtyCode]=cmmdtyName}});if(cmmdty.length>0){cart.cmmdty=cmmdty;gatherAddcart(cart)}})},addCart1:function(){$(document).on("click",".fare-merge-order .add-cart-24",function(e){e.preventDefault();var that=$(this);var cmmdtyCode=that.attr("cmmdtyCode");var shopCode=that.attr("shopCode");coudanAddCart("05","01","",cmmdtyCode,shopCode,1,"",that)})}},selectList:{init:function(){this.bindEvent();this.querySelect()},bindEvent:function(){var that=this;$(document).on("click",".m-cart-body .chk-item",function(){that.activeSelect(this);that.singleSelect(this)});$(document).on("click",".store-title .checkbox",function(){if($(this).siblings("label.label-undisable").length<=0){that.storeAllSelect(this)}});$(document).on("click",".J-AllCheckBox",function(){that.cartAllSelect(this)});that.selectMeetcut();that.selectCMeetcut();that.queryActiveSelect();that.cartAllStoreSelect()},cartAllStoreSelect:function(){var dCartWrapper=$(".cart-wrapper"),dMCartBody=dCartWrapper.find(".m-cart-body"),$allItems=dMCartBody.find(".cart-list").find("div.item,div.suit").not(".item-fail,.suit-fail,.item-yr,.suit-yr").find(".chk-item"),$allStores=$(".m-store"),$cartAllCheckBox=dCartWrapper.find(".J-AllCheckBox"),isSelect=false;var itemsLen=$allItems.length;if(itemsLen==0){$cartAllCheckBox.parent().find("label").addClass("label-undisable");$cartAllCheckBox.prop("checked",false);$cartAllCheckBox.parent(".cart-checkbox").removeClass("cart-checkbox-checked")}for(var i=0;i<itemsLen;i++){var isItemSelect=$allItems.eq(i).prop("checked");if(isItemSelect){isSelect=true;continue}else{isSelect=false;break}}if(isSelect){$cartAllCheckBox.prop("checked",isSelect);$cartAllCheckBox.parent(".cart-checkbox").addClass("cart-checkbox-checked")}$allStores.each(function(i){var isStoreSelect=false;var $storesItems=$(this).find("div.item,div.suit").not(".item-fail,.suit-fail,.item-yr,.suit-yr").find(".chk-item");var storesItemsLen=$storesItems.length;if(storesItemsLen==0){$(this).find(".store-title label").addClass("label-undisable");$(this).find(".store-title .checkbox").prop("checked",false);$(this).find(".store-title").removeClass("store-checked");return}for(var i=0;i<storesItemsLen;i++){var isItemSelect=$storesItems.eq(i).prop("checked");if(isItemSelect){isStoreSelect=true;continue}else{isStoreSelect=false;break}}if(isStoreSelect){$(this).find(".store-title .checkbox").prop("checked",isStoreSelect);$(this).find(".store-title").addClass("store-checked")}})},activeSelect:function(ele){var $ele=$(ele),isSelect=$ele.prop("checked");if(isSelect){$ele.closest(".meet-suit").addClass("meet-suit-selected")}},selectProcess:function(obj,isSelect){$.each(obj,function(n,checkBoxList){var reg=/^J_CheckBox_/;if(!reg.test(checkBoxList.id)){var cmmdtyItem=checkBoxList.id;$.each(operateCheckCmmdty,function(n,value){var cmmItem=value.split("-")[0];if(cmmItem==cmmdtyItem){operateCheckCmmdty.splice(n,1);return false}});operateCheckCmmdty.push(cmmdtyItem+"-"+(isSelect?"1":"0"))}});if(operateCheckCmmdty.length==0){return false}this.checkOperateMethod()},storeAllSelect:function(ele){var that=this;var $ele=$(ele),$cartAllCheckBox=$(".J-AllCheckBox"),$parentNode=$ele.closest(".m-store"),isSelect=$ele.prop("checked");$parentNode.find(":checkbox.chk-item").each(function(){$(this).prop("checked",isSelect)});var cstoreId="#"+$ele.attr("data-id");var allCheckBox=$(".checkbox",cstoreId);if(isSelect){$parentNode.find("div.item,div.suit,div.item-sub").addClass("item-checked");if(this.queryCartAllSelect()){$cartAllCheckBox.prop("checked",true);$cartAllCheckBox.closest(".cart-checkbox").addClass("cart-checkbox-checked")}$ele.closest(".store-title").addClass("store-checked")}else{$parentNode.find("div.item,div.suit,div.item-sub").removeClass("item-checked");$ele.closest(".store-title").removeClass("store-checked");$cartAllCheckBox.prop("checked",false);$cartAllCheckBox.closest(".cart-checkbox").removeClass("cart-checkbox-checked")}probeAuthStatus(function(){that.selectProcess(allCheckBox,isSelect)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){that.selectProcess(allCheckBox,isSelect)})}else{that.selectProcess(allCheckBox,isSelect)}})},cartAllSelect:function(ele){var that=this;var $ele=$(ele),isSelect=$ele.prop("checked"),dCartWrapper=$(".cart-wrapper"),dMCartBody=dCartWrapper.find(".m-cart-body"),$cartAllCheckBox=dCartWrapper.find(".J-AllCheckBox"),dStoreTitle=dCartWrapper.find(".store-title");var allCheckBox=$(".checkbox",".m-cart-body");dMCartBody.find(":checkbox.checkbox").prop("checked",isSelect);dStoreTitle.find(":checkbox.checkbox").prop("checked",isSelect);$cartAllCheckBox.prop("checked",isSelect);if(isSelect){dMCartBody.find(":checkbox.checkbox").each(function(){$(this).closest("div.item,div.suit,div.item-sub").not(".item-fail,.suit-fail,.item-yr,.suit-yr").addClass("item-checked")});$cartAllCheckBox.closest(".cart-checkbox").addClass("cart-checkbox-checked");dStoreTitle.addClass("store-checked")}else{dMCartBody.find(".item-checked").removeClass("item-checked");dStoreTitle.removeClass("store-checked");$cartAllCheckBox.closest(".cart-checkbox").removeClass("cart-checkbox-checked")}probeAuthStatus(function(){that.selectProcess(allCheckBox,isSelect)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){that.selectProcess(allCheckBox,isSelect)})}else{that.selectProcess(allCheckBox,isSelect)}})},singleSelect:function(ele){var that=this;var $ele=$(ele),$cartAllCheckBox=$(".J-AllCheckBox"),dThisStoreTitle=$ele.closest(".m-store").find(".store-title"),$storeAllCheckBox=dThisStoreTitle.find(".checkbox"),$parentNode=$ele.closest("div.item,div.suit,div.item-sub"),isSelect=$ele.prop("checked");if(isSelect){$parentNode.addClass("item-checked");if(this.queryStoreAllSelect($ele)){$storeAllCheckBox.prop("checked",true);dThisStoreTitle.addClass("store-checked");if(this.queryCartAllSelect()){$cartAllCheckBox.prop("checked",true);$cartAllCheckBox.closest(".cart-checkbox").addClass("cart-checkbox-checked")}}}else{$parentNode.removeClass("item-checked");$cartAllCheckBox.closest(".cart-checkbox").removeClass("cart-checkbox-checked");dThisStoreTitle.removeClass("store-checked");$storeAllCheckBox.prop("checked",false);$cartAllCheckBox.prop("checked",false)}probeAuthStatus(function(){that.selectProcess($ele,isSelect)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){that.selectProcess($ele,isSelect)})}else{that.selectProcess($ele,isSelect)}})},queryStoreAllSelect:function(ele){var storeCheckBox=$(ele).closest(".m-store").find(":checkbox.chk-item"),result=true;storeCheckBox.each(function(){if($(this).prop("checked")===false){result=false;return false}});return result},queryCartAllSelect:function(){var result=true;$(".m-cart-body :checkbox.chk-item").each(function(){if($(this).prop("checked")===false){result=false;return false}});return result},querySelect:function(){var allSelectBox=$(".chk-item:checked",".m-cart-body");if(allSelectBox.length==0){$(".checkout").addClass("checkout-disable-tip")}else{var checkoutFloat=false;$.each(allSelectBox,function(i,n){var itemNo=$(n).attr("id");var msgObject=$("#"+itemNo+"-amount-msg");var emObject=msgObject.next(".amount-tip");var fixJu=msgObject.attr("subActivityType");if(itemNo!=undefined){if(msgObject.length>0&&msgObject.html()!=""&&!emObject.length>0&&!(typeof fixJu!="undefined"&&fixJu!="")){checkoutFloat=true;return false}else{if($(n).parents(".suit").length>0){var subItems=$(n).parents(".suit").find(".item-sub").find(".haoye");$.each(subItems,function(i,n){itemNo=$(n).attr("itemno");msgObject=$("#"+itemNo+"-amount-msg");emObject=msgObject.next(".amount-tip");if(msgObject.length>0&&msgObject.html()!=""&&!emObject.length>0){checkoutFloat=true;return false}})}}}});if(checkoutFloat){$(".checkout").addClass("checkout-disable")}else{$(".checkout").removeClass("checkout-disable")}}},checkOperateMethod:function(){cloudCart1.selectList.disableCheckbox();var loginSign=$("#loginSign").val();var operateCheckCmmdtyData=operateCheckCmmdty.toString();operateCheckCmmdty=new Array();$.ajax({type:"get",dataType:"jsonp",url:"operateCartOneCheck.do",data:{loginSign:loginSign,operateCheckCmmdty:operateCheckCmmdtyData},crossDomain:true,success:function(data){if(data.result=="false"){return false}cloudCart1.refreshPage(data)},complete:function(XMLHttpRequest,textStatus){cloudCart1.selectList.enableCheckbox()}})},queryActiveSelect:function(){var meetSuitBox=$(".meet-suit");$.each(meetSuitBox,function(i,n){var meet=$(n),isExisted=meet.find(".chk-item:checked");if(isExisted.length>0){meet.addClass("meet-suit-selected")}})},disableCheckbox:function(){$(".m-cart-body :checkbox , .m-cart-header :checkbox , .cart-toolbar-box :checkbox , .tool-area-box :checkbox").each(function(){$(this).attr("disabled","false")})},enableCheckbox:function(){$(".m-cart-body :checkbox , .m-cart-header :checkbox, .cart-toolbar-box :checkbox , .tool-area-box :checkbox").each(function(){$(this).removeAttr("disabled","true")})},selectMeetcut:function(){$(document).on("click",".ui-tooltip .meet-cut-select label",function(e){var _that=$(this);e.stopPropagation();if(_that.hasClass("label-disable")){return}var dParentLI=_that.closest("li");if(dParentLI.find(".cart-raido").length!=0){if(dParentLI.hasClass("pro-checked")){dParentLI.removeClass("pro-checked")}else{dParentLI.addClass("pro-checked")}}else{if(dParentLI.find(".cart-checkbox").length!=0){if(dParentLI.hasClass("item-checked")){dParentLI.removeClass("item-checked")}else{dParentLI.addClass("item-checked")}}}})},selectCMeetcut:function(){$(document).on("click",".ui-tooltip .meet-exchange-cshop label",function(e){var _that=$(this);e.stopPropagation();var dParentLI=_that.closest(".meet-exchange-cshop").find("li");var numStr=_that.closest(".meet-exchange-cshop").find(".ff-tahoma").eq(0).text();var checkNum=$.grep(dParentLI,function(e){return $(e).hasClass("item-checked")}).length;if($.isNumeric(numStr)){if(checkNum>=parseInt(numStr)){dParentLI.each(function(){if(!$(this).hasClass("item-checked")){$(this).find(".cart-checkbox input").attr("disabled","disabled");$(this).find(".cart-checkbox label").addClass("label-disable")}})}else{dParentLI.each(function(){$(this).find(".cart-checkbox input").removeAttr("disabled");$(this).find(".cart-checkbox label").removeClass("label-disable")})}if(_that.closest(".meet-exchange-cshop").find(".ff-tahoma").length==2){_that.closest(".meet-exchange-cshop").find(".ff-tahoma").eq(1).text(checkNum)}else{if(_that.closest(".meet-exchange-cshop").find(".ff-tahoma").length==1){_that.closest(".meet-exchange-cshop").find(".content-title").html(_that.closest(".meet-exchange-cshop").find(".content-title").html()+"，已选<span class='c-f60 ff-tahoma'>"+checkNum+"</span>件")}}}})}},checkout:{init:function(){this.bindEvent();this.splitBuy();this.giftErrorPop()},bindEvent:function(){var _that=this;$(document).on("click",".checkout",function(e){e.preventDefault();if($(this).hasClass("checkout-disable")||$(this).hasClass("checkout-disable-tip")||$(this).hasClass("checkout-loading")){return false}ensureLogin(function(){var inputObjects=$("input[name=icart1_goods_sel]");var hwgCodeArray=new Array();var normalCodeArray=new Array();var tmCodeArry=new Array();$.each(inputObjects,function(n,inputObject){if($(inputObject).attr("checked")){var cmmdtyCode;var shopCode;var activityType=$(inputObject).attr("activityType");var subActivityType=$(inputObject).attr("subActivityType");if(activityType=="04"||activityType=="05"||activityType=="06"||activityType=="12"){var suitObject=$(inputObject).parents(".suit");cmmdtyCode=$(suitObject.find(".haoye")[0]).attr("cmmdtyCode");shopCode=$(suitObject.find(".haoye")[0]).attr("shopcode")}else{cmmdtyCode=$(inputObject).attr("cmmdtyCode");shopCode=$(inputObject).attr("shopcode")}if($(inputObject).attr("overSeasFlag")=="927HWG"||$(inputObject).attr("overSeasFlag")=="927HWG1"){hwgCodeArray.push(shopCode+"-"+cmmdtyCode)}else{if(activityType=="02"&&subActivityType=="14"){tmCodeArry.push(shopCode+"-"+cmmdtyCode)}else{normalCodeArray.push(shopCode+"-"+cmmdtyCode)}}}});if((hwgCodeArray.length>0&&normalCodeArray.length>0)||(tmCodeArry.length>0&&normalCodeArray.length>0)||(hwgCodeArray.length>0&&tmCodeArry.length>0)){$.mLionDialog({css:{width:"520px"},title:"温馨提示",http:function(e,o){$.ajax({type:"post",url:"showPromptPaySplitftl.do",data:{normalCodeArray:normalCodeArray.toString(),hwgCodeArray:hwgCodeArray.toString(),tmCodeArry:tmCodeArry.toString()},dataType:"html",success:function(data){e.find(".content").html(data);e.find(".btn.close").attr("name","icart1_ope_buyclose01");$.resizeLionDialog();cartListLoop.listloop({wrap:".abroad-list",loopBox:".abroad-ul",step:{wide:3,narrow:3},scrollWidth:{wide:276,narrow:276},hasLabel:false,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".common-list",loopBox:".common-ul",step:{wide:3,narrow:3},scrollWidth:{wide:276,narrow:276},hasLabel:false,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".famous-list",loopBox:".famous-ul",step:{wide:3,narrow:3},scrollWidth:{wide:276,narrow:276},hasLabel:false,isRandom:false,hoverArr:true})}})},overlayCss:{background:"black",opacity:"0.3"},fadeIn:100,fadeOut:100});return}buyRule="";_that.realCheckOut()})})},getCartOneProduct:function(shoppingCartPayError){var shoppingCartPayErrorList=shoppingCartPayError;var failCmmdty=new Array();($("input[type='checkbox']").each(function(){if(shoppingCartPayErrorList.length>0){for(var i=0;i<shoppingCartPayErrorList.length;i++){var CartOne=new Object();CartOne.itemNo="";CartOne.cmmdtyName="";CartOne.salesPrice="";CartOne.cmmdtyCode="";CartOne.activityId="";CartOne.firstSubCmmdtyCode="";CartOne.firstSubCmmdtyName="";if(shoppingCartPayErrorList[i].itemNo==$(this).attr("id")&&$(this).attr("checked")=="checked"){CartOne.itemNo=$(this).attr("id");CartOne.cmmdtyName=$(this).attr("cmmdtyName");CartOne.cmmdtyCode=$(this).attr("cmmdtyCode");CartOne.salesPrice=$(this).attr("salesPrice");CartOne.shopCode=$(this).attr("shopCode");CartOne.activityId=$(this).attr("activityId");CartOne.activityType=$(this).attr("activityType");if(!(CartOne.activityId!=""&&CartOne.activityType=="06")){if(!cloudCart1.checkout.checkHaveCmmdty(failCmmdty,CartOne)){failCmmdty.push(CartOne)}}}var itemSubs=$(this).parents(".suit");var itemItems=$(itemSubs).find(".haoye");$.each(itemItems,function(n,item){if(CartOne.activityId!=""&&CartOne.activityType=="06"&&n==0){CartOne.firstSubCmmdtyCode=$(item).attr("cmmdtyCode");CartOne.firstSubCmmdtyName=$(item).attr("cmmdtyName");if(!cloudCart1.checkout.checkHaveCmmdty(failCmmdty,CartOne)){failCmmdty.push(CartOne)}}var itemNo=$(item).attr("itemNo");if(shoppingCartPayErrorList[i].itemNo==itemNo){CartOne.cmmdtyName=$(item).attr("cmmdtyName");CartOne.cmmdtyCode=$(item).attr("cmmdtyCode");CartOne.salesPrice=$(item).attr("salesPrice");CartOne.shopCode=$(item).attr("shopCode");if(!cloudCart1.checkout.checkHaveCmmdty(failCmmdty,CartOne)){failCmmdty.push(CartOne)}}})}}}));return failCmmdty},realCheckOut:function(fcTokenId){if(!$(".checkout").hasClass("checkout-loading")){$(".checkout").addClass("checkout-loading")}var cart2Url="order.do";var itemLi="";var imgUrl=$("#imgNewUrl").val();var c2dt="";if(typeof bd!="undefined"&&bd&&bd!="undefined"){c2dt=bd.rst()}$.ajax({url:"cartSettlement.do",type:"POST",data:{fcTokenId:typeof fcTokenId=="string"?fcTokenId:"",cityCode:$("#city").attr("cityCode"),districtCode:$("#city").attr("districtCode"),provinceCode:$("#city").attr("provincecode"),c2dt:c2dt,validateCode:validateCode,validateUuid:validateUuid,buyRule:buyRule},dataType:"json",success:function(data){if("4000"===data.returnCode){var errorMsg='<div class="company-channel"><p class="tips">您访问的太频繁，网络拥堵，请您稍后再试！</p></div>';$.mLionDialog({css:{width:"366px"},title:"温馨提示",http:function(e,o){e.find(".content").html(errorMsg);cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}if(data.fcFlag=="1"){openB2cPopPage(data,cloudCart1.checkout.realCheckOut,fc_config);return}if(data.result.isSuccess=="Y"){window.location.href=cart2Url+"?cart2No="+data.result.cart2No}else{var errorMsg="";var errorList=data.result.resultErrorList;var reg=/^9/g;var errorType="1";appendInput("Tosettlement");try{if(reg.test(errorList[0][0].errorCode)||errorList[0][0].errorCode=="001"){errorType="0"}if(errorList[0][0].backErrorCode!=undefined&&errorList[0][0].backErrorCode!="undefined"&&errorList[0][0].backErrorCode!=""){sa.openAPI.sendMessage("Tosettlement",errorList[0][0].errorCode+"&&"+errorType+"&&"+errorList[0][0].errorMessage+"（"+errorList[0][0].backErrorCode+"）&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("Tosettlement",errorType,errorList[0][0].errorCode,errorList[0][0].errorMessage+"（"+errorList[0][0].backErrorCode+")")}else{sa.openAPI.sendMessage("Tosettlement",errorList[0][0].errorCode+"&&"+errorType+"&&"+errorList[0][0].errorMessage+"&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("Tosettlement",errorType,errorList[0][0].errorCode,errorList[0][0].errorMessage)}}catch(e){}if(errorList.length>0&&errorList[0][0].backErrorCode!=undefined&&errorList[0][0].backErrorCode!="undefined"&&errorList[0][0].backErrorCode=="MC100005"){cloudCart1.reload();return}if(!(errorList.length>0&&errorList[0][0].systemErrorFlag=="Y")){if(errorList[0][0].errorCode==="009"||errorList[0][0].errorCode==="014"){aqSuning1.showMobilePopType(false);if($(".checkout").hasClass("checkout-loading")){$(".checkout").removeClass("checkout-loading")}return}else{if(errorList[0][0].errorCode=="010"||errorList[0][0].errorCode=="011"||errorList[0][0].errorCode=="012"||errorList[0][0].errorCode=="013"||errorList[0][0].errorCode=="008"||errorList[0][0].errorCode=="023"||errorList[0][0].errorCode=="024"||errorList[0][0].errorCode=="042"||errorList[0][0].errorCode=="043"||errorList[0][0].errorCode=="046"){errorMsg+='<div class="dialog-common system-error"><p class="tips"><i class="tip-icon tip-warning-24"></i>'+errorList[0][0].errorMessage+'</p> <a  href="javascript:;" class="dialog-opt dialog-certain close" onclick="cloudCart1.reload()">知道了</a></div>';$.mLionDialog({css:{width:"436px"},title:"温馨提示",http:function(e,o){e.find(".content").html(errorMsg);cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}else{if(errorList[0][0].errorCode==="018"){errorMsg+='<div class="company-channel"><p class="tips">大宗购物请点击<span><a href="//b.suning.com">企业用户渠道&gt;</a></span>小苏的服务会更贴心！</p></div>';$.mLionDialog({css:{width:"366px"},title:"温馨提示",http:function(e,o){e.find(".content").html(errorMsg);cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}else{if(errorList[0][0].errorCode==="017"){$("#uuid").val(data.uuid);$("#sceneId").val(data.sceneId);var t_defaultValue=cloudCart1.validatSecurityCode.getDefaultValue($("#sceneId").val());errorMsg+='<div class="dialog-common identify-code"><p class="tips">很抱歉，您购买的宝贝销售异常火爆，请稍后再试~</p><div class="code-input clearfix"><dl><dt class="l">验证码</dt><dd class="l"><p class="item-ide"><input autocomplete="off" onblur="cloudCart1.validatSecurityCode.blurFunc();" onfocus="cloudCart1.validatSecurityCode.focusFunc();" class="ui-text l" type="text" placeholder="'+t_defaultValue+'" id="inputCode" ><i id="tipCode" ></i></p><p class="item-ide"><img onclick="cloudCart1.validatSecurityCode.changeCode();" id="imgCode" class="l" src="//vcs.suning.com/vcs/imageCode.htm?uuid='+data.uuid+"&sceneId="+data.sceneId+"&yys="+new Date().getTime()+'"><span class="change l">看不清楚？<a href="javascript:void(0);" onclick="cloudCart1.validatSecurityCode.changeCode();">换一张</a></span></p><p class="item-ide"><a class="dialog-opt dialog-certain" href="javascript:void(0);" id="validateButton" onclick="cloudCart1.validatSecurityCode.validateCodeFunc();">确定</a><a class="dialog-opt dialog-close close" href="javascript:void(0);" onclick="cloudCart1.reload();return false;">关闭</a></p></dd></dl></div></div>';$.mLionDialog({css:{width:"448px"},title:"温馨提示",http:function(e,o){$("#tipCode").hide();e.find(".content").html(errorMsg);cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});cloudCart.supportPlaceHolder.init();cloudCart.changeInputBorder();return}else{if(errorList[0][0].errorCode==="019"){errorMsg+='<div class="identify-code"><p class="tips">很抱歉，您购买的宝贝销售异常火爆，请稍后再试~</p></div>';$.mLionDialog({css:{width:"448px"},title:"温馨提示",http:function(e,o){$("#tipCode").hide();e.find(".content").html(errorMsg);cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});cloudCart.supportPlaceHolder.init();cloudCart.changeInputBorder();return}else{if(errorList[0][0].errorCode==="020"){errorMsg+='<div class="dialog-common system-busy"><div class="poor-lion more-font-lion clearfix"><i class="poor"></i><div class="tip-opt"><p>海外购商品需要<span class="c-ff6600">根据商家分开结算</span>，以便海外进口商品顺利通过海关。</p><a href="javascript:void(0);" class="dialog-opt dialog-certain close" name="icart1_ope_iknow02">知道了</a></div></div></div>';$.mLionDialog({css:{width:"436px"},title:"温馨提示",http:function(e,o){e.find(".content").html(errorMsg);e.find(".btn.close").attr("name","icart1_ope_buyclose02");cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}else{if(errorList[0][0].errorCode==="021"){var itemLis="";var shoppingCartPayErrorList=errorList[0];var cmmdtyLength=shoppingCartPayErrorList.length;var listClass="";if(cmmdtyLength<3){listClass="list-lt3"}for(var i=0;i<shoppingCartPayErrorList.length;i++){var cmmdtyCode=shoppingCartPayErrorList[i].cmmdtyCode;var cmmdtyName=shoppingCartPayErrorList[i].cmmdtyName;var shopCode=shoppingCartPayErrorList[i].shopCode;if(typeof cmmdtyCode!="undefined"&&cmmdtyCode&&cmmdtyCode!="undefined"&&typeof shopCode!="undefined"&&shopCode&&shopCode!="undefined"){itemLis=itemLis+'<li class="list"><img alt="'+cmmdtyName+'" src="'+imgUrl+"/"+shopCode+"-"+cmmdtyCode+'_1_400x400.jpg"></li>'}}errorMsg+='<div class="dialog-common abroad-split abroad-split-one-store-limit abroad-new-rule"><p class="tips"><i class="tip-icon tip-info-24"></i>您已超出<span class="c-f60">海关限额</span>，请返回购物车修改商品数量</p><div class="limit-rule"><p class="rule-th">限制规则：</p><p>1、消费者购买部分进口商品，一笔订单中同一件商品购买总额不可超出2000元（不含关税）。</p><p>2、如果商品单价超出2000元，则一笔订单只可购买一件。</p> </div><p class="tc">以下<span class="c-ff6600">'+cmmdtyLength+'</span>件商品超出购买限额</p><div class="clearfix nobo '+listClass+'"><div class="abroad-list"><a href="javascript:void(0);" class="prev"></a><div class="loop-div"><ul class="abroad-ul">'+itemLis+'</ul> </div> <a href="javascript:void(0);" class="next"></a>  </div> <div class="pay-div"><a class="dialog-opt dialog-certain" onclick="cloudCart1.reload();return false;">返回购物车</a></div></div></div>';$.mLionDialog({css:{width:"442px"},title:"温馨提示",http:function(e,o){e.find(".content").html(errorMsg);e.find(".btn.close").attr("name","icart1_ope_buyclose03");$.resizeLionDialog();cloudCart1.checkout.closePop();cartListLoop.listloop({wrap:".abroad-list",loopBox:".abroad-ul",step:{wide:3,narrow:3},scrollWidth:{wide:276,narrow:276},hasLabel:false,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".common-list",loopBox:".common-ul",step:{wide:3,narrow:3},scrollWidth:{wide:276,narrow:276},hasLabel:false,isRandom:false,hoverArr:true})},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}else{if(errorList[0][0].errorCode==="022"){var shoppingCartPayErrorList=errorList[0];if(shoppingCartPayErrorList.length>0){var giftErrorHtml="<div class='layer_present dialog-common'><p class='tips'><i class='tip-icon tip-warning-24'></i>以下赠品剩余数量不足，是否继续购买？</p>";giftErrorHtml+="<div class='present-cont wd290'><ul>";for(var i=0;i<shoppingCartPayErrorList.length;i++){var errorMessage=shoppingCartPayErrorList[i].errorMessage;var giftName=shoppingCartPayErrorList[i].cmmdtyName;var cmmdtyQty=errorMessage;if(cmmdtyQty==0){giftErrorHtml+="<li><span class='has-over r'>已赠完</span><span class='pre-first bg-over'>赠品</span><span class='present-name fcl' title='"+giftName+"'>"+giftName+"</span></li>"}else{giftErrorHtml+="<li><span class='remain r'>剩余"+cmmdtyQty+"件</span><span class='pre-first'>赠品</span><span class='present-name fcl' title='"+giftName+"'>"+giftName+"</span></li>"}}giftErrorHtml+="</ul></div><div class='present-btn'><a href='javascript:;' class='dialog-opt dialog-certain'>确定</a><a href='javascript:;' class='dialog-opt dialog-close close'>取消</a></div></div></div>";$.mLionDialog({css:{width:"440px"},http:function(e,o){e.find(".content").html(giftErrorHtml);cloudCart1.checkout.closePop()},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}}}}}}}}}itemLi+='<div class="dialog-common limit-buy">';for(var i=0;i<errorList.length;i++){var failCmmdty=errorList[i];itemLi+='<p class="tips"><i class="tip-icon tip-warning-24"></i>'+errorList[i][0].errorMessage+'</p><a href="javascript:void(0);" class="arr prev"></a><a href="javascript:void(0);" class="arr next"></a><div class="list-pro-box "><ul class="list-box">';for(var j=0;j<failCmmdty.length;j++){var cmmdtyCode=failCmmdty[j].cmmdtyCode;var cmmdtyName=failCmmdty[j].cmmdtyName;var shopCode=failCmmdty[j].shopCode;if(typeof cmmdtyCode!="undefined"&&cmmdtyCode&&cmmdtyCode!="undefined"){var imgMsg="";if(errorList[i][j].errorCode=="007"){imgMsg='<div class="service-warming-product-img-box" title="'+cmmdtyName+'"></div>'}else{if(typeof shopCode!="undefined"&&shopCode&&shopCode!="undefined"){imgMsg='<img alt="'+cmmdtyName+'" src="'+imgUrl+"/"+shopCode+"-"+cmmdtyCode+'_1_400x400.jpg">'}else{imgMsg='<img alt="'+cmmdtyName+'" src="'+imgUrl+"/"+cmmdtyCode.substr(0,14)+"/"+cmmdtyCode+"/"+failCmmdty[j].cmmdtyCode+'_ls1.jpg">'}}itemLi+='<li class="list">'+imgMsg+'</a><p class="pro-name" title="'+cmmdtyName+'">'+cmmdtyName+"</p></li>"}}itemLi+='</ul></div><a href="javascript:void(0)" onclick="cloudCart1.reload();return false;" class="dialog-opt dialog-certain close">知道了</a></div>';break}}else{itemLi+='<div class="dialog-common system-busy"><div class="poor-lion clearfix"><i class="poor"></i><div class="tip-opt"><p>'+errorList[0][0].errorMessage+'</p><a href="javascript:void(0);" class="dialog-opt dialog-certain close">知道了</a></div></div></div>'}$.mLionDialog({css:{width:"436px"},title:"温馨提示",http:function(e,o){e.find(".content").html(itemLi);cloudCart1.checkout.closePop();var proLen=$(".limit-buy .list-box li").length,arr=$(".limit-buy .arr");if(proLen>=2){cartListLoop.listloop({wrap:".limit-buy",loopBox:".list-box",step:{wide:2,narrow:2},scrollWidth:{wide:300,narrow:304},hasLabel:false,isRandom:false})}else{if(proLen==1){$(".limit-buy .list-box li").addClass("one");arr.hide()}}},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300})}},error:function(e){itemLi='<div class="dialog-common system-busy"><div class="poor-lion clearfix"><i class="poor"></i><div class="tip-opt"><p>网络出错了，请稍后再试'+e.status+'</p><a href="javascript:void(0);" class="dialog-opt dialog-certain close">知道了</a></div></div></div>';var errorType="0";appendInput("Tosettlement");try{sa.openAPI.sendMessage("Tosettlement",e.status+"&&"+errorType+"&&网络出错了，请稍后再试"+e.status+"&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("Tosettlement",errorType,e.status,"网络出错了，请稍后再试"+e.status)}catch(e){}$.mLionDialog({css:{width:"436px"},title:"温馨提示",http:function(e,o){e.find(".content").html(itemLi);cloudCart1.checkout.closePop();var proLen=$(".limit-buy .list-box li").length,arr=$(".limit-buy .arr");if(proLen>=2){cartListLoop.listloop({wrap:".limit-buy",loopBox:".list-box",step:{wide:2,narrow:2},scrollWidth:{wide:300,narrow:304},hasLabel:false,isRandom:false})}else{if(proLen==1){$(".limit-buy .list-box li").addClass("one");arr.hide()}}},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300})}})},checkHaveCmmdty:function(failCmmdty,cartOne){for(var i=0;i<failCmmdty.length;i++){if(failCmmdty[i].cmmdtyCode==cartOne.cmmdtyCode){return true}}},splitBuy:function(){$(document).on("click","#normalBuy",function(){$.unmLionDialog();$(".checkout").addClass("checkout-loading");buyRule=1;cloudCart1.checkout.realCheckOut()});$(document).on("click","#hwgBuy",function(){$.unmLionDialog();$(".checkout").addClass("checkout-loading");buyRule=2;cloudCart1.checkout.realCheckOut()});$(document).on("click","#tmBuy",function(){$.unmLionDialog();$(".checkout").addClass("checkout-loading");buyRule=11;cloudCart1.checkout.realCheckOut()})},closePop:function(){$(".container .btn.close,.container .cart-btn.close,.container .check-btn.close,.container  .dialog-opt.dialog-certain.close").bind("click",function(e){e.preventDefault();cloudCart1.reload()})},giftErrorPop:function(){$(document).on("click",".content .layer_present .dialog-opt.dialog-certain",function(e){e.preventDefault();$.unmLionDialog();buyRule=1;cloudCart1.checkout.realCheckOut()});$(document).on("click",".content .layer_present .dialog-opt.dialog-close",function(e){e.preventDefault();cloudCart1.reload()})}},allChoose:{isAlchoseEmpty:function(){var hadBuy=$(".had-buy");hadBuyList=hadBuy.find(".list-box .list").length;hadBuyList==0?$(".cart-toolbar").find(".alchose-span").hide():$(".cart-toolbar").find(".alchose-span").show();return hadBuyList==0?true:false}},refreshPage:function(data){cmmdtyDOM=new Array();specsMap={};$("#cart-one-delivery").remove();$("#cart-wrapper").html(data.html);$("#cart-one-header").append($("#cart-one-delivery").removeClass("hide"));this.snAddressInit();this.judgeFailure();this.selectList.querySelect();this.selectList.cartAllStoreSelect();this.selectList.queryActiveSelect();this.changeNumber.init();this.fixBottom();this.judeFixBottom();this.getAjaxGift();this.jugeQuickChangeOrReChange();this.getAjaxCoupon();this.getAjaxPcssLabel();this.fullCut();this.lazyQueryProduct();this.controlTaxFareDisplay();this.allStoreDiscount.checkDisplay();this.queryUsableCouponList();this.promoLocation.init()},validatSecurityCode:{validate:function(){var code=$("#inputCode").val();code=$.trim(code);if(code==""||code==undefined){$("#tipCode").hide();$("#inputCode").addClass("error-input");$("#inputCode").val("");$("#inputCode").attr("placeholder","请输入正确的验证码");cloudCart1.validatSecurityCode.changeCode();return}var uuid=$("#uuid").val();var param="code="+code+"&uuid="+uuid+"&delFlag=0";$.ajax({type:"POST",url:"//vcs.suning.com/vcs/validate_jsonp.htm",data:param,dataType:"jsonp",jsonp:"callback",success:function(data){if(data[0].result=="true"){$("#tipCode").addClass("tip-icon tip-ok-16 tip-ok l");$("#tipCode").show()}else{$("#tipCode").hide();$("#inputCode").addClass("error-input");$("#inputCode").val("");$("#inputCode").attr("placeholder","请输入正确的验证码");cloudCart1.validatSecurityCode.changeCode()}}})},changeCode:function(){var uuid=$("#uuid").val();var sceneId=$("#sceneId").val();var src="//vcs.suning.com/vcs/imageCode.htm?uuid="+uuid+"&sceneId="+sceneId+"&yys="+new Date().getTime();$("#imgCode").attr("src",src)},blurFunc:function(){var code=$("#inputCode").val();code=$.trim(code);if(code!=""&&code!=undefined){cloudCart1.validatSecurityCode.validate()}},focusFunc:function(){$("#inputCode").removeClass("error-input");var t_defaultValue=cloudCart1.validatSecurityCode.getDefaultValue($("#sceneId").val());$("#inputCode").attr("placeholder",t_defaultValue)},validateCodeFunc:function(){var code=$("#inputCode").val();code=$.trim(code);if(code==""||code==undefined){$("#tipCode").hide();$("#inputCode").addClass("error-input");$("#inputCode").val("");$("#inputCode").attr("placeholder","请输入正确的验证码");cloudCart1.validatSecurityCode.changeCode();return}var uuid=$("#uuid").val();var param="code="+code+"&uuid="+uuid+"&delFlag=0";$.ajax({type:"POST",url:"//vcs.suning.com/vcs/validate_jsonp.htm",data:param,dataType:"jsonp",jsonp:"callback",success:function(data){if(data[0].result=="true"){$("#tipCode").addClass("tip-icon tip-ok-16 tip-ok l");$("#tipCode").show();validateCode=code;validateUuid=uuid;$(".checkout").removeClass("checkout-loading");$.unmLionDialog();$(".checkout").trigger("click")}else{$("#tipCode").hide();$("#inputCode").addClass("error-input");$("#inputCode").val("");$("#inputCode").attr("placeholder","请输入正确的验证码");changeCode(uuid)}},error:function(data){alert("error")}})},getDefaultValue:function(sceneId){var defaultValue="以下字符不区分大小写";if(sceneId!=null&&sceneId!=undefined&&sceneId!="undefined"){if(sceneId=="1"){defaultValue="以下字符不区分大小写"}else{if(sceneId=="4"){defaultValue="请输入以下汉字"}else{if(sceneId=="5"){defaultValue="请输入以下问题的计算结果"}}}}return defaultValue}},changeNumber:{tpl:{_load:'<table><tr><td><p class="loading-message">处理中，请稍后...</p></td></tr></table>',_success:"<table><tr><td>商品数量修改成功</td></tr></table>",_error:'<table><tr><td><span class="c-error">处理失败，请从新尝试</span></td></tr></table>'},init:function(){this.bindEvent()},bindEvent:function(){var that=this;$("input.text-amount",".item-amount").numer({callback:function(a,b){var plunNum=a;var startCount=b.attr("startCount");if(!isNaN(startCount)){if(parseInt(plunNum)<parseInt(startCount)){plunNum=startCount}}if("warranty"==b.attr("cmmdtyType")){var warrantyItemNo=b.attr("warrantyItemNo");var cmmdtyItemNo=b.attr("cmmdtyItemNo");var pSubs=$(b).parents(".sun-package-list");var itemBoxs=pSubs.find(".item-box");var totalNum=0;$.each(itemBoxs,function(i,itemBox){var itemNum=$(itemBox).find(".td-amount > .item-amount > .text-amount").val();totalNum=parseInt(totalNum)+parseInt(itemNum)});var cmmdtyNum=$("#"+cmmdtyItemNo+"-text-amount").val();if(cmmdtyNum==""){cmmdtyNum=$("#"+cmmdtyItemNo+"-text-amount").html()}if(parseInt(cmmdtyNum)<parseInt(totalNum)){$("#"+cmmdtyItemNo+"-amount-msg").html("商品数量应大于阳光包数量").next(".amount-tip").html("");if(($("#"+cmmdtyItemNo).length==0&&$("input[itemno='"+cmmdtyItemNo+"']").parents(".suit").hasClass("item-checked"))||$("#"+cmmdtyItemNo).attr("checked")=="checked"){$(".checkout").addClass("checkout-disable")}}else{$("#"+cmmdtyItemNo+"-amount-msg").html("").next(".amount-tip").html("")}var itemSubs=$(b).parents(".item-box");var dj=itemSubs.find(".price-now > em").html();itemSubs.find(".td-sum > .sn-price > em").html((parseFloat(dj)*parseInt(plunNum)).toFixed(2));$.each(updateNumCmmdty,function(n,value){var cmmItem=value.split("-")[0];if(cmmItem==warrantyItemNo){updateNumCmmdty.splice(n,1);return false}});updateNumCmmdty.push(warrantyItemNo+"-"+plunNum)}else{var itemNo=b.attr("itemNo");if("04"==b.attr("activityType")||"05"==b.attr("activityType")||"06"==b.attr("activityType")||"12"==b.attr("activityType")||"23"==b.attr("activityType")){var pSubs=$(b).parents(".suit");var headSub=pSubs.find(".item-header");var itemSubs=pSubs.find(".item-sub");var sCmmdtyQty=b.attr("packageScaleQty").split("-");$.each(updateNumCmmdty,function(n,value){var cmmItem=value.split("-")[0];if(cmmItem==itemNo){updateNumCmmdty.splice(n,1);return false}});var zCmmdtyNum=parseInt(sCmmdtyQty[0])*parseInt(plunNum);updateNumCmmdty.push(itemNo+"-"+zCmmdtyNum);$.each(itemSubs,function(subNum,subValue){var dj=$(subValue).find(".price-line .price-now  em").html();var sCmmdtyNum=parseInt(sCmmdtyQty[subNum+1])*parseInt(plunNum);$(subValue).find(".td-amount .item-amount:not('.amount-busy')").find("span").html(sCmmdtyNum);$(subValue).find(".td-sum  .sn-price  em").html((parseFloat(dj)*parseInt(sCmmdtyNum)).toFixed(2));var itemBoxs=$(subValue).siblings(".item-extra").find(".sun-package-list > .item-box");$.each(itemBoxs,function(i,itemBox){$(itemBox).find(".td-amount > .item-amount > span").html(sCmmdtyNum)})});var tdj=headSub.find(".price-line  .sn-price  em").html();headSub.find(".td-sum  .sn-price  em:not(.nonCodeAmount_em)").html((parseFloat(tdj)*parseInt(plunNum)).toFixed(2))}else{if("01"==b.attr("activityType")||"02"==b.attr("activityType")){var itemSubs=$(b).parents(".item-main");var itemBoxs=itemSubs.siblings(".item-extra").find(".sun-package-list > .item-box");$.each(itemBoxs,function(i,itemBox){$(itemBox).find(".td-amount > .item-amount > span").html(plunNum)});var dj=itemSubs.find(".price-now  em").html();itemSubs.find(".td-sum  .sn-price  em").html((parseFloat(dj)*parseInt(plunNum)).toFixed(2));$.each(updateNumCmmdty,function(n,value){var cmmItem=value.split("-")[0];if(cmmItem==itemNo){updateNumCmmdty.splice(n,1);return false}});updateNumCmmdty.push(itemNo+"-"+plunNum)}}}clearTimeout(cartTimeFlag);var sunshineBtn=b.parents(".td-amount").parent().find(".item-remark").find(".sunshine-btn");if(sunshineBtn.length>0){sunshineBtn.parent().addClass("sun-package-load");sunshineBtn.removeClass("sunshine-btn");sunshineBtn.find("i").removeClass("arr").addClass("loadding")}cartTimeFlag=setTimeout(function(){probeAuthStatus(function(){that.updateNumMethod(b)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){that.updateNumMethod(b,sunshineBtn)})}else{that.updateNumMethod(b,sunshineBtn)}})},1000)}})},updateNumMethod:function(ele,sunshineBtn){var updateNumCmmdtyData=updateNumCmmdty.toString();updateNumCmmdty=new Array();var loginSign=$("#loginSign").val();$.ajax({type:"get",dataType:"jsonp",url:"updateCartOneProNum.do",data:{loginSign:loginSign,updateNumCmmdty:updateNumCmmdtyData},crossDomain:true,success:function(data){if(data.result=="false"){return false}cloudCart1.refreshPage(data)},error:function(data){if(sunshineBtn!="undefined"&&sunshineBtn.length>0){sunshineBtn.parent().removeClass("sun-package-load");sunshineBtn.find("i").removeClass("loadding").addClass("arr")}},complete:function(XMLHttpRequest,textStatus){}})}},changeSpecs:{init:function(){$(document).on("click",function(event){if($(event.target).closest(".item-specs-can").size()==0&&$(event.target).closest(".edit-select").size()==0){$(".m-cart-body").find(".edit-box").remove()}else{if($(event.target).closest(".item-specs-can").size()!=0){var specsCan=$(event.target).closest(".item-specs-can");$(".m-cart-body .item-specs-can").not(specsCan).find(".edit-box").remove()}}});$(document).on("mouseenter",".item-specs-can",function(){var _this=$(this);var height=_this.outerHeight()-2;if(!_this.find(".edit-box").find(".modify").hasClass("modify-on")){_this.addClass("item-specs-can-hover");var specs=_this.find(".td-specs");var editDom='<div class="edit-box"><a href="javascript:void(0);" class="modify" data-placement="bottom" data-node="#editSelect">修改</a></div>';_this.find(".tip-look-alike").show();specs.append(editDom);if(_this.find("div[class='item-extra']").length>0){_this.find(".edit-box").css("height",96)}else{_this.find(".edit-box").css("height",height)}}});$(document).on("mouseleave",".item-specs-can",function(){var _this=$(this);if(!_this.find(".edit-box").find(".modify").hasClass("modify-on")){_this.removeClass("item-specs-can-hover");_this.find(".edit-box").remove()}if(!_this.closest(".item").hasClass("item-fail")){_this.find(".tip-look-alike").hide()}});this.effect();st.tooltipNew.run({selector:".item-specs-can .td-specs .modify",type:"click",placement:"bottom",closeBtn:1,openFn:function(options,tipDom,targetDom,tipFn){var shopCode=targetDom.parents(".item").find(".haoye").attr("shopCode");var cmmdtyCode=targetDom.parents(".item").find(".haoye").attr("cmmdtyCode");cloudCart1.queryAllPrice(shopCode,cmmdtyCode);tipDom.find(".ui-tooltip-inner").html(targetDom.closest(".td-specs").find("div[id^='editSelect']").clone().html());targetDom.parents(".item-specs-can").addClass("item-specs-can-hover");targetDom.addClass("modify-on");tipDom.find(".edit-select dl").each(function(){var _this=$(this),height=_this.height(),heightTemp,moreDom='<dd class="more"><span>更多</span><i></i></dd>';if(_this.hasClass("proinfo-color")){heightTemp=100}else{heightTemp=70}if(height>heightTemp){_this.find("dd").addClass("collapse");_this.append(moreDom)}});tipDom.addClass("ui-tooltip-edit-select");tipFn.position(options,tipDom,targetDom);tipDom.find(".edit-cancel").one("click",function(){st.tooltipNew.allHide()});var currentEditDom=targetDom.closest(".edit-box");$(".m-cart-body .edit-box").not(currentEditDom).remove();var map=specsMap[shopCode+"-"+cmmdtyCode];if(typeof(map)=="undefined"){var lis=tipDom.find("li"),liSize=lis.length;for(var i=0;i<liSize;i++){if(!$(lis[i]).hasClass("selected")){$(lis[i]).addClass("disabled")}}}else{var lisSize=tipDom.find(".proinfo-buytype").length;if(lisSize>1){var cid1=$(tipDom.find(".proinfo-buytype")[0]).find(".selected").attr("cid");var lis=$(tipDom.find(".proinfo-buytype")[1]).find("li"),lisize=lis.length;for(var i=0;i<lisize;i++){if(!$(lis[i]).hasClass("selected")){var cid=cid1+$(lis[i]).attr("cid");if(map[cid]==""||map[cid]==null||typeof(map[cid])=="undefined"){$(lis[i]).addClass("disabled")}}}}else{var lis=$(tipDom.find(".proinfo-buytype")[0]).find("li"),lisize=lis.length;for(var i=0;i<lisize;i++){if(!$(lis[i]).hasClass("selected")){var cid=$(lis[i]).attr("cid");if(map[cid]==""||map[cid]==null||typeof(map[cid])=="undefined"){$(lis[i]).addClass("disabled")}}}}}},closeFn:function(tipDom,targetDom,tipFn){targetDom.parents(".item-specs-can").removeClass("item-specs-can-hover");targetDom.removeClass("modify-on")}});$(document).on("click",".ui-tooltip-edit-select .edit-post",function(){var _that=$(this),itemNo=_that.attr("itemno"),shopCode=_that.attr("shopcode"),cmmdtyCode=_that.attr("cmmdtyCode"),editSelect=_that.closest(".edit-select"),selectedLi=editSelect.find(".selected"),liLen=selectedLi.length,cidString="";_that.removeClass("edit-post");for(var i=0;i<liLen;i++){cidString+=$(selectedLi[i]).attr("cid")}probeAuthStatus(function(){cloudCart1.updateProDetail(itemNo,cmmdtyCode,shopCode,cidString,_that)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){cloudCart1.updateProDetail(itemNo,cmmdtyCode,shopCode,cidString,_that)})}else{cloudCart1.updateProDetail(itemNo,cmmdtyCode,shopCode,cidString,_that)}})});$(document).on("click",".edit-select .more",function(){var _this=$(this),ddBox=_this.prev(),height;if(_this.parent().hasClass("proinfo-color")){height=100}else{height=70}if(_this.hasClass("more-expand")){_this.find("span").text("更多");_this.removeClass("more-expand");ddBox.addClass("collapse");ddBox.css("height",height)}else{_this.addClass("more-expand");_this.find("span").text("收起");ddBox.removeClass("collapse");ddBox.css("height","auto")}})},effect:function(){$(document).on("mouseenter",".ui-tooltip .edit-select ul li",function(){$(this).addClass("hover")});$(document).on("mouseleave",".ui-tooltip .edit-select ul li",function(){$(this).removeClass("hover")});$(document).on("click",".ui-tooltip .edit-select ul li",function(){if($(this).hasClass("disabled")){return}$(this).addClass("selected").siblings().removeClass("selected");var ddsize=$(this).parents(".edit-select").find(".proinfo-buytype").length;if(ddsize==2&&$(this).closest("dl").index()==0){var shopCode=$(this).parents(".edit-select").find(".edit-confirm").attr("shopcode"),cmmdtyCode=$(this).parents(".edit-select").find(".edit-confirm").attr("cmmdtyCode");var map=specsMap[shopCode+"-"+cmmdtyCode];var cid1=$($(this).parents(".edit-select").find(".proinfo-buytype")[0]).find(".selected").attr("cid");var lis=$($(this).parents(".edit-select").find(".proinfo-buytype")[1]).find("li"),lisize=lis.length;for(var i=0;i<lisize;i++){$(lis[i]).removeClass();var cid=cid1+$(lis[i]).attr("cid");if(map[cid]==""||map[cid]==null||typeof(map[cid])=="undefined"){$(lis[i]).addClass("disabled")}}}var checksize=$(this).parents(".edit-select").find(".selected").length;if(ddsize!=checksize){$(this).parents(".edit-select").find(".edit-confirm").addClass("edit-disable")}else{$(this).parents(".edit-select").find(".edit-confirm").removeClass("edit-disable")}})}},hoverOpt:{init:function(){this.addCart();$(document).on("mouseenter",".item,.suit",function(){var _that=$(this);_that.addClass("opt-hover")});$(document).on("mouseleave",".item,.suit",function(){var _that=$(this);if(_that.hasClass("opt-hover")){if(_that.find(".alike-click-on").length==0&&_that.find(".del-click-on").length==0){_that.removeClass("opt-hover")}}});st.tooltipNew.run({selector:".tip-look-alike",type:"click",node:"#alikePro",placement:"bottom",closeBtn:1,openFn:function(options,tipDom,targetDom,tipFn){targetDom.addClass("alike-click-on");tipDom.find(".ui-tooltip-inner").css("width","185px");tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipLoad);cloudCart1.hoverOpt.querySimilarCmmdty(options,tipDom,targetDom,tipFn)},closeFn:function(tipDom,targetDom,tipFn){targetDom.removeClass("alike-click-on")}})},querySimilarCmmdty:function(options,tipDom,targetDom,tipFn){var custNum=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var u="";if(typeof custNum!="undefined"&&custNum&&custNum!="undefined"){u=u+custNum}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}var recommendDomain="//tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp?";var cityId=cloudCart1.getCityCode();var topObject=targetDom.parent(".td-op");var cmmdtyCode=topObject.attr("cmmdtyCode");var recommendURL=recommendDomain+"u="+u+"&c="+c+"&parameter="+cmmdtyCode+"&cityId="+cityId+"&sceneIds=1-30&count=20";$.ajax({type:"get",url:recommendURL,dataType:"jsonp",cache:true,success:function(data){similarCmmdty_jsonpCallback(data,options,tipDom,targetDom,tipFn);cartListLoop.listloop({wrap:".ui-tooltip .J-alike-pro",loopBox:".list-box",step:{wide:5,narrow:4},scrollWidth:{wide:1150,narrow:968},hasLabel:true,isRandom:false})}})},addCart:function(){$(document).on("click",".ui-tooltip .J-alike-pro .add-cart",function(){var that=$(this);var cmmdtyCode=that.attr("cmmdtyCode");var shopCode=that.attr("shopCode");querySimilarAddCart("05","01","",cmmdtyCode,shopCode,1,"",that)})}},cartRemoved:{tpl:{tipLoad:"<p class='message' style='padding: 4px 6px;'><i class='l tip-icon loading-message mr5' style='padding-left:0;'></i><span>正在努力加载，请稍后...</span></p>",tipError:"<p class='message c-error' style='padding: 4px 6px;'><i class='tip-icon tip-error mr5 l'></i><span>操作失败，请重新操作</span></p>",tipEmpty:"<p class='message c-error' style='padding: 4px 6px;'><i class='tip-icon tip-error mr5 l'></i><span>真抱歉，暂时还没有凑单商品哦</span></p>"},addCart:function(options,tipDom,targetDom,tipFn){var _this=this;tipDom.find(".ui-tooltip-inner").html(_this.tpl.tipLoad);_this.loadData(options,tipDom,targetDom,tipFn)},loadData:function(options,tipDom,targetDom,tipFn){var againBuyClickTag=targetDom.attr("againBuyClickTag");var cmmdtyArray=cartRemovedObject[againBuyClickTag];againBuy(cmmdtyArray,tipDom,targetDom)},addRepurchase:function(html){var _this=this;var dRepurchaseBox=$(".repurchase-box");if(dRepurchaseBox.length<=0){_this.getRepurchaseBoxFrame();dRepurchaseBox=$(".repurchase-box")}if(dRepurchaseBox.is(":hidden")){dRepurchaseBox.show()}dRepurchaseBox.find(".tool-area-content-box").append(html);if(dRepurchaseBox.find(".repurchase-product").length>5){dRepurchaseBox.addClass("tool-area-box-has-more-btn");if(_this.setHeight==0){_this.setHeight=1;dRepurchaseBox.find(".tool-area-content-box").css({height:132})}}},setHeight:0,getRepurchaseBoxFrame:function(){$(".cart-wrapper").after('<div class="tool-area-box repurchase-box clearfix wrapper"><p class="tool-area-bank">已删除商品，您可以撤销删除或移入收藏：</p><div class="tool-area-content-box clearfix"></div><div class="more-content arrow-down">显示全部商品<i class="arrow"></i></div></div>');var dRepurchaseBox=$(".repurchase-box");dRepurchaseBox.on("click",".more-content",function(){var _that=$(this);if(_that.hasClass("arrow-down")){_that.removeClass("arrow-down").addClass("arrow-up").html('收起部分商品<i class="arrow"></i>');dRepurchaseBox.find(".tool-area-content-box").css({height:dRepurchaseBox.find(".repurchase-product").length*26})}else{if(_that.hasClass("arrow-up")){_that.removeClass("arrow-up").addClass("arrow-down").html('显示全部商品<i class="arrow"></i>');dRepurchaseBox.find(".tool-area-content-box").css({height:132})}}})},reomveRepurchaseBoxProduct:function(targetDom){var dRepurchaseBox=$(".repurchase-box");targetDom.closest(".repurchase-product").remove();var productLen=dRepurchaseBox.find(".repurchase-product").length;if(productLen<5&&dRepurchaseBox.find(".arrow").is(":visible")){dRepurchaseBox.find(".tool-area-content-box").css({height:"auto"});dRepurchaseBox.removeClass("tool-area-box-has-more-btn")}if(productLen<=0){dRepurchaseBox.hide()}}},sunPackage:{init:function(tipDom){this.optionInit(tipDom);this.dropDown(tipDom)},getData:function(){},optionInit:function(tipDom){var $selectTxt=tipDom.find(".select-txt");$selectTxt.each(function(){var $this=$(this),$item=$this.closest(".singleItem-wrap"),$optionWap=$item.find(".select-option"),optionlen=$optionWap.find("li").length;if(optionlen>1){$item.find(".icon-dropdown").show()}else{$item.find(".icon-dropdown").hide()}if($this.find("span").length==0){var seltxt=$optionWap.find("li:first").html();$this.html(seltxt)}});if(tipDom.find(".sun-package-select").find(".sun-package-selectbox.selectedbox").length>0){tipDom.find(".sun-package-select").find(".cart-btn").removeClass("cart-btn-disable")}else{tipDom.find(".sun-package-select").find(".cart-btn").addClass("cart-btn-disable")}},dropDown:function(tipDom){var $selectBox=tipDom.find(".sun-package-selectbox"),$ck=tipDom.find(".ck"),$selectOption=$selectBox.find(".select-option li"),that=this;$selectBox.on("click",function(event){event.stopPropagation();var $this=$(this),optionlen=$this.find(".select-option li").length;if(optionlen<=1){$this.addClass("selectedbox")}that.closeList($selectBox.not($this));if(tipDom.find(".sun-package-select").find(".sun-package-selectbox.selectedbox").length>0){tipDom.find(".sun-package-select").find(".cart-btn").removeClass("cart-btn-disable")}else{tipDom.find(".sun-package-select").find(".cart-btn").addClass("cart-btn-disable")}});$selectBox.mouseover(function(event){event.stopPropagation();var $this=$(this),optionlen=$this.find(".select-option li").length;if(optionlen>1){$this.css("z-index",9);$this.addClass("selectedbox-open")}if(tipDom.find(".sun-package-select").find(".sun-package-selectbox.selectedbox").length>0){tipDom.find(".sun-package-select").find(".cart-btn").removeClass("cart-btn-disable")}else{tipDom.find(".sun-package-select").find(".cart-btn").addClass("cart-btn-disable")}that.closeList($selectBox.not($this))}).mouseleave(function(event){event.stopPropagation();var $this=$(this),optionlen=$this.find(".select-option li").length;if(optionlen>1){$this.css("z-index",9);$this.removeClass("selectedbox-open")}});$selectOption.on("click",function(event){event.stopPropagation();var $this=$(this),seltxt=$this.html(),$wrap=$(this).parent().parent();$wrap.find(".select-txt").html(seltxt);$(this).parents(".sun-package-select").find(".warning-text").html("");$wrap.removeClass("selectedbox-open");$wrap.addClass("selectedbox");if(tipDom.find(".sun-package-select").find(".sun-package-selectbox.selectedbox").length>0){tipDom.find(".sun-package-select").find(".cart-btn").removeClass("cart-btn-disable")}else{tipDom.find(".sun-package-select").find(".cart-btn").addClass("cart-btn-disable")}});$ck.on("click",function(event){event.stopPropagation();var dSunPackageSelectbox=$(this).closest(".sun-package-selectbox");dSunPackageSelectbox.toggleClass("selectedbox");$(this).parents(".sun-package-select").find(".warning-text").html("");that.closeList(dSunPackageSelectbox);if(tipDom.find(".sun-package-select").find(".sun-package-selectbox.selectedbox").length>0){tipDom.find(".sun-package-select").find(".cart-btn").removeClass("cart-btn-disable")}else{tipDom.find(".sun-package-select").find(".cart-btn").addClass("cart-btn-disable")}});$selectOption.mouseover(function(){$(this).addClass("hover")}).mouseleave(function(){$(this).removeClass("hover")});if(this.initReady==0){this.initReady=1;$(document).click(function(event){var eo=$(event.target);if(eo.attr("class")!="sun-package-selectbox"){that.closeList($(".sun-package-selectbox"))}})}},initReady:0,closeList:function(dom){dom.removeClass("selectedbox-open").css({"z-index":8})},sunPackageClickInit:function(){$(document).on("click",".ui-tooltip-inner .clearfix .cart-btn.r",function(event){event.stopPropagation();var cmmdtyItemNo=$(this).attr("cmmdtyItemNo");var sunpackageObject=$(this).parents(".sun-package-select");var selectedObject=sunpackageObject.find(".selectedbox .select-txt .sunprd-name");if(selectedObject.length==0){$(this).siblings(".warning-text").html("").html("<i class='tip-icon tip-error-16'></i>请至少选择一种服务").show();return}var warrentyArray=[];var serveCodeArray=[];selectedObject.each(function(){if($(this).attr("itemLabel")==="yb"){var supplierCode=$(this).attr("supplierCode");var cmmdtyQty=$(this).attr("cmmdtyQty");var cmmdtyCode=$(this).attr("cmmdtyCode");warrentyArray.push(supplierCode+"-"+cmmdtyQty+"-"+cmmdtyCode)}else{var cmmdtyQty=$(this).attr("cmmdtyQty");var cmmdtyCode=$(this).attr("cmmdtyCode");serveCodeArray.push(cmmdtyQty+"-"+cmmdtyCode)}});addWarranty(cmmdtyItemNo,warrentyArray,this,serveCodeArray)})}},fixBottom:function(){var cartBarBox=$(".cart-toolbar-box"),_that=this;if(cartBarBox.length==0){return}if($.browser.version!="6.0"&&_that.fixBottomIsBind==0){_that.fixBottomIsBind=1;$(window).on("scroll",function(){_that.judeFixBottom()})}},fixBottomIsBind:0,judeFixBottom:function(cartBar,cartBarTop){var cartBarBox=$(".cart-toolbar-box");if(cartBarBox.length==0){return}var cartBar=cartBarBox.find(".cart-toolbar"),cartBarBoxTop=cartBarBox.offset().top;if($.browser.version!="6.0"){if($(window).scrollTop()>=(cartBarBoxTop-$(window).height()+cartBar.height())){cartBar.removeClass("cart-toolbar-fix")}else{cartBar.addClass("cart-toolbar-fix")}}},snAddressInit:function(){$("#city").mCity({used:true,cityCb:function(data){},distCb:function(data){var cityCode=data.city.lesId;var provinceCode="";var provinceId=data.province.id;if(provinceId.length>2){provinceCode=provinceId}else{provinceCode="0"+provinceId}var districtCode=data.district.lesId;$.ajax({type:"GET",url:"updateCartOneCity.do",async:false,data:{provinceCode:provinceCode,cityCode:cityCode,districtCode:districtCode},success:function(data){}});window.location.href="cart.do"},changeCb:function(data){var cityCode=data.city.lesId;var provinceCode="";var provinceId=data.province.id;if(provinceId>2){provinceCode=provinceId}else{provinceCode="0"+provinceId}var districtCode=data.district.lesId;$.ajax({type:"GET",url:"updateCartOneCity.do",async:false,data:{provinceCode:provinceCode,cityCode:cityCode,districtCode:districtCode},success:function(data){}});window.location.href="cart.do"},getCity:function(data){$("#city").find("#provinceName").addClass("hide");$("#city").find("#districtName").addClass("hide")}})},reload:function(){window.location.href="cart.do"},runAnalyseExpo:function(){if(typeof _analyseExpoTags=="function"){_analyseExpoTags("a")}else{setTimeout(cloudCart1.runAnalyseExpo,1000)}},getAjaxWarranty:function(){if($(".m-store").length>0){var isCertValidStat=$("#isCertValidStat").val()=="true";var isCompany=$("#isCompany").val()=="true";$.ajax({type:"GET",url:"getAjaxWarranty.do",data:{isCertValidStat:isCertValidStat,isCompany:isCompany},dataType:"jsonp",crossDomain:true,success:function(data){var warrantyHtmls=data.warrantyHtmls;if(warrantyHtmls!=""){for(var i=0;i<warrantyHtmls.length;i++){var warrantyHtml=$("<div>"+warrantyHtmls[i]+"</div>");var cmmdtyItemNo=warrantyHtml.find(".cart-btn-ok").attr("cmmdtyItemNo");var cmmdtyObject=$("input[itemNo="+cmmdtyItemNo+"].haoye");var remarkObject=cmmdtyObject.parent().find(".item-remark");var sunpackageObject=cmmdtyObject.closest(".item").find(".sun-package-list");if(sunpackageObject.length>0){warrantyHtml.find(".sun-package-buy").remove()}else{warrantyHtml.find(".sun-package-modify").remove()}if(remarkObject.find(".c9").length>0){remarkObject.html(remarkObject.find(".c9")).append(warrantyHtml.html())}else{remarkObject.html(warrantyHtml.html())}}}}})}},getAjaxFreight:function(){if($(".m-store").length>0){var isCertValidStat=$("#isCertValidStat").val()=="true";var isCompany=$("#isCompany").val()=="true";$.ajax({type:"GET",url:"getAjaxFreight.do",data:{isCertValidStat:isCertValidStat,isCompany:isCompany},dataType:"jsonp",crossDomain:true,success:function(data){var freightHtmls=data.freightHtmls;if(freightHtmls!=""){for(var i=0;i<freightHtmls.length;i++){var freightHtml=$("<div>"+freightHtmls[i]+"</div>");var shopCode=freightHtml.find(".save-ship").attr("shopCode");var meetCutObject=$("#meet-cut-"+shopCode+"");meetCutObject.prevAll("p").remove();meetCutObject.before(freightHtml.html());if(freightHtml.find("em").html()!="0.00"&&shopCode!="0000000000"&&meetCutObject.siblings(".gather").length>0){meetCutObject.siblings(".gather").removeClass("hide")}else{if(shopCode!="0000000000"){meetCutObject.parent(".ship-desc").removeClass("meet-cut-btn")}}}$($(".cart-toolbar .cart-extra-price .sn-price em ")[1]).html(data.deliveryFeeAmount);$(".cart-toolbar .cart-total-price .sn-price ").html("<i>¥</i>"+data.payAmount+"")}var snFreeShippingAmount=data.snFreeShippingAmount;var snShopTotalAmout=$("#snSalesAmount").val();if(typeof snFreeShippingAmount!="undefined"&&snFreeShippingAmount&&snFreeShippingAmount!="undefined"&&typeof snShopTotalAmout!="undefined"&&snShopTotalAmout&&snShopTotalAmout!="undefined"&&parseFloat(snShopTotalAmout)<parseFloat(snFreeShippingAmount)){var needBuy=(parseFloat(snFreeShippingAmount)-parseFloat(snShopTotalAmout)).toFixed(2);$("#meet-cut-0000000000").find(".fare-merge-order .content-title").html("凑满"+snFreeShippingAmount+"元就可以免邮啦，可以更划算哦");$("#meet-cut-0000000000").siblings(".gather").removeClass("hide").find("span").html("还差"+needBuy+"元就可免运费");$("#needBuy").val(needBuy)}else{$("#store-0000000000").find(".ship-desc").removeClass("meet-cut-btn")}}})}},getAjaxGift:function(){if($("#withGifts").length>0&&$("#withGifts").val()==1){var isCertValidStat=$("#isCertValidStat").val()=="true";var isCompany=$("#isCompany").val()=="true";$.ajax({type:"GET",url:"getAjaxGift.do",data:{isCertValidStat:isCertValidStat,isCompany:isCompany},dataType:"jsonp",crossDomain:true,success:function(data){var giftHtmls=data.GiftHtmls;if(giftHtmls!=""){for(var i=0;i<giftHtmls.length;i++){var giftObject=$(giftHtmls[i]);var itemNo=giftObject.attr("itemNo");var cmmdtyObject=$("input[itemNo="+itemNo+"].haoye");var itemExtraObject=cmmdtyObject.parent().siblings(".item-extra");var sunPackageObject=itemExtraObject.find(".sun-package-list");var itemEventObject=itemExtraObject.find(".item-event-list.coupon");if(itemExtraObject.length>0){itemExtraObject.children(":not(.sun-package-list,.item-event-list.coupon)").remove();if(itemEventObject.length>0){giftObject.find(".item-event-list-last").removeClass("item-event-list-last")}if(sunPackageObject.length>0){sunPackageObject.after(giftObject.html())}else{itemExtraObject.prepend(giftObject.html())}}else{cmmdtyObject.parent().parent().append('<div class="item-extra">'+giftObject.html()+"</div>")}}}}})}},changeBuy:{init:function(){this.addChangeProduct()},queryChangeProduct:function(options,tipDom,targetDom,tipFn){var meetSuitObject=targetDom.parents(".meet-suit");var activityId=targetDom.attr("promotionId");var cmmdtyObject=meetSuitObject.find("input.haoye");var shopType=true;cmmdtyObject.each(function(){if($(this).attr("activityType")!="16"){if($(this).attr("shopcode")=="0000000000"){shopType=true}else{shopType=false}return false}});var satisfiedFlag=targetDom.attr("satisfiedFlag");var cmmdtyStr=[];if(satisfiedFlag=="T"){satisfiedFlag="2";var itemId=0;cmmdtyObject.each(function(){if($(this).attr("activityType")!="16"&&$("#"+$(this).attr("itemNo")).is(":checked")){var cmmdtyItem={};cmmdtyItem.itemId=itemId++;cmmdtyItem.partNumber=$(this).attr("cmmdtyCode");cmmdtyItem.sellerNo=$(this).attr("shopCode");cmmdtyItem.productQty=$(this).attr("cmmdtyQty");cmmdtyItem.productListPrice=$("#"+$(this).attr("itemNo")).attr("salesPrice");cmmdtyStr.push(cmmdtyItem)}})}else{satisfiedFlag="1"}$.ajax({type:"POST",url:"//quan.suning.com/queryAddPriceCmmdty.do",data:"activityId="+activityId+"&operaType="+satisfiedFlag+"&channel=1&cityCode="+cloudCart1.getCityCode()+"&cmmdtyListStr="+JSON.stringify(cmmdtyStr),cache:true,dataType:"json",xhrFields:{withCredentials:true},crossDomain:true,success:function(data){if(shopType){changeBuy_jsonpCallback(data,options,tipDom,targetDom,tipFn,activityId)}else{changeBuyCshop_jsonpCallback(data,options,tipDom,targetDom,tipFn,activityId)}var cmmdtyObject=targetDom.parents(".meet-suit").find(".haoye");var cshopBox=tipDom.find(".meet-exchange-cshop");cmmdtyObject.each(function(){var checkObject=$(this);if(checkObject.attr("activityType")=="16"){var changObjects=cshopBox.find("li");if(changObjects.length>0){changObjects.each(function(){if($(this).find("input").attr("cmmdtyCode")==checkObject.attr("cmmdtyCode")){$(this).addClass("item-checked")}})}}});var dParentLI=cshopBox.find("li");var numStr=cshopBox.find(".ff-tahoma").eq(0).text();var checkNum=$.grep(dParentLI,function(e){return $(e).hasClass("item-checked")}).length;if($.isNumeric(numStr)){if(checkNum>=parseInt(numStr)){dParentLI.each(function(){if(!$(this).hasClass("item-checked")){$(this).find(".cart-checkbox input").attr("disabled","disabled");$(this).find(".cart-checkbox label").addClass("label-disable")}})}else{dParentLI.each(function(){$(this).find(".cart-checkbox input").removeAttr("disabled");$(this).find(".cart-checkbox label").removeClass("label-disable")})}if(cshopBox.find(".ff-tahoma").length==2){cshopBox.find(".ff-tahoma").eq(1).text(checkNum)}else{if(cshopBox.find(".ff-tahoma").length==1){cshopBox.find(".content-title").html(cshopBox.find(".content-title").html()+"，已选<span class='c-f60 ff-tahoma'>"+checkNum+"</span>件")}}}},error:function(){},complete:function(XMLHttpRequest,textStatus){}})},addChangeProduct:function(){$(document).on("click",".meet-cut-select .exchange-cart-btn",function(e){e.preventDefault();var _this=$(this);var checkbox=$(".meet-cut-select .pro-checked input");if(_this.closest(".meet-cut-select").hasClass("meet-exchange-cshop")){checkbox=$(".meet-cut-select .item-checked input");if($(checkbox).length==0){st.tooltipNew.allHide();return}}var activityId=$(this).attr("promotionId");var cart={};if($(checkbox).length>0){var cmmdty=new Array();cart.sourcePageType="05";checkbox.each(function(){var cmmdtyCode=$(this).attr("cmmdtyCode");var shopCode=$(this).attr("shopCode");var cmmdtyName=$(this).attr("cmmdtyName");var cmmdtyObjetc={};cmmdtyObjetc.cmmdtyCode=cmmdtyCode;cmmdtyObjetc.shopCode=shopCode;cmmdtyObjetc.activityType="16";cmmdtyObjetc.cmmdtyQty="1";cmmdtyObjetc.activityId=activityId;cmmdty.push(cmmdtyObjetc);cmmdtyObject[cmmdtyCode]=cmmdtyName});cart.cmmdty=cmmdty;gatherAddcart(cart)}})},queryCanChangeBuyProduct:function(options,tipDom,targetDom,tipFn){var cmmdtyCodes=[];var recommendDomain="//tuijian.suning.com/recommend-portal/dyBase.jsonp?";var meetSuitObject=targetDom.parents(".meet-suit");var activityId=targetDom.attr("promotionId");var cityId=cloudCart1.getCityCode();var cmmdtyObject=meetSuitObject.find("input.haoye");var count=1;var vendorId="";cmmdtyObject.each(function(){if($(this).attr("activityType")!="16"){var cmmdtyCode=$(this).attr("cmmdtyCode");vendorId=$(this).attr("shopCode");cmmdtyCodes.push("parameters="+cmmdtyCode);count++}if(count>3){return false}});var parameters=cmmdtyCodes.join("&");if(parameters==""){parameters="parameters="}var recommendURL="";if(vendorId=="0000000000"){recommendURL=recommendDomain+parameters+"&activityId="+activityId+"&cityId="+cityId+"&sceneIds=12-13&count=27"}else{recommendURL=recommendDomain+parameters+"&activityId="+activityId+"&cityId="+cityId+"&sceneIds=4-16&count=27&vendorId="+vendorId}$.ajax({type:"get",url:recommendURL,dataType:"jsonp",cache:true,success:function(data){supportChangeBuy_jsonpCallback(data,options,tipDom,targetDom,tipFn)}})}},getCityCode:function(){var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}if(cityId==null){cityId="010"}return cityId},jugeQuickChangeOrReChange:function(){var changeBuyObject=$(".meet-suit .meet-exchange-cshop");changeBuyObject.each(function(){if($($(this).parents(".meet-suit").find(".haoye")[0]).attr("activityType")=="16"){$($(this).parents(".meet-suit").find(".meet-exchange")[1]).show();$($(this).parents(".meet-suit").find(".meet-exchange")[0]).remove()}else{$($(this).parents(".meet-suit").find(".meet-exchange")[0]).show();$($(this).parents(".meet-suit").find(".meet-exchange")[1]).remove()}})},getAjaxCoupon:function(){var storeList=$(".m-cart-body").find(".m-store");if($(storeList).length>0){var cityId=this.getCityCode();var arr=[];for(var i=0;i<$(storeList).length;i++){var storeInfo=$(storeList)[i];var itemList=$(storeInfo).find("input.haoye");for(var j=0;j<$(itemList).length;j++){var item=$(itemList)[j];var activityType=$(item).attr("activityType");if(typeof $(item).attr("itemOverdue")=="undefined"||$(item).attr("itemOverdue")!="0"||activityType==="16"){continue}var itemJson={};itemJson.storeId=$(item).attr("shopCode");itemJson.productId=$(item).attr("cmmdtyCode");itemJson.activityType=activityType;itemJson.subActivityType=$(item).attr("subActivityType");itemJson.overSeasFlag=$(item).attr("overSeasFlag");if((itemJson.activityType=="02"&&itemJson.subActivityType=="14")||(itemJson.overSeasFlag=="927HWG"&&itemJson.storeId=="0000000000")){itemJson.supplierCode=$(item).attr("supplierCode")}else{itemJson.supplierCode=""}arr.push(itemJson)}}if(arr.length==0){return}var queryVO=new Object();queryVO.cityId=cityId;queryVO.productList=arr;$.ajax({type:"POST",url:"getAjaxCoupon.do",data:JSON.stringify(queryVO),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var couponHtmls=data.couponHtmls;if(couponHtmls!=""){for(var i=0;i<couponHtmls.length;i++){var couponObject=$(couponHtmls[i]);var shopCode=couponObject.attr("shopCode");var storeObject;if(shopCode=="0000000000"){storeObject=$("#store-"+shopCode).find("b")[0];couponObject.find(".pro-list-show").each(function(){var $that=$(this);$that.find("img").each(function(){var imgItem=$(this);var cmmdtyName="";var cmmdtyCode=imgItem.attr("cmmdtyCode");var shopCode=imgItem.attr("shopCode");$("#store-"+shopCode+"-tm").find(".item-info").each(function(){var cmmdtyObject=$(this);if(cmmdtyObject.find("a").attr("cmmdtyCode")==cmmdtyCode){cmmdtyName=cmmdtyObject.find("a").attr("cmmdtyname");return}});imgItem.attr("alt",cmmdtyName);imgItem.attr("title",cmmdtyName)})})}else{if(shopCode=="0000000000-tm"||$("#store-"+shopCode+" .mrfresh-icon").length>0){storeObject=$("#store-"+shopCode).find("a")[2]}else{storeObject=$("#store-"+shopCode).find("a")[1]}}couponObject.find(".pro-list-show").each(function(){var $that=$(this);$that.find("img").each(function(){var imgItem=$(this);var cmmdtyName="";var cmmdtyCode=imgItem.attr("cmmdtyCode");var shopCode=imgItem.attr("shopCode");$("#store-"+shopCode).find(".item-info").each(function(){var cmmdtyObject=$(this);if(cmmdtyObject.find("a").attr("cmmdtyCode")==cmmdtyCode){cmmdtyName=cmmdtyObject.find("a").attr("cmmdtyname");return}});imgItem.attr("alt",cmmdtyName);imgItem.attr("title",cmmdtyName)})});$(storeObject).after(couponObject.html())}}}})}},getAjaxPcssLabel:function(){var pcssSwitch=$("#pcssSwitch").val();if(pcssSwitch!="1"){return}var storeList=$(".m-cart-body").find(".m-store");if($(storeList).length>0){var arr=[];for(var i=0;i<$(storeList).length;i++){var storeInfo=$(storeList)[i];var itemList=$(storeInfo).find("input.haoye");for(var j=0;j<$(itemList).length;j++){var item=$(itemList)[j];var itemJson={};itemJson.supplierCode=$(item).attr("shopCode");itemJson.cmmdtyCode=$(item).attr("cmmdtyCode");itemJson.labelScene="05";itemJson.channel="PC";arr.push(itemJson)}}var tempArr=[];if(arr.length>10){var arrPer=(arr.length-arr.length%10)/10+1;for(var m=0;m<arrPer;m++){var preTemp=arr.slice(m*10,(m+1)*10);if(preTemp.length>0){tempArr.push(preTemp)}}}else{tempArr.push(arr)}for(var j=0;j<tempArr.length;j++){$.ajax({type:"GET",url:"//pcsslabel.suning.cn/pcss-web/label/poplabels.do",dataType:"jsonp",callback:"callback",data:{params:JSON.stringify(tempArr[j])},success:function(data){if(data&&data.length>0){for(var x=0;x<data.length;x++){if(data[x].labelList&&data[x].labelList.length>0){for(var y=0;y<data[x].labelList.length;y++){var imgurl=data[x].labelList[y].labelPath;var imgSize=[];if(data[x].labelList[y].labelPixel){imgSize=data[x].labelList[y].labelPixel.split("x")}if(imgSize.length==2&&parseInt(imgSize[0])<100&&parseInt(imgSize[1])<100){if(imgurl&&imgurl.length>4){var imgObj="<img class='pcsslabel-img-2' src = '"+imgurl.replace("http:","")+"' />";var cmmdtyObj=$("#store-"+data[x].supplierCode).find("input[cmmdtycode="+data[x].cmmdtyCode+"]")[0];$($(cmmdtyObj).parent()[0]).find("img[class^=pcsslabel-img-]").remove();$($(cmmdtyObj).parent()[0]).find("img").before(imgObj);var tmCmmdtyObj=$("#store-"+data[x].supplierCode+"-tm").find("input[cmmdtycode="+data[x].cmmdtyCode+"]")[0];$($(tmCmmdtyObj).parent()[0]).find("img[class^=pcsslabel-img-]").remove();$($(tmCmmdtyObj).parent()[0]).find("img").before(imgObj);break}}}}}}}})}}},advertisingInit:function(){$.ajax({type:"get",url:"//lib.suning.com/api/jsonp/pcCart1.jsonp",dataType:"jsonp",callback:"cmsCallback",success:function(data){}})},login:function(){$(document).on("click","#cart-one-delivery .login-btn",function(){ensureLogin(function(){window.location.href="cart.do"})});$(document).on("click",".link-btn.cart-btn",function(){ensureLogin(function(){window.location.href="cart.do"})})},fullCut:function(){var actType="",actId="";$(".meet-suit").each(function(){var promotionType=$(this).attr("promotionType");var promotionId=$(this).attr("promotionId");if(promotionType=="5"){if(actId.indexOf(promotionId)==-1){if(actType==""){actType="4";actId=promotionId}else{actType=actType+",4";actId=actId+","+promotionId}}}});if(actType!=""&&actId!=""){var url="//quan.suning.com/search/getActUrl/"+actType+"_"+actId+"_1_quanCallBack.htm";$.ajax({type:"get",url:url,dataType:"jsonp",success:function(data){}})}var cActType="",cActId="";$(".tool-area-box .all-store-discount-content").each(function(){var promotionType=$(this).attr("promotionType");var promotionId=$(this).attr("promotionId");if(promotionType=="5"){if(cActType==""){cActType="4";cActId=promotionId}else{cActType=cActType+",4";cActId=cActId+","+promotionId}}});if(cActType!=""&&cActId!=""){var url="//quan.suning.com/search/getActUrl/"+cActType+"_"+cActId+"_1_cquanCallBack.htm";$.ajax({type:"get",url:url,dataType:"jsonp",success:function(data){}})}},lazyQueryProduct:function(){lazyelem.listen("div[data-sku]","fn",function(object){cmmdtyDOM.push(object);cloudCart1.queryProductDetail(object)})},controlTaxFareDisplay:function(){var cmmdtyObject=$("div.item,div.suit");var hasHWGProduct=false;cmmdtyObject.each(function(){if($(this).parents(".m-store").find(".abroad-store-icon").length>0&&$(this).find(".chk-item").prop("checked")){$($(".cart-extra-price:not(.mr20)")[1]).remove();$($(".cart-extra-price:not(.mr20)")).show();hasHWGProduct=true}});if(hasHWGProduct){$("#totalName").html("总价（含运费、税费）：")}},queryProductDetail:function(obj){var carShopSerWay=$(obj).find(".haoye").attr("carShopSerWay");if(typeof carShopSerWay!="undefined"&&carShopSerWay!=""){return}var cmmdtyCode=$(obj).find(".haoye").attr("cmmdtyCode");var shopCode=$(obj).find(".haoye").attr("shopCode");$.ajax({type:"GET",url:"getProductDetail.html",data:{cmmdtyCode:cmmdtyCode,shopCode:shopCode,queryFlag:"1"},cache:true,dataType:"json",success:function(data){if(data!=null&&data.data&&data.data.cmmdtyCode!=null&&data.data.eigenvalueVOList.length>0){var cmmdtyCode=data.data.cmmdtyCode;var shopCode=data.data.shopCode;$(".haoye").each(function(){if($(this).attr("cmmdtyCode")==cmmdtyCode&&$(this).attr("shopCode")==shopCode){specsMap[shopCode+"-"+cmmdtyCode]=data.data.characterIdMap;var itemNo=$(this).attr("itemNo");$(this).parent().find(".td-specs").html("");var specslinehtml="";for(var i=0;i<data.data.eigenvalueVOList.length;i++){specslinehtml+='<div class="specs-line"><p title="'+data.data.eigenvalueVOList[i].eigenvalueDisplay+'">'+data.data.eigenvalueVOList[i].eigenvalue+"："+data.data.eigenvalueVOList[i].eigenvalueDisplay+"</p></div>"}var modifyHtml="";if($(this).parents(".item").length==1&&data.data.eigenValueList1.length>0){$(this).parents(".item").addClass("item-specs-can");var eigenName="";for(var i=0;i<data.data.eigenValueList1.length;i++){eigenName=data.data.eigenValueList1[i].eigenvalue;modifyHtml+='<li title="'+data.data.eigenValueList1[i].eigenvalueDisplay+'" ';if(data.data.eigenValueList1[i].checkFlag=="1"){modifyHtml+='class="selected"'}modifyHtml+=' cid="'+data.data.eigenValueList1[i].characterId+'"><a href="javascript:void(0);">'+data.data.eigenValueList1[i].eigenvalueDisplay+"<i></i></a></li>"}modifyHtml='<div id="editSelect-'+cmmdtyCode+"-"+shopCode+'" class="hide"><div class="edit-select"><dl class="proinfo-buytype clearfix"><dt><span>'+eigenName+"</span></dt><dd><ul>"+modifyHtml+"</ul></dd></dl>";var modifyHtml2="";if(data.data.eigenValueList2&&data.data.eigenValueList2.length>0){for(var i=0;i<data.data.eigenValueList2.length;i++){eigenName=data.data.eigenValueList2[i].eigenvalue;modifyHtml2+='<li title="'+data.data.eigenValueList2[i].eigenvalueDisplay+'" ';if(data.data.eigenValueList2[i].checkFlag=="1"){modifyHtml2+='class="selected"'}modifyHtml2+=' cid="'+data.data.eigenValueList2[i].characterId+'"><a href="javascript:void(0);">'+data.data.eigenValueList2[i].eigenvalueDisplay+"<i></i></a></li>"}modifyHtml2='<dl class="proinfo-buytype clearfix"><dt><span>'+eigenName+"</span></dt><dd><ul>"+modifyHtml2+"</dd></dl>"}modifyHtml+=modifyHtml2+'<div class="edit-btn"><a href="javascript:void(0);" itemNo='+itemNo+" cmmdtyCode="+cmmdtyCode+" shopCode="+shopCode+' class="edit-post edit-confirm"  name="icart1_prod_change_confirm">确定</a><a href="javascript:void(0);" class="edit-cancel" name="icart1_prod_change_cancel">取消</a></div></div></div>'}$(this).parent().find(".td-specs").html(specslinehtml+modifyHtml)}})}},error:function(){},complete:function(XMLHttpRequest,textStatus){}})},queryAllPrice:function(shopCode,cmmdtyCode){var map=specsMap[shopCode+"-"+cmmdtyCode];if(typeof(map)=="undefined"){return false}var cmmdList=[];for(var key in map){cmmdList.push(map[key]+"|"+shopCode)}var str=cmmdList.join("-");if(str==""){return false}$.ajax({type:"POST",url:"queryAllPrice.do",data:{cityCode:cloudCart1.getCityCode(),cmmdtyCodes:str},async:false,dataType:"json",success:function(data){if(data&&data.code=="1"&&data.data&&data.data.prodList&&data.data.prodList.length>0){var tempMap={};var canBuyList=[];for(var prodItem in data.data.prodList){if(data.data.prodList[prodItem]&&data.data.prodList[prodItem].status=="1"){canBuyList.push(data.data.prodList[prodItem].cmmdtyCode)}}if(canBuyList.length==0){specsMap[shopCode+"-"+cmmdtyCode]={}}else{for(var key in map){if($.inArray(map[key],canBuyList)>-1){tempMap[key]=map[key]}}specsMap[shopCode+"-"+cmmdtyCode]=tempMap}}else{specsMap[shopCode+"-"+cmmdtyCode]={}}},error:function(){},complete:function(XMLHttpRequest,textStatus){}})},updateProDetail:function(itemNo,cmmdtyCode,shopCode,cid,_that){var map=specsMap[shopCode+"-"+cmmdtyCode];var endCmmdtyCode="";if(typeof(map)=="undefined"||map[cid]==""||map[cid]==null||typeof(map[cid])=="undefined"){st.tooltipNew.allHide();return false}else{endCmmdtyCode=map[cid]}if(endCmmdtyCode==""||typeof(endCmmdtyCode)=="undefined"||cmmdtyCode==endCmmdtyCode){st.tooltipNew.allHide();return false}$.ajax({type:"GET",url:"updateCartOneItemDetail.do",data:{loginSign:$("#loginSign").val(),updateDetailCmmdty:itemNo+"-"+endCmmdtyCode},cache:true,dataType:"json",success:function(data){if(data.sameResult&&data.sameResult=="prodSameError"){_that.parents(".edit-select").find(".edit-error-message").remove();var errorDom='<div class="edit-error-message"><span><i class="tip-icon tip-error-12"></i>购物车中已有相同商品</span></div>';_that.parent().before(errorDom);return false}if(data.result=="false"){st.tooltipNew.allHide();return false}cloudCart1.refreshPage(data);st.tooltipNew.allHide()},error:function(jqXHR,textStatus,errorThrown){st.tooltipNew.allHide()},complete:function(XMLHttpRequest,textStatus){_that.addClass("edit-post")}})},queryUsableCouponList:function(){$.ajax({type:"post",url:"queryCouponList.do",data:cloudCart1.packCartOneParamForCoupon(),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){if(data.returnCode=="Y"){$(".coupon-autouse").show();var $couponObject=$(data.html);$("#autouse").html($couponObject);if(data.tipMsg=="undefined"||data.tipMsg==null||data.tipMsg==""){$(".now-select-coupon").find("b").html(data.couponNum);$("#bestNum_auto").show();$(".now-select-coupon").find(".sn-price em").html(data.couponTotalMoney).show();$("#coupTotal_auto").show();$("#cart1PayAmount").html(data.sumMoney);$(".now-select-coupon").attr("name","icart1_coupon_hengfu_rukou")}else{$(".now-select-coupon").attr("name","icart1_coupon_jinerbuzu");var msg="您有<span class='c-f60'>"+data.tipMsg+"</span>优惠券还差<span class='c-f60'>"+data.distanceValue+"</span>元可用";$("#tipMsg_auto").html(msg).show()}}},error:function(){}})},commonFunction:{isEmpty:function(str){var temp=$.trim(str);return(typeof temp==="undefined")||(temp==="")||(temp.length===0)}}};cloudCart1.recommendFn={currentPage:1,pageSize:$("body").hasClass("root1200")?10:8,init:function(){var dCartRecommend=$(".cart-recommend");dCartRecommend.addClass("cart-recommend-auto");dCartRecommend.find(".recommend-body").addClass("recommend-body-rd");dCartRecommend.find(".recommend-name-box").eq(0).addClass("active");dCartRecommend.find(".recommend-box").eq(0).addClass("active");var liLen=dCartRecommend.find(".recommend-box").eq(0).find("li").length;if(liLen>cloudCart1.recommendFn.pageSize){$(".tj-arr").show()}else{$(".tj-arr").hide()}this.bindTab();this.addCart();this.arrChange();this.autoList();this.pageOpt()},bindTab:function(){var _this=this;var dCartRecommend=$(".cart-recommend");dCartRecommend.find(".recommend-name").hover(function(){cloudCart1.recommendFn.currentPage=1;var dom=$(this);clearTimeout(_this.hoverTimeout);_this.hoverTimeout=setTimeout(function(){var dParent=dom.parent(".recommend-name-box");dRd=dParent.closest(".cart-recommend"),dRdBody=dRd.find(".recommend-body");if(dParent.index()==0){dRd.addClass("cart-recommend-auto");dRdBody.addClass("recommend-body-rd")}else{dRd.removeClass("cart-recommend-auto");dRdBody.removeClass("recommend-body-rd")}var liLen=dCartRecommend.find(".recommend-box").eq(dParent.index()).find("li").length;if(liLen>cloudCart1.recommendFn.pageSize){$(".tj-arr").show()}else{$(".tj-arr").hide()}dParent.addClass("active").siblings().removeClass("active");dCartRecommend.find(".recommend-box").eq(dParent.index()).addClass("active").siblings().removeClass("active");lazyelem.detect()},200);var tabname=dom.attr("name");if(("icart1_recom_handtab"==tabname||"icart1_recom_favorittab"==tabname||"icart1_recom_tab02"==tabname)&&"recommend-name-box"==dom.parent(".recommend-name-box").attr("class")){sa.click.sendDatasIndex(this)}},function(){clearTimeout(_this.hoverTimeout)});var timer_dislike;timer_dislike=setTimeout(function(){dCartRecommend.find(".unlikeSign").mouseenter(function(){var _that=$(this),_dislike='<span name="icart1_recom_ favorittab_unlike" class="dislike">不喜欢</span>';_that.find(".unlikeASign").append(_dislike).on("click",".dislike",function(){var self=$(this);var cmmdtycode=self.parent().attr("cmmdtycode");_that.fadeOut(300,function(){unlike.sendUnlike(cmmdtycode);sa.click.sendDatasIndex(self[0]);var currentBox=$(".recommend-box.active");currentBox.find(".product-box:visible").last().next().show();_that.remove();var curLen=currentBox.find(".product-box").length;var pagecount=Math.ceil(curLen/_this.pageSize);if(currentBox.find(".product-box:visible").length==0){if(currentBox.is(".recommend-box-auto")){$(".recommend-body .page-list .current").prev().addClass("current").end().remove()}currentBox.find(".product-box:not(:lt("+((pagecount-1)*_this.pageSize)+"))").show()}if(currentBox.is(".recommend-box-auto")&&$(".recommend-body .page-list li").length>pagecount){$(".recommend-body .page-list li").last().remove()}lazyelem.detect()});return false})})},200);dCartRecommend.find(".unlikeSign").mouseleave(function(){var _that=$(this);_that.find(".unlikeASign .dislike").remove();clearTimeout(timer_dislike)})},hoverTimeout:"",addCart:function(){var dCartRecommend=$(".cart-recommend");dCartRecommend.delegate(".add-cart","click",function(){var that=$(this);var cmmdtyCode=that.attr("cmmdtyCode");var shopCode=that.attr("shopCode");recommendAddCart("05","01","",cmmdtyCode,shopCode,1,"",that)})},successFn:function(domThis){var thisPosition=domThis.position();var html=$('<div class="add-num"></div>');$(domThis).after(html);html.css({display:"block",top:thisPosition.top-html.height()+domThis.height()/2,left:thisPosition.left+domThis.width()/2-html.width()/2}).animate({top:thisPosition.top-html.height(),opacity:0},500,function(){$(this).remove()})},errorFn:function(domThis,message){var thisPosition=domThis.position();var message=message||"操作失败，请重新操作...";var html=$('<div class="cart-recommend-tooltip"><div class="ui-tooltip-arrow"><i class="ui-tooltip-arrow-front">◆</i><i class="ui-tooltip-arrow-back">◆</i></div><div class="ui-tooltip-inner"><p style="color:red;"><i class="l tip-icon tip-error mr5"></i>'+message+"</p></div></div>");$(domThis).after(html);html.fadeOut(2000,function(){$(this).remove()})},changeAlot:function(){var currentTitle=$(".recommend-header .active"),_index=currentTitle.index(),currentBox=$(".recommend-body .recommend-box").eq(_index),currentLi=currentBox.find(".product-box"),pageSize=$("body").hasClass("root1200")?10:8,liLen=currentLi.length,totalPage=Math.ceil(liLen/pageSize);if(totalPage<=1){return}cloudCart1.recommendFn.currentPage+=1;cloudCart1.recommendFn.currentPage=cloudCart1.recommendFn.currentPage>totalPage?1:cloudCart1.recommendFn.currentPage;currentBox.attr("current-page",cloudCart1.recommendFn.currentPage);currentLi.hide();var startBlock=(cloudCart1.recommendFn.currentPage-1)*cloudCart1.recommendFn.pageSize,endBlock=cloudCart1.recommendFn.currentPage*cloudCart1.recommendFn.pageSize;for(var i=startBlock;i<endBlock;i++){currentLi.eq(i).show()}lazyelem.detect();this.pageCurrent()},arrChange:function(){var that=this;$(".tj-arr-prev").click(function(){that.changeAlot()});$(".tj-arr-next").click(function(){that.changeAlot()})},autoList:function(){var cartRd=$(".cart-recommend");var pageList=$(".cart-recommend .page-list ul"),liLen=$(".cart-recommend .recommend-box").eq(0).find("li").length;var the=this;var totalPage=Math.ceil(liLen/cloudCart1.recommendFn.pageSize);if(totalPage>1){var pageLi=[];for(var i=0;i<totalPage;i++){pageLi.push("<li></li>")}pageList.html(pageLi.join(""));var curPage=pageList.find("li").eq(cloudCart1.recommendFn.currentPage-1);curPage.addClass("current").siblings("li").removeClass("current");this.autoStart(totalPage);cartRd.hover(function(){the.autoPause()},function(){the.autoStart(totalPage)})}},pageCurrent:function(){var pageList=$(".cart-recommend .page-list ul"),curPage=pageList.find("li").eq(cloudCart1.recommendFn.currentPage-1);curPage.addClass("current").siblings("li").removeClass("current")},pageOpt:function(){var that=this;var pagerLi=$(".cart-recommend .page-list li");pagerLi.hover(function(){cloudCart1.recommendFn.currentPage=parseInt($(this).index()+1);timer=setTimeout(function(){that.liShow()},200)},function(){clearTimeout(timer)})},autoStart:function(totalPage){var the=this;this.timer=setInterval(function(){cloudCart1.recommendFn.currentPage+=1;cloudCart1.recommendFn.currentPage=cloudCart1.recommendFn.currentPage>totalPage?1:cloudCart1.recommendFn.currentPage;the.liShow()},5000)},autoPause:function(){clearInterval(this.timer)},liShow:function(){var currentLi=$(".recommend-box-auto .product-box");var startBlock=(cloudCart1.recommendFn.currentPage-1)*cloudCart1.recommendFn.pageSize,endBlock=cloudCart1.recommendFn.currentPage*cloudCart1.recommendFn.pageSize;$(".recommend-box-auto").attr("current-page",cloudCart1.recommendFn.currentPage);currentLi.hide();for(var i=startBlock;i<endBlock;i++){currentLi.eq(i).show()}lazyelem.detect();this.pageCurrent()}};cloudCart1.addFavFn={run:function(options,tipDom,targetDom,tipFn){var _this=this;tipDom.find(".ui-tooltip-inner").html(_this.messageList.move)},messageList:{begin:"<p class='message' style='width:101px;padding: 4px 8px;'><i class='l tip-icon loading-message mr5' style='padding-left:0;'></i>正在处理中</p>",load:"<p class='message' style='width:101px;padding: 4px 8px;'><i class='l tip-icon loading-message mr5' style='padding-left:0;'></i>正在移入收藏</p>",success:"<p class='message' style='width:101px;padding: 4px 8px;'><i class='l tip-icon tip-ok mr5'></i>成功移入收藏</p>",error:"<p class='message' style='width:149px;padding: 4px 8px;'><i class='l tip-icon tip-error mr5'></i>操作失败，请重新操作</p>",again:"<p class='message' style='width:113px;padding: 4px 8px;'><i class='l tip-icon tip-warning mr5'></i>已收藏过该商品</p>",move:"<div style='padding: 10px 12px 3px;width:190px;'><i class='tip-icon tip-warning mr5' style='vertical-align:middle;'></i><span>确定要将此商品移入收藏夹吗？</span></div><div style='text-align:center;padding:5px 0;'><a href='javascript:;' class='cart-btn-ok cart-btn mr10'>确定</a><a href='javascript:;' class='cart-btn-cancel'>取消</a></div>"},addFav:function(options,tipDom,targetDom,tipFn){if(targetDom.attr("name")!="tempProduct"){var itemNo=targetDom.closest("div").attr("itemNo");var cmmdtyCode=targetDom.closest("div").attr("cmmdtyCode");var shopCode=targetDom.closest("div").attr("shopCode");var supplierCode=targetDom.closest("div").attr("supplierCode");var tmFlag="";var activityType=targetDom.closest("div").attr("activityType");var subActivityType=targetDom.closest("div").attr("subActivityType");var jdlmodel=targetDom.closest("div").attr("jdlmodel");var overSeasFlag=targetDom.closest("div").attr("overSeasFlag");if((activityType=="02"&&subActivityType=="14")){shopCode=supplierCode;tmFlag="1"}else{if(overSeasFlag=="927HWG"||overSeasFlag=="927HWG1"){tmFlag="2"}}if(jdlmodel=="Y"){shopCode=supplierCode}if(cloudCart1.commonFunction.isEmpty(jdlmodel)){jdlmodel=""}add2Favorite(cmmdtyCode,shopCode,itemNo,targetDom,tipDom,options,tipFn,tmFlag,jdlmodel)}else{var cmmdtyCode=targetDom.attr("cmmdtyCode");var shopCode=targetDom.attr("shopCode");var supplierCode=targetDom.attr("supplierCode");var tmFlag="";var activityType=targetDom.attr("activityType");var subActivityType=targetDom.attr("subActivityType");var jdlmodel=targetDom.attr("jdlmodel");var overSeasFlag=targetDom.attr("overSeasFlag");if((activityType=="02"&&subActivityType=="14")){shopCode=supplierCode;tmFlag="1"}else{if(overSeasFlag=="927HWG"||overSeasFlag=="927HWG1"){tmFlag="2"}}if(jdlmodel=="Y"){shopCode=supplierCode}if(cloudCart1.commonFunction.isEmpty(jdlmodel)){jdlmodel=""}add2Favorite(cmmdtyCode,shopCode,"",targetDom,tipDom,options,tipFn,tmFlag,jdlmodel)}},move:function(options,tipDom,targetDom,tipFn){if(!targetDom.hasClass("add-fav-already-click")){targetDom.addClass("add-fav-already-click");targetDom.data("tipForce",1).css({cursor:"not-allowed"})}tipFn.position(options,tipDom,targetDom);ensureLogin(function(){cloudCart1.addFavFn.addFav(options,tipDom,targetDom,tipFn)})}};cloudCart1.deleteProduct={tpl:{_delSelectedItem:"<div style='padding: 12px 8px 4px;width:156px;'><i class='tip-icon tip-warning mr5' style='vertical-align:middle;'></i><span>确定要删除选中商品吗？</span></div><div style='text-align:center;padding:5px 0;'><a href='javascript:;' class='cart-btn-ok cart-btn mr10'>确定</a><a href='javascript:;' class='cart-btn-cancel'>取消</a></div>",_delUnSelectedItem:"<p style='width: 160px;padding: 6px 8px;line-height: 15px;'><i class='tip-icon tip-warning mr5' style='vertical-align:middle;'></i>您还未选中要删除的商品</p>",_delFailItem:"<div style='padding: 12px 8px 4px;width:156px;'><i class='tip-icon tip-warning mr5' style='vertical-align:middle;'></i><span>确定要删除失效商品吗？</span></div><div style='text-align:center;padding:5px 0;'><a href='javascript:;' class='cart-btn-ok cart-btn mr10'>确定</a><a href='javascript:;' class='cart-btn-cancel'>取消</a></div>",_delAllItem:"<i class='tip-icon tip-info mr5'></i>确定要清空所有商品吗？<a href='javascript:;' class='cart-btn-ok cart-btn mr10'>确定</a><a href='javascript:;' class='cart-btn-cancel'>取消</a>",_delItem:"<div style='padding: 10px 12px 3px;width:146px;'><i class='tip-icon tip-warning mr5' style='vertical-align:middle;'></i><span>确定要删除此商品吗？</span></div><div style='text-align:center;padding:5px 0;'><a href='javascript:;' class='cart-btn-ok cart-btn mr10' name='icart1_goods_suredelate'>确定</a><a href='javascript:;' class='cart-btn-cancel' name='icart1_goods_canceldelate'>取消</a></div>",_loadItem:"<p class='message' style='width:134px;padding: 4px 8px;'><i class='l tip-icon loading-message mr5' style='padding-left:0;'></i>正在处理中，请稍后</p>",_delItemSp:"<i class='little-close-icon'></i><div style='padding: 18px 12px 3px;width:168px;' class='clearfix'><i class='tip-icon tip-warning mr5 l' style='vertical-align:middle;'></i><span class='l' style='width:144px;'>您可以选择移入到收藏夹，或删除商品？</span></div><div style='text-align:center;padding:5px 0 13px'><a href='javascript:;' class='cart-btn-ok cart-btn mr10' style='width:74px;' name='icart1_goods_shoucang'>移入收藏</a><a href='javascript:;' class='cart-btn-cancel' name='icart1_goods_shanchu2'>删除</a></div>"},select:function(options,tipDom,targetDom,tipFn){var $checks=$(".m-cart-body :checkbox.checkbox"),flag=false;$checks.each(function(){if($(this).prop("checked")===true){flag=true;return}});var message="";if(flag==true){message=this.tpl._delSelectedItem}else{message=this.tpl._delUnSelectedItem}tipDom.find(".ui-tooltip-inner").html(message)},delSelect:function(options,tipDom,targetDom,tipFn){probeAuthStatus(function(){cloudCart1.deleteProduct.delSelectItemProcess()},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){cloudCart1.deleteProduct.delSelectItemProcess()})}else{cloudCart1.deleteProduct.delSelectItemProcess()}})},item:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html(this.tpl._delItem);targetDom.addClass("del-click-on")},delOne:function(options,tipDom,targetDom,tipFn,event){tipDom.find(".ui-tooltip-inner").html(cloudCart1.deleteProduct.tpl._loadItem);if(!targetDom.hasClass("add-fav-already-click")){targetDom.addClass("add-fav-already-click");targetDom.data("tipForce",1).css({cursor:"not-allowed"})}tipFn.position(options,tipDom,targetDom);probeAuthStatus(function(){cloudCart1.deleteProduct.delItemProcess(targetDom,tipFn)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){cloudCart1.deleteProduct.delItemProcess(targetDom,tipFn)})}else{cloudCart1.deleteProduct.delItemProcess(targetDom,tipFn)}})},itemSp:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html(cloudCart1.deleteProduct.tpl._delItemSp);targetDom.addClass("del-click-on")},delOneSp:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html(cloudCart1.deleteProduct.tpl._loadItem);if(!targetDom.hasClass("add-fav-already-click")){targetDom.addClass("add-fav-already-click");targetDom.data("tipForce",1).css({cursor:"not-allowed"})}tipFn.position(options,tipDom,targetDom);probeAuthStatus(function(){cloudCart1.deleteProduct.delItemProcess(targetDom,tipFn)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){cloudCart1.deleteProduct.delItemProcess(targetDom,tipFn)})}else{cloudCart1.deleteProduct.delItemProcess(targetDom,tipFn)}})},delOneSpAddFav:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html(cloudCart1.deleteProduct.tpl._loadItem);tipFn.position(options,tipDom,targetDom);cloudCart1.addFavFn.run(options,tipDom,targetDom,tipFn)},fail:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html(this.tpl._delFailItem)},delFail:function(options,tipDom,targetDom,tipFn){probeAuthStatus(function(){cloudCart1.deleteProduct.delFailItemProcess()},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){cloudCart1.deleteProduct.delFailItemProcess()})}else{cloudCart1.deleteProduct.delFailItemProcess()}})},delItemProcess:function(selector,tipFn){var itemNo=selector.parent().attr("itemNo");var oldStrucString=$("#oldStrucString").val();$.ajax({type:"get",dataType:"jsonp",url:"deleteCartOnePro.do",data:{cummtyItemNos:itemNo,oldStrucString:oldStrucString,loginSign:$("#loginSign").val()},crossDomain:true,success:function(data){if(data.result=="true"||data.result=="empty"){cloudCart1.refreshPage(data);tipFn.allHide();var selectorParent=selector.parent();var o2oServiceFlag=selectorParent.attr("o2oServiceFlag");var serviceStoreCode=selectorParent.attr("serviceStoreCode");var serviceStoreName=selectorParent.attr("serviceStoreName");var isOverdue=selectorParent.attr("isOverdue");var cmmdtyCode=selectorParent.attr("cmmdtyCode");var cmmdtyName=selectorParent.attr("cmmdtyName");var shopCode=selectorParent.attr("shopCode");var activityType=selectorParent.attr("activityType");var activityId=selectorParent.attr("activityId");var subActivityType=selectorParent.attr("subActivityType");var carShopSerWay=selectorParent.attr("carShopSerWay");var carShopCode=selectorParent.attr("carShopCode");var supplierCode=selectorParent.attr("supplierCode");var cmmdtyArray=new Array();if(isOverdue==0&&selectorParent.parent().find(".yr-icon").length===0){if(activityType=="04"||activityType=="05"||activityType=="06"||activityType=="12"||activityType=="23"){var pSubs=selector.parents(".suit");var headSub=pSubs.find(".item-header");var itemSubs=pSubs.find(".item-sub");var cmmdtyObject=new Object();cmmdtyObject.cmmdtyCode=cmmdtyCode;cmmdtyObject.cmmdtyName=cmmdtyName;cmmdtyObject.shopCode=shopCode;cmmdtyObject.activityType=activityType;cmmdtyObject.activityId=activityId;cmmdtyObject.carShopSerWay=carShopSerWay;cmmdtyObject.carShopCode=carShopCode;var cmmdtyQty=headSub.find(".td-amount input").val();var cmmdtyAmount=headSub.find(".td-sum .sn-price em").html();cmmdtyObject.cmmdtyQty=cmmdtyQty;cmmdtyObject.cmmdtyAmount=cmmdtyAmount;cmmdtyArray.push(cmmdtyObject);var cmmdtyWarrayObjectArray=new Array();$.each(itemSubs,function(n,itemSub){var cmmdtyName=$(itemSub).find(".item-title").html();var cmmdtyCode=$(itemSub).find(".haoye").attr("cmmdtyCode");var accessoryRelationID=$(itemSub).find(".haoye").attr("accessoryRelationID");var cmmdtyQty=$(itemSub).find(".td-amount span").html();var carShopSerWay=$(itemSub).find(".haoye").attr("carShopSerWay");var carShopCode=$(itemSub).find(".haoye").attr("carShopCode");var isFixedWarray=$(itemSub).find(".haoye").attr("isFixedWarray");if(isFixedWarray&&activityType=="12"){var cmmdtyWarrayObject=new Object();cmmdtyWarrayObject.cmmdtyCode=cmmdtyCode;cmmdtyWarrayObject.cmmdtyQty=cmmdtyQty;cmmdtyWarrayObject.supplierCode=shopCode;cmmdtyWarrayObject.isCollocation=1;cmmdtyWarrayObjectArray.push(cmmdtyWarrayObject)}else{var cmmdtyObject=new Object();cmmdtyObject.cmmdtyCode=cmmdtyCode;cmmdtyObject.cmmdtyName=cmmdtyName;cmmdtyObject.shopCode=shopCode;cmmdtyObject.cmmdtyQty=cmmdtyQty;cmmdtyObject.accessoryRelationID=accessoryRelationID;cmmdtyObject.carShopSerWay=carShopSerWay;cmmdtyObject.carShopCode=carShopCode;cmmdtyArray.push(cmmdtyObject)}});if(cmmdtyArray.length>1&&cmmdtyWarrayObjectArray.length>0){cmmdtyArray[1].childCmmdtyWarrantyVOList=cmmdtyWarrayObjectArray}var href="";if(activityType=="06"){href="<a href='"+snDomain+"/emall/xn_10052_10051_"+activityId+"_.html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>"}else{href="<a href='"+productDomain+"/"+shopCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>"}var _item1="<div class='repurchase-product clearfix'><span class='l repurchase-name'>"+href+"</span><span  class='l sn-price'><i>&yen;</i><em>"+cmmdtyArray[0].cmmdtyAmount+"</em></span><span class='l repurchase-num'>"+cmmdtyArray[0].cmmdtyQty+"</span><div class='l repurchase-tool'><a  href='javascript:;' class='repurchase-btn tip-common-click-fn-btn' data-tip-type='repurchase' data-placement='top' againBuyClickTag='"+againBuyClickTag+"'>撤销删除</a></span></div>";cloudCart1.cartRemoved.addRepurchase(_item1);cartRemovedObject[againBuyClickTag]=cmmdtyArray}else{if(selector.parent(".td-op").attr("cmmdtyType")!="warranty"){var itemSub;if(!activityType.length>0){itemSub=selector.parents(".item-sub")}else{itemSub=selector.parents(".item-main")}var cmmdtyName=itemSub.find(".item-title").html();var cmmdtyAmount=itemSub.find(".td-sum .sn-price em").html();var jdlmodel=selectorParent.attr("jdlmodel");var overSeasFlag=selectorParent.attr("overSeasFlag");var cmmdtyQty;if(activityType=="03"||activityType==""||activityType=="16"){cmmdtyQty=itemSub.find(".td-amount span").html()}else{cmmdtyQty=itemSub.find(".td-amount input").val()}if(!activityType.length>0){activityType="01"}var cmmdtyObject=new Object();cmmdtyObject.cmmdtyCode=cmmdtyCode;cmmdtyObject.cmmdtyName=cmmdtyName;cmmdtyObject.shopCode=shopCode;cmmdtyObject.activityType=activityType;cmmdtyObject.activityId=activityId;cmmdtyObject.cmmdtyAmount=cmmdtyAmount;cmmdtyObject.cmmdtyQty=cmmdtyQty;cmmdtyObject.carShopSerWay=carShopSerWay;cmmdtyObject.carShopCode=carShopCode;cmmdtyObject.supplierCode=supplierCode;if(serviceStoreName!=null&&serviceStoreName!="undefined"&&serviceStoreName!=""){cmmdtyObject.serviceStoreName=serviceStoreName}if(serviceStoreCode!=null&&serviceStoreCode!="undefined"&&serviceStoreCode!=""){cmmdtyObject.serviceStoreCode=serviceStoreCode}if(o2oServiceFlag!=null&&o2oServiceFlag!="undefined"&&o2oServiceFlag!=""){cmmdtyObject.commodityType=o2oServiceFlag}cmmdtyArray.push(cmmdtyObject);var href="";var fav="";if(subActivityType=="6"){href="<a href='"+productDomain+"/mp/"+cloudCart1.dealPreZeroPartnum(cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>"}else{if(activityType=="02"&&subActivityType=="14"){href="<a href='"+productDomain+"/"+supplierCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>";fav="<a  href='javascript:;' class='add-fav tip-common-click-fn-btn' data-tip-type='addFav' name='tempProduct' data-placement='top' cmmdtyCode='"+cmmdtyArray[0].cmmdtyCode+"' shopCode='"+cmmdtyArray[0].shopCode+"' supplierCode='"+supplierCode+"'>移入收藏</a>"}else{if((overSeasFlag=="927HWG"||overSeasFlag=="927HWG1")&&jdlmodel=="Y"){href="<a href='"+productDomain+"/"+supplierCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>";fav="<a  href='javascript:;' class='add-fav tip-common-click-fn-btn' data-tip-type='addFav' name='tempProduct' data-placement='top' cmmdtyCode='"+cmmdtyArray[0].cmmdtyCode+"' shopCode='"+cmmdtyArray[0].shopCode+"' supplierCode='"+supplierCode+"' jdlmodel='"+jdlmodel+"'>移入收藏</a>"}else{href="<a href='"+productDomain+"/"+shopCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>";fav="<a  href='javascript:;' class='add-fav tip-common-click-fn-btn' data-tip-type='addFav' name='tempProduct' data-placement='top' cmmdtyCode='"+cmmdtyArray[0].cmmdtyCode+"' shopCode='"+cmmdtyArray[0].shopCode+"'>移入收藏</a>"}}}var _item1="<div class='repurchase-product clearfix'><span class='l repurchase-name'>"+href+"</span><span  class='l sn-price'><i>&yen;</i><em>"+cmmdtyArray[0].cmmdtyAmount+"</em></span><span class='l repurchase-num'>"+cmmdtyArray[0].cmmdtyQty+"</span><div class='l repurchase-tool'><a  href='javascript:;' class='repurchase-btn tip-common-click-fn-btn' data-tip-type='repurchase' data-placement='top' againBuyClickTag='"+againBuyClickTag+"'>撤销删除</a>"+fav+"</span></div>";cloudCart1.cartRemoved.addRepurchase(_item1);cartRemovedObject[againBuyClickTag]=cmmdtyArray}}againBuyClickTag++}}else{selector.removeClass("add-fav-already-click");selector.removeData("tipForce").css({cursor:"pointer"});tipFn.allHide()}},error:function(data){selector.removeClass("add-fav-already-click");selector.removeData("tipForce").css({cursor:"pointer"});tipFn.allHide()}})},delFailItemProcess:function(){$.ajax({type:"GET",url:"emptyCartOne.do",data:{emptyFlag:"2"},dataType:"jsonp",crossDomain:true,success:function(data){window.location.href="cart.do"}})},delSelectItemProcess:function(){var selectArrayItemNo=new Array();var selectCmmdtyArray=new Array();($("input[type='checkbox']").each(function(){if($(this).attr("checked")=="checked"){if(this.id!=""&&this.id!="chooseAllCheckBox"&&this.id!="chooseAllCheckBox2"){var itemNo=this.id;selectArrayItemNo.push(itemNo);var cmmdtyArray=new Array();var activityType=$(this).attr("activityType");if(activityType=="04"||activityType=="05"||activityType=="06"||activityType=="12"||activityType=="23"){var pSubs=$(this).parents(".suit");var headSub=pSubs.find(".item-header");var $selectorParent=headSub.find(".td-op a.del").parent();var cmmdtyCode=$selectorParent.attr("cmmdtyCode");var cmmdtyName=$selectorParent.attr("cmmdtyName");var shopCode=$selectorParent.attr("shopCode");var activityId=$selectorParent.attr("activityId");var isOverdue=$selectorParent.attr("isOverdue");var itemSubs=pSubs.find(".item-sub");var cmmdtyQty=headSub.find(".td-amount input").val();var carShopSerWay=$selectorParent.attr("carShopSerWay");var carShopCode=$selectorParent.attr("carShopCode");var cmmdtyObject=new Object();cmmdtyObject.cmmdtyCode=cmmdtyCode;cmmdtyObject.cmmdtyName=cmmdtyName;cmmdtyObject.shopCode=shopCode;cmmdtyObject.activityType=activityType;cmmdtyObject.activityId=activityId;cmmdtyObject.cmmdtyQty=cmmdtyQty;cmmdtyObject.carShopSerWay=carShopSerWay;cmmdtyObject.carShopCode=carShopCode;var cmmdtyAmount=headSub.find(".td-sum .sn-price em").html();cmmdtyObject.cmmdtyAmount=cmmdtyAmount;if(isOverdue=="0"){cmmdtyArray.push(cmmdtyObject);$.each(itemSubs,function(n,itemSub){var cmmdtyName=$(itemSub).find(".item-title").html();var cmmdtyCode=$(itemSub).find(".haoye").attr("cmmdtyCode");var accessoryRelationID=$(itemSub).find(".haoye").attr("accessoryRelationID");var cmmdtyAmount=$(itemSub).find(".td-sum .sn-price em").html();var cmmdtyQty=$(itemSub).find(".td-amount span").html();var carShopSerWay=$(itemSub).find(".haoye").attr("carShopSerWay");var carShopCode=$(itemSub).find(".haoye").attr("carShopCode");var cmmdtyObject=new Object();cmmdtyObject.cmmdtyCode=cmmdtyCode;cmmdtyObject.cmmdtyName=cmmdtyName;cmmdtyObject.shopCode=shopCode;cmmdtyObject.cmmdtyAmount=cmmdtyAmount;cmmdtyObject.cmmdtyQty=cmmdtyQty;cmmdtyObject.accessoryRelationID=accessoryRelationID;cmmdtyObject.carShopSerWay=carShopSerWay;cmmdtyObject.carShopCode=carShopCode;cmmdtyArray.push(cmmdtyObject)});selectCmmdtyArray.push(cmmdtyArray)}}else{var itemSub=$(this).parents(".item-main");var accessoryRelationID=itemSub.find(".item-pic input").attr("accessoryRelationID");var cmmdtyAmount=itemSub.find(".td-sum .sn-price em").html();var $selectorParent=itemSub.find(".td-op a.del").parent();var cmmdtyCode=$selectorParent.attr("cmmdtyCode");var cmmdtyName=$selectorParent.attr("cmmdtyName");var shopCode=$selectorParent.attr("shopCode");var activityType=$selectorParent.attr("activityType");var activityId=$selectorParent.attr("activityId");var isOverdue=$selectorParent.attr("isOverdue");var subActivityType=$selectorParent.attr("subActivityType");var carShopSerWay=$selectorParent.attr("carShopSerWay");var carShopCode=$selectorParent.attr("carShopCode");var supplierCode=$selectorParent.attr("supplierCode");var jdlmodel=$selectorParent.attr("jdlmodel");var overSeasFlag=$selectorParent.attr("overSeasFlag");var o2oServiceFlag=$selectorParent.attr("o2oServiceFlag");var serviceStoreCode=$selectorParent.attr("serviceStoreCode");var serviceStoreName=$selectorParent.attr("serviceStoreName");var cmmdtyQty;if(activityType=="03"||activityType==""||activityType=="16"){cmmdtyQty=itemSub.find(".td-amount span").html()}else{cmmdtyQty=itemSub.find(".td-amount input").val()}if(isOverdue=="0"){var cmmdtyObject=new Object();cmmdtyObject.cmmdtyCode=cmmdtyCode;cmmdtyObject.cmmdtyName=cmmdtyName;cmmdtyObject.shopCode=shopCode;cmmdtyObject.activityType=activityType;cmmdtyObject.activityId=activityId;cmmdtyObject.cmmdtyAmount=cmmdtyAmount;cmmdtyObject.cmmdtyQty=cmmdtyQty;cmmdtyObject.subActivityType=subActivityType;cmmdtyObject.accessoryRelationID=accessoryRelationID;cmmdtyObject.carShopSerWay=carShopSerWay;cmmdtyObject.carShopCode=carShopCode;cmmdtyObject.supplierCode=supplierCode;cmmdtyObject.jdlmodel=jdlmodel;cmmdtyObject.overSeasFlag=overSeasFlag;if(serviceStoreName!=null&&serviceStoreName!="undefined"&&serviceStoreName!=""){cmmdtyObject.serviceStoreName=serviceStoreName}if(serviceStoreCode!=null&&serviceStoreCode!="undefined"&&serviceStoreCode!=""){cmmdtyObject.serviceStoreCode=serviceStoreCode}if(o2oServiceFlag!=null&&o2oServiceFlag!="undefined"&&o2oServiceFlag!=""){cmmdtyObject.commodityType=o2oServiceFlag}cmmdtyArray.push(cmmdtyObject);selectCmmdtyArray.push(cmmdtyArray)}}}}}));$.ajax({type:"get",url:"deleteCartOnePro.do",dataType:"jsonp",crossDomain:true,data:{cummtyItemNos:selectArrayItemNo.toString(),loginSign:$("#loginSign").val()},success:function(data){if(data.result=="true"||data.result=="empty"){cloudCart1.refreshPage(data);$.each(selectCmmdtyArray,function(n,cmmdtyArray){if(cmmdtyArray.length>1){var href="";if(cmmdtyArray[0].activityType=="06"){href="<a href='//"+snDomain+"/emall/xn_10052_10051_"+cmmdtyArray[0].activityId+"_.html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>"}else{href="<a href='"+productDomain+"/"+cmmdtyArray[0].shopCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyArray[0].cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>"}var _item1="<div class='repurchase-product clearfix'><span class='l repurchase-name'>"+href+"</span><span  class='l sn-price'><i>&yen;</i><em>"+cmmdtyArray[0].cmmdtyAmount+"</em></span><span class='l repurchase-num'>"+cmmdtyArray[0].cmmdtyQty+"</span><div class='l repurchase-tool'><a  href='javascript:;' class='repurchase-btn tip-common-click-fn-btn' data-tip-type='repurchase' data-placement='top' againBuyClickTag='"+againBuyClickTag+"'>撤销删除</a></span></div>";cloudCart1.cartRemoved.addRepurchase(_item1);cartRemovedObject[againBuyClickTag]=cmmdtyArray}else{var href="";var fav="";if(cmmdtyArray[0].subActivityType=="6"){href="<a href='"+productDomain+"/mp/"+cloudCart1.dealPreZeroPartnum(cmmdtyArray[0].cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>"}else{if(cmmdtyArray[0].activityType=="02"&&cmmdtyArray[0].subActivityType=="14"){href="<a href='"+productDomain+"/"+cmmdtyArray[0].supplierCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyArray[0].cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>";fav="<a  href='javascript:;' class='add-fav tip-common-click-fn-btn' data-tip-type='addFav' name='tempProduct' data-placement='top' cmmdtyCode='"+cmmdtyArray[0].cmmdtyCode+"' shopCode='"+cmmdtyArray[0].shopCode+"' supplierCode='"+cmmdtyArray[0].supplierCode+"'>移入收藏</a>"}else{if((cmmdtyArray[0].overSeasFlag=="927HWG"||cmmdtyArray[0].overSeasFlag=="927HWG1")&&cmmdtyArray[0].jdlmodel=="Y"){href="<a href='"+productDomain+"/"+cmmdtyArray[0].supplierCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyArray[0].cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>";fav="<a  href='javascript:;' class='add-fav tip-common-click-fn-btn' data-tip-type='addFav' name='tempProduct' data-placement='top' cmmdtyCode='"+cmmdtyArray[0].cmmdtyCode+"' shopCode='"+cmmdtyArray[0].shopCode+"' supplierCode='"+cmmdtyArray[0].supplierCode+"' jdlmodel='"+cmmdtyArray[0].jdlmodel+"'>移入收藏</a>"}else{href="<a href='"+productDomain+"/"+cmmdtyArray[0].shopCode+"/"+cloudCart1.dealPreZeroPartnum(cmmdtyArray[0].cmmdtyCode)+".html' title='"+cmmdtyArray[0].cmmdtyName+"'>"+cmmdtyArray[0].cmmdtyName+"</a>";fav="<a  href='javascript:;' class='add-fav tip-common-click-fn-btn' data-tip-type='addFav' name='tempProduct' data-placement='top' cmmdtyCode='"+cmmdtyArray[0].cmmdtyCode+"' shopCode='"+cmmdtyArray[0].shopCode+"'>移入收藏</a>"}}}var _item1="<div class='repurchase-product clearfix'><span class='l repurchase-name'>"+href+"</span><span  class='l sn-price'><i>&yen;</i><em>"+cmmdtyArray[0].cmmdtyAmount+"</em></span><span class='l repurchase-num'>"+cmmdtyArray[0].cmmdtyQty+"</span><div class='l repurchase-tool'><a  href='javascript:;' class='repurchase-btn tip-common-click-fn-btn' data-tip-type='repurchase' data-placement='top' againBuyClickTag='"+againBuyClickTag+"'>撤销删除</a>"+fav+"</span></div>";cloudCart1.cartRemoved.addRepurchase(_item1);cartRemovedObject[againBuyClickTag]=cmmdtyArray}againBuyClickTag++})}},error:function(data){window.location.href="cart.do"}})}};cloudCart1.alwaysBuy={init:function(){this.addCart()},addCart:function(){var _this=this;$(document).on("click",".always-buy-module .add-cart",function(){var that=$(this);var cmmdtyCode=that.attr("cmmdtyCode");var shopCode=that.attr("shopCode");recommendAddCart("05","01","",cmmdtyCode,shopCode,1,"",that)})},successFn:function(domThis){var thisPosition=domThis.position();var html=$('<div class="add-num"></div>');$(domThis).after(html);html.css({display:"block",top:thisPosition.top-html.height()+domThis.height()/2,left:thisPosition.left+domThis.width()/2-html.width()/2}).animate({top:thisPosition.top-html.height(),opacity:0},800,function(){$(this).remove()})},errorFn:function(domThis,message){var thisPosition=domThis.position();var message=message||"操作失败，请重新操作...";var html=$('<div class="cart-recommend-tooltip"><div class="ui-tooltip-arrow"><i class="ui-tooltip-arrow-front">◆</i><i class="ui-tooltip-arrow-back">◆</i></div><div class="ui-tooltip-inner"><p style="color:red;"><i class="l tip-icon tip-error mr5"></i>'+message+"</div></div>");$(domThis).after(html);html.fadeOut(3000,function(){$(this).remove()})}};cloudCart1.allStoreDiscount={init:function(){this.checkDisplay();this.bindEvent()},checkDisplay:function(){var atLen=$(".all-store-discount-box .all-store-discount-body").length;if(atLen>3){var moreDom='<div class="more-content arrow-down">显示全部活动<i class="arrow"></i></div>';$(".all-store-discount-box").append(moreDom);$(".all-store-discount-box").addClass("tool-area-box-has-more-btn")}},bindEvent:function(){var atLen=$(".all-store-discount-box .all-store-discount-body").length;$(document).on("click",".all-store-discount-box .more-content",function(){var dTtoolAreaContentBox=$(this).closest(".all-store-discount-box").find(".tool-area-content-box"),hasOpen,height;if(dTtoolAreaContentBox.find(".all-store-discount-body-open").length>0){hasOpen=true}else{hasOpen=false}if($(this).hasClass("arrow-down")){$(this).removeClass("arrow-down").addClass("arrow-up").html('收起部分活动<i class="arrow"></i>');if(hasOpen){height=dTtoolAreaContentBox.find(".all-store-discount-content-box").length*36+148}else{height=dTtoolAreaContentBox.find(".all-store-discount-content-box").length*36}dTtoolAreaContentBox.css("max-height",500)}else{dTtoolAreaContentBox.find(".all-store-discount-body").removeClass("all-store-discount-body-open");dTtoolAreaContentBox.find(".all-store-discount-icon").removeClass("all-store-discount-icon-down");$(this).removeClass("arrow-up").addClass("arrow-down").html('显示全部活动<i class="arrow"></i>');height=108}dTtoolAreaContentBox.css("height",height)});$(document).on("click",".goods-list-box .list-box .checkbox",function(e){e.preventDefault();var _this=$(this);probeAuthStatus(function(){cloudCart1.allStoreDiscount.discountOperate(_this)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){cloudCart1.allStoreDiscount.discountOperate(_this)})}else{cloudCart1.allStoreDiscount.discountOperate(_this)}})});$(document).on("click",".all-store-discount-body .tip-btn",function(){var _this=$(this),body=_this.closest(".all-store-discount-body"),dTtoolAreaContentBox=$(this).closest(".all-store-discount-box").find(".tool-area-content-box"),promotionId=$(this).attr("promotionId"),goodList=$("#"+promotionId).clone().html(),height,hasExpand,hasMore=atLen>3?true:false,moreContent=_this.closest(".tool-area-box").find(".more-content");if(moreContent.hasClass("arrow-up")){hasExpand=true}else{hasExpand=false}if(dTtoolAreaContentBox.find(".all-store-discount-body-open").length>0&&body.hasClass("all-store-discount-body-open")){body.find(".goods-list-box").remove();body.removeClass("all-store-discount-body-open");_this.find(".all-store-discount-icon").removeClass("all-store-discount-icon-down");if((hasMore&&hasExpand)||!hasMore){height=dTtoolAreaContentBox.find(".all-store-discount-content-box").length*36}else{if(hasMore&&!hasExpand){height=108}}}else{body.find(".goods-list-box").remove();if((hasMore&&hasExpand)||!hasMore){height=dTtoolAreaContentBox.find(".all-store-discount-content-box").length*36+148}else{if(hasMore&&!hasExpand){height=256}}body.addClass("all-store-discount-body-open").siblings().removeClass("all-store-discount-body-open");body.siblings().find(".all-store-discount-icon").removeClass("all-store-discount-icon-down");body.append(goodList);cartListLoop.listloop({wrap:".tool-area-box .all-store-discount-body-open .J-discount-"+promotionId+"",loopBox:".list-box",step:{wide:7,narrow:6},scrollWidth:{wide:1120,narrow:930},hasLabel:false,isRandom:false});_this.find(".all-store-discount-icon").addClass("all-store-discount-icon-down")}dTtoolAreaContentBox.css("height",height);if($.browser.msie){body.find(".goods-list-box label").click(function(e){e.preventDefault();$("#"+$(this).attr("for")).click().change()})}})},discountOperate:function(_this){if(_this.parent().hasClass("cart-checkbox-checked")){_this.parent().removeClass("cart-checkbox-checked");_this.prop("checked",false)}else{_this.parent().addClass("cart-checkbox-checked");_this.prop("checked",true)}var cmmdtyItem=_this.attr("itemNo");$.each(operateCheckCmmdty,function(n,value){var cmmItem=value.split("-")[0];if(cmmItem==cmmdtyItem){operateCheckCmmdty.splice(n,1);return false}});var isSelect=_this.prop("checked");operateCheckCmmdty.push(cmmdtyItem+"-"+(isSelect?"1":"0"));if(operateCheckCmmdty.length==0){return false}cloudCart1.selectList.disableCheckbox();var loginSign=$("#loginSign").val();var operateCheckCmmdtyData=operateCheckCmmdty.toString();operateCheckCmmdty=new Array();var promotionId=_this.attr("promotionId");$.ajax({type:"get",dataType:"jsonp",url:"operateCartOneCheck.do",data:{loginSign:loginSign,operateCheckCmmdty:operateCheckCmmdtyData},crossDomain:true,success:function(data){if(data.result=="false"){return false}cloudCart1.refreshPage(data);var scrollTop=$(document).scrollTop();$("body").scrollTop(scrollTop);$(".all-store-discount-body .tip-btn").each(function(){if($(this).attr("promotionId")==promotionId){$(this).trigger("click")}})},complete:function(XMLHttpRequest,textStatus){cloudCart1.selectList.enableCheckbox()}})}};cloudCart1.promoLocation={promo:"",init:function(){cloudCart1.promoLocation.promo=$("[data-promo^=youhui]");if(cloudCart1.promoLocation.promo.length>0){$(".promo-location").removeClass("hide")}},bindEvent:function(){this.init();$(document).on("click",".promo-location",function(){var _that=$(this),promoFlag=_that.attr("promo-index"),topLocation=_that.offset().top,topPromo=0,docHeight=$(document).scrollTop(),_thatTop=_that.position().top;if(promoFlag==""||promoFlag==null){_that.attr("promo-index",1);topPromo=cloudCart1.promoLocation.promo.eq(0).offset().top}else{var promoNext=parseInt(promoFlag)+1;if(promoNext==cloudCart1.promoLocation.promo.length+1){promoNext=1}_that.attr("promo-index",promoNext);topPromo=cloudCart1.promoLocation.promo.eq(promoNext-1).offset().top}$("html,body").stop().animate({scrollTop:topPromo-topLocation+docHeight},300);_that.removeClass("promo-flag");_that.stop().css({top:(topPromo-topLocation+_thatTop)})})}};cloudCart1.tipfn={tipBind:function(){st.tooltipNew.run({selector:".coupon-bg",type:"click",node:"#coupon-1",placement:"bottom",closeBtn:1,openFn:function(options,tipDom,targetDom,tipFn){targetDom.addClass("coupon-bg-acitive");tipDom.addClass("yhq-tooltip");tipDom.css("margin-top","1px")},closeFn:function(tipDom,targetDom,tipFn){targetDom.removeClass("coupon-bg-acitive")}});st.tooltipNew.run({selector:".meet-cut-btn",type:"click",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){targetDom.addClass("meet-cut-btn-active");tipDom.css("margin-top","1px");tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipLoad);if(targetDom.data().meetCutType=="1"){cloudCart1.gatherOrder.meetCutFn(options,tipDom,targetDom,tipFn)}else{if(targetDom.data().meetCutType=="2"){cloudCart1.gatherOrder.cMeetCutFn(options,tipDom,targetDom,tipFn)}}},closeFn:function(tipDom,targetDom,tipFn){targetDom.removeClass("meet-cut-btn-active")}});st.tooltipNew.run({selector:".meet-exchange",type:"click",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipLoad);cloudCart1.changeBuy.queryChangeProduct(options,tipDom,targetDom,tipFn)},closeFn:function(tipDom,targetDom,tipFn){}});st.tooltipNew.run({selector:".yhhg-btn",type:"click",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){targetDom.addClass("meet-cut-btn-active");tipDom.css("margin-top","2px");tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipLoad);cloudCart1.changeBuy.queryCanChangeBuyProduct(options,tipDom,targetDom,tipFn)},closeFn:function(tipDom,targetDom,tipFn){targetDom.removeClass("meet-cut-btn-active")}});st.tooltipNew.run({selector:".sunshine-btn",type:"click",node:"#sun-package-1",placement:"bottom",flag:"sunshine-tooltip",closeBtn:1,openFn:function(options,tipDom,targetDom,tipFn){if(tipDom.find(".singleItem-wrap").length<=1){tipDom.closest(".sunshine-tooltip").addClass("sunshine-tooltip-only");var dSunPackageSelect=tipDom.find(".sun-package-select");dSunPackageSelect.css({width:dSunPackageSelect.find(".singleItem-wrap-box").outerWidth()})}cloudCart1.sunPackage.init(tipDom);tipDom.find(".cart-btn-ok").one("click",function(){cloudCart1.sunPackage.getData()});tipDom.find(".cart-btn-cancel").one("click",function(){st.tooltipNew.allHide()})},closeFn:function(tipDom,targetDom,tipFn){var dBtn=tipDom.find(".cart-btn-ok, .cart-btn-cancel");if(dBtn>0){dBtn.unbind("click")}dBtn=null}});st.tooltipNew.run({selector:".toolbar-box .now-select-goods",type:"click",node:"#selected-pro",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){var li=tipDom.find(".list");var liLen=li.length;if(liLen==0){return}var listBox=$(".ui-tooltip .ui-had-buy"),listBoxW,tipW;if(liLen<=8){listBoxW=80*liLen+(liLen-1)*10;listBox.css("width",listBoxW);li.last().addClass("last");tipW=listBoxW+22+"px"}else{listBox.addClass("ui-had-buy-slide");cartListLoop.listloop({wrap:".ui-tooltip .J-selected-pro",loopBox:".list-box",step:{wide:8,narrow:8},scrollWidth:{wide:720,narrow:720},hasLabel:false,isRandom:false});tipW="778px"}if(cloudCart1.ieVesion(6)||cloudCart1.ieVesion(7)){targetDom.data("style","{'width': '"+tipW+"'}");tipFn.position(options,tipDom,targetDom)}targetDom.find(".alchose-span").removeClass("alchose-up").addClass("alchose-down")},closeFn:function(tipDom,targetDom,tipFn){targetDom.find(".alchose-span").removeClass("alchose-down").addClass("alchose-up")}});st.tooltipNew.run({selector:".toolbar-box .now-select-coupon",type:"click",node:"#autouse",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){if(cloudCart1.ieVesion(6)||cloudCart1.ieVesion(7)){targetDom.data("style","{'width': '450px'}");tipFn.position(options,tipDom,targetDom)}targetDom.find(".alchose-span").removeClass("alchose-up").addClass("alchose-down");tipDom.find(".pro-left").click(function(){var _this=$(this),_parent=_this.closest(".item");if(_parent.hasClass("item-open")){_parent.removeClass("item-open");tipFn.position(options,tipDom,targetDom)}else{_parent.addClass("item-open");tipFn.position(options,tipDom,targetDom)}})},closeFn:function(tipDom,targetDom,tipFn){targetDom.find(".alchose-span").removeClass("alchose-down").addClass("alchose-up");tipDom.find(".pro-left").unbind("click")}});$(document).on("click",".use-coupon-tips .close",function(){$(".use-coupon-tips").hide()});st.tooltipNew.run({selector:".tip-common-click-fn-btn",type:"click",placement:"top",openFn:function(options,tipDom,targetDom,tipFn){var thisData=targetDom.data();var okFn,cancelFn;if(typeof thisData.tipType!="undefined"&&thisData.tipType){switch(thisData.tipType){case"addFav":cloudCart1.addFavFn.run(options,tipDom,targetDom,tipFn);okFn=cloudCart1.addFavFn.move;break;case"delOne":cloudCart1.deleteProduct.item(options,tipDom,targetDom,tipFn);okFn=cloudCart1.deleteProduct.delOne;break;case"delOneSp":cloudCart1.deleteProduct.itemSp(options,tipDom,targetDom,tipFn);okFn=cloudCart1.deleteProduct.delOneSpAddFav;cancelFn=cloudCart1.deleteProduct.delOneSp;tipDom.find(".little-close-icon").one("click",function(e){tipFn.allHide()});break;case"delSelect":cloudCart1.deleteProduct.select(options,tipDom,targetDom,tipFn);okFn=cloudCart1.deleteProduct.delSelect;break;case"delFail":cloudCart1.deleteProduct.fail(options,tipDom,targetDom,tipFn);okFn=cloudCart1.deleteProduct.delFail;break;case"repurchase":cloudCart1.cartRemoved.addCart(options,tipDom,targetDom,tipFn);break}}if(okFn){if(targetDom.hasClass("add-fav")){tipDom.find(".cart-btn-ok").unbind().bind("click",function(event){event.preventDefault();event.stopPropagation();okFn&&okFn(options,tipDom,targetDom,tipFn)});tipDom.find(".cart-btn-cancel").unbind().bind("click",function(e){if(cancelFn){e.stopPropagation();cancelFn(options,tipDom,targetDom,tipFn)}else{targetDom.removeData("tipForce").css({cursor:"pointer"});tipFn.allHide()}})}else{tipDom.find(".cart-btn-ok").one("click",function(event){event.preventDefault();event.stopPropagation();okFn&&okFn(options,tipDom,targetDom,tipFn)});tipDom.find(".cart-btn-cancel").one("click",function(e){if(cancelFn){e.stopPropagation();cancelFn(options,tipDom,targetDom,tipFn)}else{tipFn.allHide()}})}}},closeFn:function(tipDom,targetDom,tipFn){targetDom.removeClass("del-click-on");var dBtn=tipDom.find(".cart-btn-ok, .cart-btn-cancel");if(dBtn>0){dBtn.unbind("click")}dBtn=null}});st.tooltipNew.run({selector:".tip-common-hover-fn-btn",type:"hover",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){},closeFn:function(tipDom,targetDom,tipFn){}});st.tooltipNew.run({selector:".storeInformation-icon",type:"hover",placement:"bottom",openFn:function(options,tipDom,targetDom,tipFn){var o2oStoreCode=$(targetDom).attr("o2oStoreCode");if(o2oStoreCode!=null&&o2oStoreCode!=""&&o2oStoreCode!="undefined"){queryO2OStoreInfo(o2oStoreCode,tipDom)}},closeFn:function(tipDom,targetDom,tipFn){}});st.tooltipNew.run({selector:".cart-toolbar .checkout-disable-tip",type:"hover",placement:"top",wrapper:".cart-checkout",flag:"sp-cart-checkout",openFn:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html('<p style="position:relative;z-index:2;padding: 5px 11px;">请至少选择一件商品，再去结算</p>')},closeFn:function(tipDom,targetDom,tipFn){}});st.tooltipNew.run({selector:".cart-toolbar .checkout-subsidy-tip",type:"hover",placement:"top",wrapper:".cart-checkout",flag:"sp-cart-checkout-subsidy",openFn:function(options,tipDom,targetDom,tipFn){tipDom.find(".ui-tooltip-inner").html('<p style="position:relative;z-index:2;padding: 5px 11px;">您的订单中包含节能补贴商品，建议分开结算</p>')},closeFn:function(tipDom,targetDom,tipFn){}});st.tooltipNew.run({selector:".m-lion-dialog .limit-help",type:"hover",placement:"bottom",wrapper:".m-lion-dialog .abroad-h3-1",node:"#abroadTipDom",flag:"abroad-limit-tip",openFn:function(options,tipDom,targetDom,tipFn){},closeFn:function(tipDom,targetDom,tipFn){}});var timer_ship;$(document).on("mouseenter",".ship-desc .gather .tip-icon",function(){clearTimeout(timer_ship);var _that=$(this),idaddr=_that.attr("idaddr");if(_that.find(".single-tooltip").size()>0){return}var obj={msg:$("#"+idaddr).html()||"",wrap:_that,pos:"bottom",style:{left:-210,top:28}};if(obj.msg!=""){cart2Util.tip(obj)}});$(document).on("mouseleave",".ship-desc .gather .tip-icon",function(){var tipDom=$(this).find(".single-tooltip");timer_ship=setTimeout(function(){tipDom.animate({opacity:0},1000,function(){tipDom.unbind("hover").remove()})},200)});$(document).on("click",".ui-tooltip .fare-info-tip .all-tips",function(){if($(this).hasClass("all-tips-active")){$(this).removeClass("all-tips-active");$(".ui-tooltip .ship-rule-box").hide()}else{$(this).addClass("all-tips-active");$(".ui-tooltip .ship-rule-box").show()}});$(document).on("click",function(event){if($(event.target).closest(".all-tips").size()==0){$(".ui-tooltip .ship-rule-box").hide();$(".ui-tooltip .fare-info-tip .all-tips").removeClass("all-tips-active")}})},resetBtn:function(domArrClass,domClass){var dArr=$(domArrClass);dArr.removeData("tipForce").css({cursor:"pointer"});dArr.each(function(){if($(this).hasClass(domClass)){var targetNum=$(this).data("tipNum");$(this).removeData("tipNum").removeClass(domClass);$(this).removeData("tipShow");$(".ui-tooltip[data-tip-targetnum = "+targetNum+"]").remove();return}});dArr=null}};cloudCart1.ieVesion=function(ver){var b=document.createElement("b");b.innerHTML="<!--[if IE "+ver+"]><i></i><![endif]-->";return b.getElementsByTagName("i").length===1};cloudCart1.fareMerge=function(){cloudCart.tab({selector:".fare-tab",event:"mouseover",delay:100,selected:"current"})};cloudCart1.couponExpand=function(){$(document).on("click",".coupon-select .cart-usable-pro",function(){var _this=$(this),_parent=_this.closest(".item");if(_parent.hasClass("item-open")){_parent.removeClass("item-open")}else{_parent.addClass("item-open")}})};cloudCart1.packCartOneParamForCoupon=function(){var jsonStr;var cityId=cloudCart1.getCityCode();if(cityId==null||cityId==""){cityId="025"}var productFlag=0;jsonStr='{"cityId": "'+cityId+'","sumMoney": "'+$(".cart-toolbar-box .sn-price.price-color").text().slice(1)+'","sumSave": "'+$(".cart-toolbar-box .cart-sub-total.mr20").find("em").html()+'","productList":[';$(".cart-wrapper .item-checked").each(function(){var _that=this;var product=$(_that).find(".cart-checkbox input");if(product.length==0){return true}var activitytype=$(product).attr("activitytype");if(activitytype=="16"){return true}if(activitytype=="04"){var products=$(_that).find(".suit-item-list input");var mainProductId=product.attr("id");products.each(function(){var itemNo=$(this).attr("itemNo");var overSeasFlag=$(this).attr("overSeasFlag");var subActivityType=$(this).attr("subActivityType");var mainProductStatus=$(this).attr("mainProductStatus");if(mainProductStatus=="0"){var accessoryRelationID=$(this).attr("accessoryRelationID");if(accessoryRelationID=="undefined"||accessoryRelationID==null||accessoryRelationID==""){return true}}productFlag=1;var swlFlag=$(this).attr("swlFlag");var commdtyType="";if(swlFlag!="undefined"&&swlFlag=="1"){commdtyType="2"}jsonStr+='{"itemId":"'+itemNo+'", "commdtyCode":"'+$(this).attr("cmmdtycode")+'", "businessSign":"'+cloudCart1.getBusinessSign(overSeasFlag,$(this).attr("activityType"),$(this).attr("subActivityType"))+'", "marketingActivityType":"'+cloudCart1.getMarketingActivityType(activitytype,subActivityType)+'", "listPrice":"'+$(this).attr("salesprice")+'", "commdtyType":"'+commdtyType+'", "storeId":"'+$(this).attr("shopcode")+'", "productQty":"'+$(this).attr("cmmdtyqty")+'","discountList":[';var promotiontype=$(this).attr("promotype");var promotionPrice=$(this).attr("allocatedamount");if((promotiontype=="5"||promotiontype=="8")&&mainProductId==itemNo&&!((typeof promotionPrice==="undefined")||($.trim(promotionPrice)==="")||($.trim(promotionPrice).length===0))){jsonStr+='{"activityType":"'+promotiontype+'","discount":"'+promotionPrice+'"}]},'}else{jsonStr+="]},"}})}else{if(activitytype=="23"){var products=$(_that).find(".suit-item-list input");products.each(function(){var itemNo=$(this).attr("itemNo");var overSeasFlag=$(this).attr("overSeasFlag");var subActivityType=$(this).attr("subActivityType");var mainProductStatus=$(this).attr("mainProductStatus");if(mainProductStatus=="0"){return true}productFlag=1;var swlFlag=$(this).attr("swlFlag");var commdtyType="";if(swlFlag!="undefined"&&swlFlag=="1"){commdtyType="2"}jsonStr+='{"itemId":"'+itemNo+'", "commdtyCode":"'+$(this).attr("cmmdtycode")+'", "businessSign":"'+cloudCart1.getBusinessSign(overSeasFlag,$(this).attr("activityType"),$(this).attr("subActivityType"))+'", "marketingActivityType":"'+cloudCart1.getMarketingActivityType(activitytype,subActivityType)+'", "listPrice":"'+$(this).attr("salesprice")+'", "commdtyType":"'+commdtyType+'", "storeId":"'+$(this).attr("shopcode")+'", "productQty":"'+$(this).attr("cmmdtyqty")+'","discountList":[';var promotiontype=$(this).attr("promotypeZ");var promotionPrice=$(this).attr("allocatedamountZ");if((promotiontype=="5"||promotiontype=="8")&&!((typeof promotionPrice==="undefined")||($.trim(promotionPrice)==="")||($.trim(promotionPrice).length===0))){jsonStr+='{"activityType":"'+promotiontype+'","discount":"'+promotionPrice+'"}'}var nonCodeAmount=$(this).attr("nonCodeAmount");if(!((typeof nonCodeAmount==="undefined")||($.trim(nonCodeAmount)===""))){if((promotiontype=="5"||promotiontype=="8")&&!((typeof promotionPrice==="undefined")||($.trim(promotionPrice)==="")||($.trim(promotionPrice).length===0))){jsonStr+=","}jsonStr+='{"activityType":"4","discount":"'+nonCodeAmount+'"}]},'}else{jsonStr+="]},"}})}else{if(activitytype=="06"){var products=$(_that).find(".suit-item-list input");products.each(function(){var overSeasFlag=$(this).attr("overSeasFlag");var subActivityType=$(this).attr("subActivityType");productFlag=1;var swlFlag=$(this).attr("swlFlag");var commdtyType="";if(swlFlag!="undefined"&&swlFlag=="1"){commdtyType="2"}jsonStr+='{"itemId":"'+$(this).attr("itemNo")+'", "commdtyCode":"'+$(this).attr("cmmdtycode")+'", "businessSign":"'+cloudCart1.getBusinessSign(overSeasFlag,$(this).attr("activityType"),$(this).attr("subActivityType"))+'", "marketingActivityType":"'+cloudCart1.getMarketingActivityType(activitytype,subActivityType)+'", "listPrice":"'+$(this).attr("salesprice")+'", "commdtyType":"'+commdtyType+'", "storeId":"'+$(this).attr("shopcode")+'", "productQty":"'+$(this).attr("cmmdtyQty")+'","discountList":[]},'})}else{var overSeasFlag=$(product).attr("overSeasFlag");var subActivityType=$(product).attr("subActivityType");productFlag=1;var swlFlag=$(product).attr("swlFlag");var commdtyType="";if(swlFlag!="undefined"&&swlFlag=="1"){commdtyType="2"}var supplierCmmdtyCode="";if(($(product).attr("activityType")=="02"&&$(product).attr("subActivityType")=="14")||($(product).attr("shopCode")=="0000000000"&&$(product).attr("overSeasFlag")=="927HWG")){supplierCmmdtyCode=$(product).attr("supplierCode")}jsonStr+='{"itemId":"'+$(product).attr("id")+'", "supplierCmmdtyCode":"'+supplierCmmdtyCode+'","commdtyCode":"'+$(product).attr("cmmdtycode")+'", "businessSign":"'+cloudCart1.getBusinessSign(overSeasFlag,$(product).attr("activityType"),$(product).attr("subActivityType"))+'", "marketingActivityType":"'+cloudCart1.getMarketingActivityType(activitytype,subActivityType)+'", "listPrice":"'+$(product).attr("salesprice")+'", "commdtyType":"'+commdtyType+'", "storeId":"'+$(product).attr("shopcode")+'", "productQty":"'+$(product).attr("cmmdtyQty")+'","discountList":[';var promotiontype=$(product).attr("promotype");var promotionPrice=$(product).attr("allocatedamount");if((promotiontype=="5"||promotiontype=="8")&&!((typeof promotionPrice==="undefined")||($.trim(promotionPrice)==="")||($.trim(promotionPrice).length===0))){jsonStr+='{"activityType":"'+promotiontype+'","discount":"'+promotionPrice+'"}]},'}else{jsonStr+="]},"}}}}});if(productFlag==1){jsonStr=jsonStr.substring(0,(jsonStr.length-1))}var shopFlag=0;jsonStr+='],"shopList":[';$(".m-store").each(function(){if($(this).find(".item-checked").length>0){shopFlag=1;if(typeof $(this).attr("id")!="undefined"&&$(this).attr("id")=="store-0000000000"){if(typeof($("#newFreightGray").val())!="undefined"&&$("#newFreightGray").val()=="true"&&$("#basicFare").val()!="undefined"&&$("#basicFare").val()!=""){jsonStr+='{"shopCode":"'+$(this).attr("storeid")+'", "freightAmount":"'+$("#basicFare").val()+'","businessSign":"0"},'}else{jsonStr+='{"shopCode":"'+$(this).attr("storeid")+'", "freightAmount":"'+$(this).attr("storefee")+'","businessSign":"0"},'}}else{if(typeof $(this).attr("id")!="undefined"&&$(this).attr("id")=="store-0000000000-tm"){jsonStr+='{"shopCode":"'+$(this).attr("storeid")+'", "freightAmount":"'+$(this).attr("storefee")+'","businessSign":"5"},'}else{if(typeof $(this).attr("id")!="undefined"&&$(this).attr("id")=="store-0000000000-snhwg"){jsonStr+='{"shopCode":"'+$(this).attr("storeid")+'", "freightAmount":"'+$(this).attr("storefee")+'","businessSign":"1"},'}else{if(typeof $(this).attr("storeType")!="undefined"&&($(this).attr("storeType")=="927HWG"||$(this).attr("storeType")=="927HWG1")){jsonStr+='{"shopCode":"'+$(this).attr("storeid")+'", "freightAmount":"'+$(this).attr("storefee")+'","businessSign":"1"},'}else{jsonStr+='{"shopCode":"'+$(this).attr("storeid")+'", "freightAmount":"'+$(this).attr("storefee")+'","businessSign":"0"},'}}}}}});if(shopFlag==1){jsonStr=jsonStr.substring(0,(jsonStr.length-1))}jsonStr+='],"aftersaleProductList":[';$(".item-checked").find(".sun-package-list #haoye").each(function(){jsonStr+='{"aftersaleProductItemNo":"'+$(this).attr("itemNo")+'", "aftersaleCommdtyCode":"'+$(this).attr("cmmdtyCode")+'", "aftersaleProductQty":"'+$(this).attr("cmmdtyQty")+'", "aftersaleProductPrice":"'+$(this).attr("cmmdtyPrice")+'"},'});if($(".item-checked").find(".sun-package-list #haoye").length>0){jsonStr=jsonStr.substring(0,(jsonStr.length-1))}jsonStr+="]}";return jsonStr};cloudCart1.getBusinessSign=function(overseaFlag,activeType,subActiveType){if(activeType=="02"&&subActiveType=="14"){return"5"}else{if(overseaFlag!=null&&overseaFlag!=""){return"1"}else{return"0"}}};cloudCart1.getMarketingActivityType=function(activeType,subActiveType){if(activeType=="03"){return"5"}if((activeType=="02"||activeType=="12")&&subActiveType!=null&&subActiveType!=""){if(subActiveType=="1"){return"1"}if(subActiveType=="2"){return"5"}if(subActiveType=="3"){return"6"}if(subActiveType=="4"){return"7"}if(subActiveType=="5"){return"3"}if(subActiveType=="6"){return"2"}if(subActiveType=="7"){return"9"}if(subActiveType=="8"){return"10"}if(subActiveType=="10"){return"11"}if(subActiveType=="14"){return"21"}}return"0"};cloudCart1.sendSAMessageV3=function(typeName,errorType,errorCode,errorDetail){try{var param={type_name:typeName,error_type:errorType,error_code:errorCode,error_detail:errorDetail,member_id:getCookie("custno"),member_level:getCookie("custLevel"),region:getCookie("SN_CITY"),bid:"ccfShop"};sa.openAPI.sendMsgV2(param)}catch(e){}};cloudCart1.dealPreZeroPartnum=function(str){var rg=new RegExp("^0*");return str.replace(rg,"")};function cmsCallback(data){if(typeof(data.llqx_ad)!="undefined"&&typeof(data.llqx_ad.tag)!="undefined"&&typeof(data.llqx_ad.tag[0])!="undefined"){if(data.llqx_ad.tag[0].linkUrl!=undefined&&data.llqx_ad.tag[0].picUrl){var advertiseDiv='<div class="cart-top-pic"><a name="icart1_top_row_wind" href="'+data.llqx_ad.tag[0].linkUrl+'" title="'+data.llqx_ad.tag[0].elementName+'" target="_blank"><img src="//image.suning.cn'+data.llqx_ad.tag[0].picUrl+'" alt="'+data.llqx_ad.tag[0].elementName+'"></a></div>';$("#cart-g-logo").before(advertiseDiv)}}}function quanCallBack(data){var errorType="1";if(data.actUrlList!="undefined"&&data.actUrlList.length>0){for(var i=0;i<data.actUrlList.length;i++){if(data.actUrlList[i].resultUrl!=""){$("div[id^= 'promotion-"+data.actUrlList[i].actId+"']").each(function(){if($(this).attr("satisfiedFlag")=="T"){$(this).find(".name-info").after("<a href='"+data.actUrlList[i].resultUrl+"' class='meet-cut-go' name='icart1_collect' target='_blank'>再逛逛</a>")}else{$(this).find(".name-info").after("<a href='"+data.actUrlList[i].resultUrl+"' class='meet-cut-go' name='icart1_collect' target='_blank'>去凑单</a>")}})}else{sa.openAPI.sendMessage("GetPromoCoudan",data.errorCode+"&&"+errorType+"&&"+data.errorMsg+"（"+data.actUrlList[i].actId+"）&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("GetPromoCoudan",errorType,data.errorCode,data.errorMsg+"（"+data.actUrlList[i].actId+"）")}}}else{sa.openAPI.sendMessage("GetPromoCoudan",data.errorCode+"&&"+errorType+"&&"+data.errorMsg+"&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("GetPromoCoudan",errorType,data.errorCode,data.errorMsg)}}function cquanCallBack(data){var errorType="1";if(data.actUrlList!="undefined"&&data.actUrlList.length>0){for(var i=0;i<data.actUrlList.length;i++){if(data.actUrlList[i].resultUrl!=""){$(".tool-area-box .all-store-discount-content").each(function(){if(data.actUrlList[i].actId==$(this).attr("promotionId")){if($(this).attr("satisfiedFlag")=="T"){$(this).append('<a href="'+data.actUrlList[i].resultUrl+'" class="go-merge"  target="_blank">再逛逛</a>')}else{$(this).append('<a href="'+data.actUrlList[i].resultUrl+'" class="go-merge"  target="_blank">去凑单</a>')}}})}else{sa.openAPI.sendMessage("GetCPromoCoudan",data.errorCode+"&&"+errorType+"&&"+data.errorMsg+"（"+data.actUrlList[i].actId+"）&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("GetCPromoCoudan",errorType,data.errorCode,data.errorMsg+"（"+data.actUrlList[i].actId+"）")}}}else{sa.openAPI.sendMessage("GetCPromoCoudan",data.errorCode+"&&"+errorType+"&&"+data.errorMsg+"&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("GetCPromoCoudan",errorType,data.errorCode,data.errorMsg)}}function queryO2OStoreInfo(storeCode,tipDom){var stordId="sCode_"+storeCode;if($("#"+stordId).length>0){var storeAddress=$("#"+stordId).attr("storeAddress");var storeTel=$("#"+stordId).attr("storeTel");$(tipDom).find("span.o2oAdressSpan").html(storeAddress);$(tipDom).find("span.o2oTelSpan").html(storeTel)}else{$.ajax({type:"GET",url:"o2o/queryStoreInfo.do",data:{storeCode:storeCode},dataType:"json",success:function(data){var code=data.code;if(code=="1"&&data.data!="undefined"&&data.data!=null){var result=data.data;if(result.isSuccess=="Y"&&result.storeInfo!=null&&result.storeInfo!="undefined"){var storeAdd=result.storeInfo.storeAdd;var storeTel=result.storeInfo.storeTel;if(typeof storeAdd=="null"&&storeAdd!=""&&typeof storeAdd=="null"&&storeTel!=""){$("body").append('<input type="hidden" id="sCode_'+storeCode+'" storeAddress ="'+storeAdd+'" storeTel="'+storeTel+'">')}$(tipDom).find("span.o2oAdressSpan").html(storeAdd);$(tipDom).find("span.o2oTelSpan").html(storeTel)}else{}}}})}};function recommendInit(){var lastCmmdtyCode=$("#lastCmmdtyCode").val();var secondCmmdtyCode=$("#secondCmmdtyCode").val();var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}var custNum=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}if(cityId==null){cityId="010"}sn.cityId=cityId;var recommendURL="";var recommendDomain="//tuijian.suning.com/recommend-portal/recommend/paramsBiz.jsonp?";var parameters="";if($(".chk-item").length==0){var parameter=[];var partnumbers=getCookie("smhst");if(null!=partnumbers){var count=0;var goods=partnumbers.split("a");$(goods).each(function(){if(count>4){return false}parameter.push("parameters=000000000"+this);count++});parameters=parameter.join("&")}}else{var parameter=[];if(typeof lastCmmdtyCode!="undefined"&&lastCmmdtyCode&&lastCmmdtyCode!="undefined"){parameter.push("parameters="+lastCmmdtyCode);if(typeof secondCmmdtyCode!="undefined"&&secondCmmdtyCode&&secondCmmdtyCode!="undefined"){parameter.push("parameters="+secondCmmdtyCode)}}parameters=parameter.join("&")}if(parameters==""){parameters="parameters="}var u="&u=";if(typeof custNum!="undefined"&&custNum&&custNum!="undefined"){u=u+custNum}if($(".chk-item").length!=0){recommendURL=recommendDomain+parameters+"&cityId="+cityId+"&sceneIds=10-23&count=40"+u+"&c="+c+"&flag="}else{recommendURL=recommendDomain+parameters+"&cityId="+cityId+"&sceneIds=10-23&count=40"+u+"&c="+c+"&flag=1"}$.ajax({type:"get",url:recommendURL,dataType:"jsonp",cache:true,jsonpCallback:"jsonpCallback",success:function(){},error:function(){$("#recommendDiv").html("");$("#recommendArea").addClass("hide")}})}function getItemLi(a,b,c,d,e,f,g,h,i,j,k,l,type,pt){var productDomain="//product.suning.com";var itemLi=[],positionIndex=(Math.floor((b-1)/4)+1)+"-"+(b%4==0?4:b%4);var imgUrl=$("#imgNewUrl").val();var promotionInfoSpan="";if(j!=""){promotionInfoSpan="<span class='rmd-flag'>"+j+"</span>"}if(i=="0000000000"){if((pt=="4"||pt=="5")&&type!="hand"){promotionInfoSpan+="<span class='abroad-flag'>海外购自营</span>"}else{promotionInfoSpan+="<span class='rmd-flag'>自营</span>"}}var sign="_rectjsp_";if(type=="hand"){sign="_recgthsp_";itemLi.push('<li class="product-box " >')}else{itemLi.push('<li class="product-box unlikeSign" >')}itemLi.push('<a  target="_blank" name="cart1_'+d+sign+positionIndex+"_p_"+i+"_"+d+"_"+h+'" href='+productDomain+"/"+i+"/"+dealPreZeroPartnum(d)+".html?src=cart1_"+d+sign+positionIndex+"_p_"+i+"_"+d+"_"+h+' target="_blank" cmmdtycode="'+d+'" class="product-pic unlikeASign"><img lazy-src="'+imgUrl+"/"+i+"-"+d+'_1_200x200.jpg" class="product-img"/></a>');if(typeof g!="undefined"&&g!=""){var arrPrice=g.split(".");var tempHtml='<p class="product-price-num"><span class="sn-price clearfix"><i class="price-icon l">&yen;</i><em class="price-big l">'+arrPrice[0]+"</em>";if(typeof(arrPrice[1])!="undefined"&&arrPrice[1]!=""){tempHtml+='<em class="price-small l">.'+arrPrice[1]+"</em></span>"}else{tempHtml+='<em class="price-small l">.00</em></span>'}itemLi.push(tempHtml)}else{itemLi.push('<p class="product-price-num"><span class="sn-price clearfix"><i class="price-icon l"></i><em class="price-big l"></em><em class="price-small l"></em></span>')}if(typeof k!="undefined"&&k!=null&&k!=""&&k!=0){if(k>10000){var num=parseInt(k/10000);var num1=parseInt((k%10000)/1000);if(num1!=0){num=num+"."+num1}k=num+"万"}itemLi.push('<span class="product-num"><em>'+k+"</em>人已购买</span>")}itemLi.push("</p>");itemLi.push('<p class="product-name">'+promotionInfoSpan+"<a href="+productDomain+"/"+i+"/"+dealPreZeroPartnum(d)+".html?src=cart1_"+d+sign+positionIndex+"_c_"+i+"_"+d+"_"+h+' class="product-content" target="_blank" id="baoguang'+sign+positionIndex+"_"+i+"_"+d+"_"+h+'" name="cart1_'+d+sign+positionIndex+"_c_"+i+"_"+d+"_"+h+'" title="'+e+'">'+e+"<b>"+f+"</b></a></p>");var shopcode=i;if(l=="14"){shopcode="0000000000"}itemLi.push('<a class="add-cart" cmmdtyCode="'+d+'" shopCode="'+shopcode+'" name="cart1_'+d+sign+positionIndex+"_b_"+i+"_"+d+"_"+h+'"><i></i>加入购物车</a>');itemLi.push("</li>");return itemLi.join("")}function jsonpCallback(json){if(typeof json=="undefined"||typeof json.sugGoods[0]=="undefined"||typeof json.sugGoods[0].skus=="undefined"||json.sugGoods[0].skus==null||json.sugGoods[0].skus.length==0){if($.trim($("#handShopDiv").html())==""&&$.trim($("#favoriteDiv").html())==""){$(".cart-recommend").addClass("hide")}return}$(".cart-recommend").removeClass("hide");$("#recommendArea").removeClass("hide");var count=0;$.each(json.sugGoods[0],function(k,v){var items=[],skus=[];if(k=="skus"){skus=v;var skuLength=skus.length;if(skus.length!=0){$.each(skus,function(){count++;items.push(getItemLi(skuLength,count,this.sugGoodsId,this.sugGoodsCode,this.sugGoodsName,this.sugGoodsDes,this.price,this.handwork,this.vendorId,this.promotionInfo,this.salesVolume,this.promotionType,"",this.productType))})}$("#recommendDiv").append(items.join(""));if($("#handShopTab").hasClass("hide")&&$("#myFavoriteProduct").hasClass("hide")){cloudCart1.recommendFn.init();$("#recommendArea").find(".recommend-name").trigger("mouseenter");cloudCart1.runAnalyseExpo()}lazyelem.listen()}})}function recommendAddCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyCmmdtyCodeArray,obj){addCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyCmmdtyCodeArray,"","",recommendCallBack);function recommendCallBack(data){var errorList=data.addCartErrorList;if(data.isSuccess=="Y"){$.ajax({type:"GET",dataType:"jsonp",url:"addCallBack.do",crossDomain:true,success:function(data){if(data.result=="true"&&data.html!=""){cloudCart1.refreshPage(data)}}});cloudCart1.recommendFn.successFn(obj)}else{if(errorList.length>0){if(errorList[0].errorCode=="002"){cloudCart1.recommendFn.errorFn(obj,"购物车已满，请去清理一下吧")}else{if(errorList[0].errorCode=="003"){cloudCart1.recommendFn.errorFn(obj,"此商品暂不销售")}else{if(errorList[0].errorCode=="004"){cloudCart1.recommendFn.errorFn(obj,"此商品无货")}else{if(errorList[0].errorCode=="017"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M017)")}else{if(errorList[0].errorCode=="018"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M018)")}else{if(errorList[0].errorCode=="019"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M019)")}else{cloudCart1.recommendFn.errorFn(obj,"请前往详情页面购买")}}}}}}}else{cloudCart1.recommendFn.errorFn(obj,"请前往详情页面购买")}}}}function favoriteInit(){var cartOneMyCollectionSwitch=$("#cartOneMyCollectionSwitch").val();if(cartOneMyCollectionSwitch!="1"){return}var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}if(typeof cityId=="undefined"||!cityId||cityId=="undefined"){return}$("#myFavoriteProduct").show();$("#favoriteDiv").html("");probeAuthStatus(function(){mySuningFav.getProductFavToCartJsonp(cityId,10,productFavoriteCallBack)},function(){$("#favoriteDiv").html("");$("#myFavoriteProduct").hide()})}function productFavoriteCallBack(productInfoList){var imgUrl=$("#imgNewUrl").val();var itemLi=[];if(typeof productInfoList!="undefined"&&productInfoList&&productInfoList!="undefined"&&productInfoList.length!=0){$(".cart-recommend").removeClass("hide");$("#myFavoriteProduct").removeClass("hide");var cutDownSum=0;$.each(productInfoList,function(){itemLi.push('<li class="product-box" >');itemLi.push('<a target="_blank" name="shop_'+this.partnumber+"_shoucang_1-1_p_"+this.shopId+"_"+this.partnumber+'" href='+productDomain+"/"+this.shopId+"/"+dealPreZeroPartnum(this.partnumber)+".html?cart=shop_"+this.partnumber+"_shoucang_1-1_p_"+this.shopId+"_"+this.partnumber+'  target="_blank" class="product-pic" ><img lazy-src="'+imgUrl+"/"+this.shopId+"-"+this.partnumber+'_1_200x200.jpg" class="product-img"/>');var faPrice=this.cutDownPrice;if(typeof faPrice!="undefined"&&faPrice!=""&&faPrice>0){cutDownSum++;itemLi.push('<p class="reduce">已降价<span class="sn-price"><i>&yen;</i><em>'+faPrice+"</em></span></p>")}itemLi.push("</a>");itemLi.push('<p class="product-price-num">');if(typeof this.price!="undefined"&&this.price!=""){var arrPrice=this.price.split(".");var tp='<span class="sn-price clearfix"><i class="price-icon l">&yen;</i><em class="price-big l">'+arrPrice[0]+"</em>";if(typeof(arrPrice[1])!="undefined"&&arrPrice[1]!=""){tp+='<em class="price-small l">.'+arrPrice[1]+"</em></span>"}else{tp+='<em class="price-small l">.00</em></span>'}itemLi.push(tp)}else{itemLi.push('<span class="sn-price clearfix"><i class="price-icon l"></i><em class="price-big l"></em><em class="price-small l"></em></span>')}itemLi.push("</p>");itemLi.push('<p class="product-name">');itemLi.push('<a class="product-content" target="_blank" href='+productDomain+"/"+this.shopId+"/"+dealPreZeroPartnum(this.partnumber)+'.html  class="product-content" target="_blank"  name="shop_'+this.partnumber+"_shoucang_1-1_c_"+this.shopId+"_"+this.partnumber+'" title="'+this.productName+'" id="baoguang_shoucang_1-1_'+this.shopId+"_"+this.partnumber+'">'+this.productName+"</a></p>");var shopcode=this.shopId;if(this.pdtType=="1"||(this.pdtType=="2"&&this.shoptType=="Y")){shopcode="0000000000"}itemLi.push('<a class="add-cart" cmmdtyCode="'+this.partnumber+'" shopCode="'+shopcode+'"   name="shop_'+this.partnumber+"_shoucang_1-1_b_"+this.shopId+"_"+this.partnumber+'"><i></i>加入购物车</a>');itemLi.push("</li>");itemLi.join("")});if(cutDownSum>0){$("#myFavourite_cutDown_tab").show()}else{$("#myFavourite_cutDown_tab").hide()}$("#favoriteDiv").append(itemLi.join(""));if($("#handShopTab").hasClass("hide")&&$("#recommendArea").hasClass("hide")){cloudCart1.recommendFn.init();$("#myFavoriteProduct").find(".recommend-name").trigger("mouseenter");cloudCart1.runAnalyseExpo()}lazyelem.listen()}else{if($.trim($("#handShopDiv").html())==""&&$.trim($("#recommendDiv").html())==""){$(".cart-recommend").addClass("hide")}$("#favoriteDiv").html("");$("#myFavoriteProduct").hide()}}function handShopingInit(){var custLevel=$.cookie("custLevel");if(custLevel!="161000000100"){return}var lastCmmdtyCode=$("#lastCmmdtyCode").val();var secondCmmdtyCode=$("#secondCmmdtyCode").val();var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}var custNum=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}if(cityId==null){cityId="010"}sn.cityId=cityId;var recommendURL="";var recommendDomain="//tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp?";var parameters="";if($(".chk-item").length==0){var parameter=[];var partnumbers=getCookie("smhst");if(null!=partnumbers){var count=0;var goods=partnumbers.split("a");$(goods).each(function(){if(count>4){return false}parameter.push("parameters=000000000"+this);count++});parameters=parameter.join("&")}}else{var parameter=[];if(typeof lastCmmdtyCode!="undefined"&&lastCmmdtyCode&&lastCmmdtyCode!="undefined"){parameter.push("parameters="+lastCmmdtyCode);if(typeof secondCmmdtyCode!="undefined"&&secondCmmdtyCode&&secondCmmdtyCode!="undefined"){parameter.push("parameters="+secondCmmdtyCode)}}parameters=parameter.join("&")}if(parameters==""){parameters="parameters="}var u="&u=";if(typeof custNum!="undefined"&&custNum&&custNum!="undefined"){u=u+custNum}if($(".chk-item").length!=0){recommendURL=recommendDomain+parameters+"&cityId="+cityId+"&sceneIds=4-15&count=24"+u+"&c="+c}else{recommendURL=recommendDomain+parameters+"&cityId="+cityId+"&sceneIds=4-15&count=24"+u+"&c="+c}$.ajax({type:"get",url:recommendURL,dataType:"jsonp",cache:true,jsonpCallback:"handShopCallback",success:function(){},error:function(){$(".cart-recommend").addClass("hide");$("#handShopDiv").html("");$("#handShopTab").addClass("hide")}})}function handShopCallback(json){if(typeof json=="undefined"||typeof json.sugGoods[0]=="undefined"||typeof json.sugGoods[0].skus=="undefined"||json.sugGoods[0].skus==null||json.sugGoods[0].skus.length==0){if($.trim($("#recommendDiv").html())==""&&$.trim($("#favoriteDiv").html())==""){$(".cart-recommend").addClass("hide")}$("#handShopTab").addClass("hide");return}$(".cart-recommend").removeClass("hide");$("#handShopTab").removeClass("hide");var count=0;$.each(json.sugGoods[0],function(k,v){var items=[],skus=[];if(k=="skus"){skus=v;var skuLength=skus.length;if(skus.length!=0){$.each(skus,function(){count++;items.push(getItemLi(skuLength,count,this.sugGoodsId,this.sugGoodsCode,this.sugGoodsName,this.sugGoodsDes,this.price,this.handwork,this.vendorId,this.promotionInfo,"",this.promotionType,"hand",this.productType))})}$("#handShopDiv").append(items.join(""));if($("#recommendArea").hasClass("hide")&&$("#myFavoriteProduct").hasClass("hide")){cloudCart1.recommendFn.init();$("#handShopTab").find(".recommend-name").trigger("mouseenter");cloudCart1.runAnalyseExpo()}lazyelem.listen()}})}function dealPreZeroPartnum(str){var rg=new RegExp("^0*");return str.replace(rg,"")}var unlike={sendUnlike:function(parameter){var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}var recommendDomain="unLike.do?c="+c+"&parameter="+parameter;$.ajax({type:"get",url:recommendDomain,success:function(data){}})}};function alwayBuyInit(){var cityId=null;var snCity=$.cookie("SN_CITY");if(null!=snCity){var tempCityArray=snCity.split("_");if(tempCityArray.length>2){cityId=tempCityArray[1]}}if(cityId==null||cityId=="undefined"){cityId="010"}var userId=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}var c="";if(typeof arr[1]!="undefined"&&arr[1]&&arr[1]!="undefined"){c=c+arr[1]}var recommendDomain="changGou.do";var inputData={userId:userId,cookieId:c,sceneIds:["5-35"],cityId:cityId,count:5};$.ajax({type:"post",url:recommendDomain,contentType:"application/json",dataType:"json",data:JSON.stringify(inputData),success:function(data){if(data.code=="1"){var sugGoods=data.data.sugGoods;if(sugGoods!=null&&sugGoods.length>0){for(var i=0;i<sugGoods.length;i++){if(sugGoods[i].resCode=="01"&&sugGoods[i].sceneId=="5-35"){changgouList(sugGoods[i]);break}}}}}})}function changgouList(goods){if(goods.skus==null||goods.skus.length<1){return}var goodsList=goods.skus;var productDomain="//product.suning.com";var sign="_recgwcycg_";var imgUrl=$("#imgNewUrl").val();var goodsLength=goodsList.length;if(goodsLength>5){goodsLength=5}var sb=[];for(var i=0;i<goodsLength;i++){var index=i+1;var positionIndex=(Math.floor((index-1)/4)+1)+"-"+(index%4==0?4:index%4);sb[sb.length]='<li class="product-box">';sb[sb.length]=' <a href="'+productDomain+"/"+goodsList[i].vendorId+"/"+dealPreZeroPartnum(goodsList[i].sugGoodsCode)+".html?src=cart1_"+goodsList[i].sugGoodsCode+sign+positionIndex+"_p_"+goodsList[i].sugGoodsCode+"_"+goodsList[i].sugGoodsCode+"_"+goodsList[i].handwork;sb[sb.length]='" target="_blank" class="product-pic">';sb[sb.length]='<img class="product-img lazy-loading" alt="" src="'+imgUrl+"/"+goodsList[i].vendorId+"-"+goodsList[i].sugGoodsCode+'_1_200x200.jpg">';var spread=goodsList[i].spread;if(spread!=""&&spread!="undefined"&&spread>0){sb[sb.length]='<p class="reduce">已降价<span class="sn-price"><i>&yen;</i><em>'+spread+"</em></span></p>"}sb[sb.length]=" </a>";sb[sb.length]='<p class="product-price-num">';sb[sb.length]=' <span class="sn-price clearfix"><i class="price-icon l">&yen;</i>';sb[sb.length]='<em class="price-big l">'+goodsList[i].price+'</em><em class="price-small l"></em></span>';if(!isNaN(goodsList[i].purchasesNumber)&&goodsList[i].purchasesNumber!=0){sb[sb.length]='<span class="product-num">已购<em>'+goodsList[i].purchasesNumber+"</em>次</span>"}else{if(!isNaN(goodsList[i].salesVolume)&&goodsList[i].salesVolume!=0){sb[sb.length]='<span class="product-num"><em>'+goodsList[i].salesVolume+"</em>人已购买</span>"}}sb[sb.length]="</p>";sb[sb.length]='<p class="product-name">';var promotionInfoSpan="";if(goodsList[i].promotionInfo!=""){promotionInfoSpan="<span class='rmd-flag'>"+goodsList[i].promotionInfo+"</span>"}var productType=goodsList[i].productType;if(goodsList[i].vendorId=="0000000000"){if(productType=="4"||productType=="5"){promotionInfoSpan+="<span class='abroad-flag'>海外购自营</span>"}else{promotionInfoSpan+="<span class='rmd-flag'>自营</span>"}}sb[sb.length]=promotionInfoSpan;sb[sb.length]='<a href="'+productDomain+"/"+goodsList[i].vendorId+"/"+dealPreZeroPartnum(goodsList[i].sugGoodsCode)+".html?src=cart1_"+goodsList[i].sugGoodsCode+sign+positionIndex+"_p_"+goodsList[i].sugGoodsCode+"_"+goodsList[i].sugGoodsCode+"_"+goodsList[i].handwork;sb[sb.length]='" title="" class="product-content" target="_blank">';sb[sb.length]=goodsList[i].sugGoodsName+"</a>";sb[sb.length]="</p>";var shopcode=goodsList[i].vendorId;if(productType=="1"||productType=="3"||productType=="4"||productType=="5"){shopcode="0000000000"}sb[sb.length]=' <a class="add-cart" cmmdtyCode="'+goodsList[i].sugGoodsCode+'" shopCode="'+shopcode+'" ><i></i>加入购物车</a>';sb[sb.length]="</li>"}var html=sb.join("");if(html!=""){$("#changgou_ul").append(html);$("#changgou_div").show()}};function gather_jsonpCallback(json,options,tipDom,targetDom,tipFn,needBuy){var region=json.sugGoods[0].skus;var size=region.length;if(size==0){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty);return}var oneAreaRegion=[];var twoAreaRegion=[];var threeAreaRegion=[];var fourAreaRegion=[];var fiveAreaRegion=[];for(var i=0;i<size;i++){var regionPrice=region[i].price;if(regionPrice!=undefined&&regionPrice!="undefined"&&regionPrice!=""){var areaId=Math.floor(regionPrice/10);if(areaId==0){oneAreaRegion.push(region[i])}else{if(areaId==1){twoAreaRegion.push(region[i])}else{if(areaId==2){threeAreaRegion.push(region[i])}else{if(areaId==3){fourAreaRegion.push(region[i])}else{fiveAreaRegion.push(region[i])}}}}}}var oneHtml=getItem_area_coudan(oneAreaRegion);var twoHtml=getItem_area_coudan(twoAreaRegion);var threeHtml=getItem_area_coudan(threeAreaRegion);var fourHtml=getItem_area_coudan(fourAreaRegion);var fiveHtml=getItem_area_coudan(fiveAreaRegion);var innerHtml=$($(targetDom.data().clonenode).clone().html());innerHtml.find(".J-fare-01").find(".list-box").html(oneHtml);innerHtml.find(".J-fare-02").find(".list-box").html(twoHtml);innerHtml.find(".J-fare-03").find(".list-box").html(threeHtml);innerHtml.find(".J-fare-04").find(".list-box").html(fourHtml);innerHtml.find(".J-fare-05").find(".list-box").html(fiveHtml);tipDom.addClass("sp-meet-cut-select");tipDom.find(".ui-tooltip-inner").html(innerHtml);tipDom.find(".fare-merge-order").attr("data-meet-cut",targetDom.attr("id"));tipFn.position(options,tipDom,targetDom);cartListLoop.listloop({wrap:".ui-tooltip .J-fare-01",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-02",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-03",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-04",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-05",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});var startIndex=0;if(needBuy!=undefined&&needBuy!="undefined"&&needBuy!=""){startIndex=Math.floor(needBuy/10);if(startIndex>4){startIndex=4}}cloudCart.tab({wrap:".ui-tooltip",selector:".ui-tooltip .fare-tab",event:"mouseover",delay:100,selected:"current",start:startIndex});cloudCart1.runAnalyseExpo()}function gather_jsonpCallback_freight(json,options,tipDom,targetDom,tipFn,needBuy){var region=json.sugGoods;var size=region.length;var sizeflag=true;var oneAreaRegion=[];var twoAreaRegion=[];var threeAreaRegion=[];var fourAreaRegion=[];var fiveAreaRegion=[];for(var i=0;i<size;i++){var regionSkus=region[i].skus;var skusSize=regionSkus.length;if(skusSize>0){sizeflag=false;for(var j=0;j<skusSize;j++){var regionPrice=regionSkus[j].price;if(regionPrice!=undefined&&regionPrice!="undefined"&&regionPrice!=""){var sceneId=region[i].sceneId;if(sceneId=="4-9"){oneAreaRegion.push(regionSkus[j])}else{if(sceneId=="4-10"){twoAreaRegion.push(regionSkus[j])}else{if(sceneId=="4-24"){threeAreaRegion.push(regionSkus[j])}else{if(sceneId=="4-25"){fourAreaRegion.push(regionSkus[j])}else{if(sceneId=="4-26"){fiveAreaRegion.push(regionSkus[j])}}}}}}}}}if(sizeflag){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty);return}var oneHtml=getItem_area_coudan_freight(oneAreaRegion,"1");var twoHtml=getItem_area_coudan_freight(twoAreaRegion,"2");var threeHtml=getItem_area_coudan_freight(threeAreaRegion,"3");var fourHtml=getItem_area_coudan_freight(fourAreaRegion,"4");var fiveHtml=getItem_area_coudan_freight(fiveAreaRegion,"5");var innerHtml=$($(targetDom.data().clonenode).clone().html());innerHtml.find(".J-fare-01").find(".list-box").html(oneHtml);innerHtml.find(".J-fare-02").find(".list-box").html(twoHtml);innerHtml.find(".J-fare-03").find(".list-box").html(threeHtml);innerHtml.find(".J-fare-04").find(".list-box").html(fourHtml);innerHtml.find(".J-fare-05").find(".list-box").html(fiveHtml);tipDom.addClass("sp-meet-cut-select");tipDom.find(".ui-tooltip-inner").html(innerHtml);tipDom.find(".fare-merge-order").attr("data-meet-cut",targetDom.attr("id"));tipFn.position(options,tipDom,targetDom);cartListLoop.listloop({wrap:".ui-tooltip .J-fare-01",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-02",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-03",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-04",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});cartListLoop.listloop({wrap:".ui-tooltip .J-fare-05",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});var startIndex=0;if(needBuy!=undefined&&needBuy!="undefined"&&needBuy!=""){startIndex=Math.floor(needBuy/10);if(startIndex>4){startIndex=4}}cloudCart.tab({wrap:".ui-tooltip",selector:".ui-tooltip .fare-tab",event:"mouseover",delay:100,selected:"current",start:startIndex});cloudCart1.runAnalyseExpo()}function getItem_area_coudan(areaRegion){html='<ul class="list">';var size=areaRegion.length;for(var i=0;i<size;i++){var index=i+1;html+=get_area_itemLi_coudan(areaRegion[i].sugGoodsId,index,areaRegion[i].sugGoodsCode,areaRegion[i].sugGoodsName,areaRegion[i].sugGoodsDes,areaRegion[i].price,areaRegion[i].handwork,areaRegion[i].vendorId,areaRegion[i].salesVolume);if((i+1)%6==0&&(i+1)!=size){html+="</ul>";html+='<ul class="list">'}}html+="</ul>";return html}function getItem_area_coudan_freight(areaRegion,tabIndex){html='<ul class="list">';var size=areaRegion.length;for(var i=0;i<size;i++){var index=i+1;html+=get_area_itemLi_coudan_freight(areaRegion[i].sugGoodsId,index,areaRegion[i].sugGoodsCode,areaRegion[i].sugGoodsName,areaRegion[i].sugGoodsDes,areaRegion[i].price,areaRegion[i].handwork,areaRegion[i].vendorId,areaRegion[i].salesVolume,tabIndex,areaRegion[i].weight);if((i+1)%6==0&&(i+1)!=size){html+="</ul>";html+='<ul class="list">'}}html+="</ul>";return html}function get_area_itemLi_coudan(a,b,c,d,e,f,g,h,i){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;itemLi.push("<li>");itemLi.push('<div class="pro-pic">');itemLi.push('<a name="cart1_'+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+'" href='+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+' target="_blank"><img src="'+imgUrl+"/"+h+"-"+c+'_1_160x160.jpg" /></a>');itemLi.push("</div>");itemLi.push('<div class="pro-info">');itemLi.push('<p  class="pro-name"><a href="'+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" class="pro-name" target="_blank" id="baoguang_reccd_'+positionIndex+"_"+h+"_"+c+"_"+g+'" title="'+d+'" name="cart1_'+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" title="'+d+'">'+d+"</a></p>");if(f!="undefined"&&f!=""){itemLi.push('<p class="sn-price price-color"><i>&yen;</i>'+f+"</em></p>")}else{itemLi.push('<p class="sn-price price-color"><i></i></em></p>')}itemLi.push("</div>");if(typeof i!="undefined"&&i!=""){itemLi.push('<div class="pro-num"><span class="buy-num"><em>'+i+"</em>人已购买</span></div>")}itemLi.push('<a  class="add-cart-24" cmmdtyCode="'+c+'" shopCode="'+h+'"></a>');itemLi.push("</li>");return itemLi.join("")}function get_area_itemLi_coudan_freight(a,b,c,d,e,f,g,h,i,j,k){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=j+"-"+b;itemLi.push("<li>");itemLi.push('<div class="pro-pic">');itemLi.push('<a name="cart1_'+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+'" href='+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+' target="_blank"><img src="'+imgUrl+"/"+h+"-"+c+'_1_160x160.jpg" /></a>');itemLi.push("</div>");itemLi.push('<div class="pro-info">');itemLi.push('<p  class="pro-name"><a href="'+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" class="pro-name" target="_blank" id="baoguang_reccd_'+positionIndex+"_"+h+"_"+c+"_"+g+'" title="'+d+'" name="cart1_'+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" title="'+d+'">'+d+"</a></p>");if((typeof i!="undefined"&&i!="")||(typeof k!="undefined"&&k!="")){itemLi.push('<div class="pro-num">');if(k!="undefined"&&k!=""){itemLi.push('<span class="pro-weight">'+k+"kg</span>")}if(typeof i!="undefined"&&i!=""){itemLi.push('<span class="buy-num"><em>'+i+"</em>人已购买</span>")}itemLi.push("</div>")}itemLi.push('<p class="sn-price price-color"><i>&yen;</i>'+f+"</em></p>");itemLi.push("</div>");itemLi.push('<a  class="add-cart-24" cmmdtyCode="'+c+'" shopCode="'+h+'"></a>');itemLi.push("</li>");return itemLi.join("")}function getItemLi_coudan(a,b,c,d,e,f,g,h){var imgUrl=$("#imgUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;itemLi.push("<li>");itemLi.push('<div class="cart-checkbox">');itemLi.push('<input type="checkbox"  class="checkbox chk-item" id="J_CheckBox_hg'+b+'" cmmdtyCode="'+c+'" shopCode="'+h+'" cmmdtyName="'+d+'" salesPrice="'+f+'">');itemLi.push('<label for="J_CheckBox_hg'+b+'"></label>');itemLi.push("</div>");itemLi.push('<div class="item-pic">');itemLi.push('<a name="cart1_'+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+'" href='+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+' target="_blank"><img src="'+imgUrl+"/000000000"+c.substring(9,14)+"/"+c+"/"+c+'_ls1.jpg" /></a>');itemLi.push("</div>");itemLi.push('<div class="item-info">');itemLi.push('<a href="'+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" class="item-title" target="_blank" id="baoguang_reccd_'+positionIndex+"_"+h+"_"+c+"_"+g+'" title="'+d+'" name="cart1_'+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" title="'+d+'">'+d+"</a>");itemLi.push('<b class="sn-price"><i>&yen;</i>'+f+"</em></b>");itemLi.push("</div>");itemLi.push("</li>");return itemLi.join("")}function cgather_jsonpCallback(json,options,tipDom,targetDom,tipFn){var region=json.sugGoods[0].skus;var size=region.length;if(size==0){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty);return}var innerHtml=$($(targetDom.data().clonenode).clone().html());var emtyFlag=false;for(var i=0;i<size;i++){var index=i+1,regionitem=region[i].list,html='<ul class="list">';activityId=region[i].activiyid,clength=regionitem.length;if(regionitem.length!=0){for(var j=0;j<clength;j++){html+=cget_area_itemLi_coudan(regionitem[j].sugGoodsId,index,regionitem[j].sugGoodsCode,regionitem[j].sugGoodsName,regionitem[j].sugGoodsDes,regionitem[j].price,regionitem[j].handwork,regionitem[j].vendorId,regionitem[j].salesVolume);if((j+1)%6==0&&(j+1)!=clength){html+="</ul>";html+='<ul class="list">'}}emtyFlag=true}html+="</ul>";innerHtml.find(".list-box").each(function(){var _that=$(this);if(_that.attr("promotionId")==activityId){_that.html(html)}})}if(!emtyFlag){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty);return}tipDom.addClass("sp-meet-cut-select");tipDom.find(".ui-tooltip-inner").html(innerHtml);tipDom.find(".fare-merge-order").attr("data-meet-cut",targetDom.attr("id"));tipFn.position(options,tipDom,targetDom);innerHtml.find(".add-on-container").each(function(){var id=this.id;cartListLoop.listloop({wrap:".ui-tooltip ."+id+"",loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:665,narrow:665},hasLabel:true,isRandom:false,hoverArr:true});var picLen=$(this).find(".content-title .list").length;if(picLen>9){cartListLoop.listloop({wrap:".ui-tooltip ."+id+"",loopBox:".pic-list ul",triggerLeft:".pic-prev",triggerRight:".pic-next",step:{wide:9,narrow:9},scrollWidth:{wide:450,narrow:450},hasLabel:false,isRandom:false,hoverArr:true})}else{var picWidth=picLen*50;$(".ui-tooltip .content-title .pic-list").css("width",picWidth);$(".ui-tooltip .content-title .pic-list").css("margin-right",0)}});cloudCart.tab({wrap:".ui-tooltip",selector:".ui-tooltip .fare-tab",event:"mouseover",delay:100,selected:"current",start:0});cloudCart1.runAnalyseExpo()}function cget_area_itemLi_coudan(a,b,c,d,e,f,g,h,i){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;itemLi.push("<li>");itemLi.push('<div class="pro-pic">');itemLi.push('<a name="cart1_'+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+'" href='+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_p_"+h+"_"+c+"_"+g+' target="_blank"><img src="'+imgUrl+"/"+h+"-"+c+'_1_160x160.jpg" /></a>');itemLi.push("</div>");itemLi.push('<div class="pro-info">');itemLi.push('<p  class="pro-name"><a href="'+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" class="pro-name" target="_blank" id="baoguang_reccd_'+positionIndex+"_"+h+"_"+c+"_"+g+'" title="'+d+'" name="cart1_'+c+"_reccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" title="'+d+'">'+d+"</a></p>");if(f!="undefined"&&f!=""){itemLi.push('<p class="sn-price price-color"><i>&yen;</i>'+f+"</em></p>")}else{itemLi.push('<p class="sn-price price-color"><i></i></em></p>')}if(typeof i!="undefined"&&i!=""){itemLi.push('<div class="pro-num"><span class="buy-num"><em>'+i+"</em>人已购买</span></div>")}itemLi.push("</div>");itemLi.push('<a  class="add-cart-24" cmmdtyCode="'+c+'" shopCode="'+h+'"></a>');itemLi.push("</li>");return itemLi.join("")}function gatherAddcart(cart){addCartBatch(cart,gatherCallBack);function gatherCallBack(data){if(data.isSuccess=="Y"){$.ajax({type:"GET",dataType:"jsonp",url:"addCallBack.do",crossDomain:true,success:function(data){if(data.result=="true"&&data.html!=""){cloudCart1.refreshPage(data);st.tooltipNew.allHide()}}})}else{var imgUrl=$("#imgUrl").val();var productDomain="//product.suning.com";var errorList=data.addCartErrorList;var itemLi="";var isHasOverCart=false;itemLi+='<div class="dialog-common limit-buy J-dialog-limit01">';itemLi+='<p class="tips"><i class="tip-icon tip-warning-24"></i>以下商品暂无法购买</p><a href="javascript:void(0);" class="arr prev"></a><a href="javascript:void(0);" class="arr next"></a><div class="list-pro-box "><ul class="list-box">';for(var j=0;j<errorList.length;j++){if(errorList[j].errorCode=="002"){itemLi='<div class="dialog-common system-busy"><div class="poor-lion clearfix"><i class="poor"></i><div class="tip-opt"><p>购物车已满，请去清理一下吧</p><a href="javascript:void(0);" class="dialog-opt dialog-certain close">知道了</a></div></div></div>';isHasOverCart=true;break}else{if(errorList[j].errorCode=="017"||errorList[j].errorCode=="018"||errorList[j].errorCode=="019"){var errorMsg='<div class="dialog-common system-error"><p class="tips"><i class="tip-icon tip-warning-24"></i>'+errorList[j].errorMessage+'</p><a href="javascript:void(0)" class="dialog-opt dialog-certain close">知道了</a></div>';$.mLionDialog({css:{width:"436px"},title:"温馨提示",http:function(e,o){e.find(".content").html(errorMsg)},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300});return}else{if(errorList[j].cmmdtyCode!=""&&errorList[j].cmmdtyCode!="undefined"&&errorList[j].cmmdtyCode!=undefined){itemLi+='<li class="list"><a target="_blank"  name="icart1_opeerror_pic"  href="'+productDomain+"/"+errorList[j].shopCode+"/"+errorList[j].cmmdtyCode+'.html"><img alt="'+cmmdtyObject[errorList[j].cmmdtyCode]+'" src="'+imgUrl+"/"+errorList[j].cmmdtyCode.substr(0,14)+"/"+errorList[j].cmmdtyCode+"/"+errorList[j].cmmdtyCode+'_ls1.jpg"></a><p class="pro-name"><a class="item-title" name="icart1_opeerror_name" title="'+cmmdtyObject[errorList[j].cmmdtyCode]+'" target="_blank"  href="'+productDomain+"/"+errorList[j].shopCode+"/"+errorList[j].cmmdtyCode+'.html">'+cmmdtyObject[errorList[j].cmmdtyCode]+"</a></p></li>"}}}}if(!isHasOverCart){itemLi+='</ul></div><a href="javascript:void(0)" class="dialog-opt dialog-certain close">知道了</a></div>'}$.mLionDialog({css:{width:"436px"},title:"温馨提示",http:function(e,o){e.find(".content").html(itemLi);var proLen=$(".limit-buy .list-box li").length,arr=$(".limit-buy .arr");if(proLen>=2){cartListLoop.listloop({wrap:".limit-buy",loopBox:".list-box",step:{wide:2,narrow:2},scrollWidth:{wide:304,narrow:304},hasLabel:false,isRandom:false})}else{if(proLen==1){$(".limit-buy .list-box li").addClass("one");arr.hide()}}},overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300})}}}function changeBuy_jsonpCallback(json,options,tipDom,targetDom,tipFn,activityId){if(json.isSuccess=="1"&&json.cmmdtyList&&json.cmmdtyList.length>0){var region=json.cmmdtyList;var size=region.length;var html='<ul class="list">';for(var i=0;i<size;i++){var index=i+1;html+=getItemLi_changeBuy(region[i],index,activityId)}html+="</ul>";var innerHtml=$($(targetDom.data().clonenode).clone().html());innerHtml.find(".list-box").html(html);tipDom.find(".ui-tooltip-inner").html(innerHtml);tipFn.position(options,tipDom,targetDom);cloudCart1.runAnalyseExpo()}else{var errorType="1";tipDom.find(".ui-tooltip-inner").html("<p class='message c-error' style='padding: 4px 6px;'><i class='tip-icon tip-error mr5 l'></i><span>换购商品已卖完，下次要早点哦！</span></p>");sa.openAPI.sendMessage("ChangeBuySN",json.isSuccess+"&&"+errorType+"&&"+json.errorDesc+"（"+activityId+"）&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("ChangeBuySN",errorType,json.isSuccess,json.errorDesc+"（"+activityId+"）")}}function changeBuyCshop_jsonpCallback(json,options,tipDom,targetDom,tipFn,activityId){if(json.isSuccess=="1"&&json.cmmdtyList&&json.cmmdtyList.length>0){var region=json.cmmdtyList;var size=region.length;var html='<ul class="list">';for(var i=0;i<size;i++){var index=i+1;html+=getItemLi_changeBuyForCshop(region[i],index,activityId)}html+="</ul>";var innerHtml=$($(targetDom.data().clonenode).clone().html());innerHtml.find(".list-box").html(html);tipDom.find(".ui-tooltip-inner").html(innerHtml);tipFn.position(options,tipDom,targetDom);cloudCart1.runAnalyseExpo()}else{tipDom.find(".ui-tooltip-inner").html("<p class='message c-error' style='padding: 4px 6px;'><i class='tip-icon tip-error mr5 l'></i><span>换购商品已卖完，下次要早点哦！</span></p>");var errorType="1";sa.openAPI.sendMessage("ChangeBuyCshop",json.isSuccess+"&&"+errorType+"&&"+json.errorDesc+"（"+activityId+"）&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("ChangeBuyCshop",errorType,json.isSuccess,json.errorDesc+"（"+activityId+"）")}}function getItemLi_changeBuyForCshop(item,b,activityId){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;if((b%2)==0){itemLi.push("<li class>")}else{itemLi.push("<li>")}itemLi.push('<div class="cart-checkbox">');itemLi.push('<input type="checkbox"  class="checkbox chk-item" id="J_CheckBox_hg'+b+'" cmmdtyCode="'+item.partNumber+'" shopCode="'+item.sellerNo+'" cmmdtyName="'+item.partName+'" salesPrice="'+item.tradePartSePrice+'" activityId="'+activityId+'" name="icart1_yhhg_hgspgx">');itemLi.push('<label for="J_CheckBox_hg'+b+'"></label>');itemLi.push("</div>");itemLi.push('<div class="item-pic">');itemLi.push("<a href="+productDomain+"/"+item.sellerNo+"/"+dealPreZeroPartnum(item.partNumber)+'.html target="_blank"><img name="icart1_yhhg_hgspp" src="'+imgUrl+"/"+item.sellerNo+"-"+item.partNumber+'_1_160x160.jpg" /></a>');itemLi.push("</div>");itemLi.push('<div class="item-info">');itemLi.push('<a href="'+productDomain+"/"+item.sellerNo+"/"+dealPreZeroPartnum(item.partNumber)+'.html" class="item-title" target="_blank"title="'+item.partName+'">'+item.partName+"</a>");itemLi.push('<b class="sn-price"><i>&yen;</i>'+item.tradePartSePrice+"</em></b>");if(typeof(item.price)!="undefined"&&item.price!=""){itemLi.push('<span class="or-price"><i>¥</i><em>'+item.price+"</em></span>")}itemLi.push("</div>");itemLi.push("</li>");return itemLi.join("")}function getItemLi_changeBuy(item,b,activityId){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;if((b%2)==0){itemLi.push("<li class>")}else{itemLi.push("<li>")}itemLi.push('<div class="cart-checkbox">');itemLi.push('<input type="checkbox"  class="checkbox chk-item" id="J_CheckBox_hg'+b+'" cmmdtyCode="'+item.partNumber+'" shopCode="'+item.sellerNo+'" cmmdtyName="'+item.partName+'" salesPrice="'+item.tradePartSePrice+'" activityId="'+activityId+'">');itemLi.push('<label for="J_CheckBox_hg'+b+'"></label>');itemLi.push("</div>");itemLi.push('<div class="item-pic">');itemLi.push("<a href="+productDomain+"/"+item.sellerNo+"/"+dealPreZeroPartnum(item.partNumber)+'.html target="_blank"><img src="'+imgUrl+"/"+item.sellerNo+"-"+item.partNumber+'_1_160x160.jpg" /></a>');itemLi.push("</div>");itemLi.push('<div class="item-info">');itemLi.push('<a href="'+productDomain+"/"+item.sellerNo+"/"+dealPreZeroPartnum(item.partNumber)+'.html" class="item-title" target="_blank" title="'+item.partName+'" title="'+item.partName+'">'+item.partName+"</a>");itemLi.push('<b class="sn-price"><i>&yen;</i>'+item.tradePartSePrice+"</em></b>");if(typeof(item.price)!="undefined"&&item.price!=""){itemLi.push('<span class="or-price"><i>&yen;</i><em>'+item.price+"</em></span>")}itemLi.push("</div>");itemLi.push("</li>");return itemLi.join("")}function similarCmmdty_jsonpCallback(json,options,tipDom,targetDom,tipFn){var region=json.sugGoods[0].skus;var size=region.length;if(size==0){tipDom.removeClass("alike-prolist-tip");tipDom.find(".ui-tooltip-inner").css("width","230px");tipDom.find(".ui-tooltip-inner").html("<p class='message c-error' style='padding: 4px 6px;'><i class='tip-icon tip-error mr5 l'></i><span>相似商品已卖完，下次要早点哦！</span></p>");return}tipDom.addClass("alike-prolist-tip");tipDom.find(".ui-tooltip-inner").css("width","auto");var html="";for(var i=0;i<size;i++){var index=i+1;html+=getItemLi_similarCmmdty(size,index,region[i].sugGoodsId,region[i].sugGoodsCode,region[i].sugGoodsName,region[i].sugGoodsDes,region[i].price,region[i].handwork,region[i].vendorId,region[i].promotionType)}var innerHtml=$($(targetDom.data().clonenode).clone().html());innerHtml.find(".list-box").html(html);tipDom.find(".ui-tooltip-inner").html(innerHtml);tipDom.find(".J-alike-pro").attr("data-alike",targetDom.attr("id"));cloudCart1.runAnalyseExpo()}function getItemLi_similarCmmdty(a,b,c,d,e,f,g,h,i,j){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;itemLi.push('<li class="list" >');itemLi.push('<a name="cart1_'+d+"_recgwzs_"+positionIndex+"_p_"+i+"_"+d+"_"+h+'" href='+productDomain+"/"+i+"/"+dealPreZeroPartnum(d)+".html?src=cart1_"+d+"_recgwzs_"+positionIndex+"_p_"+i+"_"+d+"_"+h+' target="_blank"><img src="'+imgUrl+"/"+i+"-"+d+'_1_200x200.jpg" class="product-img"/></a>');itemLi.push("<p ><a href="+productDomain+"/"+i+"/"+dealPreZeroPartnum(d)+".html?src=cart1_"+d+"_recgwzs_"+positionIndex+"_c_"+i+"_"+d+"_"+h+' class="product-content" target="_blank" id="baoguang_recgwzs_'+positionIndex+"_"+i+"_"+d+"_"+h+'" name="cart1_'+d+"_recgwzs_"+positionIndex+"_c_"+i+"_"+d+"_"+h+'" title="'+e+'">'+e+"<b>"+f+"</b></a></p>");if(typeof g!="undefined"&&g!=""){var arrPrice=g.split(".");var tempHtml='<p class="product-price sn-price clearfix"><i class="price-icon l">&yen;</i><em class="price-big l">'+arrPrice[0]+"</em>";if(typeof(arrPrice[1])!="undefined"&&arrPrice[1]!=""){tempHtml+='<em class="price-small l">.'+arrPrice[1]+"</em></p>"}else{tempHtml+='<em class="price-small l">.00</em></p>'}itemLi.push(tempHtml)}else{itemLi.push('<p class="product-price sn-price clearfix"><i class="price-icon l"></i><em class="price-big l"></em><em class="price-small l"></em></p>')}var shopcode=i;if(j=="14"){shopcode="0000000000"}itemLi.push('<em class="add-cart" cmmdtyCode="'+d+'" shopCode="'+shopcode+'" name="cart1_'+d+"_recgwzs_"+positionIndex+"_b_"+i+"_"+d+"_"+h+'"></em>');itemLi.push("</li>");return itemLi.join("")}function supportChangeBuy_jsonpCallback(json,options,tipDom,targetDom,tipFn){var region=json.sugGoods[0].skus;var size=region.length;if(size==0){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipEmpty);var activityId=targetDom.attr("promotionId");sa.openAPI.sendMessage("SupportChangeBuy","0&&1&&换购推荐数据空（"+activityId+"）&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("SupportChangeBuy","1","0","换购推荐数据空（"+activityId+"）");return}var html='<ul class="list">';for(var i=0;i<size;i++){var index=i+1;html+=getItemLi_supportChangeBuycoudan(region[i].sugGoodsId,index,region[i].sugGoodsCode,region[i].sugGoodsName,region[i].sugGoodsDes,region[i].price,region[i].handwork,region[i].vendorId);if((i+1)%9==0&&(i+1)!=size){html+="</ul>";html+='<ul class="list">'}}html+="</ul>";var innerHtml=$($(targetDom.data().clonenode).clone().html());innerHtml.find(".list-box").html(html);tipDom.find(".ui-tooltip-inner").html(innerHtml);tipFn.position(options,tipDom,targetDom);var dataListloop=targetDom.data("listloop");cartListLoop.listloop({wrap:".ui-tooltip ."+dataListloop,loopBox:".list-box",step:{wide:1,narrow:1},scrollWidth:{wide:639,narrow:639},hasLabel:true,isRandom:false,hoverArr:true});cloudCart1.runAnalyseExpo()}function getItemLi_supportChangeBuycoudan(a,b,c,d,e,f,g,h){var imgUrl=$("#imgNewUrl").val();var productDomain="//product.suning.com";var itemLi=[];var positionIndex=(Math.floor((b-1)/9)+1);var index=b-(positionIndex-1)*9;positionIndex=positionIndex+"-"+index;itemLi.push("<li>");itemLi.push('<div class="cart-checkbox">');itemLi.push('<input type="checkbox"  class="checkbox chk-item" id="J_CheckBox_hg'+b+'" cmmdtyCode="'+c+'" shopCode="'+h+'" cmmdtyName="'+d+'" salesPrice="'+f+'">');itemLi.push('<label for="J_CheckBox_hg'+b+'"></label>');itemLi.push("</div>");itemLi.push('<div class="item-pic">');if(h=="0000000000"){itemLi.push('<a name="cart1_'+c+"_reccdsp_"+positionIndex+"_p_"+h+"_"+c+"_"+g+'" href='+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_reccdsp_"+positionIndex+"_p_"+h+"_"+c+"_"+g+' target="_blank"><img src="'+imgUrl+"/"+h+"-"+c+'_1_160x160.jpg" /></a>')}else{itemLi.push('<a name="cart1_'+c+"_recccdsp_"+positionIndex+"_p_"+h+"_"+c+"_"+g+'" href='+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_recccdsp_"+positionIndex+"_p_"+h+"_"+c+"_"+g+' target="_blank"><img src="'+imgUrl+"/"+h+"-"+c+'_1_160x160.jpg" /></a>')}itemLi.push("</div>");itemLi.push('<div class="item-info">');if(h=="0000000000"){itemLi.push('<a href="'+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_recccd_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" class="item-title" target="_blank" id="baoguang_reccdsp_'+positionIndex+"_"+h+"_"+c+"_"+g+'" title="'+d+'" name="cart1_'+c+"_reccdsp_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" title="'+d+'">'+d+"</a>")}else{itemLi.push('<a href="'+productDomain+"/"+h+"/"+dealPreZeroPartnum(c)+".html?src=cart1_"+c+"_recccdsp_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" class="item-title" target="_blank" id="baoguang_recccdsp_'+positionIndex+"_"+h+"_"+c+"_"+g+'" title="'+d+'" name="cart1_'+c+"_recccdsp_"+positionIndex+"_c_"+h+"_"+c+"_"+g+'" title="'+d+'">'+d+"</a>")}if(f!="undefined"&&f!=""){itemLi.push('<b class="sn-price"><i>&yen;</i>'+f+"</em></b>")}else{itemLi.push('<b class="sn-price"><i></i></em></b>')}itemLi.push("</div>");itemLi.push("</li>");return itemLi.join("")}function coudanAddCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyCmmdtyCodeArray,obj){addCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyCmmdtyCodeArray,"","",recommendCallBack);function recommendCallBack(data){var errorList=data.addCartErrorList;if(data.isSuccess=="Y"){$.ajax({type:"GET",dataType:"jsonp",url:"addCallBack.do",crossDomain:true,success:function(data){if(data.result=="true"&&data.html!=""){cloudCart1.refreshPage(data);if(typeof($("#newFreightGray").val())!="undefined"&&$("#newFreightGray").val()=="true"){if($(".sp-meet-cut-select").find(".fare-merge-order").attr("data-meet-cut")=="meetCut0000000000"){$(".sp-meet-cut-select").find(".fare-info-tip").remove();$(".sp-meet-cut-select").find(".fare-merge-order").before($("#meet-cut-0000000000").find(".fare-info-tip").clone())}}var tipDom=$(obj.parents(".sp-meet-cut-select"));var targetDom=$("#"+tipDom.find(".fare-merge-order").attr("data-meet-cut"));if(tipDom.length>0&&targetDom.length>0){st.tooltipNew.position("",tipDom,targetDom);tipDom.css("margin-top","1px")}var promotionid=$(obj.parents(".list-box")).attr("promotionid");if(promotionid!=undefined){var eventId="#"+shopCode+"-"+promotionid;var tipChoudan=$(data.html).find(".fare-merge-order").find(".content-title").find(eventId).html();var spanObj=$(obj.parents(".add-on-container")).find(eventId);if(tipChoudan!=undefined){spanObj.html(tipChoudan)}else{if(typeof spanObj!=undefined){spanObj.html("已满足包邮活动")}}}}}});cloudCart1.recommendFn.successFn(obj)}else{if(errorList.length>0){if(errorList[0].errorCode=="002"){cloudCart1.recommendFn.errorFn(obj,"购物车已满，请去清理一下吧")}else{if(errorList[0].errorCode=="003"){cloudCart1.recommendFn.errorFn(obj,"此商品暂不销售")}else{if(errorList[0].errorCode=="004"){cloudCart1.recommendFn.errorFn(obj,"此商品无货")}else{if(errorList[0].errorCode=="017"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M017)")}else{if(errorList[0].errorCode=="018"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M018)")}else{if(errorList[0].errorCode=="019"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M019)")}else{cloudCart1.recommendFn.errorFn(obj,"请前往详情页面购买")}}}}}}}else{cloudCart1.recommendFn.errorFn(obj,"请前往详情页面购买")}}}}function querySimilarAddCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyCmmdtyCodeArray,obj){addCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyCmmdtyCodeArray,"","",recommendCallBack);function recommendCallBack(data){var errorList=data.addCartErrorList;if(data.isSuccess=="Y"){$.ajax({type:"GET",dataType:"jsonp",url:"addCallBack.do",crossDomain:true,success:function(data){if(data.result=="true"&&data.html!=""){cloudCart1.refreshPage(data);var tipDom=$(obj.parents(".alike-prolist-tip"));var targetDom=$("#"+tipDom.find(".J-alike-pro").attr("data-alike"));if(tipDom.length>0&&targetDom.length>0){$(targetDom).closest(".item").addClass("opt-hover");targetDom.addClass("alike-click-on");tipDom.find(".ui-tooltip-inner").css("width","185px");st.tooltipNew.position("",tipDom,targetDom);tipDom.find(".ui-tooltip-inner").css("width","auto")}}}});cloudCart1.recommendFn.successFn(obj)}else{if(errorList.length>0){if(errorList[0].errorCode=="002"){cloudCart1.recommendFn.errorFn(obj,"购物车已满，请去清理一下吧")}else{if(errorList[0].errorCode=="003"){cloudCart1.recommendFn.errorFn(obj,"此商品暂不销售")}else{if(errorList[0].errorCode=="004"){cloudCart1.recommendFn.errorFn(obj,"此商品无货")}else{if(errorList[0].errorCode=="017"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M017)")}else{if(errorList[0].errorCode=="018"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M018)")}else{if(errorList[0].errorCode=="019"){cloudCart1.recommendFn.errorFn(obj,"此商品销售异常火爆(M019)")}else{cloudCart1.recommendFn.errorFn(obj,"请前往详情页面购买")}}}}}}}else{cloudCart1.recommendFn.errorFn(obj,"请前往详情页面购买")}}}}function dealPreZeroPartnum(str){var rg=new RegExp("^0*");return str.replace(rg,"")};var commPartnumber="";var recommendProductInfo="";function addCart(sourcePageType,activityType,activityId,cmmdtyCode,shopCode,cmmdtyQty,warrantyInfo,cmmdtyKind,overSeaFlag,callback){var newCmmdtyCode=buildCmmdtyCode(cmmdtyCode);var cart=new Object();var cmmdtyArray=new Array();var cmmdty=new Object();cmmdty.activityType=activityType;cmmdty.activityId=activityId;cmmdty.cmmdtyCode=newCmmdtyCode;cmmdty.shopCode=shopCode;cmmdty.cmmdtyQty=cmmdtyQty;cmmdty.overSeaFlag=overSeaFlag;var cmmdtyWarranty=new Array();var warrantyArray=warrantyInfo.split(",");if(warrantyArray!=""){for(var i=0;i<warrantyArray.length;i++){var cmmdtyWarrantyObject=new Object();cmmdtyWarrantyObject.cmmdtyCode=warrantyArray[i];cmmdtyWarrantyObject.cmmdtyQty="1";cmmdtyWarranty[i]=cmmdtyWarrantyObject}}cmmdty.cmmdtyWarranty=cmmdtyWarranty;cmmdtyArray[0]=cmmdty;if(typeof(bd)!="undefined"){setCookie("c2dt",bd.rst())}cart.cmmdty=cmmdtyArray;var cartVO=cartObject2Json(cart);$.ajax({type:"get",url:"addCart.do",data:{cartVO:cartVO},cache:false,crossDomain:true,dataType:"jsonp",success:function(result){if(callback){callback(result)}else{if(result.isSuccess=="Y"){commPartnumber=newCmmdtyCode;var custNum=$.cookie("custno");var visiterId=$.cookie("_snma");var arr=new Array();if(typeof visiterId!="undefined"&&visiterId&&visiterId!="undefined"){arr=visiterId.split("|")}alsoBuy($.cookie("cityId"),cmmdtyKind,custNum,arr[1])}else{var msg="";for(var i=0;i<result.addCartErrorList.length;i++){msg+=result.addCartErrorList[i].errorMessage}alert(msg)}}}})}function addCartBatch(cart,callback){if(typeof(bd)!="undefined"){setCookie("c2dt",bd.rst())}var cartVOInfo=cartObject2Json(cart);$.ajax({type:"get",dataType:"jsonp",url:"addCart.do",data:{cartVO:cartVOInfo},cache:false,async:false,crossDomain:true,success:function(result){if(callback){callback(result)}else{if(result.isSuccess=="Y"){window.location.href="cart.do"}else{var msg="";for(var i=0;i<result.addCartErrorList.length;i++){msg+=result.addCartErrorList[i].errorMessage}alert(msg)}}}})}function setCookie(keyStr,valStr){var v3=window.location.href;v3=v3.substring(v3.indexOf("//")+2);v3=v3.substring(0,v3.indexOf("/"));if(v3.indexOf(".")>0){v3=v3.substring(v3.indexOf("."))}var domain=v3;var path="/";var str=keyStr+"="+encodeURIComponent(valStr)+";domain="+domain+";path="+path;document.cookie=str};function againBuy(cmmdtyInfo,tipDom,targetDom){var loginTag=$("#loginSign").val();if(loginTag=="true"){probeAuthStatus(function(){againBuyMethod(cmmdtyInfo,tipDom,targetDom)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){window.location.href="cart.do"})}})}else{againBuyMethod(cmmdtyInfo,tipDom,targetDom)}}function againBuyMethod(cmmdtyInfo,tipDom,targetDom){var itemTag=0;var cart={};cart.sourcePageType="05";var cmmdty=new Array();var cmmdtyObjetc={};var childCmmdty=new Array();if(typeof(cmmdtyInfo)!="undefined"){for(var i=0;i<cmmdtyInfo.length;i++){if(typeof(cmmdtyInfo[i].activityType)!="undefined"&&cmmdtyInfo[i].activityType.length>0){cmmdtyObjetc.headerItemNo=itemTag;cmmdtyObjetc.activityType=attribute2Value(cmmdtyInfo[i].activityType);cmmdtyObjetc.activityId=attribute2Value(cmmdtyInfo[i].activityId);itemTag+=1;cmmdtyObjetc.itemNo=itemTag;cmmdtyObjetc.cmmdtyCode=buildCmmdtyCode(attribute2Value(cmmdtyInfo[i].cmmdtyCode));cmmdtyObjetc.cmmdtyName=attribute2Value(cmmdtyInfo[i].cmmdtyName);cmmdtyObjetc.shopCode=attribute2Value(cmmdtyInfo[i].shopCode);cmmdtyObjetc.shopName=attribute2Value(cmmdtyInfo[i].shopName);cmmdtyObjetc.cmmdtyQty=attribute2Value(cmmdtyInfo[i].cmmdtyQty);cmmdtyObjetc.carShopSerWay=attribute2Value(cmmdtyInfo[i].carShopSerWay);cmmdtyObjetc.carShopCode=attribute2Value(cmmdtyInfo[i].carShopCode);cmmdtyObjetc.serviceStoreName=attribute2Value(cmmdtyInfo[i].serviceStoreName);cmmdtyObjetc.serviceStoreCode=attribute2Value(cmmdtyInfo[i].serviceStoreCode);cmmdtyObjetc.commodityType=attribute2Value(cmmdtyInfo[i].commodityType)}if(typeof(cmmdtyInfo[i].activityType)=="undefined"||cmmdtyInfo[i].activityType==""||cmmdtyInfo[i].activityType.length==0){var childCmmdtyObject={};itemTag+=1;childCmmdtyObject.itemNo=itemTag;childCmmdtyObject.cmmdtyCode=buildCmmdtyCode(attribute2Value(cmmdtyInfo[i].cmmdtyCode));childCmmdtyObject.cmmdtyName=attribute2Value(cmmdtyInfo[i].cmmdtyName);childCmmdtyObject.cmmdtyQty=attribute2Value(cmmdtyInfo[i].cmmdtyQty);childCmmdtyObject.accessoryRelationID=attribute2Value(cmmdtyInfo[i].accessoryRelationID);childCmmdtyObject.carShopSerWay=attribute2Value(cmmdtyInfo[i].carShopSerWay);childCmmdtyObject.carShopCode=attribute2Value(cmmdtyInfo[i].carShopCode);if(typeof(cmmdtyInfo[i].childCmmdtyWarrantyVOList)!="undefined"&&cmmdtyInfo[i].childCmmdtyWarrantyVOList.length>0){childCmmdtyWarrantyObject={};var warrayArray=cmmdtyInfo[i].childCmmdtyWarrantyVOList;var childCmmdtyWarrantyArray=new Array();for(var j=0;j<warrayArray.length;j++){itemTag+=1;childCmmdtyWarrantyObject.itemNo=itemTag;childCmmdtyWarrantyObject.cmmdtyCode=warrayArray[j].cmmdtyCode;childCmmdtyWarrantyObject.cmmdtyQty=warrayArray[j].cmmdtyQty;childCmmdtyWarrantyObject.supplierCode=warrayArray[j].supplierCode;childCmmdtyWarrantyObject.isCollocation=warrayArray[j].isCollocation;childCmmdtyWarrantyArray.push(childCmmdtyWarrantyObject)}childCmmdtyObject.childCmmdtyWarranty=childCmmdtyWarrantyArray}childCmmdty[childCmmdty.length]=childCmmdtyObject}}cmmdtyObjetc.childCmmdty=childCmmdty}cmmdty[0]=cmmdtyObjetc;cart.cmmdty=cmmdty;var requestData=cartObject2Json(cart);if(typeof(bd)!="undefined"){setCookie("c2dt",bd.rst())}$.ajax({type:"GET",contentType:"application/json;charset=utf-8",dataType:"json",url:"againBuy.do",data:{cartVOInfo:requestData},success:function(data){againBuyMethodBack(data,tipDom,targetDom)},error:function(){tipDom.find(".ui-tooltip-inner").html(cloudCart1.cartRemoved.tpl.tipError)}})}function againBuyMethodBack(data,tipDom,targetDom){if(data.result=="false"){tipDom.find(".ui-tooltip-inner").html("加入失败了，请稍后尝试");return false}cloudCart1.cartRemoved.reomveRepurchaseBoxProduct(targetDom);st.tooltipNew.allHide();cloudCart1.refreshPage(data)}function setCookie(keyStr,valStr){var v3=window.location.href;v3=v3.substring(v3.indexOf("//")+2);v3=v3.substring(0,v3.indexOf("/"));if(v3.indexOf(".")>0){v3=v3.substring(v3.indexOf("."))}var domain=v3;var path="/";var str=keyStr+"="+encodeURIComponent(valStr)+";domain="+domain+";path="+path;document.cookie=str};function attribute2Value(attribute){if(typeof(attribute)!="undefined"){return attribute}else{return""}}function cartObject2Json(cart){var jsonStr="";if(cart!=""){jsonStr+="{";jsonStr+='"sourcePageType":"'+attribute2Value(cart.sourcePageType)+'",';jsonStr+='"cmmdtyVOList":[';if(typeof(cart.cmmdty)!="undefined"){for(var i=0;i<cart.cmmdty.length;i++){jsonStr+="{";jsonStr+='"headerItemNo":"'+attribute2Value(cart.cmmdty[i].headerItemNo)+'",';jsonStr+='"activityType":"'+attribute2Value(cart.cmmdty[i].activityType)+'",';jsonStr+='"activityId":"'+attribute2Value(cart.cmmdty[i].activityId)+'",';jsonStr+='"itemNo":"'+attribute2Value(cart.cmmdty[i].itemNo)+'",';jsonStr+='"cmmdtyCode":"'+buildCmmdtyCode(attribute2Value(cart.cmmdty[i].cmmdtyCode))+'",';jsonStr+='"shopCode":"'+attribute2Value(cart.cmmdty[i].shopCode)+'",';jsonStr+='"shopName":"'+attribute2Value(cart.cmmdty[i].shopName)+'",';jsonStr+='"cmmdtyQty":"'+attribute2Value(cart.cmmdty[i].cmmdtyQty)+'",';jsonStr+='"carShopSerWay":"'+attribute2Value(cart.cmmdty[i].carShopSerWay)+'",';jsonStr+='"carShopCode":"'+attribute2Value(cart.cmmdty[i].carShopCode)+'",';jsonStr+='"serviceStoreName":"'+attribute2Value(cart.cmmdty[i].serviceStoreName)+'",';jsonStr+='"serviceStoreCode":"'+attribute2Value(cart.cmmdty[i].serviceStoreCode)+'",';jsonStr+='"commodityType":"'+attribute2Value(cart.cmmdty[i].commodityType)+'",';jsonStr+='"cmmdtyWarrantyVOList":[';if(typeof(cart.cmmdty[i].cmmdtyWarranty)!="undefined"){var jsonStrTemp="";for(var n=0;n<cart.cmmdty[i].cmmdtyWarranty.length;n++){jsonStrTemp+="{";jsonStrTemp+='"itemNo":"'+attribute2Value(cart.cmmdty[i].cmmdtyWarranty[n].itemNo)+'",';jsonStrTemp+='"cmmdtyCode":"'+buildCmmdtyCode(attribute2Value(cart.cmmdty[i].cmmdtyWarranty[n].cmmdtyCode))+'",';jsonStrTemp+='"cmmdtyQty":"'+attribute2Value(cart.cmmdty[i].cmmdtyWarranty[n].cmmdtyQty)+'"';jsonStrTemp+="},"}jsonStrTemp=jsonStrTemp.substring(0,(jsonStrTemp.length-1));jsonStr+=jsonStrTemp}jsonStr+="],";jsonStr+='"childCmmdtyVOList":[';if(typeof(cart.cmmdty[i].childCmmdty)!="undefined"){var jsonStrChildTemp="";for(var m=0;m<cart.cmmdty[i].childCmmdty.length;m++){jsonStrChildTemp+="{";jsonStrChildTemp+='"itemNo":"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].itemNo)+'",';jsonStrChildTemp+='"cmmdtyCode":"'+buildCmmdtyCode(attribute2Value(cart.cmmdty[i].childCmmdty[m].cmmdtyCode))+'",';jsonStrChildTemp+='"cmmdtyQty":"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].cmmdtyQty)+'",';jsonStrChildTemp+='"shopCode":"'+attribute2Value(cart.cmmdty[i].shopCode)+'",';jsonStrChildTemp+='"shopName":"'+attribute2Value(cart.cmmdty[i].shopName)+'",';jsonStrChildTemp+='"accessoryRelationID":"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].accessoryRelationID)+'",';jsonStrChildTemp+='"carShopSerWay":"'+attribute2Value(cart.cmmdty[i].carShopSerWay)+'",';jsonStrChildTemp+='"carShopCode":"'+attribute2Value(cart.cmmdty[i].carShopCode)+'",';jsonStrChildTemp+='"childCmmdtyWarrantyVOList":[';if(typeof(cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty)!="undefined"){var jsonStrChildWarrantyTemp="";for(var t=0;t<cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty.length;t++){jsonStrChildWarrantyTemp+="{";jsonStrChildWarrantyTemp+='"itemNo":"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty[t].itemNo)+'",';jsonStrChildWarrantyTemp+='"cmmdtyCode":"'+buildCmmdtyCode(attribute2Value(cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty[t].cmmdtyCode))+'",';jsonStrChildWarrantyTemp+='"cmmdtyQty":"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty[t].cmmdtyQty)+'",';jsonStrChildWarrantyTemp+='"supplierCode":"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty[t].supplierCode)+'",';jsonStrChildWarrantyTemp+='isCollocation:"'+attribute2Value(cart.cmmdty[i].childCmmdty[m].childCmmdtyWarranty[t].isCollocation)+'"';jsonStrChildWarrantyTemp+="},"}jsonStrChildWarrantyTemp=jsonStrChildWarrantyTemp.substring(0,(jsonStrChildWarrantyTemp.length-1));jsonStrChildTemp+=jsonStrChildWarrantyTemp}jsonStrChildTemp+="]},"}jsonStrChildTemp=jsonStrChildTemp.substring(0,(jsonStrChildTemp.length-1));jsonStr+=jsonStrChildTemp}jsonStr+="]},"}jsonStr=jsonStr.substring(0,(jsonStr.length-1))}jsonStr+="]}";return jsonStr}else{return"{}"}}function buildCmmdtyCode(cmmdtyCode){if(cmmdtyCode.length==9){return"000000000"+cmmdtyCode}else{return cmmdtyCode}}function shoppingCartPopBox(commPartnumber){$.mDialog({css:{width:"460px"},http:function(e,o){if(recommendProductInfo==undefined||recommendProductInfo==""){var data='<div class="pop-car-win"><div class="pop-content">';data+='<div class="pop-success no-products"><h4><b></b>添加成功！</h4>';data+='<div class="clearfix"><a name="icart1_ope_buy02" href="javascript:void(0)" class="car-btn shopping-btn close l"><span>继续购物</span></a>';data+='<a name="icart1_ope_buy01" href="javascript:toShoppingCart();" class="car-btn account-btn close"><span>去购物车结算</span></a></div>';data+="</div>";data+="</div></div>";recommendProductInfo=data}e.find(".content").html(recommendProductInfo);e.find(".btn.close").attr("name","prd_"+(commPartnumber).substring(9,18)+"_gwctk_guanbi")},overlayClick:true,overlayCss:{background:"black",opacity:"0.3"},fadeIn:300,fadeOut:300})}function toShoppingCart(){window.location.href="cart.do"}function alsoBuy(cityId,cmmdtyKind,custNum,visiterId){if(cityId=="undefined"){cityId="9173"}var _url="";if(custNum!=undefined&&custNum!=""){if(cmmdtyKind=="0"){_url="//tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp?parameter="+commPartnumber+"&cityId="+cityId+"&sceneIds=10-11&count=5&u="+custNum+"&c="+visiterId}else{if(cmmdtyKind=="1"){_url="//tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp?parameter="+commPartnumber+"&cityId="+cityId+"&sceneIds=10-12&count=5&u="+custNum+"&c="+visiterId}}}else{if(cmmdtyKind=="0"){_url="//tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp?parameter="+commPartnumber+"&cityId="+cityId+"&sceneIds=10-11&count=5&c="+visiterId}else{if(cmmdtyKind=="1"){_url="//tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp?parameter="+commPartnumber+"&cityId="+cityId+"&sceneIds=10-12&count=5&c="+visiterId}}}$.ajax({url:_url,cache:true,dataType:"jsonp",jsonpCallback:"recommendData",success:function(){}})}function recommendData(jsondata){var sugGoodsList=jsondata.sugGoods;$.each(sugGoodsList,function(i,sugGoods){if(sugGoods.resCode!="02"){recommendProductInit(sugGoods)}shoppingCartPopBox(commPartnumber)})}function recommendProductInit(item){var data='<div class="pop-car-win"><div class="pop-content">';if(item.skus!=undefined&&item.skus.length>=4){data+='<div class="pop-success"><h4><b></b>添加成功！</h4>';data+='<div class="clearfix"><a name="icart1_ope_buy02" href="javascript:void(0)" class="car-btn shopping-btn close l"><span>继续购物</span></a>';data+='<a name="icart1_ope_buy01" href="javascript:toShoppingCart();" class="car-btn account-btn close"><span>去购物车结算</span></a></div>';data+='<div class="pop-others"><p>买了该商品的顾客还买了</p><ul>';for(var i=0;i<4;i++){if(i==3){data+='<li class="last">'}else{data+="<li>"}data+='<a name="prd_'+(commPartnumber).substring(9,18)+"_recbuymore_1-"+(i+1)+"_p_0000000000_"+(item.skus[i].sugGoodsCode).substring(9,18)+"_"+item.skus[i].handwork+'" href="'+sn.elecProductDomain+"/0000000000/"+dealPreZeroPartnum(item.skus[i].sugGoodsCode)+".html?src=prd_"+(commPartnumber).substring(9,18)+"_recbuymore_1-"+(i+1)+"_p_0000000000_"+(item.skus[i].sugGoodsCode).substring(9,18)+"_"+item.skus[i].handwork+'" title="'+item.skus[i].sugGoodsName+'" class="picbox" target="_blank"><img src="'+sn.imageDomianDir+"/content/catentries/"+(item.skus[i].sugGoodsCode).substring(0,14)+"/"+item.skus[i].sugGoodsCode+"/"+item.skus[i].sugGoodsCode+'_ls.jpg" alt="'+item.skus[i].sugGoodsName+'" /></a>';data+='<p name="prd_'+(commPartnumber).substring(9,18)+"_recbuymore_1-"+(i+1)+"_c_0000000000_"+(item.skus[i].sugGoodsCode).substring(9,18)+"_"+item.skus[i].handwork+'" class="details"><a href="'+sn.elecProductDomain+"/0000000000/"+dealPreZeroPartnum(item.skus[i].sugGoodsCode)+".html?src=prd_"+(commPartnumber).substring(9,18)+"_recbuymore_1-"+(i+1)+"_c_0000000000_"+(item.skus[i].sugGoodsCode).substring(9,18)+"_"+item.skus[i].handwork+'" title="'+item.skus[i].sugGoodsName+'" target="_blank">'+item.skus[i].sugGoodsName+"</a></p>";data+='<span class="snPrice"><i>¥</i><em>'+item.skus[i].price+"</em></span>";data+="</li>"}data+="</ul></div>"}else{data+='<div class="pop-success no-products"><h4><b></b>添加成功！</h4>';data+='<div class="clearfix"><a name="icart1_ope_buy02" href="javascript:void(0)" class="car-btn shopping-btn close l"><span>继续购物</span></a>';data+='<a name="icart1_ope_buy01" href="javascript:toShoppingCart();" class="car-btn account-btn close"><span>去购物车结算</span></a></div>';data+="</div>"}data+="</div></div>";recommendProductInfo=data}function dealPreZeroPartnum(str){var rg=new RegExp("^0*");return str.replace(rg,"")};var addFavoriteItemNo;var addFavoriteItemObj;var showObject;var tipDomObject,optionsObject,tipFnObject;function add2Favorite(q,p,c,obj,tipDom,options,tipFn,tmFlag,jdlFlag){tipDom.find(".ui-tooltip-inner").html(cloudCart1.addFavFn.messageList.load);tipFn.position(options,tipDom,obj);showObject=$(obj).closest(".item,.item-sub");var o=18-(q+"").length;for(var f=0;f<o;f++){q="0"+q}if("0000000000"!=p){var s=10-(p+"").length;for(var f=0;f<s;f++){p="0"+p}}addFavoriteItemNo=c;addFavoriteItemObj=obj;tipDomObject=tipDom;optionsObject=options;tipFnObject=tipFn;mySuning.add2ProductFavorite(q,p,"shoppingCart1","addFavoriteCallBack","",tmFlag,jdlFlag)}function addFavoriteCallBack(data){if(data.returnCode==0||data.returnCode==1){if(addFavoriteItemNo!=""){tipDomObject.find(".ui-tooltip-inner").html(cloudCart1.addFavFn.messageList.success);tipFnObject.position(optionsObject,tipDomObject,addFavoriteItemObj);delProductByFavorite(addFavoriteItemNo);favoriteInit()}else{cloudCart1.tipfn.resetBtn(".add-fav","add-fav-already-click");cloudCart1.cartRemoved.reomveRepurchaseBoxProduct(addFavoriteItemObj);cloudCart1.tipfn.resetBtn(".del","add-fav-already-click")}}if(data.returnCode==-2){if(addFavoriteItemNo!=""){tipDomObject.find(".ui-tooltip-inner").html(cloudCart1.addFavFn.messageList.error);tipFnObject.position(optionsObject,tipDomObject,addFavoriteItemObj);setTimeout(function(){cloudCart1.tipfn.resetBtn(".add-fav","add-fav-already-click");cloudCart1.tipfn.resetBtn(".del","add-fav-already-click")},200)}else{if(typeof(addFavoriteItemObj)=="object"){tipDomObject.find(".ui-tooltip-inner").html(cloudCart1.addFavFn.messageList.error);tipFnObject.position(optionsObject,tipDomObject,addFavoriteItemObj);setTimeout(function(){cloudCart1.tipfn.resetBtn(".add-fav","add-fav-already-click");cloudCart1.tipfn.resetBtn(".del","add-fav-already-click")},200)}}}}function delProductByFavorite(itemNo){$.ajax({dataType:"GET",url:"deleteCartOnePro.do",dataType:"jsonp",crossDomain:true,data:{cummtyItemNos:itemNo},success:function(data){cloudCart1.tipfn.resetBtn(".add-fav","add-fav-already-click");cloudCart1.tipfn.resetBtn(".del","add-fav-already-click");cloudCart1.refreshPage(data)}})};function addWarranty(cmmdtyitemNo,cmmdtyWarranty,obj,serveCodeArray){probeAuthStatus(function(){addWarrantyMethod(cmmdtyitemNo,cmmdtyWarranty,obj,serveCodeArray)},function(){var loginSign=$("#loginSign").val();if(loginSign=="true"){ensureLogin(function(){window.location.href="cart.do"})}else{addWarrantyMethod(cmmdtyitemNo,cmmdtyWarranty,obj,serveCodeArray)}})}function addWarrantyMethod(cmmdtyitemNo,cmmdtyWarranty,obj,serveCodeArray){$.ajax({url:"updateWarranty.do",type:"GET",data:{cmmdtyitemNo:cmmdtyitemNo,cmmdtyWarranty:cmmdtyWarranty.toString(),cmmdtyServeCode:serveCodeArray.toString()},cache:false,async:false,dataType:"jsonp",crossDomain:true,success:function(data){if(data.result=="false"){$(obj).siblings(".warning-text").html("").html("<i class='tip-icon tip-error-16'></i>加入失败，请重新购买！");$(obj).siblings(".warning-text").show();return false}$(this).closest(".ui-tooltip").remove();st.tooltipNew.allHide();cloudCart1.refreshPage(data)},error:function(){$(obj).siblings(".msg-box").html("加入失败，请重新购买！")}})};function receiveFreeCoupon(activityId,activityKey,shopCode,thisObject,cityId){probeAuthStatus(function(){receiveFreeCouponMethod(activityId,activityKey,shopCode,thisObject,true,cityId)},function(){ensureLogin(function(){receiveFreeCouponMethod(activityId,activityKey,shopCode,thisObject,false,cityId)})})}function receiveFreeCouponMethod(activityId,activityKey,shopCode,thisObject,flag,cityId){var c2dt="";if(typeof bd!="undefined"&&bd&&bd!="undefined"){c2dt=bd.rst()}$.ajax({url:"receiveFreeCoupon.do",type:"post",data:{activityId:activityId,activityKey:activityKey,shopCode:shopCode,detect:encodeURIComponent(c2dt),cityId:cityId},cache:false,dataType:"json",success:function(data){var itemObject=$(thisObject).parent().parent();if(data.resultFlag=="success"){$(itemObject).find(".get").html("<span class='c9'>领取成功</span>")}else{if(data.resultFlag=="fail"){var reg=/^[0-9]+$/;if(reg.test(data.resultCode)){$(itemObject).find(".coupon-info").remove();$(itemObject).find(".get").remove();$(itemObject).find(".pro-list-show").remove();$(itemObject).find(".cart-usable-pro").remove();if(data.resultCode=="33"){$(itemObject).append("<div class='coupon-error'><p><i class='tip-icon tip-warning-16'></i>"+data.failReason+"<a class='go-clear' href='//quan.suning.com/yhq.do'>点此清理<em>></em></a></p></div>")}else{$(itemObject).append("<div class='coupon-error'><p><i class='tip-icon tip-warning-16'></i>"+data.failReason+"</p></div>")}}else{$(itemObject).find(".get").html("<span class='c9'>领取失败</span>")}sa.openAPI.sendMessage("ReceiveFreeCoupon",data.resultCode+"&&1&&"+data.failReason+"&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("ReceiveFreeCoupon","1",data.resultCode,data.failReason)}else{if(data.resultFlag=="minosControl"){$(itemObject).find(".get").html("<span class='c9'>"+data.failReason+"</span>");sa.openAPI.sendMessage("ReceiveFreeCoupon","minosControl&&1&&minosControl&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("ReceiveFreeCoupon","1","minosControl","minosControl")}}}if(!flag){window.location.href="cart.do"}},error:function(){var itemObject=$(thisObject).parent().parent();$(itemObject).find(".get").html("<span class='c9'>领取失败</span>");sa.openAPI.sendMessage("ReceiveFreeCoupon","001&&0&&领取失败&&"+getCookie("custno"));cloudCart1.sendSAMessageV3("ReceiveFreeCoupon","0","001","领取失败")}})};